
var documents = [{
    "id": 0,
    "url": "/404.html",
    "title": "404",
    "body": "404 Page not found!Please use the search bar from the bottom left or visit our homepage! "
    }, {
    "id": 1,
    "url": "/about",
    "title": "Hey, Iâ€™m an Chinese software engineer living and working in Chengdu. I love Creating the future in digital worlds, big and small.",
    "body": "My favourites::  Vim Ruby Elixir Soccer HearthStone Detective StoryMy main career::  ThoughtWorks Jinshuju. net Sudiyi (HiveBox now)"
    }, {
    "id": 2,
    "url": "/categories",
    "title": "Categories",
    "body": ""
    }, {
    "id": 3,
    "url": "/",
    "title": "Home",
    "body": "                                                                                              Hotwire: æ²¡æœ‰JavaScriptçš„Reactive Rails                         1 2 3 4 5                      :       æœ¬æ–‡å·²è·å¾—åŸä½œè€…ï¼ˆVladimir Dementyevï¼‰å’Œ Evil Martians æˆæƒè®¸å¯è¿›è¡Œç¿»è¯‘ã€‚åŸæ–‡ä»‹ç»äº† Rails çš„æœ€æ–°â€œé­”æ³•â€ï¼šHotwireã€‚è¿™ä¹Ÿæ˜¯ Vladimir Dementyev åœ¨ RailsConf 2021 ä¸Šçš„æ¼”è®²å†…å®¹ã€‚:                                                                               Mr. Z                 24 Apr 2021                                                                                                                          Tailwindcssåº•å±‚åŸºçŸ³çš„ç†å¿µ              :       Tailwindcss ä» 2019 å¹´å¼€å§‹é€æ¸åœ¨å›½å¤–çš„ Web å¼€å‘åœˆå­å†…ç››è¡Œèµ·æ¥ã€‚å›½å†…å€’æ˜¯è‡³ä»Šä»ç„¶ä¸æ¸©ä¸ç«ã€‚2020 å¹´çš„ Ruby China ä¸Šè¿‡çº¯ä¸­åšè¿‡ä¸€æ¬¡åœ¨é¡¹ç›®ä¸Šä½¿ç”¨ tailwindcss ä½“éªŒçš„æœ‰å…³æ¼”è®²ã€‚æˆ‘åœ¨ 2020 å¹´ä¹Ÿå†™è¿‡ä¸€ç¯‡æœ‰å…³çš„åšå®¢â€œåœ¨ Rails 6 ä¸­æ•´åˆ Stimulus å’Œ Tailwind CSSâ€ï¼ˆè¢«å‰è€…åœ¨æ¼”è®²ä¸­æ‰€å¼•ç”¨^_^ï¼‰ã€‚:                                                                               Mr. Z                 10 Apr 2021                                                                                                                          Hotwireä¹‹æ„å»ºTurboåº”ç”¨              :       æœ¬æ–‡æ˜¯å¯¹æ„å»º Turbo åº”ç”¨çš„å…·ä½“æè¿°ï¼ŒåŸæ–‡å‡ºè‡ªï¼šhttps://turbo. hotwire. dev/handbook/buildingã€‚:                                                                               Mr. Z                 26 Mar 2021                                                                                                                          Hotwireä¹‹ä½¿ç”¨Turbo Streamsç„•å‘æ´»åŠ›              :       æœ¬æ–‡æ˜¯å¯¹ Turbo Streams çš„è¯¦ç»†è¯´æ˜ï¼ŒåŸæ–‡å‡ºè‡ªï¼šhttps://turbo. hotwire. dev/handbook/streamsã€‚:                                                                               Mr. Z                 19 Mar 2021                                                                                                                          Hotwireä¹‹ä½¿ç”¨Turbo Frameè§£æ„é¡µé¢              :       æœ¬æ–‡æ˜¯å¯¹ Turbo Frame çš„è¯¦ç»†è¯´æ˜ï¼ŒåŸæ–‡å‡ºè‡ªï¼šhttps://turbo. hotwire. dev/handbook/framesã€‚:                                                                               Mr. Z                 16 Mar 2021                                                                                                                          Hotwireä¹‹ä½¿ç”¨Turbo Driveå¯¼èˆª              :       æœ¬æ–‡æ˜¯å¯¹ Turbo Drive çš„è¯¦ç»†è¯´æ˜ï¼ŒåŸæ–‡å‡ºè‡ªï¼šhttps://turbo. hotwire. dev/handbook/driveã€‚:                                                                               Mr. Z                 13 Mar 2021                                   &laquo;        1        2        3        4        5        6        7        8        9       &raquo; "
    }, {
    "id": 4,
    "url": "/page2/",
    "title": "Home",
    "body": "  {% for post in paginator. posts %}    {% include postbox. html %}  {% endfor %}  {% include pagination. html %}"
    }, {
    "id": 5,
    "url": "/page3/",
    "title": "Home",
    "body": "  {% for post in paginator. posts %}    {% include postbox. html %}  {% endfor %}  {% include pagination. html %}"
    }, {
    "id": 6,
    "url": "/page4/",
    "title": "Home",
    "body": "  {% for post in paginator. posts %}    {% include postbox. html %}  {% endfor %}  {% include pagination. html %}"
    }, {
    "id": 7,
    "url": "/page5/",
    "title": "Home",
    "body": "  {% for post in paginator. posts %}    {% include postbox. html %}  {% endfor %}  {% include pagination. html %}"
    }, {
    "id": 8,
    "url": "/page6/",
    "title": "Home",
    "body": "  {% for post in paginator. posts %}    {% include postbox. html %}  {% endfor %}  {% include pagination. html %}"
    }, {
    "id": 9,
    "url": "/page7/",
    "title": "Home",
    "body": "  {% for post in paginator. posts %}    {% include postbox. html %}  {% endfor %}  {% include pagination. html %}"
    }, {
    "id": 10,
    "url": "/page8/",
    "title": "Home",
    "body": "  {% for post in paginator. posts %}    {% include postbox. html %}  {% endfor %}  {% include pagination. html %}"
    }, {
    "id": 11,
    "url": "/page9/",
    "title": "Home",
    "body": "  {% for post in paginator. posts %}    {% include postbox. html %}  {% endfor %}  {% include pagination. html %}"
    }, {
    "id": 12,
    "url": "/robots.txt",
    "title": "",
    "body": "      Sitemap: {{ â€œsitemap. xmlâ€   absolute_url }}   "
    }, {
    "id": 13,
    "url": "/2021/04/hotwire-reactive-rails-with-no-javascript/",
    "title": "Hotwire: æ²¡æœ‰JavaScriptçš„Reactive Rails",
    "body": "2021/04/24 - æœ¬æ–‡å·²è·å¾—åŸä½œè€…ï¼ˆVladimir Dementyevï¼‰å’Œ Evil Martians æˆæƒè®¸å¯è¿›è¡Œç¿»è¯‘ã€‚åŸæ–‡ä»‹ç»äº† Rails çš„æœ€æ–°â€œé­”æ³•â€ï¼šHotwireã€‚è¿™ä¹Ÿæ˜¯ Vladimir Dementyev åœ¨ RailsConf 2021 ä¸Šçš„æ¼”è®²å†…å®¹ã€‚  åŸæ–‡é“¾æ¥ï¼šHotwire: Reactive Rails with no JavaScript? ä½œè€…ï¼šVladimir Dementyev ç«™ç‚¹ï¼šEvil Martians â€”â€”ä½äºçº½çº¦å’Œä¿„ç½—æ–¯çš„ Ruby on Rails å¼€å‘äººå‘˜åšå®¢ã€‚ å®ƒå‘å¸ƒäº†è®¸å¤šä¼˜ç§€çš„æ–‡ç« ï¼Œå¹¶ä¸”æ˜¯ä¸å°‘ gem çš„èµåŠ©å•†ã€‚ã€æ­£æ–‡å¦‚ä¸‹ã€‘ å¼•è¨€: åˆ°ä¼ æ’­ DHH åŠå…¶å…¬å¸ä¹…ç»è€ƒéªŒçš„æ–°é­”æ³•çš„æ—¶å€™äº†ï¼Œå¹¶ä¸”åœ¨è¶…è¿‡ 5 åˆ†é’Ÿçš„æ•™å­¦ä¸­å­¦ä¹ ä½¿ç”¨ Hotwireã€‚è‡ªä»ä»Šå¹´æ­å¼€å…¶é¢çº±ä»¥æ¥ï¼Œè¿™ä¸ªç”¨äºæ„å»ºç°ä»£ Web ç•Œé¢è€Œä¼¼ä¹æ— éœ€ä»»ä½• JavaScript çš„æŠ€æœ¯çš„åå­—å°±å¤‡å—æ¬¢è¿ã€‚è¿™ä¸ª HTML-over-the-wire çš„æ–¹æ¡ˆæ­£åœ¨ Rails ä¸–ç•Œé‡Œæ¿€å‘èµ·å±‚å±‚æ¶Ÿæ¼ªï¼šä¸è®¡å…¶æ•°çš„åšå®¢æ–‡ç« ã€reddit ç¤¾åŒºå¸–å­ã€å½•å±è§†é¢‘ï¼Œä»¥åŠä»Šå¹´ RailsConf çš„äº”ä¸ªæ¼”è®²ï¼Œè€Œå…¶ä¸­ä¼šåŒ…å«ä½ æ‰€æœŸæœ›çš„å†…å®¹ã€‚æœ¬æ–‡ä¸­ï¼Œæˆ‘æƒ³è¦å¯¹ Hotwire è¿›è¡Œå½»åº•åœ°è§£é‡Šâ€”â€”å€ŸåŠ©ä»£ç ç¤ºä¾‹å’Œæµ‹è¯•ç­–ç•¥ã€‚å°±åƒæˆ‘æœ€çˆ±çš„æ‘‡æ»šä¹é˜Ÿè¯´çš„é‚£æ ·ï¼Œè®©æˆ‘ä»¬ Hotwired æ¥â€¦â€¦self destruct å­¦ä¹ æ–°æŠ€å·§å§ï¼ã€è¯‘è€…æ³¨ï¼šæ‘‡æ»šä¹é˜Ÿ Metallica 2016 å¹´å‘è¡Œäº†ä¸“è¾‘ã€ŠHardwired â€¦ To Self-Destructã€‹ï¼Œä½œè€…åœ¨è¿™å„¿ä½¿ç”¨äº†åç§°çš„è°éŸ³ã€‘ Life is short: è¦æ¦‚è§ˆ Hotwire åœ¨ Rails 6 ä¸­è¿›è¡Œä½¿ç”¨çš„å…¨è²Œï¼Œæ¯‹éœ€å†è´¹å…¶ä»–åŠŸå¤«ï¼Œçœ‹è¿™ä¸ª PR å°±è¶³å¤Ÿäº†ã€‚ æ¥ä¸‹æ¥çš„æ–‡ç« ä¼šè§£é‡Šä¸Šè¿° PR ä»£ç â€”â€”åœ¨å¾ˆå¤šç»†èŠ‚ä¸Šã€‚å®ƒæ˜¯æˆ‘çš„ RailsConf 2021 æ¼”è®²ï¼šâ€œFrontendless Rails frontendâ€ çš„ä¸€ä¸ªæ”¹ç¼–å’Œæ‰©å±•ç‰ˆæœ¬ï¼Œæ‰€æœ‰ RailsConf çš„å‚ä¼šè€…éƒ½å·²èƒ½å¤Ÿåœ¨çº¿è§‚çœ‹ã€‚å¦‚æœä½ æ²¡æœ‰å¤§ä¼šé—¨ç¥¨ä¹Ÿä¸ç”¨æ‹…å¿ƒï¼šå¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°å…¶ç®€æŠ¥ï¼Œè€Œä¸”è¯¥é¡µé¢ä¼šæ›´æ–°æ¼”è®²è§†é¢‘ï¼Œä¸€æ—¦æ¼”è®²å¯ä»¥å…¬å¼€å‘å¸ƒçš„è¯ã€‚ â€œThis is the wayâ€: è¿‡å»äº”å¹´ä¸­ï¼Œæˆ‘ä¸€ç›´ä¸»è¦åœ¨åšçº¯åç«¯çš„å¼€å‘ï¼šREST å’Œ GraphQL APIsã€WebSocketã€gRPCã€æ•°æ®åº“ã€ç¼“å­˜ç­‰ã€‚ æ•´ä¸ªå‰ç«¯çš„è¿›åŒ–åƒå·¨æµªä¸€æ ·å¸­å·äº†æˆ‘ï¼šæˆ‘ä»ç„¶ä¸ç†è§£ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ª Web åº”ç”¨éƒ½ä½¿ç”¨ reacts å’Œ webpacksã€‚ä¼ ç»Ÿçš„ HTML-first çš„ Rails æ–¹å¼ æ‰æ˜¯æˆ‘çš„æ–¹å¼ï¼ˆæˆ–è€…è¯´æ·å¾„ğŸ˜‰ï¼‰ã€‚è¿˜è®°å¾—é‚£äº› JavaScript åœ¨ä½ çš„åº”ç”¨ä¸­æ— éœ€ä»€ä¹ˆ MVCï¼ˆæˆ– MVVMï¼‰çš„æ—¥å­å—ï¼Ÿæˆ‘æ€€å¿µé‚£ç§æ—¥å­ã€‚è€Œè¿™äº›æ—¥å­æ­£åœ¨æ‚„æ‚„åœ°å·åœŸé‡æ¥ã€‚ ä»Šå¤©ï¼Œæˆ‘ä»¬ç›®ç¹äº† HTML-over-the-wire çš„å´›èµ·ï¼ˆæ˜¯çš„ï¼Œç°åœ¨å®ƒæ˜¯ä¸€ä¸ªå®é™…åè¯äº†ï¼‰ã€‚ç”± Phoenix LiveView ç‡å…ˆæå‡ºï¼ŒStimulusReflex ç³»åˆ— gems å¯¹å…¶å‘æ‰¬å…‰å¤§ï¼Œè¿™ç§åŸºäºåç«¯é€šè¿‡ WebSocket æŠŠæ¸²æŸ“çš„æ¨¡æ¿æ¨é€åˆ°æ‰€æœ‰æ‰€è¿æ¥çš„å®¢æˆ·ç«¯çš„æ–¹æ¡ˆï¼Œåœ¨ Rails ç¤¾åŒºè·å¾—äº†æå¤§çš„å¸å¼•åŠ›ã€‚æœ€ç»ˆï¼ŒDHH æœ¬äººäºä»Šå¹´åˆæŠŠ Hotwire å‘ˆç°äºä¸–ç•Œé¢å‰ã€‚ æˆ‘ä»¬æ˜¯å¦æ­£ç«™åœ¨ Web å¼€å‘çš„å¦ä¸€ä¸ªå…¨çƒèŒƒå¼è½¬å˜çš„è¾¹ç¼˜ï¼Ÿå›åˆ°æœåŠ¡ç«¯æ¸²æŸ“æ¨¡æ¿çš„ç®€å•æ€ç»´æ¨¡å‹ï¼Œè¿™ä¸€æ¬¡èŠ±è´¹å¾ˆå°‘çš„ç²¾åŠ›å°±å¯å®ç°å„ç§èŠ±é‡Œèƒ¡å“¨çš„ååº”å¼ç•Œé¢å—ï¼Ÿç»å°½è„‘æ±åï¼Œæˆ‘è®¤è¯†åˆ°è¿™æ˜¯ä¸€å¢æƒ…æ„¿çš„æƒ³æ³•ï¼šæŠ€æœ¯é¢†åŸŸå·²ç»æœ‰å¤ªå¤šçš„æŠ•èµ„åœ¨å®¢æˆ·ç«¯æ¸²æŸ“çš„åº”ç”¨ä¸Šè€Œå¾ˆéš¾å›å¤´äº†ã€‚2020 æ—¶ä»£çš„å‰ç«¯å¼€å‘å·²ç»æ˜¯ä¸€ç§ç‹¬ç«‹çš„èµ„è´¨å’Œæœ‰å…¶è‡ªèº«éœ€æ±‚çš„ç‹¬ç«‹è¡Œä¸šï¼Œæˆ‘ä»¬å°†æ²¡åŠæ³•å†æˆä¸ºâ€œå…¨æ ˆâ€äº†ã€‚ ç„¶è€Œï¼ŒHOTWireï¼ˆçœ‹åˆ°é‚£ä¸ªé¦–å­—æ¯ç¼©å†™å—ï¼ŸBasecamp è¿™æ–¹é¢å¾ˆèªæ˜ï¼Œæ˜¯å§ï¼Ÿï¼‰ï¼Œä¸ºå¤æ‚çš„ï¼Œæˆ–è€…æˆ‘ä»¬åº”è¯¥è¯´â€œé”™ç»¼å¤æ‚çš„â€ï¼Œèˆªå¤©ç§‘å­¦ä¸€èˆ¬é’ˆå¯¹æµè§ˆå™¨çš„ç°ä»£å®¢æˆ·ç«¯ç¼–ç¨‹ï¼Œæä¾›äº†ä¸€ç§æ€¥éœ€çš„æ›¿ä»£æ–¹æ¡ˆã€‚ å¯¹äºåŒå€¦äº†åªåš API åº”ç”¨è€Œæ— æ³•æŒæ§å…¶å‘ˆç°ï¼Œä»¥åŠæ€€å¿µåˆ›å»ºå“è¶Šç”¨æˆ·ä½“éªŒè€Œæ‘†è„±æ¯å‘¨ 40 å°æ—¶å……æ–¥ç€ SQL å’Œ JSON çš„ä¸€å Rails å¼€å‘è€…è€Œè¨€ï¼ŒHotwire å°±å¦‚ä»–æ‰€æ¸´æœ›èƒ½å¸¦æ¥æ–°é²œæ°”æ¯çš„å‘¼å¸ä¸€èˆ¬ï¼Œè®© Web å¼€å‘é‡æ‹¾ä¹è¶£ã€‚ æœ¬æ–‡ä¸­ï¼Œæˆ‘ä¼šæ¼”ç¤ºå¦‚ä½•æŠŠ HTML-over-the-wire å“²å­¦é€šè¿‡ Hotwire ç”¨åˆ°ç°æœ‰çš„ Rails åº”ç”¨ä¸Šã€‚å°±åƒæˆ‘æœ€è¿‘çš„å¤§å¤šæ•°æ–‡ç« ä¸€æ ·ï¼Œæˆ‘ä¼šä½¿ç”¨ AnyCable demo åº”ç”¨ä½œä¸ºå°ç™½é¼ ã€‚ è¿™ä¸ªåº”ç”¨å¾ˆåº”æ™¯ï¼šäº¤äº’å’Œååº”ï¼ŒTurbolinks é©±åŠ¨ï¼Œä»¥åŠå°‘é‡è‡ªå®šä¹‰ JavaScriptsï¼Œè¿˜æœ‰ç›¸å½“å¥½çš„ç³»ç»Ÿæµ‹è¯•è¦†ç›–ç‡ï¼ˆè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥è¿›è¡Œå®‰å…¨åœ°é‡æ„ï¼‰ã€‚æˆ‘ä»¬çš„ Hotwire åŒ– å°†ä¼šæŒ‰ç…§å¦‚ä¸‹æ­¥éª¤è¿›è¡Œï¼š  From Turbolinks to Turbo Drive Framing with Turbo Frames Streaming with Turbo Streams Beyond Turbo, or using Stimulus and custom elementsFrom Turbolinks to Turbo Drive: Turbolinks åœ¨ Rails ä¸–ç•Œé‡Œå¾ˆé•¿æ—¶é—´ä¹…è´Ÿç››åï¼›å…¶ç¬¬ä¸€ä¸ªä¸»è¦ç‰ˆæœ¬åœ¨ 2013 å¹´æ—©æœŸå‘å¸ƒã€‚ç„¶è€Œï¼Œåœ¨æˆ‘çš„å¼€å‘ç”Ÿæ¶¯åˆæœŸï¼ŒRails å¼€å‘è€…æœ‰ä¸€ä¸ªç»éªŒä¹‹è°ˆï¼šå¦‚æœä½ çš„å‰ç«¯å‡ºæ¯›ç—…äº†ï¼Œå°è¯•ä¸€ä¸‹ç¦ç”¨Turbolinksã€‚è®©ç¬¬ä¸‰æ–¹ JS åº“çš„ä»£ç è·Ÿ Turbolinks çš„ä¼ªå¯¼èˆªï¼ˆå‚è€ƒï¼špushState + AJAXï¼‰å…¼å®¹å¯ä¸åƒåœ¨å…¬å›­é‡Œæ•£æ­¥é‚£æ ·å®¹æ˜“ã€‚ å½“ StimulusJS å‡ºæ¥ä»¥åï¼Œæˆ‘å°±ä¸å†èº²é¿ Turbolinks äº†ã€‚å®ƒé€šè¿‡ä¾é ç°ä»£çš„ DOM mutation APIs è€Œä»æ ¹æœ¬ä¸Šè§£å†³äº†â€œè¿æ¥â€å’Œâ€œæ–­å¼€è¿æ¥â€ JavaScript çš„é—®é¢˜ã€‚Turbolinks ä¸ Stimulus çš„ä»£ç ç»„åˆï¼ŒDOM æ“ä½œä»…ä»¥ React-Angular å‡ åˆ†ä¹‹ä¸€çš„å¼€å‘æˆæœ¬å°±è½»è€Œæ˜“ä¸¾äº§ç”Ÿäº†â€œSPAâ€èˆ¬çš„ä½“éªŒã€‚ æ˜”æ—¥è¯¸èˆ¬å¥½å¤„çš„ Turbolinks ç°åœ¨æ›´åä¸º Turbo Driveï¼Œå°±å¦‚å­—é¢ä¸Šé‚£æ ·å®ƒé©±åŠ¨äº† Turbo â€”â€” Hotwire åŒ…çš„æ ¸å¿ƒã€‚ å¦‚æœä½ çš„åº”ç”¨å·²ç»ä½¿ç”¨äº† Turbolinksï¼ˆå¦‚æˆ‘ä¸€èˆ¬ï¼‰ï¼Œåˆ‡æ¢åˆ° Turbo Drive ä¸è´¹å¹ç°ä¹‹åŠ›ã€‚ä¸è¿‡æ˜¯ä¸€äº›é‡å‘½åçš„äº‹å„¿ç½¢äº†ã€‚ æ‰€æœ‰ä½ éœ€è¦åšçš„å°±æ˜¯æŠŠpackage. jsonä¸­çš„turbolinksæ›¿æ¢ä¸º@hotwired/turbo-railsï¼Œä»¥åŠæŠŠGemfileä¸­çš„turbolinksæ›¿æ¢ä¸ºturbo-railsã€‚ åˆå§‹åŒ–ä»£ç ç¨æœ‰å·®å¼‚ï¼Œç°åœ¨çš„æ›´ç®€æ´äº†ï¼š - import Turbolinks from 'turbolinks';- Turbolinks. start();+ import  @hotwired/turbo æ³¨æ„ï¼Œæˆ‘ä»¬ç°åœ¨ä¸éœ€è¦æ‰‹åŠ¨å¯åŠ¨ Turbo Drive äº†ï¼ˆå½“ç„¶ä½ å¯ä»¥ä¸è¿™ä¹ˆåšï¼‰ã€‚ è¿˜æœ‰äº›â€œæŸ¥æ‰¾ &amp; æ›¿æ¢â€å·¥ä½œè¦åšï¼šæŠŠæ‰€æœ‰ HTML çš„ data å±æ€§çš„data-turbolinksæ›´æ–°ä¸ºdata-turboã€‚ è¿™äº›å˜æ›´ä¸­å”¯ä¸€èŠ±è´¹äº†æˆ‘ä¸€ç‚¹æ—¶é—´è€Œå€¼å¾—ä¸€æçš„æ˜¯å¤„ç† forms å’Œ redirectsã€‚ä¹‹å‰ä½¿ç”¨ Turbolinks æ—¶ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ remote formsï¼ˆremote: trueï¼‰å’Œ Redirection concern æ¥å“åº”ä»¥ JavaScript æ¨¡æ¿ã€‚Turbo Drive å·²ç»å†…ç½®äº†å¯¹è¡¨å•æ‹¦æˆªçš„æ”¯æŒï¼Œæ‰€ä»¥remote: trueå°±ä¸å†éœ€è¦äº†ã€‚ç„¶è€Œï¼Œäº‹å®è¯æ˜ redirection ä»£ç å¿…é¡»è¿›è¡Œæ›´æ–°ï¼Œæˆ–è€…æ›´ç²¾ç¡®åœ°è¯´ï¼Œæ˜¯ redirection status codeï¼š - redirect_to workspace+ redirect_to workspace, status: :see_otherä½¿ç”¨æœ‰äº›æ™¦æ¶©çš„ See Other HTTP response code (303) æ˜¯ä¸€ä¸ªèªæ˜çš„é€‰æ‹©ï¼šå®ƒå…è®¸ Turbo ä¾èµ–åŸç”Ÿ Fetch API çš„ redirect:  follow  é€‰é¡¹ï¼Œè¿™æ ·åœ¨è¡¨å•æäº¤åä½ å°±ä¸å¿…æ˜ç¡®å‘èµ·å¦ä¸€ä¸ªè¯·æ±‚ä»¥è·å–æ–°å†…å®¹ã€‚æ ¹æ®å…¶è§„èŒƒï¼Œâ€œif status is 303 and requestâ€™s method is not GET or HEADâ€ï¼ŒGET è¯·æ±‚å¿…é¡»è¢«è‡ªåŠ¨æ‰§è¡Œã€‚æŠŠè¿™ä¸ªè·Ÿ â€œif status is 301 or 302 and requestâ€™s method is POSTâ€ æ¯”è¾ƒä¸€ä¸‹â€”â€”çœ‹åˆ°åŒºåˆ«äº†å—ï¼Ÿ å…¶ä»–çš„ 3xx çŠ¶æ€ä»…é€‚ç”¨äº POST è¯·æ±‚ï¼Œè€Œ Rails ä¸­æˆ‘ä»¬é€šå¸¸ä½¿ç”¨ POST, PATCH, PUT, å’Œ DELETEã€‚ Framing with Turbo Frames: è¯¥æ¥çœ‹ä¸€äº›çœŸæ­£çš„æ–°ä¸œè¥¿äº†ï¼šTurbo Framesã€‚ Turbo Frames å¸¦æ¥äº†é¡µé¢åœ¨å±€éƒ¨ä¸Šçš„æ— ç¼æ›´æ–°ï¼ˆä¸åƒ Turbo Drive æ˜¯åœ¨æ•´ä¸ªé¡µé¢ä¸Šï¼‰ã€‚æˆ‘ä»¬å¯ä»¥è¯´å®ƒéå¸¸ç±»ä¼¼äº&lt;iframe&gt;æ‰€åšçš„ï¼Œä½†å´ä¸ç”¨åˆ›å»ºå•ç‹¬çš„ windowsã€DOM æ ‘ä»¥åŠä¸ä¹‹ä¿±æ¥çš„é‚£äº›å®‰å…¨å™©æ¢¦ã€‚ æˆ‘ä»¬æ¥çœ‹çœ‹å®é™…çš„ä¾‹å­ã€‚ AnyCable demo åº”ç”¨ï¼ˆç§°ä¸º AnyWorkï¼‰å…è®¸ä½ åˆ›å»º dashboardsï¼Œå…¶å¸¦å¤šä¸ª ToDo åˆ—è¡¨å’Œä¸€ä¸ªèŠå¤©å®¤ã€‚ç”¨æˆ·å¯ä»¥ä¸ä¸åŒåˆ—è¡¨ä¸­çš„æ¡ç›®è¿›è¡Œäº¤äº’ï¼šæ·»åŠ ã€åˆ é™¤ä»¥åŠæŠŠå…¶æ ‡æ³¨ä¸ºå·²å®Œæˆã€‚ èµ·åˆï¼Œå®Œæˆå’Œåˆ é™¤è¿™äº›æ¡ç›®æ˜¯é€šè¿‡ AJAX è¯·æ±‚å’Œä¸€ä¸ªè‡ªå®šä¹‰ Stimulus controller æ¥åšåˆ°çš„ã€‚æˆ‘å†³å®šä½¿ç”¨ Turbo Frames æ¥é‡å†™è¿™éƒ¨åˆ†åŠŸèƒ½ä»¥å…¨éƒ¨ä½¿ç”¨ HTMLã€‚ æˆ‘ä»¬å¦‚ä½•æ¥è§£æ„è¿™äº› ToDo åˆ—è¡¨é¡¹ä»¥å¤„ç†å•ä¸ªæ¡ç›®çš„æ›´æ–°å‘¢ï¼ŸæŠŠæ¯ä¸ªæ¡ç›®éƒ½è½¬åŒ–ä¸ºä¸€ä¸ª frameï¼ &lt;!-- _item. html. rb --&gt;&lt;%= turbo_frame_tag dom_id(item) do %&gt; &lt;div class= any-list--item&lt;%= item. completed? ?   checked  :   %&gt; &gt;  &lt;%= form_for item do |f| %&gt;   &lt;!-- . . . --&gt;  &lt;% end %&gt;  &lt;%= button_to item_path(item), method: :delete %&gt;   &lt;!-- . . . --&gt;  &lt;% end %&gt; &lt;/div&gt;&lt;% end %&gt;è¿™é‡Œæˆ‘ä»¬åšäº†ä¸‰ä¸ªé‡è¦çš„äº‹æƒ…ï¼š  é€šè¿‡ helper ä¼ é€’ä¸€ä¸ªå”¯ä¸€è¯†åˆ«ç¬¦ï¼ˆæ¥è‡ªActionViewçš„å¯çˆ±çš„ dom_id æ–¹æ³•ï¼‰ï¼ŒæŠŠå•ä¸ªæ¡ç›®åŒ…è£¹åœ¨ä¸€ä¸ª&lt;turbo-frame&gt; tag ä¹‹å†…ï¼› æ·»åŠ ä¸€ä¸ª HTML formï¼Œä½¿å¾— Turbo æ‹¦æˆªè¡¨å•æäº¤å¹¶æ›´æ–°è¯¥ frame çš„å†…å®¹ï¼›ä»¥åŠ ä½¿ç”¨button_to helper å¹¶å¸¦ method: :delete å‚æ•°ï¼Œåœ¨è¯¥ä»£ç å¤„ä¹Ÿåˆ›å»ºäº†ä¸€ä¸ª HTML formã€‚ç°åœ¨ï¼Œä»»ä½•æ—¶å€™è¯¥ frame å†…æœ‰è¡¨å•æäº¤ï¼ŒTurbo éƒ½ä¼šæ‹¦æˆªè¯¥æäº¤ï¼Œæ‰§è¡Œ AJAX è¯·æ±‚ï¼Œä»å“åº”è¿”å›çš„ HTML ä¸­æå–å‡ºæœ‰ç›¸åŒ ID çš„ frameï¼ŒæŠŠå…¶å†…å®¹æ›¿æ¢åˆ°è¯¥ frame ä¸Šã€‚ æ‰€æœ‰ä¸Šè¿°å·¥ä½œæ²¡æœ‰ä¸€è¡Œè‡ªå·±æ‰‹å†™çš„ JavaScriptï¼ æ¥çœ‹ä¸€ä¸‹æ›´æ–°è¿‡åçš„ controller ä»£ç ï¼š class ItemsController &lt; ApplicationController def update  item. update!(item_params)  render partial:  item , locals: { item } end def destroy  item. destroy!  render partial:  item , locals: { item } endendæ³¨æ„ï¼Œå½“æˆ‘ä»¬åˆ é™¤æ¡ç›®æ—¶ï¼Œä»¥åŒæ ·çš„ partial è¿›è¡Œäº†å“åº”ã€‚ä½†æˆ‘ä»¬éœ€è¦ç§»é™¤è¯¥æ¡ç›®çš„ HTML èŠ‚ç‚¹è€Œéæ›´æ–°å®ƒã€‚è¦å¦‚ä½•åšå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªç©º frame æ¥å“åº”ï¼æ›´æ–° partial ä¸ºå¦‚ä¸‹ï¼š &lt;!-- _item. html. rb --&gt;&lt;%= turbo_frame_tag dom_id(item) do %&gt; &lt;% unless item. destroyed? %&gt;  &lt;div class= any-list--item&lt;%= item. completed? ?   checked  :   %&gt; &gt;   &lt;!-- . . . --&gt;  &lt;/div&gt; &lt;% end %&gt;&lt;% end %&gt;ä½ å¯èƒ½ä¼šé—®è‡ªå·±ä¸€ä¸ªé—®é¢˜ï¼šâ€œå½“æ ‡æ³¨ä¸€ä¸ªæ¡ç›®ä¸ºå®Œæˆæ—¶å¦‚ä½•è§¦å‘è¡¨å•æäº¤å‘¢ï¼Ÿâ€æ¢å¥è¯è¯´ï¼Œå¦‚ä½•è®© checkbox çš„çŠ¶æ€å˜æ›´æ¥è§¦å‘æäº¤è¡¨å•ï¼Ÿæˆ‘ä»¬å¯ä»¥é€šè¿‡å®šä¹‰ä¸€ä¸ªè¡Œå†…äº‹ä»¶ç›‘å¬å™¨åšåˆ°ï¼š &lt;%= f. check_box :completed, onchange:  this. form. requestSubmit();  %&gt;æé†’ï¼šä½¿ç”¨ requestSubmit() è€Œé submit() å¾ˆé‡è¦ï¼šå‰è€…è§¦å‘çš„â€œsubmitâ€äº‹ä»¶èƒ½å¤Ÿè¢« Turbo æ‰€æ‹¦æˆªï¼Œè€Œåè€…ä¸èƒ½ã€‚ æ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾å¼ƒæ‰€æœ‰ä¸“é—¨ä¸ºæ­¤åŠŸèƒ½å®šåˆ¶çš„ JS äº†ï¼Œåªéœ€ä¸€ç‚¹ HTML æ¨¡æ¿çš„æ›´æ”¹å’Œ controller ä»£ç çš„ç®€åŒ–ã€‚éå¸¸ä»¤äººå…´å¥‹ï¼Œä¸æ˜¯ä¹ˆï¼Ÿ æˆ‘ä»¬å¯ä»¥æ›´è¿›ä¸€æ­¥ï¼ŒæŠŠåˆ—è¡¨ä¹Ÿè½¬åŒ–ä¸º framesã€‚è¿™ä¼šè®©æˆ‘ä»¬åœ¨æ·»åŠ ä¸€ä¸ªæ–°æ¡ç›®æ—¶ï¼Œä» Turbo Drive çš„æ•´ä¸ªé¡µé¢æ›´æ–°åˆ‡æ¢ä¸ºä»…ç‰¹æ®Šé¡µé¢èŠ‚ç‚¹çš„æ›´æ–°ã€‚ä½ å¤§å¯è‡ªå·±å°è¯•ä¸€ä¸‹ï¼ å‡è®¾ä½ ä¹ŸæœŸæœ›åœ¨ä¸€ä¸ªæ¡ç›®è¢«å®Œæˆæˆ–åˆ é™¤çš„ä»»ä½•æ—¶å€™éƒ½ä¸ºç”¨æˆ·å±•ç¤ºä¸€ä¸ª flash æé†’ï¼ˆæ¯”å¦‚ï¼Œâ€œæ¡ç›®å·²è¢«æˆåŠŸåˆ é™¤â€ï¼‰ã€‚æˆ‘ä»¬èƒ½å€ŸåŠ©äº Turbo Frames åšåˆ°å—ï¼Ÿå¬èµ·æ¥æˆ‘ä»¬éœ€è¦æŠŠ flash æ¶ˆæ¯å®¹å™¨åŒ…è£¹åœ¨ä¸€ä¸ª frame å†…ï¼Œå¹¶å°†æ›´æ–°åçš„ HTML è·Ÿæ ‡è®°ä¸€èµ·æ¨é€ç»™è¯¥æ¡ç›®ã€‚è¿™æ˜¯æˆ‘åˆå§‹çš„æ€è·¯ï¼Œä½†å…¶å¹¶ä¸èƒ½æ­£å¸¸å·¥ä½œï¼šframe çš„æ›´æ–°æ˜¯åœ¨æ‰€åˆ›å»ºçš„ frame å®šä¹‰åŸŸå†…çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ— æ³•æ›´æ–°åœ¨å…¶å¤–éƒ¨çš„ä»»ä½•ä¸œè¥¿ã€‚ ç»è¿‡ä¸€ç•ªæ¢ç´¢ä¹‹åï¼Œæˆ‘å‘ç° Turbo Streams èƒ½å¸®æˆ‘ä»¬åšåˆ°è¿™ç‚¹ã€‚ Streaming with Turbo Streams: è¾ƒä¹‹äº Drive å’Œ Framesï¼ŒTurbo Streams å®Œå…¨æ˜¯ä¸€é¡¹æ–°æŠ€æœ¯ã€‚è·Ÿå‰ä¸¤è€…ä¸åŒï¼ŒStreams å«ä¹‰æ˜ç¡®ï¼Œæ˜“äºç†è§£ã€‚æ²¡æœ‰ä»€ä¹ˆä¼šè‡ªåŠ¨å‘ç”Ÿï¼Œä½ å¾—è´Ÿè´£é¡µé¢ä¸Šä½•æ—¶æ›´æ–°ä½•ç§å†…å®¹ã€‚è¦åšåˆ°è¿™ç‚¹ï¼Œä½ éœ€è¦ä½¿ç”¨ç‰¹æ®Šçš„&lt;trubo-stream&gt;å…ƒç´ ã€‚ æ¥çœ‹ä¸€ä¸ª stream å…ƒç´ çš„ç¤ºä¾‹ï¼š &lt;turbo-stream action= replace  target= flash-alerts &gt; &lt;template&gt;  &lt;div class= flash-alerts--container  id= flash-alerts &gt;   &lt;!-- --&gt;  &lt;/div&gt; &lt;/template&gt;&lt;/turbo-stream&gt;è¯¥å…ƒç´ è´Ÿè´£ä»¥&lt;template&gt; tag å†…æ‰€ä¼ è¾“è¿‡æ¥çš„æ–° HTML å†…å®¹æ›¿æ¢ï¼ˆaction= replace ï¼‰DOM ID ä¸ºflash-alertså…¶ä¸‹çš„èŠ‚ç‚¹ã€‚ä¸ç®¡ä»€ä¹ˆæ—¶å€™ä½ æŠŠè¿™æ ·çš„&lt;turbo-stream&gt;å…ƒç´ ä¸‹å‘åˆ°é¡µé¢ä¸Šï¼Œå®ƒéƒ½ä¼šç«‹åˆ»æ‰§è¡Œå…¶ action å¹¶é”€æ¯å…¶è‡ªèº«ã€‚è€Œåœ¨åº•å±‚ï¼Œå®ƒä½¿ç”¨äº† HTML çš„ Custom Elements API â€”â€” åˆä¸€ä¸ªä¸ºäº†å¼€å‘ä¹è¶£ï¼ˆæ¯”å¦‚ï¼Œæ›´å°‘çš„ JavaScript ğŸ˜„ï¼‰è€Œä½¿ç”¨ç°ä»£ Web APIs çš„èŒƒä¾‹ã€‚ æˆ‘å¾—è¯´ï¼ŒTurbo Streams æ˜¯è€å¼çš„ JavaScript æ¨¡æ¿çš„ä¸€ä¸ªå£°æ˜å¼æ›¿ä»£æ–¹æ¡ˆã€‚åœ¨ 2010 å¹´ä»£ï¼Œæˆ‘ä»¬å†™çš„ä»£ç ç±»ä¼¼è¿™æ ·ï¼š // destroy. js. erb$( #&lt;%= dom_id(item) %&gt; ). remove();è€Œç°åœ¨ï¼Œæˆ‘ä»¬è¿™æ ·å†™ï¼š &lt;!-- destroy. html. erb --&gt;&lt;%= turbo_stream. remove dom_id(item) %&gt;ç›®å‰ï¼Œä»…æœ‰äº”ç§å¯ç”¨çš„ actionsï¼šappendã€prependã€replaceã€remove å’Œ updateï¼ˆä»…æ›¿æ¢èŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹ï¼‰ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹é¢è°ˆè®ºå…¶å±€é™æ€§å’Œå¦‚ä½•å…‹æœå®ƒã€‚ å›åˆ°æˆ‘ä»¬çš„åˆå§‹é—®é¢˜ï¼šä¸º ToDo æ¡ç›®çš„å®Œæˆæˆ–åˆ é™¤ï¼Œå±•ç¤ºå“åº”ç»“æœä¸­çš„ flash æé†’ã€‚ æˆ‘ä»¬æƒ³è¦ä¸€æ¬¡å“åº”ç»“æœå°±å¸¦æœ‰&lt;turbo-frame&gt;å’Œ&lt;turbo-stream&gt;ä¸¤ç§æ›´æ–°ã€‚å¦‚ä½•æ¥åšï¼Ÿä¸ºå…¶æ·»åŠ ä¸€ä¸ªæ–°çš„ partial æ¨¡æ¿ï¼š &lt;!-- _item_update. html. erb --&gt;&lt;%= render item %&gt;&lt;%= turbo_stream. replace  flash-alerts  do %&gt; &lt;%= render  shared/alerts  %&gt;&lt;% end %&gt;å¯¹ItemsControlleræ·»åŠ ä¸€ç‚¹å°çš„æ”¹åŠ¨ï¼š +  flash. now[:notice] =  Item has been updated -  render partial:  item , locals: { item }+  render partial:  item_update , locals: { item }ä¸å¹¸åœ°æ˜¯ï¼Œä¸Šè¿°ä»£ç å¹¶æœªå¦‚é¢„æœŸé‚£æ ·æ­£å¸¸å·¥ä½œï¼šæˆ‘ä»¬æ²¡æœ‰çœ‹åˆ°ä»»ä½• flash æé†’ã€‚ æ·±å…¥ç ”ç©¶æ–‡æ¡£ä¹‹åï¼Œæˆ‘å‘ç°æ˜¯ Turbo æœŸæœ› HTTP å“åº”å…·æœ‰text/vnd. turbo-stream. html content type æ‰å¯æ¿€æ´» stream å…ƒç´ ã€‚å¥½å§ï¼ŒåŠ ä¸Šå®ƒï¼š -  render partial:  item_update , locals: { item }+  render partial:  item_update , locals: { item }, content_type:  text/vnd. turbo-stream. html ç°åœ¨æˆ‘ä»¬å¾—åˆ°äº†ç›¸åçš„æƒ…å†µï¼šflash æ¶ˆæ¯æ­£å¸¸å·¥ä½œï¼Œä½†æ¡ç›®çš„å†…å®¹ä¸èƒ½æ›´æ–°äº†ğŸ˜ã€‚æ˜¯æˆ‘å¯¹ Hotwire è¦æ±‚å¤ªé«˜äº†ä¹ˆï¼Ÿé˜…è¯»äº†ä¸‹ Turbo çš„æºç ï¼Œæˆ‘å‘ç°ç±»ä¼¼è¿™æ ·æŠŠ streams å’Œ frames è¿›è¡Œæ··åˆæ˜¯ä¸è¡Œçš„ã€‚ è¿™è¯´æ˜ï¼Œæœ‰ä¸¤ç§æ–¹å¼æ¥å®ç°è¯¥åŠŸèƒ½ï¼š  æŠŠ streams ç”¨åœ¨æ‰€æœ‰ä¸œè¥¿ä¸Šã€‚ æŠŠ&lt;turbo-stream&gt;ç½®äº&lt;turbo-frame&gt;å†…éƒ¨ã€‚ç¬¬äºŒä¸ªé€‰é¡¹ï¼Œå¯¹æˆ‘è€Œè¨€ï¼Œä¸åœ¨å¸¸è§„é¡µé¢ä¸Šé‡ç”¨ HTML partials å¹¶ä»¥ Turbo è¿›è¡Œæ›´æ–°çš„æƒ³æ³•èƒŒé“è€Œé©°ã€‚æ‰€ä»¥ï¼Œæˆ‘é€‰æ‹©ç¬¬ä¸€ä¸ªï¼š &lt;!-- _item_update. html. erb --&gt;&lt;%= turbo_stream. replace dom_id(item) do %&gt; &lt;%= render item %&gt;&lt;% end %&gt;&lt;%= turbo_stream. replace  flash-alerts  do %&gt; &lt;%= render  shared/alerts  %&gt;&lt;% end %&gt;ä»»åŠ¡å®Œæˆã€‚ä½†ä»˜å‡ºäº†ä»€ä¹ˆä»£ä»·å‘¢ï¼Ÿæˆ‘ä»¬ä¸å¾—ä¸ä¸ºè¿™ç§ç”¨ä¾‹æ·»åŠ ä¸€ä¸ªæ–°çš„æ¨¡æ¿ã€‚å¹¶ä¸”æˆ‘æ‹…å¿ƒåœ¨ç°å®ä¸­çš„åº”ç”¨ç¨‹åºé‡Œï¼Œè¿™ç§ partials çš„æ•°é‡ä¼šéšç€åº”ç”¨çš„è¿›åŒ–è€Œå¢é•¿ã€‚ æ›´æ–°ï¼ˆ2021-04-13ï¼‰ï¼šAlex Takitani å»ºè®®äº†ä¸€ç§æ›´åŠ ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ layout æ¥æ›´æ–° flash å†…å®¹ã€‚æˆ‘ä»¬å¯ä»¥å¦‚ä¸‹é¢è¿™æ ·æŠŠ application layout å®šä¹‰ä¸º Turbo Stream å“åº”ï¼š &lt;!-- layouts/application. turbo_stream. erb --&gt;&lt;%= turbo_stream. replace  flash-alerts  do %&gt; &lt;%= render  shared/alerts  %&gt;&lt;% end %&gt;&lt;%= yield %&gt;ç„¶åï¼Œæˆ‘ä»¬éœ€è¦ä» controller ç§»é™¤ç›¸åº”çš„æ¸²æŸ“ï¼ˆå› ä¸ºè¦ä¸ç„¶ layout å°±ä¸ä¼šè¢«ç”¨ä¸Šäº†ï¼‰ï¼š def update   item. update!(item_params)   flash. now[:notice] =  Item has been updated --  render partial:  item_update , locals: { item }, content_type:  text/vnd. turbo-stream. html   endæ³¨æ„ï¼šåˆ«å¿˜äº†æŠŠformat: :turbo_streamæ·»åŠ åˆ° controller/request specs æµ‹è¯•ç›¸åº”çš„è¯·æ±‚ä¸Šï¼Œä»¥ä¾¿ä½¿å¾— render èƒ½æ­£å¸¸å·¥ä½œã€‚ å¹¶ä¸”æŠŠæˆ‘ä»¬çš„_item_update partial è½¬æ¢ä¸ºupdateçš„ Turbo Stream æ¨¡æ¿ï¼š &lt;!-- update. turbo_stream. erb --&gt;&lt;%= turbo_stream. replace dom_id(item) do %&gt; &lt;%= render item %&gt;&lt;% end %&gt;å¾ˆé…·ï¼Œå¯¹å§ï¼Ÿè¿™æ­£æ˜¯ Rails çš„æ–¹å¼ï¼ ç°åœ¨ï¼Œè®©æˆ‘ä»¬è½¬åˆ°ä¸€äº›å®æ—¶çš„æµå¹¿æ’­ä¸Šã€‚ Turbo Streams ç»å¸¸åœ¨å®æ—¶æ›´æ–°çš„è¯­å¢ƒä¸­è¢«æåˆ°ï¼ˆä¸”å¸¸å¸¸è¢«ç”¨æ¥è·Ÿ StimulusReflex æ¯”è¾ƒï¼‰ã€‚ æ¥çœ‹çœ‹æˆ‘ä»¬èƒ½å¤Ÿå¦‚ä½•åœ¨ Turbo Streams ä¹‹ä¸Šæ„å»ºåˆ—è¡¨çš„åŒæ­¥åŒ–ï¼š åœ¨æœ‰ Turbo ä¹‹å‰ï¼Œæˆ‘ä¸å¾—ä¸æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„ Action Cable channel å’Œä¸€ä¸ª Stimulus controller æ¥å¤„ç†å¹¿æ’­çš„äº‹æƒ…ã€‚æˆ‘ä¹Ÿéœ€è¦å¤„ç†æ¶ˆæ¯çš„æ ¼å¼ï¼Œå› ä¸ºå¿…é¡»åŒºåˆ†å¯¹æ¡ç›®çš„åˆ é™¤å’Œå®Œæˆã€‚æ¢å¥è¯è¯´ï¼Œæœ‰ä¸å°‘ä»£ç è¦ç»´æŠ¤ã€‚ è€Œ Turbo Streams å·²ç»ç…§é¡¾å¥½äº†å‡ ä¹ä¸€åˆ‡ï¼šturbo-rails gem è‡ªå¸¦ä¸€ä¸ªé€šç”¨çš„Turbo::StreamChannelå’Œä¸€ä¸ª helperï¼ˆ#turbo_stream_fromï¼‰ï¼Œç”¨æ¥ä» HTML ä¸­åˆ›å»ºä¸€ä¸ª subscriptionï¼š &lt;!-- worspaces/show. html. erb --&gt;&lt;div&gt; &lt;%= turbo_stream_from workspace %&gt; &lt;!-- . . . --&gt;&lt;/div&gt;åœ¨ controller ä¸­ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†#broadcast_new_itemå’Œ#broadcast_changesè¿™æ ·çš„â€œafter actionâ€ callback è´Ÿè´£å¯¹æ›´æ–°è¿›è¡Œæ’­å‘ã€‚ç°åœ¨æˆ‘ä»¬æ‰€æœ‰éœ€è¦åšçš„å°±æ˜¯åˆ‡æ¢åˆ°Turbo::StreamChannelï¼š def broadcast_changes  return if item. errors. any?  if item. destroyed?-  ListChannel. broadcast_to list, type:  deleted , id: item. id+  Turbo::StreamsChannel. broadcast_remove_to workspace, target: item  else-  ListChannel. broadcast_to list, type:  updated , id: item. id, desc: item. desc, completed: item. completed+  Turbo::StreamsChannel. broadcast_replace_to workspace, target: item, partial:  items/item , locals: { item }  end endè¿™æ¬¡è¿ç§»å¾ˆé¡ºç•…ï¼Œå‡ ä¹â€”â€”å› ä¸ºæ‰€æœ‰æ£€éªŒæ’­å‘ï¼ˆ#have_broadcasted_toï¼‰çš„ controller å•å…ƒæµ‹è¯•éƒ½å¤±è´¥äº†ã€‚ ä¸å¹¸çš„æ˜¯ï¼ŒTurbo Rails æ²¡æœ‰æä¾›ä»»ä½•æµ‹è¯•å·¥å…·ï¼ˆ?ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä¸å¾—ä¸è‡ªå·±å†™ä¸€ä¸ªï¼Œä»¥è‡ªå·±ç†Ÿæ‚‰çš„æ–¹å¼ï¼š module Turbo::HaveBroadcastedToTurboMatcher include Turbo::Streams::StreamName def have_broadcasted_turbo_stream_to(*streamables, action:, target:) # rubocop:disable Naming/PredicateName  target = target. respond_to?(:to_key) ? ActionView::RecordIdentifier. dom_id(target) : target  have_broadcasted_to(stream_name_from(streamables))   . with(a_string_matching(%(turbo-stream action= #{action}  target= #{target} ))) endendRSpec. configure do |config| config. include Turbo::HaveBroadcastedToTurboMatcherendä¸‹é¢æ˜¯æˆ‘å¦‚ä½•æŠŠè¿™ä¸ªæ–°çš„åŒ¹é…å™¨ç”¨åœ¨æµ‹è¯•ä¸Šï¼š it  broadcasts a deleted message  do- expect { subject }. to have_broadcasted_to(ListChannel. broadcasting_for(list))-  . with(type:  deleted , id: item. id)+ expect { subject }. to have_broadcasted_turbo_stream_to(+  workspace, action: :remove, target: item+ ) endåˆ°ç›®å‰ä¸ºæ­¢ï¼Œä½¿ç”¨ Turbo çš„å®æ—¶å¤„ç†è¿›å±•é¡ºåˆ©ï¼ä¸€å¤§å †ä»£ç éƒ½è¢«ç§»é™¤äº†ã€‚ è€Œæˆ‘ä»¬ä»ç„¶è¿˜æ˜¯ä¸€è¡Œ JavaScript ä»£ç éƒ½æ²¡æœ‰å†™ã€‚è¿™ä¹Ÿå¤ªä¸çœŸå®äº†å§ï¼Ÿ ä¸è¿‡æ˜¯ä¸ªå¹»æ¢¦å—ï¼Ÿä½•æ—¶æˆ‘ä¼šé†’æ¥ï¼Ÿå¥½å§ï¼Œå°±æ˜¯ç°åœ¨ã€‚ Beyond Turbo, or using Stimulus and custom elements: åœ¨å‘ Turbo è¿ç§»çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ç¢°åˆ°äº†å¥½å‡ ä¸ªåœºæ™¯ï¼Œä½¿ç”¨å·²æœ‰çš„ API æ˜¯ä¸å¤Ÿçš„ï¼Œæ‰€ä»¥æˆ‘æœ€ç»ˆä¸å¾—ä¸ç¼–å†™ä¸€äº› JavaScript ä»£ç ï¼ åœºæ™¯ä¸€ï¼šå‘ dashboard å®æ—¶æ·»åŠ æ–°çš„åˆ—è¡¨ã€‚è¿™è·Ÿå‰é¢æåˆ°çš„åˆ—è¡¨ä¸­æ¡ç›®çš„ç¤ºä¾‹æœ‰ä½•ä¸åŒï¼Ÿåœ¨äºæ ‡è®°ã€‚æ¥çœ‹ä¸€ä¸‹ dashboard layoutï¼š &lt;div id= workspace_1 &gt; &lt;div id= list_1 &gt;. . . &lt;/div&gt; &lt;div id= list_2 &gt;. . . &lt;/div&gt; &lt;div id= new_list &gt;  &lt;form&gt;. . . &lt;/form&gt; &lt;/div&gt;&lt;/div&gt;æœ€åä¸€ä¸ªå…ƒç´ æ€»æ˜¯æ–°åˆ—è¡¨çš„ form å®¹å™¨ã€‚ä¸ç®¡æˆ‘ä»¬ä½•æ—¶æ·»åŠ æ–°åˆ—è¡¨ï¼Œå®ƒéƒ½ä¼šè¢«æ’å…¥åˆ°#new_listèŠ‚ç‚¹ä¹‹å‰ã€‚è¿˜è®°å¾— Turbo Streams ä»…ä»…æ”¯æŒäº”ç§ actions ä¸ï¼Ÿæ˜ç™½é—®é¢˜æ‰€åœ¨äº†å—ï¼Ÿä¸‹é¢æ˜¯æˆ‘èµ·åˆä½¿ç”¨çš„ä»£ç ï¼š handleUpdate(data) { this. formTarget. insertAdjacentHTML( beforebegin , data. html);}è¦ä½¿ç”¨ Turbo Streams å®ç°ç±»ä¼¼çš„è¡Œä¸ºï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ª hackï¼Œåœ¨åˆ—è¡¨è¢«é€šè¿‡ stream æ·»åŠ ä¹‹åç«‹å³æŠŠå…¶ç§»åŠ¨åˆ°æ­£ç¡®çš„ä½ç½®ã€‚æ‰€ä»¥ï¼Œæ¥æ·»åŠ æˆ‘ä»¬è‡ªå·±çš„ JavaScript ä»£ç å§ã€‚ é¦–å…ˆæ¥ç»™æˆ‘ä»¬çš„ä»»åŠ¡ä¸€ä¸ªæ­£å¼çš„å®šä¹‰ï¼šâ€œå½“ä¸€ä¸ªæ–°åˆ—è¡¨è¢« append åˆ° workspace å®¹å™¨æ—¶ï¼Œå®ƒåº”è¯¥å‡ºç°åœ¨é‚£ä¸ª new form å…ƒç´ ä¹‹å‰çš„æ­£ç¡®ä½ç½®ä¸Šã€‚â€ã€‚è¿™é‡Œçš„â€œå½“â€æ„å‘³ç€æˆ‘ä»¬éœ€è¦è§‚å¯Ÿ DOM å¹¶å¯¹å˜æ›´ä½œå‡ºååº”ã€‚æ˜¯ä¸æ˜¯å¬èµ·æ¥å¾ˆç†Ÿæ‚‰ï¼Ÿæ²¡é”™ï¼Œæˆ‘ä»¬å·²ç»æåˆ°è¿‡ä¸ Stimulus æœ‰å…³çš„ MutationObserver APIï¼ç”¨å®ƒå°±å¯¹äº†ã€‚ å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸æ˜¯å¿…é¡»ç¼–å†™é«˜é˜¶çš„ JavaScript æ‰èƒ½ä½¿ç”¨è¯¥ç‰¹æ€§ï¼›æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ stimulus-useï¼ˆæŠ±æ­‰ä½¿ç”¨è¿™ç§é‡è¨€å¼è¯­æ³•ã€‚ã€è¯‘è€…æ³¨ï¼šåŸæ–‡æ˜¯ use stimulus-useï¼Œæ‰€ä»¥ä½œè€…è¿™ä¹ˆè¯´ã€‘ï¼‰ã€‚Stimulus Use æ˜¯ä¸€ä¸ª Stimulus controllers å¾ˆæœ‰ç”¨çš„è¡Œä¸ºçš„é›†åˆï¼Œä»¥ç®€å•çš„ä»£ç ç‰‡æ®µè§£å†³å¤æ‚çš„é—®é¢˜ã€‚æˆ‘ä»¬è¿™å„¿ï¼Œéœ€è¦ useMutation è¡Œä¸ºã€‚ å¦‚ä¸‹çš„ controller ä»£ç ç›¸å½“ç®€æ´ï¼Œå«ä¹‰ä¸è¨€è‡ªæ˜ï¼š import { Controller } from  stimulus ;import { useMutation } from  stimulus-use ;export default class extends Controller { static targets = [ lists ,  newForm ]; connect() {  [this. observeLists, this. unobserveLists] = useMutation(this, {   element: this. listsTarget,   childList: true,  }); } mutate(entries) {  // There should be only one entry in case of adding a new list via streams  const entry = entries[0];  if (!entry. addedNodes. length) return;  // Disable observer while we modify the childList  this. unobserveLists();  // Move newForm to the end of the childList  this. listsTarget. append(this. newFormTarget);  this. observeLists(); }}é—®é¢˜å°±è¿™æ ·è§£å†³äº†ã€‚ æ¥è®¨è®ºä¸‹ç¬¬äºŒä¸ªè¾¹ç•Œåœºæ™¯ï¼šå®ç°èŠå¤©å®¤åŠŸèƒ½ã€‚ æˆ‘ä»¬æœ‰ä¸€ä¸ªéå¸¸ç®€å•çš„èŠå¤©å®¤é™„åœ¨æ¯ä¸ª dashboard ä¸Šï¼šç”¨æˆ·å¯ä»¥å‘é€ä¸´æ—¶æ¶ˆæ¯ï¼ˆä¸ä¼šè¢«å­˜å‚¨åˆ°ä»»ä½•åœ°æ–¹ï¼‰å’Œå®æ—¶æ¥æ”¶å®ƒä»¬ã€‚æ¶ˆæ¯å…·æœ‰ä¾èµ–äºä¸Šä¸‹æ–‡çš„ä¸åŒå¤–è§‚ï¼šè‡ªå·±çš„æ¶ˆæ¯æœ‰ç»¿è‰²è¾¹æ¡†ï¼Œé å·¦ï¼›å…¶ä»–æ¶ˆæ¯åˆ™æ˜¯ç°è‰²ï¼Œé å³ã€‚è€Œæˆ‘ä»¬æ˜¯å‘æ¯ä¸ªæ‰€è¿æ¥çš„å®¢æˆ·ç«¯æ’­å‘ç›¸åŒçš„ HTMLã€‚è¦å¦‚ä½•ä½¿å¾—ç”¨æˆ·çœ‹åˆ°è¿™ç§åŒºåˆ«å‘¢ï¼Ÿè¿™å¯¹äºèŠå¤©å®¤ç±»çš„åº”ç”¨æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„é—®é¢˜ï¼Œä¸”ä¸€èˆ¬è€Œè¨€ï¼Œå®ƒé€šè¿‡è¦ä¹ˆå‘æ¯ä¸ªç”¨æˆ· channel å‘é€ä¸ªæ€§åŒ–çš„ HTMLï¼Œè¦ä¹ˆå¢å¼ºæ‰€æ”¶åˆ°çš„ HTML åœ¨å®¢æˆ·ç«¯æ¥è§£å†³ã€‚æˆ‘æ›´å–œæ¬¢ç¬¬äºŒç§ï¼Œæ‰€ä»¥æ¥å®ç°å®ƒå§ã€‚ è¦æŠŠå½“å‰ç”¨æˆ·çš„ä¿¡æ¯ä¼ é€’ç»™ JavaScriptï¼Œæˆ‘ä½¿ç”¨ meta tagsï¼š &lt;!-- layouts/application. html. erb --&gt;&lt;head&gt; &lt;% if logged_in? %&gt;  &lt;meta name= current-user-name  content= &lt;%= current_user. name %&gt;  data-turbo-track= reload &gt;  &lt;meta name= current-user-id  content= &lt;%= current_user. id %&gt;  data-turbo-track= reload &gt; &lt;% end %&gt; &lt;!-- . . . --&gt;&lt;/head&gt;å’Œä¸€ä¸ªå°çš„ JS helper æ¥è·å–è¿™äº› valuesï¼š let user;export const currentUser = () =&gt; { if (user) return user; const id = getMeta( id ); const name = getMeta( name ); user = { id, name }; return user;};function getMeta(name) { const element = document. head. querySelector(  `meta[name='current-user-${name}']` ); if (element) {  return element. getAttribute( content ); }}è¦æ’­å‘èŠå¤©å®¤æ¶ˆæ¯ï¼Œæˆ‘ä»¬å°†ä¼šä½¿ç”¨Turbo::StreamChannelï¼š def create Turbo::StreamsChannel. broadcast_append_to(  workspace,  target: ActionView::RecordIdentifier. dom_id(workspace, :chat_messages),  partial:  chats/message ,  locals: { message: params[:message], name: current_user. name, user_id: current_user. id } ) # . . . endä¸‹é¢æ˜¯åˆå§‹çš„chat/messageæ¨¡æ¿ï¼š &lt;div class= chat--msg &gt; &lt;%= message %&gt; &lt;span data-role= author  class= chat--msg--author &gt;&lt;%= name %&gt;&lt;/span&gt;&lt;/div&gt;ä»¥åŠå‰è¿°æ ¹æ®å½“å‰ç”¨æˆ·èµ‹äºˆä¸åŒæ ·å¼çš„ JS ä»£ç ï¼Œè¿™äº›ä»£ç æˆ‘ä»¬å¾ˆå¿«å°±è¦å»æ‰ï¼š // Don't get attached to itappendMessage(html, mine) { this. messagesTarget. insertAdjacentHTML( beforeend , html); const el = this. messagesTarget. lastElementChild; el. classList. add(mine ?  mine  :  theirs ); if (mine) {  const authorElement = el. querySelector('[data-role= author ]');  if (authorElement) authorElement. innerText =  You ; }}ç°åœ¨ï¼Œå½“ Turbo è´Ÿè´£æ›´æ–° HTML æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åšç‚¹ä¸åŒçš„äº‹ã€‚å½“ç„¶ï¼ŒuseMutaionä¹Ÿä¼šåœ¨è¿™é‡Œè¢«ç”¨åˆ°ã€‚å¹¶ä¸”è¿™æœ‰å¯èƒ½æ˜¯æˆ‘å°†ç”¨åœ¨ç°å®é¡¹ç›®ä¸Šçš„ã€‚ç„¶è€Œï¼Œæˆ‘ä»Šå¤©çš„ç›®æ ‡æ˜¯æ¼”ç¤ºä»¥ä¸åŒçš„æ–¹å¼æ¥è§£å†³é—®é¢˜ã€‚ è¿˜è®°å¾—æˆ‘ä»¬ä¸€ç›´åœ¨è°ˆè®º Custom Elementsï¼ˆå“¦ï¼Œé‚£æ˜¯å¥½å‡ é¡µä¹‹å‰äº†ï¼ŒæŠ±æ­‰ï¼Œè¿™è¯´æ˜æˆ‘ä»¬é˜…è¯»å¤ªä¹…äº†ï¼‰ï¼Ÿå®ƒæ­£æ˜¯ä»¤ Turbo ä¹‹æ‰€ä»¥å¼ºå¤§çš„ Web APIã€‚æˆ‘ä»¬å¹²å˜›ä¸ç”¨å‘¢ï¼ è®©æˆ‘å…ˆåˆ†äº«ä¸€ä¸ªæ›´æ–°åçš„ HTML æ¨¡æ¿ï¼š &lt;any-chat-message class= chat--msg  data-author-id= &lt;%= user_id %&gt;&gt; &lt;%= message %&gt; &lt;span data-role= author  class= chat--msg--author &gt;&lt;%= name %&gt;&lt;/span&gt;&lt;/any-chat-message&gt;æˆ‘ä»¬åªæ·»åŠ äº†data-author-idå±æ€§ï¼Œå¹¶æŠŠ&lt;div&gt;æ›¿æ¢ä¸ºè‡ªå®šä¹‰ tag â€”â€”&lt;any-chat-message&gt;ã€‚ ç°åœ¨æ¥å¯¹ custom element è¿›è¡Œæ³¨å†Œï¼š import { currentUser } from  . . /utils/current_user ;// This is how you create custom HTML elements with a modern APIexport class ChatMessageElement extends HTMLElement { connectedCallback() {  const mine = currentUser(). id == this. dataset. authorId;  this. classList. add(mine ?  mine  :  theirs );  const authorElement = this. querySelector('[data-role= author ]');  if (authorElement &amp;&amp; mine) authorElement. innerText =  You ; }}customElements. define( any-chat-message , ChatMessageElement);å¤§åŠŸå‘Šæˆï¼ç°åœ¨å½“ä¸€ä¸ªæ–°çš„&lt;any-chat-message&gt;å…ƒç´ è¢«æ·»åŠ åˆ°é¡µé¢æ—¶ï¼Œå¦‚æœå®ƒæ¥è‡ªäºå½“å‰ç”¨æˆ·å°±è‡ªåŠ¨æ›´æ–°è‡ªå·±ã€‚è€Œä¸”ç”šè‡³æˆ‘ä»¬ä¸ºæ­¤éƒ½ä¸å†éœ€è¦ Stimulus äº†ï¼ ä½ å¯ä»¥åœ¨è¿™ä¸ª PR ä¸­æ‰¾åˆ°æœ¬æ–‡æœ‰å…³çš„å…¨éƒ¨æºä»£ç ã€‚ æ‰€ä»¥ï¼Œé‚£ä¹ˆé›¶ JavaScript çš„ Reactive Rails åˆ°åº•å­˜åœ¨å—ï¼Ÿå¹¶ä¸ã€‚æˆ‘ä»¬ç§»é™¤äº†å¾ˆå¤š JS ä»£ç ï¼Œä½†æœ€åä¸å¾—ä¸ç”¨ä¸€äº›æ–°ä¸œè¥¿æ¥æ›¿ä»£ã€‚è¿™äº›æ–°ä¸œè¥¿è·Ÿä¹‹å‰çš„æœ‰æ‰€åŒºåˆ«ï¼šå®ƒæ›´åŠ ï¼Œæˆ‘å¾—è¯´ï¼Œå®ç”¨ä¸»ä¹‰ã€‚å®ƒä¹Ÿæ›´åŠ é«˜é˜¶ï¼Œéœ€è¦å¯¹ JavaScript ä»¥åŠæœ€æ–°æµè§ˆå™¨ APIs æœ‰å¾ˆå¥½çš„äº†è§£ï¼Œè¿™è‚¯å®šæ˜¯è¦æƒè¡¡è€ƒè™‘çš„ã€‚ é™„ï¼šæˆ‘å¯¹ CableReady å’Œ StimulusReflex ä¹Ÿæœ‰ä¸€ä¸ªç±»ä¼¼çš„ PRã€‚ä½ å¯ä»¥æŠŠå®ƒè·Ÿ Hotwire çš„è¿™ä¸ª PR è¿›è¡Œæ¯”è¾ƒï¼Œåœ¨ Twitter ä¸Šä¸æˆ‘ä»¬åˆ†äº«ä½ çš„è§‚ç‚¹ã€‚ "
    }, {
    "id": 14,
    "url": "/2021/04/the-foundation-of-how-tailwindcss-works/",
    "title": "Tailwindcssåº•å±‚åŸºçŸ³çš„ç†å¿µ",
    "body": "2021/04/10 - Tailwindcss ä» 2019 å¹´å¼€å§‹é€æ¸åœ¨å›½å¤–çš„ Web å¼€å‘åœˆå­å†…ç››è¡Œèµ·æ¥ã€‚å›½å†…å€’æ˜¯è‡³ä»Šä»ç„¶ä¸æ¸©ä¸ç«ã€‚2020 å¹´çš„ Ruby China ä¸Šè¿‡çº¯ä¸­åšè¿‡ä¸€æ¬¡åœ¨é¡¹ç›®ä¸Šä½¿ç”¨ tailwindcss ä½“éªŒçš„æœ‰å…³æ¼”è®²ã€‚æˆ‘åœ¨ 2020 å¹´ä¹Ÿå†™è¿‡ä¸€ç¯‡æœ‰å…³çš„åšå®¢â€œåœ¨ Rails 6 ä¸­æ•´åˆ Stimulus å’Œ Tailwind CSSâ€ï¼ˆè¢«å‰è€…åœ¨æ¼”è®²ä¸­æ‰€å¼•ç”¨^_^ï¼‰ã€‚ è¿™ç¯‡æ–‡ç« æ¥èŠä¸€ä¸‹æœ‰å…³ Tailwindcss åº•å±‚ç†å¿µçš„ä¸œè¥¿ã€‚äº†è§£äº†è¿™ä¸ªï¼Œå†æ¥çœ‹å®ƒå°±ä¸è§‰å¾—æ¯«æ— å¤´ç»ªè€Œç•æƒ§äº†ã€‚ åœ¨ Tailwindcss ä¸­ï¼Œâ€œå·¥å…·ç±»ä¸ºä¸€ç­‰å…¬æ°‘ï¼ˆutility classes are kingï¼‰â€ã€‚è¿™ç§å·¥å…·ç±»åœ¨ Bootstrap ä¸­æ—©å·²ä¸ºäººç†ŸçŸ¥ï¼Œå¹¶éä»€ä¹ˆæ–°é²œäº‹ç‰©ï¼Œæ¯”å¦‚text-muted,bg-successã€‚ä½† Tailwindcss åˆæœ‰æ‰€ä¸åŒï¼Œæ­£æ˜¯è¿™äº›ä¸åŒä½¿å¾—å®ƒæ›´â€œTailwindâ€ã€‚ å¤§éƒ¨åˆ†æ—¶é—´å†…ï¼Œåœ¨ä½¿ç”¨ Tailwindcss æ—¶éƒ½é¢å¯¹ä¸¤ç±»å¯¹è±¡ã€‚ä¸€ä¸ªæ˜¯ themeï¼Œé€šç”¨æ€§é…ç½®ã€‚å¦ä¸€ä¸ªæ˜¯ä¸€å¤§å †çš„ property åˆ—è¡¨ï¼Œå¯æŠŠå®ƒä»¬ç”¨åœ¨ theme ä¸Šã€‚theme æœ‰ä¸€ç³»åˆ—çš„ç»†ç²’åº¦å¯¹è±¡ï¼Œæä¾›äº†è¶…å¤šçš„å¯é…ç½®é¡¹ã€‚ æ¯”å¦‚è¯´ï¼Œåœ¨å¼€å§‹ä¸€ä¸ª theme çš„è®¾è®¡æ—¶ï¼Œä¼šä»è¿™ä¸‰ç§é…ç½®å¼€å§‹ï¼šscreenã€colorã€spacingã€‚é¦–å…ˆæ¥çœ‹ color å’Œ spacingï¼š  Color ä» 0 å¼€å§‹ï¼Œä¸€ç›´åˆ° 900ã€‚è¶Šæ¥è¿‘ 900ï¼Œcolor å°±è¶Šæš—ï¼Œåä¹‹åˆ™è¶Šäº®ã€‚ Spacing æ˜¯ space ä¹‹æ•°å­—ï¼Œæˆ–å¯¹è±¡ä¹‹å¤§å°ï¼Œåœ¨ 0 - 96 ä¹‹é—´ã€‚è¿˜æœ‰ä¸Šé¢æ‰€æåˆ°çš„é‚£äº› propertyï¼Œæ¯”å¦‚margin,width,paddingç­‰ã€‚ åªè¦æœ‰äº†è¿™ä¸¤ç§â€œå˜é‡â€ï¼Œä½ å°±å¯ä»¥æŠŠå®ƒä»¬å¦‚æ­¤ç»„åˆèµ·æ¥ï¼š{property}-{color/spacing}ã€‚å¦‚æœæƒ³è¦ä¸€ä¸ªæš—çº¢è‰²çš„èƒŒæ™¯ï¼Œå°±å†™bg-red-900ï¼Œè€Œå¦‚æœæƒ³è¦ 6 ä¸ªåƒç´ çš„ paddingï¼Œå°±å†™p-6ã€‚ å†çœ‹ screenã€‚Screen ç”¨äºå“åº”å¼çš„ breakpointï¼Œå¦‚ desktop / tablet / mobile çš„è®¾è®¡ä¸Šï¼ˆsm,md,lg,xlï¼‰ã€‚æœ‰äº† screen ä¹‹åï¼Œä¸Šé¢çš„å…¬å¼å°±å˜ä¸º{screen}:{property}-{color/spacing}ã€‚ ç”¨ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹æ¥æ¼”ç¤ºã€‚ æˆ‘æƒ³è¦ä¸€ä¸ªæœ‰æš—çº¢è‰²èƒŒæ™¯ï¼Œç™½è‰²æ–‡å­—ï¼Œä»¥åŠ padding ä¸º 6 çš„ DIVï¼š &lt;div class= bg-red-900 text-white p-6 &gt;Messi&lt;/div&gt;æ¥ä¸‹æ¥å¯ä»¥å†æ·»åŠ ä¸€äº›åˆ«çš„å·¥å…·ç±»ã€‚æƒ³è¦æŠŠè¿™ä¸ª DIV åœ¨æµè§ˆå™¨å†…å±…ä¸­ï¼Œå¯ç”¨mx-autoã€‚æƒ³è¦è®©å…¶å®½åº¦è‡ªåŠ¨æ‰©å±•ï¼Œå¯ç”¨w-autoã€‚æœ€åï¼Œæƒ³è¦è®©å…¶æ–‡å­—å±…ä¸­ï¼Œæ˜¾ç„¶ï¼Œç”¨text-centerå³å¯ï¼š &lt;div class= bg-red-900 p-6 mx-auto w-auto       text-white text-center  &gt;Messi&lt;/div&gt;è¿™æ ·ï¼Œåœ¨ desktop ä¸Šçœ‹èµ·æ¥å·²ç»å¾ˆå¥½äº†ã€‚ä¸è¿‡ï¼Œæˆ‘æƒ³åœ¨ mobile ä¸Š padding è¦æ›´å°ä¸€ç‚¹ã€‚æ­¤æ—¶ï¼Œå°±æ˜¯ screen å‘æŒ¥ä½œç”¨çš„æ—¶å€™äº†ã€‚é€‚é…ä¸åŒçš„ breakpoint å’Œ property èƒ½å¸¦æ¥å¾ˆå¤šå¥½å¤„ã€‚å‡è®¾é»˜è®¤ padding ä¸º 3ï¼Œè€Œä» phone è¿‡æ¸¡åˆ° tablet çš„å°ºå¯¸ï¼Œåˆ™ä½¿å…¶ padding å˜ä¸º 6ï¼š &lt;div class= bg-red-900 p-3 md:p-6 mx-auto       w-auto text-white text-center &gt;Messi&lt;/div&gt;æœ€åï¼Œå†é’ˆå¯¹å„ breakpoint åˆ†åˆ«é€‚é…ä»¥é€‚å½“çš„æ–‡å­—ï¼š &lt;div class= bg-red-900 text-center p-3       mx-auto w-auto text-white text-center       text-md md:text-lg lg:text-2xl  &gt;Messi&lt;/div&gt;Tailwindcss è¿˜æœ‰å¾ˆå¤šå…¶ä»–ç±»ä¼¼çš„å·¥å…·ç±»ï¼Œ å®ƒçš„å®˜æ–¹æ–‡æ¡£ä¸­éƒ½æœ‰è¯¦ç»†è®²è¿°ã€‚ è¿™ä¸€åˆ‡çœ‹èµ·æ¥æ˜¯â€œè¿‡åº¦è®¾è®¡â€äº†ï¼Œç„¶è€Œ Tailwindcss çš„é—ªå…‰ä¹‹å¤„ï¼Œå°±æ˜¯â€œç»„ä»¶é©±åŠ¨è®¾è®¡ï¼ˆcomponent driven designï¼‰â€ã€‚æŠŠè¿™äº›å·¥å…·ç±»ç”¨äºç»„ä»¶ä¹‹ä¸Šï¼Œç„¶åç»„ä»¶ç”¨äºç³»ç»Ÿå„å¤„ã€‚å¤šä¸ªç»„ä»¶åˆ™å¯æ„æˆç»„ä»¶åº“ã€‚ç»„ä»¶åº“å³ç±»ä¼¼äº Bootstrap é‡Œçš„ modal ä¹‹ç±»ã€‚ ä¸€äº›ç›¸å…³çš„ Tailwindcss component é“¾æ¥:  https://tailwindui. com/ Tailwindcss å®˜æ–¹çš„ UI kit ç«™ç‚¹ https://tailwindcomponents. com/ ä¸€ä¸ªç¤¾åŒºç±» components é›†åˆç«™ç‚¹ https://tailwind. build/editor ä¸€ä¸ª Tailwindcss component builder"
    }, {
    "id": 15,
    "url": "/2021/03/hotwire-build-turbo-application/",
    "title": "Hotwireä¹‹æ„å»ºTurboåº”ç”¨",
    "body": "2021/03/26 - æœ¬æ–‡æ˜¯å¯¹æ„å»º Turbo åº”ç”¨çš„å…·ä½“æè¿°ï¼ŒåŸæ–‡å‡ºè‡ªï¼šhttps://turbo. hotwire. dev/handbook/buildingã€‚ Turbo ä¹‹æ‰€ä»¥å¿«æ˜¯å› ä¸ºå½“ä½ ç‚¹å‡»é“¾æ¥æˆ–è€…æäº¤è¡¨å•æ—¶å®ƒé˜²æ­¢äº†æ•´ä¸ªé¡µé¢çš„é‡æ–°åŠ è½½ã€‚ä½ çš„åº”ç”¨æˆä¸ºæµè§ˆå™¨ä¸­å¸¸é©»è€Œä¸åœè¿è½¬çš„è¿›ç¨‹ã€‚è¿™å°±éœ€è¦ä½ é‡æ–°è€ƒè™‘ç»„ç»‡ä½ çš„ JavaScript çš„æ–¹å¼ã€‚ ç‰¹åˆ«æ˜¯ï¼Œä½ å¯ä»¥ä¸å†ä¾èµ–äºé¡µé¢çš„æ¯æ¬¡å¯¼èˆªæ—¶æ•´ä¸ªé¡µé¢çš„è½½å…¥æ¥é‡ç½®ä½ çš„ç¯å¢ƒã€‚JavaScript çš„windowå’Œdocumentå¯¹è±¡åœ¨é¡µé¢å˜æ›´æœŸé—´ä¿æŒå…¶çŠ¶æ€ï¼Œè€Œä»»ä½•å…¶ä»–ä½ æ”¾å…¥å†…å­˜çš„å¯¹è±¡å°†ä¼šç•™åœ¨å†…å­˜ä¸­ã€‚ æœ‰äº†è¿™ä¸ªæ„è¯†ï¼Œå¹¶ç¨å¾®å°å¿ƒä¸€ç‚¹ï¼Œä½ å°±èƒ½å¯¹åº”ç”¨è¿›è¡Œè®¾è®¡ä»¥ä¼˜é›…åœ°å¤„ç†è¿™ç§çº¦æŸï¼Œè€Œæ— éœ€ä¸ Turbo ç´§å¯†è€¦åˆåœ¨ä¸€èµ·ã€‚ Working with Script Elements: æµè§ˆå™¨ä¼šè‡ªåŠ¨è½½å…¥å¹¶æ‰§è¡Œä»»ä½•åˆå§‹é¡µé¢åŠ è½½çš„&lt;script&gt;å…ƒç´ ã€‚ å½“ä½ å¯¼èˆªåˆ°ä¸€ä¸ªæ–°é¡µé¢æ—¶ï¼ŒTurbo Drive å°±æŸ¥æ‰¾åœ¨æ–°é¡µé¢çš„&lt;head&gt;ä¸­çš„ä»»ä½•&lt;script&gt;å…ƒç´ ï¼Œä¸”å…¶æœªå‡ºç°äºå½“å‰é¡µé¢ä¸Šã€‚ç„¶åï¼ŒTurbo Drive æŠŠå®ƒä»¬ append åˆ°å½“å‰çš„&lt;head&gt;ï¼Œæµè§ˆå™¨å¯¹å…¶è¿›è¡ŒåŠ è½½å’Œæ‰§è¡Œã€‚ä½ å¯ä»¥ç”±æ­¤æ¥æŒ‰éœ€åŠ è½½é¢å¤–çš„ JavaScript æ–‡ä»¶ã€‚ Turbo Drive åœ¨æ¯æ¬¡æ¸²æŸ“é¡µé¢æ—¶æ‰§è¡Œè¯¥é¡µé¢&lt;body&gt;ä¸­çš„&lt;script&gt;å…ƒç´ ã€‚ä½ å¯ä»¥ä½¿ç”¨ inline body script æ¥å»ºç«‹æ¯ä¸ªé¡µé¢çš„ JavaScript çŠ¶æ€æˆ–è€…å¯åŠ¨å®¢æˆ·ç«¯çš„ modelã€‚è¦å»ºç«‹æŸäº›è¡Œä¸ºï¼Œæˆ–åœ¨é¡µé¢å˜æ›´æ—¶æ‰§è¡Œæ›´å¤æ‚çš„æ“ä½œï¼Œé¿å…ä½¿ç”¨ script å…ƒç´ ï¼Œä½¿ç”¨turbo:loadäº‹ä»¶æ¥ä»£æ›¿ã€‚ å¦‚æœä½ ä¸æƒ³ Turbo åœ¨é¡µé¢æ¸²æŸ“åæ‰§è¡Œ&lt;script&gt;å…ƒç´ ï¼Œå°±ä½¿ç”¨data-turbo-eval= false å¯¹å…¶è¿›è¡Œæ³¨è§£ã€‚æ³¨æ„ï¼Œè¿™ç§æ³¨è§£ä¸ä¼šé˜²æ­¢æµè§ˆå™¨åœ¨åˆå§‹é¡µé¢åŠ è½½æ—¶æ‰§è¡Œè¿™äº› scriptsã€‚ Loading Your Applicationâ€™s JavaScript Bundle: è¦æ€»æ˜¯ç¡®ä¿åœ¨&lt;head&gt;ä¸­ä½¿ç”¨&lt;script&gt;å…ƒç´ æ¥åŠ è½½ä½ åº”ç”¨çš„ JavaScript æ‰“åŒ…æ–‡ä»¶ã€‚å¦åˆ™ï¼ŒTurbo Drive å°†ä¼šåœ¨æ¯æ¬¡é¡µé¢å˜æ›´æ—¶éƒ½é‡è½½å®ƒã€‚ &lt;head&gt; . . .  &lt;script src= /application-cbd3cd4. js  defer&gt;&lt;/script&gt;&lt;/head&gt;ä½ ä¹Ÿåº”è¯¥è€ƒè™‘æŠŠ asset æ‰“åŒ…ç³»ç»Ÿé…ç½®æˆç»™æ¯ä¸ª script åŠ ä¸ŠæŒ‡çº¹ï¼Œè¿™æ ·å½“å…¶å†…å®¹å˜åŠ¨æ—¶å°±ä¼šæ˜¯ä¸€ä¸ªæ–°çš„ URLã€‚ç„¶åï¼Œä½ å¯ä»¥ä½¿ç”¨data-turbo-trackå±æ€§æ¥å¼ºåˆ¶å½“éƒ¨ç½²äº†æ–° JavaScript æ‰“åŒ…æ–‡ä»¶ä¹‹ååšä¸€æ¬¡å…¨é¡µé¢é‡è½½ã€‚å‚çœ‹ Assets å˜æ›´åé‡è½½ å¯è·å¾—æ›´å¤šä¿¡æ¯ã€‚ Understanding Caching: Turbo Drive ç»´æŠ¤ç€è¿‘æœŸè®¿é—®é¡µé¢çš„ä¸€ä¸ªç¼“å­˜ã€‚è¯¥ç¼“å­˜æœ‰ä¸¤ä¸ªç›®çš„ï¼šåœ¨ restoration è®¿é—®æœŸé—´å±•ç¤ºé¡µé¢æ— éœ€è®¿é—®ç½‘ç»œï¼Œå’Œåœ¨ application è®¿é—®æœŸé—´é€šè¿‡æ˜¾ç¤ºä¸´æ—¶æ€§çš„é¢„è§ˆæ¥æå‡å¯æ„ŸçŸ¥çš„æ€§èƒ½ã€‚ å½“é€šè¿‡ history å¯¼èˆªï¼ˆä»¥ Restoration è®¿é—®ï¼‰ï¼Œåªè¦å¯èƒ½ï¼ŒTurbo Drive å°†ä»ç¼“å­˜æ¢å¤é¡µé¢è€Œæ— éœ€ä»ç½‘ç»œåŠ è½½ä¸€ä¸ªå…¨æ–°çš„æ‹·è´ã€‚ å¦åˆ™ï¼Œåœ¨æ ‡å‡†å¯¼èˆªæœŸé—´ï¼ˆä»¥ Application è®¿é—®ï¼‰ï¼ŒTurbo Drive å°†ä»ç¼“å­˜ä¸­ç«‹å³æ¢å¤é¡µé¢ä½œä¸ºä¸€ä¸ªé¢„è§ˆï¼Œå¹¶åŒæ—¶ä»ç½‘ç»œåŠ è½½ä¸€ä¸ªå…¨æ–°æ‹·è´ã€‚è¿™å°±ç»™ç»å¸¸è®¿é—®çš„ä½ç½®å¸¦æ¥äº†ç¬æ—¶é¡µé¢åŠ è½½çš„é”™è§‰ã€‚ Turbo Drive åœ¨æ¸²æŸ“æ–°é¡µé¢ä¹‹å‰ï¼ŒæŠŠå½“å‰é¡µé¢çš„ä¸€ä¸ªæ‹·è´ä¿å­˜åˆ°å…¶ç¼“å­˜ä¸­ã€‚æ³¨æ„ï¼ŒTurbo Drive ä½¿ç”¨äº†cloneNode(true) æ¥æ‹·è´é¡µé¢ï¼Œè¿™æ„å‘³ç€ä»»ä½• attach çš„äº‹ä»¶ç›‘å¬åŠå…³è”æ•°æ®éƒ½è¢«ä¸¢å¼ƒæ‰ã€‚ Preparing the Page to be Cached: å¦‚æœä½ éœ€è¦åœ¨ Turbo Drive ç¼“å­˜å¯¹å…¶ä¹‹å‰å‡†å¤‡ documentï¼Œå¯ä»¥ç›‘å¬turbo-cacheäº‹ä»¶ã€‚ä½¿ç”¨è¯¥äº‹ä»¶æ¥é‡ç½®è¡¨å•ã€æ”¶èµ·æ‰€å±•å¼€çš„ UI å…ƒç´ ã€æˆ–æ¸…ç†ä»»ä½•ç¬¬ä¸‰æ–¹çš„ widgetsï¼Œä»¥ä¾¿å‡†å¤‡å¥½é‡æ–°æ˜¾ç¤ºè¯¥é¡µé¢ã€‚ document. addEventListener( turbo:before-cache , function() { // . . . })Detecting When a Preview is Visible: å½“ Turbo Drive ä»ç¼“å­˜ä¸­å±•ç¤ºä¸€ä¸ªé¢„è§ˆæ—¶ï¼Œå®ƒå‘&lt;html&gt;å…ƒç´ ä¸Šæ·»åŠ äº†ä¸€ä¸ªturbo-previewå±æ€§ã€‚å½“ä¸€ä¸ªé¢„è§ˆå¯è§çš„æ—¶å€™ï¼Œä½ å°±å¯ä»¥æ£€æŸ¥è¯¥å±æ€§çš„å­˜åœ¨è€Œæœ‰é€‰æ‹©åœ°å¯ç”¨æˆ–ç¦ç”¨è¡Œä¸ºã€‚ if (document. documentElement. hasAttribute( data-turbo-preview )) { // Turbo Drive is displaying a preview}Opting Out of Caching: æ‚¨å¯ä»¥é€šè¿‡åœ¨é¡µé¢çš„&lt;head&gt;ä¸­åŒ…å«&lt;meta name = turbo-cache-control &gt;å…ƒç´ å¹¶å£°æ˜ä¸€ä¸ªç¼“å­˜æŒ‡ä»¤æ¥æ§åˆ¶æ¯ä¸ªé¡µé¢çš„ç¼“å­˜è¡Œä¸ºã€‚ ä½¿ç”¨no-previewæŒ‡ä»¤æ¥æŒ‡å®šåœ¨ application è®¿é—®æœŸé—´ï¼Œé¡µé¢çš„ä¸€ä¸ªç¼“å­˜ç‰ˆæœ¬ä¸ä½œä¸ºé¢„è§ˆè¢«æ˜¾ç¤ºã€‚è¢«æ ‡æ³¨äº† no-preview çš„é¡µé¢å°†åªè¢«ç”¨äº restoration è®¿é—®ã€‚ è¦æŒ‡å®šä¸€ä¸ªé¡µé¢å®Œå…¨ä¸åº”è¯¥è¢«ç¼“å­˜ï¼Œä½¿ç”¨no-cacheæŒ‡ä»¤ã€‚è¢«æ ‡æ³¨äº† no-cache çš„é¡µé¢å°†æ€»æ˜¯é€šè¿‡ç½‘ç»œè·å–ï¼ŒåŒ…æ‹¬åœ¨ restoration è®¿é—®æœŸé—´ã€‚ &lt;head&gt; . . .  &lt;meta name= turbo-cache-control  content= no-cache &gt;&lt;/head&gt;è¦å®Œå…¨ç¦ç”¨åº”ç”¨ä¸­çš„ç¼“å­˜ï¼Œå°±è¦ç¡®ä¿æ¯ä¸ªé¡µé¢éƒ½åŒ…å« no-cache æŒ‡ä»¤ã€‚ Installing JavaScript Behavior: ä½ å¯èƒ½ä¹ æƒ¯äºåŠ å…¥ JavaScript è¡Œä¸ºæ¥å“åº”window. onloadï¼ŒDOMContentLoadedï¼Œæˆ–è€… JQuery çš„readyäº‹ä»¶ã€‚ä½¿ç”¨ Turbo æ—¶ï¼Œè¿™äº›äº‹ä»¶å°†åªåœ¨åˆå§‹é¡µé¢åŠ è½½æ—¶è¢«è§¦å‘ï¼Œä¹‹åçš„ä»»ä½•åç»­é¡µé¢å˜æ›´éƒ½ä¸ä¼šè§¦å‘ã€‚æˆ‘ä»¬æ¥æ¯”è¾ƒä¸‹æŠŠ JavaScript è¡Œä¸ºè¿æ¥åˆ° DOM çš„ä¸¤ç§ç­–ç•¥ã€‚ Observing Navigation Events: Turbo Drive åœ¨å¯¼èˆªæœŸé—´è§¦å‘ä¸€ç³»åˆ—äº‹ä»¶ã€‚å…¶ä¸­æœ€é‡è¦çš„æ˜¯turbo:loadäº‹ä»¶ï¼Œå…¶åªåœ¨åˆå§‹é¡µé¢åŠ è½½æ—¶è§¦å‘ä¸€æ¬¡ï¼Œå¹¶åœ¨æ¯æ¬¡ Turbo Drive è®¿é—®æ—¶è§¦å‘ä¸€æ¬¡ã€‚ ä½ å¯ä»¥åœ¨DOMContentLoadedå†…ç›‘å¬turbo:loadäº‹ä»¶æ¥åœ¨æ¯æ¬¡é¡µé¢å˜æ›´æ—¶å»ºç«‹ JavaScript è¡Œä¸ºï¼š document. addEventListener( turbo:load , function() { // . . . })è®°ä½ï¼Œå½“è¯¥äº‹ä»¶è¢«è§¦å‘æ—¶ï¼Œä½ çš„åº”ç”¨ä¸ä¼šæ€»æ˜¯åœ¨ä¸€ä¸ªå´­æ–°çš„çŠ¶æ€ï¼Œè€Œä½ å°±å¯èƒ½éœ€è¦æ¸…ç†å‰ä¸€ä¸ªé¡µé¢æ‰€å»ºç«‹çš„è¡Œä¸ºã€‚ ä¹Ÿè¦æ³¨æ„ï¼ŒTurbo Drive çš„å¯¼èˆªå¯èƒ½ä¸æ˜¯ä½ åº”ç”¨ä¸­çš„é¡µé¢æ›´æ–°çš„å”¯ä¸€æºå¤´ï¼Œæ‰€ä»¥ä½ å¯èƒ½æœŸæœ›æŠŠä½ çš„åˆå§‹åŒ–ä»£ç ç§»åˆ°ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°å†…ï¼Œä½ å¯ä»¥ä»turbo:loadå’Œä»»ä½•å…¶ä»–å¯èƒ½å˜æ›´ DOM çš„åœ°æ–¹æ¥è°ƒç”¨å®ƒ å¯èƒ½çš„è¯ï¼Œé¿å…ä½¿ç”¨turbo:loadäº‹ä»¶æ¥æŠŠå…¶ä»–äº‹ä»¶ç›‘å¬å™¨ç›´æ¥æ·»åŠ åˆ°é¡µé¢ body çš„å…ƒç´ ä¸Šã€‚ç›¸åï¼Œè€ƒè™‘ä½¿ç”¨äº‹ä»¶å§”æ‰˜æ¥æŠŠäº‹ä»¶ç›‘å¬å™¨æ³¨å†Œåˆ°documentæˆ–windowä»…ä¸€æ¬¡ã€‚ å‚çœ‹å…¨éƒ¨äº‹ä»¶åˆ—è¡¨è·å–æ›´å¤šä¿¡æ¯ã€‚ Attaching Behavior With Stimulus: æ–° DOM å…ƒç´ å¯ä»¥åœ¨ä»»ä½•æ—¶åˆ»å‘ˆç°åœ¨é¡µé¢ä¸Šï¼Œé€šè¿‡ frame å¯¼èˆªã€stream ä¿¡æ¯ã€æˆ–å®¢æˆ·ç«¯æ¸²æŸ“æ“ä½œç­‰æ–¹å¼ï¼Œè€Œè¿™äº›å…ƒç´ ç»å¸¸éœ€è¦å¦‚åŒå‡ºç°äºä¸€ä¸ªå…¨æ–°é¡µé¢åŠ è½½é‚£æ ·è¢«åˆå§‹åŒ–ã€‚ å¯¹äºæ‰€æœ‰è¿™äº›æ›´æ–°ï¼ŒåŒ…æ‹¬ä» Turbo Drive é¡µé¢åŠ è½½çš„æ›´æ–°ï¼Œä½ å¯ä»¥å€ŸåŠ©äº Turbo çš„å…„å¼Ÿæ¡†æ¶ Stimulus æ‰€æä¾›çš„çº¦å®šå’Œå›è°ƒç”Ÿå‘½å‘¨æœŸï¼Œåœ¨ä¸€ä¸ªå•ç‹¬çš„åœ°æ–¹æ¥å¤„ç†å®ƒä»¬ã€‚ Stimulus è®©ä½ ä½¿ç”¨ controllerã€action å’Œ target å±æ€§å¯¹ HTML è¿›è¡Œæ³¨é‡Šï¼š &lt;div data-controller= hello &gt; &lt;input data-hello-target= name  type= text &gt; &lt;button data-action= click-&gt;hello#greet &gt;Greet&lt;/button&gt;&lt;/div&gt;å®ç°å…¶ç›¸åº”çš„ controller å¹¶ç”± Stimulus è‡ªåŠ¨è¿æ¥åˆ°å®ƒï¼š // hello_controller. jsimport { Controller } from  stimulus export default class extends Controller { greet() {  console. log(`Hello, ${this. name}!`) } get name() {  return this. targets. find( name ). value }}Stimulus ä½¿ç”¨ MutationObserver APIï¼Œåªè¦ document å‘ç”Ÿå˜æ›´ï¼Œè¿™äº› controllers å’Œå®ƒä»¬ç›¸å…³è”çš„äº‹ä»¶å¤„ç†å™¨å°±ä¼šè¢«è¿æ¥åŠæ–­å¼€è¿æ¥ã€‚ç»“æœå°±æ˜¯ï¼Œå®ƒä¼šå¤„ç† Turbo Drive é¡µé¢å˜æ›´ã€Turbo Frames å¯¼èˆªã€ä»¥åŠ Turbo Streams ä¿¡æ¯ï¼Œä»¥å®ƒå¤„ç†å…¶ä»–ç±»å‹ DOM æ›´æ–°å®Œå…¨åŒæ ·çš„æ–¹å¼ã€‚ Making Transformations Idempotent: ä½ ç»å¸¸ä¼šæƒ³è¦åœ¨å®¢æˆ·ç«¯å¯¹æ¥æ”¶è‡ªæœåŠ¡ç«¯çš„ HTML æ‰§è¡Œå˜æ¢ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³åˆ©ç”¨æµè§ˆå™¨å¯¹ç”¨æˆ·å½“å‰æ—¶åŒºçš„äº†è§£æ¥æŒ‰æ—¥æœŸå¯¹å…ƒç´ é›†åˆè¿›è¡Œåˆ†ç»„ã€‚ å‡è®¾ä½ å·²ç»å¯¹ä¸€ç»„å…ƒç´ æ³¨é‡Šä»¥data-timestampå±æ€§æ¥æŒ‡ç¤ºå…¶ UTC åˆ›å»ºæ—¶é—´ã€‚ä½ æœ‰ä¸€ä¸ª JavaScript å‡½æ•°æ¥æŸ¥è¯¢ document ä¸­æ‰€æœ‰è¿™æ ·çš„å…ƒç´ ï¼ŒæŠŠæ—¶é—´æˆ³è½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´ï¼Œå¹¶åœ¨æ¯ä¸ªå‘ç”Ÿäºæ–°çš„ä¸€å¤©çš„å…ƒç´ ä¹‹å‰æ’å…¥æ—¥æœŸè¡¨å¤´ã€‚ è€ƒè™‘ä¸‹å¦‚æœä½ å·²ç»é…ç½®å¥½è¯¥å‡½æ•°åœ¨turbo:loadä¸Šæ‰§è¡Œçš„è¯ä¼šå‘ç”Ÿä»€ä¹ˆã€‚å½“ä½ å¯¼èˆªåˆ°è¯¥é¡µé¢ï¼Œä½ çš„å‡½æ•°æ’å…¥äº†æ—¥æœŸè¡¨å¤´ã€‚å†ç¦»å¼€è¯¥é¡µé¢ï¼Œåˆ™ Turbo Drive æŠŠä¸€ä¸ªå˜æ¢åé¡µé¢çš„æ‹·è´å­˜å…¥ç¼“å­˜ã€‚ç°åœ¨æŒ‰ä¸‹æµè§ˆå™¨å›é€€æŒ‰é’®â€”â€”Turbo Drive æ¢å¤é¡µé¢ï¼Œå†æ¬¡è§¦å‘turbo:loadï¼Œåˆ™ä½ çš„å‡½æ•°æ’å…¥ç¬¬äºŒä¸ªæ—¥æœŸè¡¨å¤´ã€‚ ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œå°±è¦è®©ä½ çš„è½¬æ¢å‡½æ•°æ˜¯å¹‚ç­‰çš„ã€‚å¹‚ç­‰è½¬æ¢èƒ½å®‰å…¨åœ°æ‰§è¡Œå¤šæ¬¡è€Œä¸ä¼šæ”¹å˜å…¶æœ€åˆåº”ç”¨çš„ç»“æœã€‚ ä½¿è½¬æ¢å¹‚ç­‰çš„ä¸€ç§æŠ€æœ¯æ˜¯é€šè¿‡åœ¨æ¯ä¸ªå¤„ç†çš„å…ƒç´ ä¸Šè®¾ç½®ä¸€ä¸ªdataå±æ€§æ¥è·Ÿè¸ªæ˜¯å¦å·²ç»æ‰§è¡Œäº†å˜æ¢ã€‚å½“ Turbo Drive ä»ç¼“å­˜ä¸­æ¢å¤é¡µé¢æ—¶ï¼Œè¿™äº›å±æ€§ä¼šä»ç„¶å­˜åœ¨ã€‚åœ¨ä½ çš„å‡½æ•°ä¸­æ£€æµ‹è¿™äº›å±æ€§ä»¥ç¡®å®šå“ªä¸ªå…ƒç´ å·²ç»è¢«å¤„ç†è¿‡äº†ã€‚ æ›´å¥å£®çš„ä¸€ç§æŠ€æœ¯æ˜¯ç®€å•åœ°æ£€æµ‹è½¬æ¢è‡ªèº«ã€‚åœ¨ä¸Šé¢æ—¥æœŸåˆ†ç»„çš„ç¤ºä¾‹ä¸­ï¼Œè¿™æ„å‘³ç€åœ¨æ’å…¥ä¸€ä¸ªæ–°æ—¥æœŸåˆ†å‰²çº¿ä¹‹å‰æ£€æŸ¥å…¶å­˜åœ¨ä¸å¦ã€‚è¿™ä¸ªæ–¹æ¡ˆä¼˜é›…åœ°å¤„ç†äº†æœªè¢«åˆå§‹è½¬æ¢æ‰€å¤„ç†çš„æ–°æ’å…¥å…ƒç´ ã€‚ Persisting Elements Across Page Loads: Turbo Drive å…è®¸ä½ æŠŠæŸäº›å…ƒç´ æ ‡æ³¨ä¸º permanentã€‚Permanent å…ƒç´ åœ¨é¡µé¢åŠ è½½ä¹‹é—´éƒ½å­˜ç•™ç€ï¼Œæ‰€ä»¥ä½ å¯¹è¿™äº›å…ƒç´ çš„ä»»ä½•å˜æ›´éƒ½ä¸éœ€è¦åœ¨é¡µé¢å¯¼èˆªä¹‹åå†æ¬¡èµ‹äºˆã€‚ è€ƒè™‘ä¸‹ä¸€ä¸ªå¸¦è´­ç‰©è½¦çš„ Turbo Drive åº”ç”¨ã€‚åœ¨æ¯ä¸ªé¡µé¢é¡¶éƒ¨éƒ½æ˜¯ä¸€ä¸ªå›¾æ ‡ï¼Œæœ‰å½“å‰åœ¨è´­ç‰©è½¦å†…çš„å•†å“æ•°é‡ã€‚è¿™ä¸ªè®¡æ•°å™¨æ˜¯å€ŸåŠ© JavaScript åŠ¨æ€æ›´æ–°çš„ï¼Œå½“å•†å“è¢«æ·»åŠ å’Œç§»é™¤æ—¶ã€‚ ç°åœ¨æƒ³è±¡ä¸€ä¸‹ï¼Œä¸€ä¸ªç”¨æˆ·åœ¨è¯¥åº”ç”¨ä¸­å·²ç»å¯¼èˆªåˆ°è¿‡å¤šä¸ªé¡µé¢ã€‚å¥¹æ·»åŠ ä¸€ä¸ªå•†å“åˆ°è´­ç‰©è½¦ï¼Œç„¶åæŒ‰ä¸‹æµè§ˆå™¨å›é€€æŒ‰é’®ã€‚Turbo Drive ä»ç¼“å­˜ä¸­æ¢å¤äº†å‰ä¸€ä¸ªé¡µé¢çš„çŠ¶æ€ï¼Œè€Œè´­ç‰©è½¦çš„å•†å“è®¡æ•°è¢«é”™è¯¯åœ°ä» 1 å˜ä¸º 0ã€‚ ä½ å¯ä»¥é€šè¿‡ä½¿è®¡æ•°å™¨å…ƒç´  permanent æ¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚è¦åˆ¶å®šå…ƒç´ ä¸º permanentï¼Œèµ‹äºˆå®ƒä»¬ä¸€ä¸ª HTML idï¼Œå¹¶ä»¥data-turbo-permanentæ¥æ³¨é‡Šå®ƒä»¬ã€‚ &lt;div id= cart-counter  data-turbo-permanent&gt;1 item&lt;/div&gt;æ¯æ¬¡æ¸²æŸ“ä¹‹å‰ï¼ŒTurbo Drive é€šè¿‡ ID åŒ¹é…åˆ°æ‰€æœ‰çš„ permanent å…ƒç´ ï¼Œå¹¶æŠŠå®ƒä»¬ä»åˆå§‹é¡µé¢è½¬æ¢åˆ°æ–°é¡µé¢ï¼Œä¿ç•™å…¶æ•°æ®å’Œäº‹ä»¶ç›‘å¬å™¨ã€‚ "
    }, {
    "id": 16,
    "url": "/2021/03/hotwire-turbo-streams/",
    "title": "Hotwireä¹‹ä½¿ç”¨Turbo Streamsç„•å‘æ´»åŠ›",
    "body": "2021/03/19 - æœ¬æ–‡æ˜¯å¯¹ Turbo Streams çš„è¯¦ç»†è¯´æ˜ï¼ŒåŸæ–‡å‡ºè‡ªï¼šhttps://turbo. hotwire. dev/handbook/streamsã€‚ Turbo Streams å°†é¡µé¢çš„æ›´æ”¹å‘å¸ƒä¸ºåŒ…åœ¨è‡ªè§£é‡Šçš„&lt;turbo-stream&gt;å…ƒç´ ä¸­çš„ HTML ç‰‡æ®µã€‚æ¯ä¸ª stream å…ƒç´ éƒ½ä¼šåŒæ—¶æŒ‡å®šä¸€ä¸ª action å’Œ target IDï¼Œä»¥å£°æ˜å…¶å†…çš„ HTML ä¼šæ€æ ·å¤„ç†ã€‚è¿™äº›å…ƒç´ è¢«æœåŠ¡ç«¯é€šè¿‡ WebSocketã€SSE æˆ–å…¶ä»–ä¼ è¾“æ–¹å¼å‘å¸ƒï¼Œå€ŸåŠ©ç”±å…¶ä»–ç”¨æˆ·æˆ–è¿›ç¨‹è¿›è¡Œçš„æ›´æ–°ä½¿åº”ç”¨ç¨‹åºç„•å‘æ´»åŠ›ã€‚æŠµè¾¾ä½ çš„ imbox çš„æ–°é‚®ä»¶å°±æ˜¯ä¸€ä¸ªç»ä½³çš„èŒƒä¾‹ã€‚ Stream Messages and Actions: ä¸€ä¸ª Turbo Streams æ¶ˆæ¯æ˜¯ä¸€ä¸ªç”±&lt;turbo-stream&gt;å…ƒç´ ç»„æˆçš„ HTML ç‰‡æ®µã€‚ä¸‹é¢çš„ stream æ¶ˆæ¯æ¼”ç¤ºäº†äº”ç§å¯ç”¨çš„ stream actionsï¼š &lt;turbo-stream action= append  target= messages &gt; &lt;template&gt;  &lt;div id= message_1 &gt;   This div will be appended to the element with the DOM ID  messages .   &lt;/div&gt; &lt;/template&gt;&lt;/turbo-stream&gt;&lt;turbo-stream action= prepend  target= messages &gt; &lt;template&gt;  &lt;div id= message_1 &gt;   This div will be prepended to the element with the DOM ID  messages .   &lt;/div&gt; &lt;/template&gt;&lt;/turbo-stream&gt;&lt;turbo-stream action= replace  target= message_1 &gt; &lt;template&gt;  &lt;div id= message_1 &gt;   This div will replace the existing element with the DOM ID  message_1 .   &lt;/div&gt; &lt;/template&gt;&lt;/turbo-stream&gt;&lt;turbo-stream action= update  target= unread_count &gt; &lt;template&gt;  &lt;!-- The contents of this template will replace the  contents of the element with ID  unread_count . --&gt;  1 &lt;/template&gt;&lt;/turbo-stream&gt;&lt;turbo-stream action= remove  target= message_1 &gt; &lt;!-- The element with DOM ID  message_1  will be removed.  The contents of this stream element are ignored. --&gt;&lt;/turbo-stream&gt;æ³¨æ„ï¼Œæ¯ä¸ª&lt;turbo-stream&gt;å…ƒç´ éƒ½å¿…é¡»æŠŠå®ƒå†…å«çš„ HTML åŒ…è£¹åœ¨ä¸€ä¸ª&lt;template&gt;å…ƒç´ ä¹‹å†…ã€‚ ä½ å¯ä»¥åœ¨ä¸€ä¸ªå•ç‹¬çš„ stream æ¶ˆæ¯ä¸­æ¸²æŸ“ä»»æ„æ•°é‡çš„ stream å…ƒç´ ï¼Œè¯¥æ¶ˆæ¯æ¥è‡ªäº WebSocketã€SSE æˆ–è€…æ˜¯ä¸€ä¸ªè¡¨å•æäº¤åçš„å“åº”ã€‚ Streaming From HTTP Responses: Turbo çŸ¥é“è‡ªåŠ¨é™„å¸¦ä¸Šé‚£äº›&lt;turbo-stream&gt;å…ƒç´ ï¼Œå½“å®ƒä»¬ä»¥&lt;form&gt;æäº¤çš„å“åº”è¿”å›å¹¶å£°æ˜äº†ä¸€ä¸ªtext/vnd. turbo-stream. htmlçš„ MIME type æ—¶ã€‚å½“æäº¤å…¶ method å±æ€§è¢«è®¾ç½®ä¸ºPOSTã€PUTã€PATCHæˆ–DELETE çš„ &lt;form&gt;å…ƒç´ æ—¶ï¼ŒTurbo å°±ä¼šæŠŠ text/vnd. turbo-stream. html æ³¨å…¥åˆ°è¯·æ±‚çš„ Accept header ä¸­çš„å“åº”æ ¼å¼é›†ä¹‹å†…ã€‚åœ¨å¯¹å…¶ Accept header åŒ…å«äº†è¿™äº›å€¼çš„è¯·æ±‚è¿›è¡Œå“åº”æ—¶ï¼ŒæœåŠ¡ç«¯å°±å¯ä»¥è°ƒæ•´ç›¸åº”ä»¥å¤„ç† Turbo Streamsï¼ŒHTTP é‡å®šå‘ï¼Œæˆ–è€…ä¸æ”¯æŒ streams çš„å…¶ä»–ç±»å‹çš„å®¢æˆ·ç«¯ï¼ˆæ¯”å¦‚åŸç”Ÿåº”ç”¨ï¼‰ã€‚ åœ¨ä¸€ä¸ª Rails controller ä¸­ï¼Œçœ‹èµ·æ¥ä¼šæ˜¯è¿™æ ·çš„ï¼š def destroy @message = Message. find(params[:id]) @message. destroy respond_to do |format|  format. turbo_stream { render turbo_stream: turbo_stream. remove(@message) }  format. html     { redirect_to messages_url } endendReusing Server-Side Templates: Turbo Streams çš„å…³é”®æ˜¯é‡ç”¨ä½ ç°æœ‰çš„æœåŠ¡ç«¯æ¨¡æ¿ä»¥æ‰§è¡Œå®æ—¶çš„éƒ¨åˆ†é¡µé¢æ›´æ”¹çš„èƒ½åŠ›ã€‚åœ¨é¡µé¢é¦–æ¬¡åŠ è½½æ—¶ç”¨æ¥æ¸²æŸ“æ¶ˆæ¯åˆ—è¡¨ä¸­æ¯ä¸€æ¡æ¶ˆæ¯çš„ HTML æ¨¡æ¿ï¼Œè·Ÿç”¨æ¥åœ¨ä¹‹ååŠ¨æ€æ·»åŠ åˆ°åˆ—è¡¨çš„ä¸€æ¡æ–°æ¶ˆæ¯çš„æ¨¡æ¿ï¼Œä¼šæ˜¯ç›¸åŒçš„ã€‚è¿™å°±æ˜¯ HTML-over-the-wire æ–¹æ¡ˆçš„æœ¬è´¨å’Œç²¾åï¼šä½ ä¸éœ€è¦å†æŠŠæ–°æ¶ˆæ¯åºåˆ—åŒ–ä¸º JSONï¼Œåœ¨ JavaScript ä¸­æ¥æ”¶å®ƒï¼Œå¹¶æ¸²æŸ“ä¸€ä¸ªå®¢æˆ·ç«¯çš„æ¨¡æ¿ã€‚å®ƒå°±æ˜¯æ ‡å‡†çš„å¯é‡ç”¨çš„æœåŠ¡ç«¯æ¨¡æ¿ã€‚ å¦ä¸€ä¸ª Rails ä¸­çš„ä¾‹å­çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š &lt;!-- app/views/messages/_message. html. erb --&gt;&lt;div id= &lt;%= dom_id message %&gt; &gt; &lt;%= message. content %&gt;&lt;/div&gt;&lt;!-- app/views/messages/index. html. erb --&gt;&lt;h1&gt;All the messages&lt;/h1&gt;&lt;%= render partial:  messages/message , collection: @messages %&gt;# app/controllers/messages_controller. rbclass MessagesController &lt; ApplicationController def index  @messages = Message. all end def create  message = Message. create!(params. require(:message). permit(:content))  respond_to do |format|   format. turbo_stream do    render turbo_stream: turbo_stream. append(:messages, partial:  messages/message ,     locals: { message: message })   end   format. html { redirect_to messages_url }  end endendå½“åˆ›å»ºä¸€æ¡æ–°æ¶ˆæ¯çš„è¡¨å•æäº¤ç»™MessagesController#create action æ—¶ï¼Œè·ŸMessagesController#indexä¸­ç”¨æ¥æ¸²æŸ“æ¶ˆæ¯åˆ—è¡¨å®Œå…¨åŒæ ·çš„ partial æ¨¡æ¿è¢«ç”¨æ¥æ¸²æŸ“ turbo-stream actionã€‚è¿™å°†ä½œä¸ºå¦‚ä¸‹æ‰€ç¤ºçš„å“åº”å‡ºç°ï¼š Content-Type: text/vnd. turbo-stream. html; charset=utf-8&lt;turbo-stream action= append  target= messages &gt; &lt;template&gt;  &lt;div id= message_1 &gt;   The content of the message.   &lt;/div&gt; &lt;/template&gt;&lt;/turbo-stream&gt;è¿™ä¸ªmessages/message partial æ¨¡æ¿ç„¶åå¯ä»¥è¢«ç”¨æ¥æ¸²æŸ“åç»­ edit/update æ“ä½œçš„æ¶ˆæ¯ï¼Œæˆ–è€…æ”¯æŒç”±å…¶ä»–ç”¨æˆ·é€šè¿‡ WebSocket æˆ– SSE è¿æ¥æ‰€åˆ›å»ºçš„æ–°æ¶ˆæ¯ã€‚èƒ½å¤Ÿåœ¨æ•´ä¸ªä½¿ç”¨èŒƒå›´å†…é‡ç”¨ç›¸åŒçš„æ¨¡æ¿éå¸¸å¼ºå¤§ï¼Œè¿™æ˜¯å‡å°‘åˆ›å»ºè¿™äº›ç°ä»£ï¼Œå¿«é€Ÿåº”ç”¨ç¨‹åºæ‰€éœ€å·¥ä½œé‡çš„å…³é”®ã€‚ Progressively Enhance When Necessary: ä¸€å¼€å§‹ä½ çš„äº¤äº’è®¾è®¡ä¸å€ŸåŠ© Turbo Streams æ˜¯ä¸€ç§å¥½çš„å®è·µã€‚å½“ Turbo Streams ä¸å¯ç”¨æ—¶ï¼Œè®©æ•´ä¸ªåº”ç”¨ç¨‹åºå¦‚é¢„æœŸé‚£æ ·è¿è¡Œï¼Œç„¶åå°†å®ƒä»¬åˆ†å±‚å‡çº§ã€‚è¿™æ„å‘³ç€ä½ å°†ä¸å¿…ä¾èµ–æ›´æ–°æ¥å¤„ç†é‚£äº›éœ€è¦åœ¨åŸç”Ÿåº”ç”¨æˆ–å…¶ä»–æ²¡æœ‰å®ƒä»¬çš„åœ°æ–¹éƒ½èƒ½æ­£å¸¸å·¥ä½œçš„æµç¨‹ã€‚ å¯¹äº WebSocket æ›´æ–°ä¹Ÿæ˜¯åŒæ ·çš„ã€‚åœ¨è¿æ¥ä¸å¥½ï¼Œæˆ–æœ‰æœåŠ¡ç«¯é—®é¢˜ï¼Œä½ çš„ WebSocket å¯èƒ½ä¼šä¸­æ–­ã€‚å¦‚æœåº”ç”¨ç¨‹åºè¢«è®¾è®¡ä¸ºä¸å€ŸåŠ©äºå®ƒè€Œæ­£å¸¸å·¥ä½œï¼Œè¿™å°±æ›´æœ‰é€‚åº”æ€§ã€‚ But What About Running JavaScript?: Turbo Streams æœ‰æ„è¯†åœ°æŠŠæ‰€èƒ½æ‰§è¡Œçš„ actions é™åˆ¶ä¸ºäº”ç§ï¼šappendã€prependã€replaceã€update å’Œ removeã€‚å¦‚æœä½ åœ¨æ‰§è¡Œè¿™äº› actions æ—¶æƒ³è¦è§¦å‘é¢å¤–çš„è¡Œä¸ºï¼Œé‚£ä½ åº”è¯¥ä½¿ç”¨ Stimulus controller æ¥é™„åŠ è¿™äº›è¡Œä¸ºã€‚è¿™ç§é™åˆ¶è®© Turbo Streams ä¸“æ³¨äºé€šè¿‡ç½‘ç»œå‘å¸ƒ HTML çš„æœ¬è´¨ä»»åŠ¡ï¼ŒæŠŠé¢å¤–çš„é€»è¾‘ç•™ç»™ä¸“é—¨çš„ JavaScript æ–‡ä»¶ã€‚ æ‹¥æŠ±è¿™äº›çº¦æŸå°†ä½¿ä½ é¿å…å°†å•ä¸ªå“åº”è½¬å˜ä¸ºæ— æ³•é‡å¤ä½¿ç”¨çš„è¡Œä¸ºï¼Œä»è€Œä½¿åº”ç”¨ç¨‹åºéš¾ä»¥éµå¾ªã€‚å¾—è‡ªäº Turbo Streams çš„å…³é”®å—ç›Šæ˜¯é‡ç”¨åˆå§‹åŒ–æ¸²æŸ“é¡µé¢çš„æ¨¡æ¿çš„èƒ½åŠ›ï¼Œè´¯ç©¿äºæ‰€æœ‰åç»­æ›´æ–°çš„è¿‡ç¨‹ä¸­ã€‚ Integration with Server-Side Frameworks: åœ¨ Turbo é™„å¸¦çš„æ‰€æœ‰æŠ€æœ¯ä¸­ï¼Œä¸ Turbo Streams ä¸€èµ·ä½¿ç”¨ï¼Œä½ å°†çœ‹åˆ°ä¸åç«¯æ¡†æ¶çš„ç´§å¯†é›†æˆæ‰€å¸¦æ¥çš„æœ€å¤§ä¼˜åŠ¿ã€‚ä½œä¸ºå®˜æ–¹ Hotwire å¥—ä»¶çš„ä¸€å‘˜ï¼Œæˆ‘ä»¬å·²ç»åˆ›å»ºäº†è¿™ç§é›†æˆçœ‹èµ·æ¥å¦‚ä½•çš„ä¸€ä¸ªå®ç°å‚è€ƒï¼Œå³ turbo-rails gemã€‚è¯¥ gem ä¾èµ–äº Rails ä¸­å†…ç½®çš„ WebSocket å’Œ å¼‚æ­¥æ¸²æŸ“çš„æ”¯æŒï¼Œå…¶åˆ†åˆ«é€šè¿‡ Action Cable å’Œ Active Job æ¡†æ¶ã€‚ ä½¿ç”¨åŠ å…¥ Active Record å…¶ä¸­çš„ Broadcastable concernï¼Œä½ å°±å¯ä»¥ç›´æ¥è§¦å‘æ¥è‡ª é¢†åŸŸæ¨¡å‹ï¼ˆdomain modelï¼‰çš„ WebSocket æ›´æ–°ã€‚è€Œä½¿ç”¨ Turbo::Streams::TagBuilderï¼Œä½ å°±å¯ä»¥æ¸²æŸ“åœ¨ inline controller å“åº”æˆ–ä¸“é—¨æ¨¡æ¿ä¸­çš„&lt;turbo-stream&gt;å…ƒç´ ï¼Œé€šè¿‡ä¸€ä¸ªç®€å•çš„ DSL æ‰§è¡Œé‚£äº”ç§ actions ä»¥åŠç›¸å…³çš„æ¸²æŸ“ã€‚ ä½†æ˜¯ï¼ŒTurbo æœ¬èº«æ˜¯å®Œå…¨ä¸åç«¯æ— å…³çš„ã€‚å› æ­¤æˆ‘ä»¬é¼“åŠ±å…¶ä»–ç”Ÿæ€åœˆä¸­çš„å…¶ä»–æ¡†æ¶æ¥çœ‹çœ‹é’ˆå¯¹ Rails æä¾›çš„å®ç°å‚è€ƒï¼Œä»¥åˆ›å»ºå®ƒä»¬è‡ªå·±çš„ç´§å¯†æ•´åˆã€‚ å¦å¤–ï¼Œå°†ä»»ä½•åç«¯åº”ç”¨ç¨‹åºä¸ Turbo Streams é›†æˆçš„ç›´æ¥æ–¹æ³•æ˜¯ä¾é  Mercure åè®®ã€‚Mercure é€šè¿‡ Server-Sent Events (SSE)ï¼Œä¸ºæœåŠ¡ç«¯æŠŠé¡µé¢å˜æ›´æ’­å‘åˆ°æ¯ä¸ªæ‰€è¿æ¥çš„å®¢æˆ·ç«¯æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹å¼ã€‚è¿™é‡Œå¯ä»¥å­¦ä¹ å¦‚ä½• Turbo Streams æ˜¯å¦‚ä½•è·Ÿ Mercure ä¸€èµ·ä½¿ç”¨çš„ã€‚ "
    }, {
    "id": 17,
    "url": "/2021/03/hotwire-turbo-frame/",
    "title": "Hotwireä¹‹ä½¿ç”¨Turbo Frameè§£æ„é¡µé¢",
    "body": "2021/03/16 - æœ¬æ–‡æ˜¯å¯¹ Turbo Frame çš„è¯¦ç»†è¯´æ˜ï¼ŒåŸæ–‡å‡ºè‡ªï¼šhttps://turbo. hotwire. dev/handbook/framesã€‚ Turbo Frames å…è®¸ä½ é¢„å®šä¹‰é¡µé¢ä¸­é‚£äº›æ ¹æ®éœ€è¦æ¥æ›´æ–°çš„éƒ¨åˆ†ã€‚ä»»ä½• frame å†…çš„é“¾æ¥å’Œè¡¨å•éƒ½ä¼šè¢«æ•è·ï¼Œè€Œ frame çš„å†…å®¹ä¼šåœ¨æ¥æ”¶åˆ°å“åº”åè¢«è‡ªåŠ¨æ›´æ–°ã€‚ä¸ç®¡æœåŠ¡ç«¯æä¾›çš„æ˜¯æ•´ä¸ª documentï¼Œè¿˜æ˜¯ä»…åŒ…å«æ‰€è¯·æ±‚ frame çš„æ›´æ–°ç‰ˆæœ¬çš„ç‰‡æ®µï¼Œéƒ½åªæœ‰é‚£ä¸ªç‰¹å®šçš„ frame ä¼šä»å“åº”ä¸­è¢«æå–å‡ºæ¥ä»¥æ›¿ä»£ç°æœ‰çš„å†…å®¹ã€‚ æŠŠé¡µé¢çš„æŸä¸€éƒ¨åˆ†åŒ…åœ¨&lt;turbo-frame&gt;å…ƒç´ ä¸­å°±åˆ›å»ºäº† Frames ã€‚æ¯ä¸ªå…ƒç´ å¿…é¡»æœ‰ä¸€ä¸ªå”¯ä¸€ IDï¼Œç”¨æ¥ä»æœåŠ¡ç«¯è¯·æ±‚è¡Œé¡µé¢æ—¶åŒ¹é…è¦è¢«æ›¿æ¢çš„å†…å®¹ã€‚ä¸€ä¸ªå•ç‹¬é¡µé¢å¯ä»¥æœ‰å¤šä¸ª framesï¼Œæ¯ä¸€ä¸ªéƒ½ç¡®ç«‹å…¶è‡ªå·±çš„ä¸Šä¸‹æ–‡ï¼š &lt;body&gt; &lt;div id= navigation &gt;Links targeting the entire page&lt;/div&gt; &lt;turbo-frame id= message_1 &gt;  &lt;h1&gt;My message title&lt;/h1&gt;  &lt;p&gt;My message content&lt;/p&gt;  &lt;a href= /messages/1/edit &gt;Edit this message&lt;/a&gt; &lt;/turbo-frame&gt; &lt;turbo-frame id= comments &gt;  &lt;div id= comment_1 &gt;One comment&lt;/div&gt;  &lt;div id= comment_2 &gt;Two comments&lt;/div&gt;  &lt;form action= /messages/comments &gt;. . . &lt;/form&gt; &lt;/turbo-frame&gt;&lt;/body&gt;è¿™ä¸ªé¡µé¢æœ‰ä¸¤ä¸ª framesï¼šä¸€ä¸ªå±•ç¤ºæ¶ˆæ¯ï¼Œå¸¦ä¸€ä¸ªç¼–è¾‘é“¾æ¥ï¼›ä¸€ä¸ªåˆ—å‡ºæ‰€æœ‰è¯„è®ºï¼Œå¸¦ä¸€ä¸ªè¡¨å•ä»¥æ·»åŠ è¯„è®ºã€‚æ¯ä¸ª frame éƒ½åˆ›å»ºäº†å…¶è‡ªèº«çš„ä¸Šä¸‹æ–‡ï¼Œæ¥æ•è·å…¶ä¸­çš„é“¾æ¥å’Œè¡¨å•æäº¤ã€‚ å½“ç¼–è¾‘æ¶ˆæ¯çš„é“¾æ¥è¢«ç‚¹å‡»æ—¶ï¼Œç”±/messages/1/editæä¾›çš„å“åº”ä¼šæŠŠå®ƒçš„&lt;trubo-frame id= message_1 &gt;éƒ¨åˆ†æå–å‡ºæ¥ï¼Œè€Œå…¶å†…å®¹åˆ™ä¼šæ›¿æ¢åˆ°é“¾æ¥ç‚¹å‡»æ‰€åœ¨çš„ frame ä¸Šã€‚ç¼–è¾‘æ¶ˆæ¯çš„å“åº”å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š &lt;body&gt; &lt;h1&gt;Editing message&lt;/h1&gt; &lt;turbo-frame id= message_1 &gt;  &lt;form action= /messages/1 &gt;   &lt;input name= message[name]  type= text  value= My message title &gt;   &lt;textarea name= message[name] &gt;My message content&lt;/textarea&gt;   &lt;input type= submit &gt;  &lt;/form&gt; &lt;/turbo-frame&gt;&lt;/body&gt;æ³¨æ„ï¼Œ&lt;h1&gt;å¹¶ä¸åœ¨&lt;turbo-frame&gt;å†…ã€‚è¿™æ„å‘³ç€å½“è¡¨å•æ›¿æ¢å±•ç¤ºçš„æ¶ˆæ¯æ—¶å®ƒä¼šè¢«å¿½ç•¥æ‰ã€‚åªæœ‰æ‰€åŒ¹é…çš„&lt;turbo-frame&gt;ä¹‹å†…çš„å†…å®¹æ‰ä¼šåœ¨ frame è¢«æ›´æ–°æ—¶ç”¨åˆ°ã€‚ å› æ­¤ï¼Œä½ çš„é¡µé¢å°±å¯è½»æ¾å®ç°åŒé‡ç›®çš„ï¼šåœ¨æ•´ä¸ªé¡µé¢ä¸“ç”¨äºæ“ä½œçš„ frame ä¹‹å†…æˆ–ä¹‹å¤–è¿›è¡Œç¼–è¾‘ã€‚ Lazily Loading Frames: å½“é¡µé¢åŠ è½½æ—¶ï¼Œå…¶ä¸­æ‰€åŒ…å«çš„ frames å¹¶ä¸å¿…éƒ½å¡«å……å†…å®¹ã€‚å¦‚æœ&lt;turbo-frame&gt;ä¸Šæœ‰ä¸€ä¸ª&lt;src&gt;å±æ€§ï¼Œé‚£ä¹ˆä¸€æ—¦è¯¥ tag å‡ºç°åœ¨é¡µé¢ä¸Šæ—¶å…¶ä¸­çš„ URL å°±å°†è¢«è‡ªåŠ¨åŠ è½½ï¼š &lt;body&gt; &lt;h1&gt;Imbox&lt;/h1&gt; &lt;div id= emails &gt;  . . .  &lt;/div&gt; &lt;turbo-frame id= set_aside_tray  src= /emails/set_aside &gt; &lt;/turbo-frame&gt; &lt;turbo-frame id= reply_later_tray  src= /emails/reply_later &gt; &lt;/turbo-frame&gt;&lt;/body&gt;è¿™ä¸ªé¡µé¢åœ¨åŠ è½½åä¼šç«‹å³åˆ—å‡ºä½ çš„ imbox ä¸­æ‰€æœ‰çš„å¯ç”¨é‚®ä»¶ï¼Œä½†éšåä¼šå‘é€ä¸¤ä¸ªåç»­è¯·æ±‚ï¼Œç”¨æ¥åœ¨é¡µé¢åº•éƒ¨ä¸ºæç½®æˆ–ç­‰å¾…ç¨åå›å¤çš„é‚®ä»¶å±•ç°å°æ‰˜ç›˜ã€‚è¿™äº›æ‰˜ç›˜éƒ½æ˜¯æ ¹æ®srcä¸­æ‰€æŒ‡å®šçš„ URL æ‰€å‘å‡ºçš„å•ç‹¬ HTTP è¯·æ±‚è€Œåˆ›å»ºçš„ã€‚ ä¸Šé¢ç¤ºä¾‹ä¸­ï¼Œæ‰˜ç›˜èµ·åˆéƒ½æ˜¯ç©ºçš„ï¼Œä½†å…¶ä¹Ÿå¯ä»¥å¡«å……ä¸€äº›åˆå§‹åŒ–å†…å®¹ï¼Œå½“ä»srcè·å–åˆ°äº†å†…å®¹æ—¶ï¼Œè¿™äº›åˆå§‹åŒ–å†…å®¹å°±ä¼šè¢«è¦†ç›–æ‰ï¼š &lt;turbo-frame id= set_aside_tray  src= /emails/set_aside &gt; &lt;img src= /icons/spinner. gif &gt;&lt;/turbo-frame&gt;åŠ è½½ imbox é¡µé¢åï¼Œset-asideæ‰˜ç›˜ä¼šä»/emails/set_asideè½½å…¥å†…å®¹ï¼Œè€Œå“åº”å¿…é¡»åŒ…å«ä¸€ä¸ªè·ŸåŸå§‹ç”¨ä¾‹ä¸­ç›¸å¯¹åº”çš„&lt;turbo-frame id= set_aside_tray &gt;å…ƒç´ ï¼š &lt;body&gt; &lt;h1&gt;Set Aside Emails&lt;/h1&gt; &lt;p&gt;These are emails you've set aside&lt;/p&gt; &lt;turbo-frame id= set_aside_tray &gt;  &lt;div id= emails &gt;   &lt;div id= email_1 &gt;    &lt;a href= /emails/1 &gt;My important email&lt;/a&gt;   &lt;/div&gt;  &lt;/div&gt; &lt;/turbo-frame&gt;&lt;/body&gt;è¯¥é¡µé¢ç°åœ¨ä»¥å…¶æœ€å°åŒ–å½¢å¼å·¥ä½œï¼Œå³ä»…å°†å…·æœ‰å•ç‹¬é‚®ä»¶çš„divåŠ è½½åˆ° imbox é¡µé¢ä¸Šçš„æ‰˜ç›˜ frame ä¸­ï¼Œè€Œä¸”è¿˜å¯ä»¥ä½œä¸ºæä¾› header å’Œæè¿°çš„ç›´æ¥ç›®æ ‡ã€‚ å°±åƒåœ¨å¸¦æœ‰ç¼–è¾‘æ¶ˆæ¯è¡¨å•çš„ç¤ºä¾‹ä¸­é‚£æ ·ã€‚ æ³¨æ„ï¼Œåœ¨/emails/set_asideä¸Šçš„&lt;turbo-frame&gt;ä¸åŒ…å«srcå±æ€§ã€‚è¿™ä¸ªå±æ€§ä»…ä»…æ·»åŠ åˆ°éœ€è¦ lazy åŠ è½½å†…å®¹çš„ frame ä¸Šï¼Œè€Œä¸æ˜¯æ·»åŠ åˆ°æä¾›å†…å®¹çš„è¢«æ¸²æŸ“çš„ frame ä¸Šã€‚ Cache Benefits to Lazily Loading Frames: æŠŠé¡µé¢ç‰‡æ®µè½¬æ¢æˆ frames èƒ½å¤Ÿå¸®åŠ©ä½¿å¾—é¡µé¢å®ç°æ›´åŠ ç®€å•ï¼Œä½†åŒæ ·é‡è¦çš„æ˜¯è¿™æ ·åšèƒ½å¤Ÿæ”¹å–„ç¼“å­˜åŠ¨æ€ã€‚å¸¦æœ‰å¾ˆå¤šç‰‡æ®µçš„å¤æ‚é¡µé¢éš¾ä»¥è¢«æœ‰æ•ˆç¼“å­˜ï¼Œç‰¹åˆ«æ˜¯å¦‚æœå®ƒä»¬å°†è®¸å¤šäººå…±äº«çš„å†…å®¹ä¸ä¸“é—¨é’ˆå¯¹å•ä¸ªç”¨æˆ·çš„å†…å®¹æ··åˆåœ¨ä¸€èµ·çš„è¯ã€‚è¿™äº›ç‰‡æ®µè¶Šå¤šï¼Œéœ€è¦ç¼“å­˜æŸ¥æ‰¾çš„ä¾èµ–çš„ key è¶Šå¤šï¼Œç¼“å­˜æµå¤±çš„é¢‘ç‡å°±è¶Šé«˜ã€‚ Frames æ˜¯å¯¹åœ¨ä¸åŒæ—¶é—´èŒƒå›´å’Œä¸åŒå—ä¼—ä¸Šå˜åŒ–çš„ç‰‡æ®µè¿›è¡Œåˆ†ç¦»çš„ç†æƒ³é€‰æ‹©ã€‚æœ‰æ—¶ï¼ŒæŠŠé¡µé¢ä¸­é’ˆå¯¹æ¯ä¸ªç”¨æˆ·çš„å…ƒç´ è½¬æ¢ä¸º frame æ˜¯æœ‰é“ç†çš„ï¼Œå¦‚æœé¡µé¢å…¶ä»–éƒ¨åˆ†éƒ½æ˜¯ç”±æ‰€æœ‰ç”¨æˆ·å…±äº«çš„è¯ã€‚æœ‰æ—¶ï¼Œåˆ™æ˜¯ç›¸åçš„åšæ³•æ›´æœ‰ç†ç”±ï¼Œä¾‹å¦‚åœ¨ä¸€ä¸ªé‡åº¦çš„ä¸ªäººåŒ–é¡µé¢ï¼ŒæŠŠä¸€ä¸ªå…±äº«çš„ç‰‡æ®µè½¬æ¢ä¸º frame ä»¥ä¾¿å…±äº«ç¼“å­˜æœåŠ¡äºå®ƒã€‚ è™½ç„¶è·å– lazy åŠ è½½çš„ frames çš„å¼€é”€é€šå¸¸å¾ˆä½ï¼Œä½†æ˜¯ä½ ä»ç„¶åº”è¯¥æ˜æ™ºåœ°ç¡®å®šè¦åŠ è½½çš„æ•°é‡ï¼Œç‰¹åˆ«æ˜¯å¦‚æœè¿™äº› frames ä¼šåœ¨é¡µé¢ä¸Šé€ æˆåŠ è½½æŠ–åŠ¨æ—¶ã€‚ç„¶è€Œï¼Œå¦‚æœå…¶å†…å®¹åœ¨é¡µé¢åŠ è½½æ—¶ä¸æ˜¯ç«‹å³å¯è§çš„ï¼Œé‚£ä¹ˆ frames åŸºæœ¬ä¸Šéƒ½æ˜¯ free çš„ã€‚å¯èƒ½æ˜¯å› ä¸ºå®ƒä»¬éšè—äº modal æˆ–é¦–å±ä¹‹ä¸‹ã€‚ Targeting Navigation Into or Out of a Frame: é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨ä¸€ä¸ª frame å†…éƒ¨çš„å¯¼èˆªå°±åªé’ˆå¯¹é‚£ä¸ª frameã€‚å¯¹äºç‚¹å‡»é“¾æ¥å’Œæäº¤è¡¨å•éƒ½æ˜¯å¦‚æ­¤ã€‚ä½†é€šè¿‡è®¾ç½®ç›®æ ‡ä¸º_topï¼Œå¯¼èˆªå¯ä»¥åˆ‡æ¢åˆ°æ•´ä¸ªé¡µé¢è€Œéé—­åˆçš„ frameã€‚æˆ–è€…ä¹Ÿå¯ä»¥åˆ‡æ¢åˆ°å¦ä¸€ä¸ªå‘½å frame ä¸Šï¼Œé€šè¿‡è®¾ç½®ç›®æ ‡åˆ°è¯¥ frame çš„ ID çš„æ–¹å¼ã€‚ åœ¨ set-aside tray çš„ç¤ºä¾‹ä¸­ï¼Œtray ä¹‹å†…åˆ°é“¾æ¥æŒ‡å‘å•ç‹¬çš„é‚®ä»¶ã€‚ä½ ä¸ä¼šæƒ³è¦è¿™äº›é“¾æ¥å»æ‰¾åŒ¹é…set_aside_tray ID çš„ frame tagã€‚ä½ æƒ³è¦çš„æ˜¯ç›´æ¥å¯¼èˆªåˆ°é‚£äº›é‚®ä»¶ã€‚è¿™é€šè¿‡æŠŠ tray frames æ ‡è®°å…¶targetå±æ€§æ¥å®ç°ï¼š &lt;body&gt; &lt;h1&gt;Imbox&lt;/h1&gt; . . .  &lt;turbo-frame id= set_aside_tray  src= /emails/set_aside  target= _top &gt; &lt;/turbo-frame&gt;&lt;/body&gt;&lt;body&gt; &lt;h1&gt;Set Aside Emails&lt;/h1&gt; . . .  &lt;turbo-frame id= set_aside_tray  target= _top &gt;  . . .  &lt;/turbo-frame&gt;&lt;/body&gt;æœ‰æ—¶ï¼Œä½ æƒ³è¦å¤§å¤šæ•°é“¾æ¥åœ¨ frame ä¸Šä¸‹æ–‡ä¸­è¿›è¡Œæ“ä½œï¼Œä½†å°‘éƒ¨åˆ†ä¸æ˜¯ã€‚å¯¹äºè¡¨å•ä¹Ÿæ˜¯åŒæ ·çš„ã€‚é‚£ä¹ˆä½ å¯ä»¥æŠŠdata-trubo-frameå±æ€§æ·»åŠ åˆ°é frame çš„å…ƒç´ ä¸Šæ¥å®ç°ï¼š &lt;body&gt; &lt;turbo-frame id= message_1 &gt;  . . .   &lt;a href= /messages/1/edit &gt;   Edit this message (within the current frame)  &lt;/a&gt;  &lt;a href= /messages/1/permission  data-turbo-frame= _top &gt;   Change permissions (replace the whole page)  &lt;/a&gt; &lt;/turbo-frame&gt; &lt;form action= /messages/1/delete  data-turbo-frame= message_1 &gt;  &lt;input type= submit  value= Delete this message &gt;  (with a confirmation shown in a specific frame) &lt;/form&gt;&lt;/body&gt;"
    }, {
    "id": 18,
    "url": "/2021/03/hotwire-turbo-drive/",
    "title": "Hotwireä¹‹ä½¿ç”¨Turbo Driveå¯¼èˆª",
    "body": "2021/03/13 - æœ¬æ–‡æ˜¯å¯¹ Turbo Drive çš„è¯¦ç»†è¯´æ˜ï¼ŒåŸæ–‡å‡ºè‡ªï¼šhttps://turbo. hotwire. dev/handbook/driveã€‚ Turbo Drive æ˜¯ Turbo çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå¢å¼ºé¡µé¢çº§åˆ«çš„å¯¼èˆªã€‚å®ƒç›‘æ§ç€ç‚¹å‡»é“¾æ¥å’Œè¡¨å•æäº¤ï¼Œä½¿å…¶åœ¨åå°æ‰§è¡Œï¼Œå¹¶æ›´æ–°é¡µé¢è€Œæ— éœ€åšå…¨é¡µé¢çš„é‡è½½ã€‚å®ƒæ˜¯Turbolinks åº“çš„è¿›åŒ–ç‰ˆæœ¬ã€‚ Page Navigation Basics: Turbo Drive æŠŠé¡µé¢å¯¼èˆªå»ºæ¨¡ä¸ºä½¿ç”¨ä¸€ç§è¡Œä¸ºå¯¹ä¸€ä¸ªé¡µé¢ä½ç½®ï¼ˆURLï¼‰çš„è®¿é—®ã€‚ è¿™ç§è®¿é—®å±•ç°äº†ä»ç‚¹å‡»åˆ°æ¸²æŸ“çš„æ•´ä¸ªå¯¼èˆªç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…å«æ›´æ”¹æµè§ˆå™¨è®¿é—®å†å²ï¼Œå‘å‡ºç½‘ç»œè¯·æ±‚ï¼Œä»ç¼“å­˜ä¸­æ¢å¤ä¸€ä¸ªé¡µé¢çš„æ‹·è´ï¼Œæ¸²æŸ“æœ€ç»ˆçš„å“åº”ï¼Œä»¥åŠæ›´æ–°é¡µé¢æ»šåŠ¨çš„ä½ç½®ã€‚ æœ‰ä¸¤ç§ç±»å‹çš„è®¿é—®ï¼šä¸€ç§æ˜¯ application è®¿é—®ï¼Œå…¶è¡Œä¸ºæ˜¯ advance æˆ– replaceã€‚è€Œå¦ä¸€ç§æ˜¯ restoration è®¿é—®ï¼Œå…¶è¡Œä¸ºæ˜¯ restoreã€‚ Application Visits: Application è®¿é—®ç”±ä¸€ä¸ªå¯ç”¨ Turbo Drive çš„é“¾æ¥ï¼Œæˆ–è€…ç¨‹åºä¸­è°ƒç”¨Turbo. visit(location)ï¼Œè€Œè¢«åˆå§‹åŒ–çš„ã€‚ ä¸€ä¸ª application è®¿é—®æ€»æ˜¯ä¼šå‘å‡ºä¸€ä¸ªç½‘ç»œè¯·æ±‚ã€‚å½“å“åº”è¿”å›ï¼ŒTurbo Drive å°±æ¸²æŸ“å…¶é¡µé¢å¹¶ç»“æŸè¿™æ¬¡è®¿é—®ã€‚ å¯èƒ½çš„è¯ï¼ŒTurbo Drive ä¼šåœ¨è®¿é—®å¼€å§‹æ—¶ç«‹å³ä»ç¼“å­˜ä¸­æ¸²æŸ“ä¸€ä¸ªé¡µé¢çš„é¢„è§ˆã€‚è¿™å°±æé«˜äº†åœ¨ç›¸åŒé¡µé¢é—´é¢‘ç¹å¯¼èˆªçš„æ„ŸçŸ¥é€Ÿåº¦ã€‚ å¦‚æœè®¿é—®çš„ä½ç½®åŒ…å«ä¸€ä¸ªé”šç‚¹ï¼ŒTurbo Drive ä¼šå°è¯•æ»šåŠ¨åˆ°æ‰€é”šä½çš„å…ƒç´ ã€‚å¦åˆ™ï¼Œä¼šæ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨ã€‚ Application è®¿é—®ä¼šå¯¼è‡´æµè§ˆå™¨è®¿é—®å†å²çš„å˜æ›´ï¼Œè€Œè®¿é—®çš„è¡Œä¸ºå†³å®šäº†è¯¥å˜æ›´æ˜¯æ€æ ·çš„ã€‚ é»˜è®¤çš„è®¿é—®è¡Œä¸ºæ˜¯ advanceã€‚åœ¨ä¸€æ¬¡ advance è®¿é—®æœŸé—´ï¼ŒTurbo Drive ä½¿ç”¨history. pushStateå‘æµè§ˆå™¨è®¿é—®å†å²æ¨å…¥ä¸€ä¸ªæ–°æ¡ç›®ã€‚ ä½¿ç”¨ Turbo Drive çš„ iOS adapter çš„åº”ç”¨ç¨‹åºé€šå¸¸å¤„ç† advance è®¿é—®æ˜¯æ¨å…¥ä¸€ä¸ªæ–°çš„ view controller åˆ°å¯¼èˆªå †æ ˆä¹‹ä¸Šã€‚ç±»ä¼¼åœ°ï¼Œä½¿ç”¨ Android adapter çš„åº”ç”¨ç¨‹åºé€šå¸¸æ˜¯æ¨å…¥ä¸€ä¸ªæ–°çš„ activity åˆ° back stack ä¹‹ä¸Šã€‚ ä½ å¯èƒ½æƒ³è¦è®¿é—®ä¸€ä¸ªä½ç½®è€Œä¸æ¨å…¥ä¸€ä¸ªæ–°è®¿é—®å†å²æ¡ç›®åˆ°å†å²å †æ ˆä¹‹ä¸Šã€‚replace è¡Œä¸ºä½¿ç”¨history. replaceStateæ¥ä¸¢å¼ƒæœ€é¡¶å±‚çš„å†å²æ¡ç›®ï¼Œå¹¶ä»¥æ–°çš„ä½ç½®æ¥æ›¿æ¢å®ƒã€‚ è¦æŒ‡å®šå¦‚ä¸‹é“¾æ¥èƒ½è§¦å‘ä¸€ä¸ª replace è®¿é—®ï¼Œä»¥data-turbo-action= replace æ³¨é‡Šé“¾æ¥å³å¯ï¼š &lt;a href= /edit  data-turbo-action= replace &gt;Edit&lt;/a&gt;è¦åœ¨ç¨‹åºä¸­ä»¥ replace è¡Œä¸ºè®¿é—®ä¸€ä¸ªä½ç½®ï¼ŒæŠŠaction:  replace é€‰é¡¹ä¼ å…¥Turbo. visitå³å¯ï¼š Turbo. visit( /edit , { action:  replace  })ä½¿ç”¨ Turbo Drive çš„ iOS adapter çš„åº”ç”¨ç¨‹åºé€šå¸¸å¤„ç† replace è®¿é—®æ˜¯æ”¾å¼ƒæœ€é¡¶å±‚çš„ view controller å¹¶æ¨å…¥ä¸€ä¸ªæ–°çš„ view controller åˆ°å¯¼èˆªå †æ ˆä¹‹ä¸Šï¼Œä¸å¸¦åŠ¨ç”»çš„æ–¹å¼ã€‚ Restoration Visits: å½“ä½ ä½¿ç”¨æµè§ˆå™¨çš„åé€€æˆ–å‰è¿›æŒ‰é’®å¯¼èˆªæ—¶ï¼ŒTurbo Drive ä¼šè‡ªåŠ¨åˆå§‹åŒ–ä¸€ä¸ªå¤ä½è®¿é—®ã€‚ä½¿ç”¨ iOS æˆ– Android adapters çš„åº”ç”¨ç¨‹åºåœ¨å¯¼èˆªå †æ ˆä¸­åç§»æ—¶ä¼šåˆå§‹åŒ–ä¸€ä¸ªå¤ä½è®¿é—®ã€‚ å¯èƒ½çš„è¯ï¼ŒTurbo Drive å°±ä»ç¼“å­˜ä¸­æ¸²æŸ“ä¸€ä¸ªé¡µé¢çš„æ‹·è´è€Œä¸å‘å‡ºè¯·æ±‚ã€‚å¦åˆ™ï¼Œå®ƒå°†ä¼šé€šè¿‡ç½‘ç»œè·å–ä¸€ä¸ªé¡µé¢çš„å…¨æ–°æ‹·è´ã€‚æŸ¥çœ‹ä¸‹é¢çš„ Understanding Caching ä»¥äº†è§£æ›´å¤šç»†èŠ‚ã€‚ Turbo Drive åœ¨å¯¼èˆªç¦»å¼€æ¯ä¸ªé¡µé¢æ—¶éƒ½ä¼šè®°ä½å…¶æ»šåŠ¨ä½ç½®ï¼Œåœ¨å¤ä½è®¿é—®æ—¶ä¼šè‡ªåŠ¨æ»šåŠ¨å›è¯¥ä½ç½®å¤„ã€‚ å¤ä½è®¿é—®æœ‰ä¸€ä¸ª restore è¡Œä¸ºï¼ŒTurbo Drive é¢„ç•™å®ƒä»¬æ˜¯ä¸ºäº†å†…éƒ¨ä½¿ç”¨ã€‚ä½ æ— éœ€å°è¯•ä½¿ç”¨restoreçš„è¡Œä¸ºæ¥æ³¨é‡Šé“¾æ¥æˆ–æ‰§è¡ŒTurbo. visitã€‚ Canceling Visits Before They Start: Application è®¿é—®åœ¨å…¶å¼€å§‹ä¹‹å‰æ˜¯å¯ä»¥è¢«å–æ¶ˆçš„ï¼Œè€Œä¸ç®¡å®ƒä»¬æ˜¯ç”±ç‚¹å‡»é“¾æ¥è¿˜æ˜¯ç”±è°ƒç”¨Turbo. visitæ¥åˆå§‹åŒ–çš„ã€‚ åœ¨è®¿é—®å¼€å§‹çš„æ—¶å€™ç›‘å¬turbo:before-visitäº‹ä»¶ï¼Œå¹¶ä½¿ç”¨event. detail. urlï¼ˆä½¿ç”¨ jQuery æ—¶æ˜¯$event. originalEvent. detail. urlï¼‰æ¥æ£€æŸ¥è®¿é—®çš„ä½ç½®ã€‚ç„¶åé€šè¿‡è°ƒç”¨event. preventDefault()æ¥å–æ¶ˆè®¿é—®ã€‚ å¤ä½è®¿é—®ä¸èƒ½è¢«å–æ¶ˆï¼Œä¸”ä¸ä¼šè§¦å‘turbo:before-visitã€‚Turbo Drive å‘å‡ºå¤ä½è®¿é—®æ¥å“åº”å¯¹å·²æœ‰çš„å†å²è®°å½•è¿›è¡Œå¯¼èˆªï¼Œé€šå¸¸æ˜¯é€šè¿‡æµè§ˆå™¨çš„åé€€æˆ–å‰è¿›æŒ‰é’®ã€‚ Disabling Turbo Drive on Specific Links or Forms: å¯ä»¥ç¦ç”¨ä¸€ä¸ªå…ƒç´ çš„Turbo Driveï¼Œé€šè¿‡åœ¨å®ƒæˆ–å…¶ä¸Šçº§å…ƒç´ ä¸Šæ·»åŠ data-turbo= fale çš„æ–¹å¼ã€‚ &lt;a href= /  data-turbo= false &gt;Disabled&lt;/a&gt;&lt;form action= /messages  method= post  data-turbo= false &gt; . . . &lt;/form&gt;&lt;div data-turbo= false &gt; &lt;a href= / &gt;Disabled&lt;/a&gt; &lt;form action= /messages  method= post &gt;  . . .  &lt;/form&gt;&lt;/div&gt;åœ¨ä¸Šçº§å…ƒç´ å·²ç¦ç”¨æ—¶è¦é‡æ–°å¯ç”¨ï¼Œä½¿ç”¨data-turbo= true ï¼š &lt;div data-turbo= false &gt; &lt;a href= /  data-turbo= true &gt;Enabled&lt;/a&gt;&lt;/div&gt;ç¦ç”¨äº† Turbo Drive çš„é“¾æ¥å’Œè¡¨å•ä»ç„¶ä¼šè¢«æµè§ˆå™¨æ­£å¸¸å¤„ç†ã€‚ ï¹ŸDisplaying Progress: åœ¨ Turbo Drive å¯¼èˆªæœŸé—´ï¼Œæµè§ˆå™¨å°†ä¸ä¼šå±•ç¤ºå…¶åŸç”Ÿçš„è¿›åº¦æ¡äº†ã€‚Turbo Drive å®‰è£…äº†ä¸€ä¸ªåŸºäº CSS çš„è¿›åº¦æ¡æ¥åœ¨å‘å‡ºè¯·æ±‚æ—¶ç»™ä»¥åé¦ˆã€‚ è¯¥è¿›åº¦æ¡é»˜è®¤æ˜¯å¯ç”¨çš„ã€‚å®ƒå¯¹ä»»ä½•è½½å…¥æ—¶é—´è¶…è¿‡ 500 ms çš„é¡µé¢éƒ½ä¼šè‡ªåŠ¨æ˜¾ç¤ºã€‚ï¼ˆä½ å¯ä»¥ä½¿ç”¨Turbo. setProgressBarDelayæ–¹æ³•ä¿®æ”¹è¿™ä¸ªå€¼ã€‚ï¼‰ è¯¥è¿›åº¦æ¡æ˜¯ä¸€ä¸ª&lt;div&gt;å…ƒç´ ï¼Œå…¶ class åä¸ºturbo-progress-barã€‚å®ƒçš„é»˜è®¤æ ·å¼ä¼šé¦–å…ˆå‘ˆç°äº documentï¼Œä¸”å¯ä»¥è¢«ä¹‹åçš„è§„åˆ™æ‰€è¦†ç›–ã€‚ ä¾‹å¦‚ï¼Œä¸‹é¢çš„ CSS å°†ä¼šå‘ˆç°ä¸€ä¸ªç»¿è‰²çš„çª„è¿›åº¦æ¡ï¼š . turbo-progress-bar { height: 5px; background-color: green;}è¦å®Œå…¨ç¦ç”¨è¯¥è¿›åº¦æ¡ï¼ŒæŠŠå…¶visibilityæ ·å¼è®¾ä¸ºhiddenï¼š . turbo-progress-bar { visibility: hidden;}Reloading When Assets Change: Turbo Drive å¯ä»¥åœ¨ä¸€ä¸ªé¡µé¢åˆ°å¦ä¸€ä¸ªé¡µé¢æ—¶è·Ÿè¸ª&lt;head&gt;ä¸­çš„ asset å…ƒç´ çš„ URLï¼Œå¦‚æœå®ƒä»¬æœ‰æ‰€å˜åŠ¨åˆ™è‡ªåŠ¨è¯·æ±‚ä¸€æ¬¡å…¨é‡é‡è½½ã€‚è¿™ç¡®ä¿äº†ç”¨æˆ·å§‹ç»ˆä¼šæ‹¥æœ‰ä½ åº”ç”¨ç¨‹åºçš„ script å’Œ style çš„æœ€æ–°ç‰ˆæœ¬ã€‚ ä½¿ç”¨data-turbo-track= reload æ³¨é‡Š asset å…ƒç´ å¹¶åœ¨ asset URL ä¸­åŒ…å«ä¸€ä¸ªç‰ˆæœ¬æ ‡è¯†ç¬¦ã€‚è¯¥æ ‡è¯†ç¬¦å¯ä»¥æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œä¸€ä¸ªæœ€è¿‘ä¿®æ”¹çš„æ—¶é—´æˆ³ï¼Œæˆ–è€…æ›´å¥½ç‚¹ï¼Œä¸€ä¸ª asset å†…å®¹çš„ digestï¼Œç±»ä¼¼å¦‚ä¸‹ï¼š &lt;head&gt; . . .  &lt;link rel= stylesheet  href= /application-258e88d. css  data-turbo-track= reload &gt; &lt;script src= /application-cbd3cd4. js  data-turbo-track= reload &gt;&lt;/script&gt;&lt;/head&gt;Ensuring Specific Pages Trigger a Full Reload: ä½ å¯ä»¥é€šè¿‡åœ¨é¡µé¢çš„&lt;head&gt;ä¸­åŒ…å«ä¸€ä¸ª&lt;meta name= turbo-visit-control &gt;å…ƒç´ æ¥ç¡®ä¿åœ¨è®¿é—®æŸä¸ªé¡µé¢æ—¶å§‹ç»ˆä¼šè§¦å‘ä¸€æ¬¡å…¨é‡é‡è½½ã€‚ &lt;head&gt; . . .  &lt;meta name= turbo-visit-control  content= reload &gt;&lt;/head&gt;è¿™ä¸ªè®¾ç½®å¯èƒ½åœ¨ç¬¬ä¸‰æ–¹ JavaScript åº“ä¸èƒ½å¾ˆå¥½åœ°è·Ÿ Turbo Drive é¡µé¢å˜æ›´è¿›è¡Œäº¤äº’æ—¶æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚ Setting a Root Location: é»˜è®¤æƒ…å†µä¸‹ï¼ŒTurbo Drive åªä¼šåŠ è½½åŒæº URLâ€”â€”æ¯”å¦‚ï¼Œè·Ÿå½“å‰é¡µé¢ç›¸åŒçš„åè®®ï¼ŒåŸŸåï¼Œç«¯å£ã€‚è®¿é—®ä»»ä½•å…¶ä»– URL éƒ½ä¼šå¯¼è‡´ä¸€æ¬¡å…¨é‡çš„é¡µé¢åŠ è½½ã€‚ æœ‰äº›åœºæ™¯ä¸­ï¼Œä½ å¯èƒ½æƒ³è¦è¿›ä¸€æ­¥å®šä¹‰ Turbo Drive åˆ°åŒæºçš„ä¸€ä¸ª path ä¸Šã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„ Turbo Drive åº”ç”¨ä½äº/appï¼Œè€Œé Turbo Drive çš„å¸®åŠ©ç«™ç‚¹ä½äº/helpï¼Œä»å‰è€…åˆ°åè€…çš„é“¾æ¥ä¸åº”è¯¥ä½¿ç”¨ Turbo Driveã€‚ åœ¨é¡µé¢çš„&lt;head&gt;ä¸­åŒ…å«ä¸€ä¸ª&lt;meta name= turbo-root &gt;å…ƒç´ ä»¥å®šä¹‰ Turbo Drive åˆ°ç‰¹å®šçš„ root ä½ç½®ã€‚Turbo Drive å°†åªåŠ è½½é‚£ä¸ª path å‰ç¼€çš„åŒæº URLã€‚ &lt;head&gt; . . .  &lt;meta name= turbo-root  content= /app &gt;&lt;/head&gt;Redirecting After a Form Submission: Turbo Drive ä»¥ä¸€ç§ç±»ä¼¼äºé“¾æ¥ç‚¹å‡»çš„æ–¹å¼å¤„ç†è¡¨å•æäº¤ã€‚å…³é”®åŒºåˆ«æ˜¯è¡¨å•æäº¤å¯ä»¥ä½¿ç”¨ HTTP POST æ–¹æ³•å‘å‡ºæœ‰çŠ¶æ€çš„è¯·æ±‚ï¼Œè€Œé“¾æ¥ç‚¹å‡»åªä¼šå‘å‡ºæ— çŠ¶æ€çš„ HTTP GET è¯·æ±‚ã€‚ åœ¨æœ‰çŠ¶æ€çš„è¡¨å•æäº¤åï¼ŒTurbo Drive æœŸæœ›æœåŠ¡ç«¯è¿”å›ä¸€ä¸ª HTTP 303 redirect responseï¼Œå…¶å°†è¢«ç”¨ä»¥å¯¼èˆªå’Œé¡µé¢æ›´æ–°è€Œæ— éœ€é‡è½½ã€‚ è¿™æ¡è§„åˆ™çš„ä¾‹å¤–æƒ…å†µæ˜¯å½“å“åº”æ˜¯ 4xx æˆ– 5xx çš„æ—¶å€™ã€‚è¿™å¯ä»¥è®©æœåŠ¡ç«¯å“åº”ä¸º422 Unprocessable Entityæ—¶å‘ˆç°è¡¨å•çš„æ ¡éªŒé”™è¯¯ï¼Œä»¥åŠå“åº”ä¸º500 Internal Server Erroræ—¶æ˜¾ç¤ºæœåŠ¡ç«¯å‡ºé”™äº†ã€‚ Turbo ä¸å…è®¸å¯¹äº 200 çš„å¸¸è§„æ¸²æŸ“çš„åŸå› æ˜¯æµè§ˆå™¨å·²æœ‰å†…ç½®çš„è¡Œä¸ºæ¥å¤„ç† POST è®¿é—®çš„é‡è½½ï¼Œä¼šå±•ç¤ºä¸€ä¸ªâ€œä½ ç¡®è®¤æƒ³è¦é‡æ–°æäº¤è¡¨å•å—ï¼Ÿâ€çš„å¯¹è¯æ¡†ï¼Œè¿™æ˜¯ Turbo æ— æ³•å¤åˆ¶çš„ã€‚ç›¸åï¼ŒTurbo ä¼šåœ¨ä¸€ä¸ªè¡¨å•æäº¤åå°è¯•æ¸²æŸ“é¡µé¢æ—¶é©»ç•™åœ¨å½“å‰ URL ä¸Šï¼Œè€Œä¸æ˜¯å˜æ›´åˆ°è¡¨å•çš„ actionï¼Œå› ä¸ºé‡è½½ä¼šå‘å‡ºåˆ°é‚£ä¸ª action æ‰€æŒ‡å‘ URL çš„ä¸€ä¸ª GET è¯·æ±‚ï¼Œè€Œè¯¥ URL ç”šè‡³å¯èƒ½æ ¹æœ¬ä¸å­˜åœ¨ã€‚ Streaming After a Form Submission: æœåŠ¡ç«¯ä¹Ÿå¯ä»¥å€ŸåŠ© Turbo Streams æ¶ˆæ¯ï¼Œé€šè¿‡å‘é€ header Content-Type: text/vnd. turbo-stream. htmlï¼Œç„¶ååœ¨å“åº”å†…å®¹ä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª&lt;turbo-stream&gt;å…ƒç´ ï¼Œæ¥å“åº”è¡¨å•æäº¤ï¼Œè¿™è®©ä½ å¯ä»¥æ— éœ€å¯¼èˆªå³å¯æ›´æ–°é¡µé¢çš„å¤šä¸ªéƒ¨åˆ†ã€‚ "
    }, {
    "id": 19,
    "url": "/2021/03/a-awesome-neovim-lsp-plugin/",
    "title": "è®©ä½ çš„NeoVim Builtin LSPç¾è½®ç¾å¥‚",
    "body": "2021/03/11 - åœ¨é…ç½® NeoVim Builtin LSP çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°å®ƒè‡ªå¸¦çš„åŸç”Ÿ UI ç•Œé¢å®åœ¨ç®€é™‹äº†äº›ã€‚è™½ç„¶åŠŸèƒ½ç”¨èµ·æ¥æ²¡é—®é¢˜ï¼Œä½†è¿œè¿œå¤Ÿä¸ä¸Šèµå¿ƒæ‚¦ç›®çš„ç¨‹åº¦ã€‚è¿™å¯¹äºåƒæˆ‘è¿™æ ·çš„â€œè§†è§‰åŠ¨ç‰©â€æ¥è¯´ï¼Œå®åœ¨æ˜¯åšå†³ä¸èƒ½å®¹å¿çš„â€œå¤§ç½ªâ€äº†ã€‚ ç»è¿‡ä¸€ç•ªæœå¯»ï¼Œç»ˆäºæ‰¾åˆ°ä¸€ä¸ªå¾ˆä¸é”™çš„ NeoVim Builtin LSP å¢å¼ºæ’ä»¶ï¼šlspsaga. nvimã€‚ å®ƒå¯¹è‡ªå·±çš„ä»‹ç»æ˜¯ï¼šâ€œA light-weight lsp plugin based on neovim built-in lsp with highly a performant UI. â€ï¼Œå¯è§å…¶å®Œå…¨èšç„¦äºæ‰“é€ ä¸€ä¸ªä¼˜é›…ç²¾è‡´çš„ UI ä¸Šã€‚ å®ƒçš„å®‰è£…å’Œé…ç½®éƒ½æ²¡ä»€ä¹ˆå¯è¯´çš„ï¼ŒæŒ‰ç…§ Readme æ–‡æ¡£çš„æ¥å°±æ˜¯äº†ã€‚ é‡ç‚¹æ˜¯æ¥ç…ç…å®ƒçš„ä¸€äº›èŒƒä¾‹ï¼š  å¼‚æ­¥ LSP æŸ¥æ‰¾  æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£  å˜é‡é‡å‘½å  æµ®åŠ¨ç»ˆç«¯çª—å£ ç¡®å®ç›¸å½“ç²¾è‡´ï¼ è¿™ç§ç‹¬æœ‰çš„ â€œTerminal ç¾å­¦â€ï¼ŒçœŸçš„æœ‰ä¸€ç§è®©äººæ¬²ç½¢ä¸èƒ½çš„é­…åŠ›ã€‚ "
    }, {
    "id": 20,
    "url": "/2021/03/hotwire-turbo-introduction/",
    "title": "Hotwireä¹‹Turboä»‹ç»",
    "body": "2021/03/10 - æˆ‘å»å¹´ 7 æœˆçš„åšå®¢å¯¹ Hey. com æŠ€æœ¯æ ˆçš„æœŸå¾… ä¸­æåˆ°äº† DHH åœ¨ HEY ä¸­æ‰€ä½¿ç”¨çš„æ–°æŠ€æœ¯æ ˆã€‚è€Œåœ¨å»å¹´ 12 æœˆ 23 æ—¥ï¼ŒDHH ä¸è´Ÿæ‰€æœ›ï¼Œå¦‚æœŸå®£å¸ƒäº†ä»–çš„â€œNEW MAGICâ€ï¼šHotwire Hotwire ç”± Turboã€Stimulus å’Œ Stradaï¼ˆå°†äº2021å…¬å¸ƒï¼‰ æ„æˆã€‚Strada å°šæœªå‘å¸ƒå…ˆä¸è®ºï¼ŒStimulus ä¹Ÿæ˜¯æ—©å°±å‘å¸ƒçš„æŠ€æœ¯ï¼Œå¹¶éæ–°äº‹ç‰©ï¼Œæ‰€ä»¥çœŸæ­£çš„ç„¦ç‚¹å°±æ˜¯ Turbo äº†ã€‚è¿™ç¯‡åšå®¢å³æ˜¯ Turbo çš„ä¸€ä¸ªæ¦‚è§ˆã€‚åŸæ–‡å‡ºè‡ªï¼šhttps://turbo. hotwire. dev/handbook/introduction Introduction: Turbo æŠŠå‡ ç§æŠ€æœ¯é›†æˆåˆ°ä¸€èµ·ä»¥åˆ›å»ºå¿«é€Ÿçš„ã€ç°ä»£çš„ã€æ¸è¿›å¼å¢å¼ºçš„ Web åº”ç”¨è€Œæ¯‹éœ€ä½¿ç”¨å¤ªå¤šçš„ JavaScriptã€‚å¯¹äºæµè¡Œçš„æŠŠæ‰€æœ‰ä¸šåŠ¡é€»è¾‘éƒ½ç½®äºå‰ç«¯ï¼Œä¸”æŠŠæœåŠ¡ç«¯é™åˆ¶åœ¨ä»…æä¾› JSON API çš„é‚£äº›å®¢æˆ·ç«¯æ¡†æ¶ï¼Œå®ƒæä¾›äº†ä¸€ç§æ›´ç®€å•çš„æ›¿ä»£æ–¹æ¡ˆã€‚ å€ŸåŠ© Turboï¼Œä½ è®©æœåŠ¡ç«¯ç›´æ¥å‘å¸ƒ HTMLï¼Œè¿™æ„å‘³ç€æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ï¼Œè¯¸å¦‚æƒé™æ£€æŸ¥ã€ç›´æ¥ä¸ä½ çš„é¢†åŸŸæ¨¡å‹äº¤äº’ï¼Œä»¥åŠç¼–å†™åº”ç”¨ç¨‹åºæ‰€éœ€çš„å…¶ä»–ä¸€åˆ‡ï¼Œéƒ½èƒ½æˆ–å¤šæˆ–å°‘åœ°åªç”¨ä½ æ‰€å–œæ¬¢çš„ç¼–ç¨‹è¯­è¨€å³å¯å®ç°ã€‚è€Œä¸ç”¨å†æŠŠè¿™äº›é€»è¾‘åœ¨è¢« JSON æ‰€åˆ’åˆ†çš„ä¸¤ç«¯éƒ½é•œåƒå®ç°ã€‚æ‰€æœ‰çš„é€»è¾‘éƒ½ä½äºæœåŠ¡ç«¯ï¼Œè€Œæµè§ˆå™¨åªå¤„ç†æœ€ç»ˆçš„ HTMLã€‚ ä½ å¯ä»¥åœ¨ Hotwire ç«™ç‚¹é˜…è¯»åˆ°å…³äº HTML-over-the-wire æ–¹æ¡ˆçš„æ›´å¤šä¼˜ç‚¹ã€‚ä¸‹é¢åˆ™æ˜¯ Turbo å¸¦æ¥çš„ä½¿ä¹‹æˆä¸ºå¯èƒ½çš„æŠ€æœ¯ã€‚ Turbo Drive: Navigate within a persistent process: ä¼ ç»Ÿå•é¡µé¢åº”ç”¨çš„å…³é”®å¸å¼•åŠ›ï¼Œæ¯”è¾ƒäºè€å¼ã€å•ç‹¬é¡µé¢çš„æ–¹æ¡ˆè€Œè¨€ï¼Œå°±æ˜¯å¯¼èˆªè·³è½¬çš„é€Ÿåº¦ã€‚SPA æ˜¯é€šè¿‡ä»…åœ¨ç¬¬ä¸€ä¸ªé¡µé¢åˆå§‹åŒ–è€Œéä¸æ–­åœ°ä¸­æ–­åº”ç”¨ç¨‹åºè¿›ç¨‹ä»è€Œè·å¾—å¦‚æ­¤é«˜çš„å“åº”é€Ÿåº¦çš„ã€‚ Turbo Drive é€šè¿‡ä½¿ç”¨åŒæ ·çš„æŒä¹…åŒ–è¿›ç¨‹æ¨¡å‹ä¸ºä½ èµ‹äºˆäº†åŒæ ·çš„é«˜é€Ÿå“åº”ï¼Œä½†æ— éœ€ä½ å›´ç»•èŒƒå¼æ¥æ„å»ºä½ çš„åº”ç”¨ã€‚æ²¡æœ‰äº†è¦ç»´æŠ¤çš„å®¢æˆ·ç«¯è·¯ç”±ï¼Œæ²¡æœ‰äº†è¦ä»”ç»†ç®¡ç†çš„å®¢æˆ·ç«¯çŠ¶æ€ã€‚æŒä¹…åŒ–è¿›ç¨‹ç”± Turbo æ¥ç®¡ç†ï¼Œè€Œä½ ç¼–å†™è‡ªå·±çš„æœåŠ¡ç«¯ä»£ç ï¼Œä»¿ä½›åˆå›åˆ°äº†æ—©å¹´é—´çš„æ—¶å…‰â€”â€”ä¸å½“ä»Š SPA æ€ªå…½çš„å¤æ‚æ€§å¹¸ç¦åœ°éš”ç¦»å¼€äº†ã€‚ è¿™é€šè¿‡æ‹¦æˆªæ‰€æœ‰åœ¨é“¾æ¥ä¸Šçš„ç‚¹å‡»åˆ°ç›¸åŒçš„é¢†åŸŸè€Œå®ç°ã€‚å½“ä½ ç‚¹å‡»ä¸€ä¸ªé“¾æ¥æ—¶ï¼ŒTurbo Drive é˜»æ­¢æµè§ˆå™¨çš„å“åº”ï¼Œä½¿ç”¨History APIæ”¹å˜æµè§ˆå™¨çš„ URLï¼Œä½¿ç”¨ fetch æ¥è·å–æ–°é¡µé¢ï¼Œç„¶åæ¸²æŸ“ HTML å“åº”ã€‚ å¯¹äºè¡¨å•æ˜¯åŒæ ·çš„å¤„ç†ã€‚å®ƒä»¬çš„æäº¤éƒ½è¢«è½¬åŒ–ä¸º fetch è¯·æ±‚ï¼ŒTurbo Drive å°†æ ¹æ®è¿™äº›è¯·æ±‚éµå¾ªé‡å®šå‘å¹¶æ¸²æŸ“ HTML å“åº”ã€‚ åœ¨æ¸²æŸ“æœŸé—´ï¼ŒTurbo Drive ä¼šå®Œå…¨æ›¿æ¢æ‰å½“å‰çš„&lt;body&gt;å…ƒç´ å¹¶åˆå¹¶&lt;head&gt;å…ƒç´ çš„å†…å®¹ã€‚JavaScript çš„ window å’Œ document å¯¹è±¡ï¼Œä»¥åŠ&lt;html&gt;å…ƒç´ ï¼Œä¼šåœ¨ä¸€ä¸ªé¡µé¢åˆ°ä¸‹ä¸€ä¸ªé¡µé¢çš„æ¸²æŸ“ä¸­ä¿æŒæŒä¹…åŒ–ã€‚ å°½ç®¡å¯ä»¥ç›´æ¥ä¸ Turbo Drive è¿›è¡Œäº¤äº’ä»¥æ§åˆ¶è®¿é—®å¦‚ä½•å‘ç”Ÿæˆ–è¿›å…¥è¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸï¼Œä½†åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ä¸€ç§å³æ’å³ç”¨çš„æ›¿ä»£æ–¹æ³•ï¼Œåªéœ€éµå¾ªä¸€äº›çº¦å®šå³å¯å…è´¹äº«å—é‚£ç§é«˜é€Ÿå“åº”ã€‚ Turbo Frames: Decompose complex pages: å¤§å¤šæ•° Web åº”ç”¨ç¨‹åºæ˜¾ç¤ºçš„é¡µé¢éƒ½åŒ…å«å‡ ä¸ªç‹¬ç«‹çš„ç‰‡æ®µã€‚å¯¹ä¸€ä¸ªè®¨è®ºåŒºé¡µé¢ï¼Œä½ å¯èƒ½æœ‰ä¸€ä¸ªå¯¼èˆªæ åœ¨é¡¶éƒ¨ï¼Œä¸€ä¸ªæ¶ˆæ¯åˆ—è¡¨åœ¨ä¸­é—´ï¼Œä¸€ä¸ªè¡¨å•åœ¨åº•éƒ¨ä»¥æ·»åŠ æ–°æ¶ˆæ¯ï¼Œä»¥åŠä¸€ä¸ªåŒ…å«ç›¸å…³ä¸»é¢˜çš„ä¾§è¾¹æ ã€‚ç”Ÿæˆè¿™ç§è®¨è®ºåŒºé¡µé¢é€šå¸¸æ„å‘³ç€ä»¥ä¸€ç§åºåˆ—åŒ–æ–¹å¼ç”Ÿæˆæ¯ä¸ªç‰‡æ®µï¼ŒæŠŠå®ƒä»¬æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œç„¶åæŠŠç»“æœä»¥å•ä¸ª HTML çš„å“åº”å‘å¸ƒç»™æµè§ˆå™¨ã€‚ å€ŸåŠ© Turbo Framesï¼Œä½ å¯ä»¥æŠŠè¿™äº›ç‹¬ç«‹ç‰‡æ®µç½®äº frame å…ƒç´ ä¹‹å†…ï¼Œä»¥é™åˆ¶å…¶å¯¼èˆªèŒƒç•´å¹¶åšæ‡’å¼åŠ è½½ã€‚é™åˆ¶å…¶å¯¼èˆªèŒƒç•´æ„å‘³ç€æ‰€æœ‰äº¤äº’åœ¨ frame å†…éƒ¨ï¼Œæ¯”å¦‚ç‚¹å‡»é“¾æ¥æˆ–è€…æäº¤è¡¨å•ï¼Œéƒ½å‘ç”Ÿäºé‚£ä¸ª frame ä¹‹å†…ï¼Œè€Œé¿å…æ›´æ”¹æˆ–é‡æ–°åŠ è½½é¡µé¢çš„å…¶ä½™éƒ¨åˆ†ã€‚ è¦å°†ä¸€ä¸ªç‹¬ç«‹ç‰‡æ®µå°è£…åœ¨å®ƒè‡ªå·±çš„å¯¼èˆªä¸Šä¸‹æ–‡ä¸­ï¼ŒæŠŠå®ƒåŒ…åœ¨ä¸€ä¸ª&lt;turbo-frame&gt; æ ‡ç­¾å†…å³å¯ã€‚ä¾‹å¦‚ï¼š &lt;turbo-frame id= new_message &gt; &lt;form action= /messages  method= post &gt;  . . .  &lt;/form&gt;&lt;/turbo-frame&gt;å½“ä½ æäº¤ä¸Šé¢çš„è¡¨å•æ—¶ï¼ŒTurbo æŠŠåŒ¹é…çš„&lt;turbo-frame id= new_message &gt;å…ƒç´ ä»é‡å®šå‘çš„ HTML å“åº”ä¸­æå–å‡ºæ¥ï¼Œå¹¶æŠŠå…¶å†…å®¹äº¤æ¢åˆ°å·²æœ‰çš„çš„new_message frame å…ƒç´ ä¸­ã€‚é¡µé¢çš„å…¶ä½™éƒ¨åˆ†ä¿æŒåŸæ ·ã€‚ é™¤äº†é™åˆ¶å¯¼èˆªèŒƒç•´ä¹‹å¤–ï¼ŒFrames ä¹Ÿå¯ä»¥æ‡’å¼åŠ è½½å…¶å†…å®¹ã€‚è¦æ‡’å¼åŠ è½½ä¸€ä¸ª frameï¼Œæ·»åŠ ä¸€ä¸ªå…¶å€¼ä¸º URL çš„srcå±æ€§å³å¯è‡ªåŠ¨åŠ è½½ã€‚ä¸ä½œç”¨åŸŸå¯¼èˆªä¸€æ ·ï¼ŒTurbo ä»å“åº”ç»“æœä¸­æŸ¥æ‰¾å¹¶æå–å‡ºåŒ¹é…çš„ frame å¹¶äº¤æ¢å…¶å†…å®¹åˆ°å®šä½ä¸­ï¼š &lt;turbo-frame id= messages  src= /messages &gt; &lt;p&gt;This message will be replaced by the response from /messages. &lt;/p&gt;&lt;/turbo-frame&gt;è¿™å¯èƒ½å¬èµ·æ¥å¾ˆåƒæ—§æ—¶çš„ framesï¼Œç”šè‡³&lt;iframe&gt;ï¼Œç„¶è€Œ Turbo Frames æ˜¯åŒä¸€ DOM çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤æ²¡æœ‰ä»»ä½•ä¸â€œçœŸå®â€ frames ç›¸å…³çš„æ€ªå¼‚æˆ–å¦¥åã€‚Turbo Frames ç”±åŒæ ·çš„ CSS å®šä¹‰æ ·å¼ï¼Œæ˜¯åŒä¸€ JavaScript ä¸Šä¸‹æ–‡çš„ä¸€éƒ¨åˆ†ï¼Œä¸”ä¸å—ä»»ä½•å…¶ä»–å†…å®¹å®‰å…¨æ€§é™åˆ¶ã€‚ é™¤äº†æŠŠä½ çš„ç‰‡æ®µè½¬åŒ–ä¸ºç‹¬ç«‹ä¸Šä¸‹æ–‡ï¼ŒTurbo Frames è¿˜ä¸ºä½ æä¾›äº†ï¼š  é«˜æ•ˆç¼“å­˜ï¼šåœ¨ä¸Šé¢çš„è®¨è®ºåŒºé¡µé¢èŒƒä¾‹ä¸­ï¼Œç›¸å…³ä¸»é¢˜çš„ä¾§è¾¹æ å½“ä¸€ä¸ªæ–°ä¸»é¢˜å‘ˆç°æ—¶ï¼ˆç¼“å­˜ï¼‰å°±éœ€è¦è¿‡æœŸï¼Œä½†ä¸­é—´çš„æ¶ˆæ¯åˆ—è¡¨åˆ™ä¸ç”¨ã€‚æ‰€æœ‰ä¸œè¥¿åªåœ¨ä¸€ä¸ªé¡µé¢æ—¶ï¼Œä¸€æ—¦ä»»ä½•ä¸€ä¸ªç‰‡æ®µè¿‡æœŸåˆ™æ•´ä¸ªç¼“å­˜éƒ½ä¼šè¿‡æœŸã€‚å€ŸåŠ© framesï¼Œæ¯ä¸ªç‰‡æ®µéƒ½è¢«ç‹¬ç«‹ç¼“å­˜ï¼Œå› æ­¤ä½ å¯ä»¥è·å¾—æ›´å°‘ä¾èµ– key çš„å¯¿å‘½æ›´é•¿çš„ç¼“å­˜ã€‚ å¹¶è¡Œæ‰§è¡Œï¼šæ¯ä¸ªæ‡’å¼åŠ è½½çš„ frame éƒ½ç”±å…¶è‡ªå·±çš„ HTTP è¯·æ±‚/å“åº”æ‰€ç”Ÿæˆï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥è¢«å•ä¸ªè¿›ç¨‹æ¥å¤„ç†ã€‚è¿™å…è®¸å¹¶è¡Œæ‰§è¡Œè€Œä¸ç”¨æ‰‹åŠ¨ç®¡ç†è¿›ç¨‹ã€‚ä¸€ä¸ªå¤æ‚çš„ç»„åˆé¡µé¢éœ€è¦èŠ±è´¹ 400 ms å®Œæˆç«¯åˆ°ç«¯æ¸²æŸ“ï¼Œåˆ™å¯ä»¥è¢«åˆ†è§£ä¸º framesï¼Œåˆå§‹è¯·æ±‚å¯èƒ½åªéœ€è¦ 50 msï¼Œè€Œä¸‰ä¸ªæ‡’å¼åŠ è½½çš„ frames æ¯ä¸ªéƒ½è€—è´¹ 50 msã€‚ç°åœ¨æ•´ä¸ªé¡µé¢ 100 ms å°±å¯åŠ è½½å®Œæˆï¼Œå› ä¸ºé‚£ä¸‰ä¸ª frames çš„50 ms è¯·æ±‚æ˜¯å¹¶å‘è€Œéåºåˆ—å¼çš„ã€‚ Mobile å‹å¥½ï¼šåœ¨ mobile app ä¸­ï¼Œä½ é€šå¸¸ä¸ä¼šæœ‰å¤§è€Œå¤æ‚çš„ç»„åˆé¡µé¢ã€‚æ¯ä¸ªç‰‡æ®µéƒ½éœ€è¦ä¸“ç”¨çš„å±å¹•ã€‚å€ŸåŠ© Turbo Frames æ„å»ºçš„åº”ç”¨ï¼Œä½ å°±å·²ç»å®Œæˆäº†æŠŠå¤æ‚é¡µé¢è½¬æ¢ä¸ºç‰‡æ®µçš„å·¥ä½œã€‚ç„¶åè¿™äº›ç‰‡æ®µå°±å¯ä»¥å‘ˆç°åœ¨åŸç”Ÿçš„è¡¨æ ¼å’Œå±å¹•ä¸­ï¼Œæ— éœ€æ”¹åŠ¨ï¼ˆå› ä¸ºå®ƒä»¬éƒ½æœ‰ç‹¬ç«‹çš„ URLï¼‰ã€‚Turbo Streams: Deliver live page changes: å“åº”å¼‚æ­¥æ“ä½œè€Œè¿›è¡Œé¡µé¢çš„éƒ¨åˆ†æ›´æ”¹æ˜¯æˆ‘ä»¬ä½¿åº”ç”¨ä¿æŒæ´»åŠ›çš„æ–¹å¼ã€‚å°½ç®¡ Turbo Frames ç»™äºˆäº†æˆ‘ä»¬è¿™ç§æ›´æ–°ä»¥å“åº”åœ¨å•ä¸ª frame å†…çš„ç›´æ¥äº¤äº’ï¼Œè€Œ Turbo Streams åˆ™è®©æˆ‘ä»¬å¾—ä»¥å“åº”é€šè¿‡ WebSocket è¿æ¥ã€SSE æˆ–å…¶ä»–ä¼ è¾“æ‰€å‘é€çš„æ›´æ–°æ¥æ›´æ”¹é¡µé¢çš„ä»»ä½•éƒ¨åˆ†ã€‚ Turbo Streams æä¾›äº†ä¸€ä¸ª&lt;turbo-stream&gt;å…ƒç´ ï¼Œå¸¦æœ‰äº”ç§åŸºæœ¬è¡Œä¸ºï¼šappendã€prependã€replaceã€updateå’Œremoveã€‚å€ŸåŠ©è¿™äº›è¡Œä¸ºï¼Œè·ŸæŒ‡å®šäº†ä½ æ‰€æƒ³æ“ä½œå…ƒç´ çš„ ID çš„targetå±æ€§ä¸€èµ·ï¼Œå°±å¯ä»¥ç¼–ç æ‰€æœ‰éœ€è¦çš„å˜æ›´å†…å®¹æ¥åˆ·æ–°é¡µé¢ã€‚ä½ ç”šè‡³å¯ä»¥ç»„åˆå‡ ä¸ª stream å…ƒç´ åœ¨ä¸€ä¸ªå•ç‹¬çš„ stream æ¶ˆæ¯ä¸­ã€‚åªç”¨æŠŠä½ éœ€è¦æ’å…¥æˆ–æ›¿æ¢çš„ HTML åŒ…å«åœ¨ä¸€ä¸ª template tag ä¸­ï¼ŒTurbo ä¼šåšå¥½å‰©ä¸‹çš„ä¸€åˆ‡ï¼š &lt;turbo-stream action= append  target= messages &gt; &lt;template&gt;  &lt;div id= message_1 &gt;My new message!&lt;/div&gt; &lt;/template&gt;&lt;/turbo-stream&gt;è¯¥ stream å…ƒç´ å°†ä¼šè·å–å¸¦æ–°æ¶ˆæ¯çš„divå¹¶æŠŠå®ƒ append åˆ° ID ä¸ºmessagesçš„å®¹å™¨ä¸­ã€‚è¦ç®€å•åœ°æ›¿æ¢æ‰å·²æœ‰çš„å…ƒç´ åˆ™å¯ï¼š &lt;turbo-stream action= replace  target= message_1 &gt; &lt;template&gt;  &lt;div id= message_1 &gt;This changes the existing message!&lt;/div&gt; &lt;/template&gt;&lt;/turbo-stream&gt;è¿™æ˜¯ Rails ä¸–ç•Œä¸­çš„ä¸€ç§æ¦‚å¿µä¸Šçš„æŒç»­ï¼ˆèµ·åˆè¢«ç§°ä½œ RJSï¼Œç„¶åè¢«ç§°ä½œ SJRï¼‰ï¼Œå´æ˜¯æ— éœ€ä»»ä½• JavaScript çš„ä¸€ç§å®ç°ã€‚ä¼˜ç‚¹æ˜¯åŒæ ·çš„ï¼š  é‡ç”¨æœåŠ¡ç«¯æ¨¡æ¿ï¼šå®æ—¶é¡µé¢æ”¹åŠ¨çš„ç”Ÿæˆéƒ½è·Ÿåˆæ¬¡åŠ è½½é¡µé¢ä¸€æ ·ä½¿ç”¨åŒæ ·çš„æœåŠ¡ç«¯æ¨¡æ¿ã€‚ HTML over the wireï¼šç”±äºæ‰€æœ‰æˆ‘ä»¬æ‰€å‘é€çš„éƒ½æ˜¯ HTMLï¼Œä½ å°±æ— éœ€ä»»ä½•å®¢æˆ·ç«¯ JavaScript ï¼ˆè¶…è¶Š Turboï¼Œå½“ç„¶å¦‚æ­¤ï¼‰æ¥å¤„ç†æ›´æ–°äº†ã€‚æ˜¯çš„ï¼ŒHTML çš„è´Ÿè·å¯èƒ½æ¯” JSON è¦å¤§ä¸€ç‚¹ï¼Œä½†å€ŸåŠ© gzipï¼Œè¿™ç‚¹å·®å¼‚é€šå¸¸éƒ½æ˜¯å¾®ä¸è¶³é“çš„ï¼Œç„¶è€Œä½ èŠ‚çœäº†æ‰€æœ‰å®¢æˆ·çš„çš„å·¥ä½œï¼šè·å– JSON å¹¶æŠŠå…¶è½¬ä¸º HTMLã€‚ æ›´ç®€å•çš„æ§åˆ¶æµï¼šå½“æ¶ˆæ¯é€šè¿‡ WebSocketã€SSE åˆ°è¾¾æˆ–è€…å“åº”è¡¨å•æäº¤æ—¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæ˜¯å¾ˆæ¸…æ™°çš„ã€‚å†ä¹Ÿæ²¡æœ‰è·¯ç”±ã€äº‹ä»¶å†’æ³¡æˆ–å…¶ä»–çš„é—´æ¥å¤„ç†ã€‚å®ƒå°±ä»…æ˜¯è¢«å˜æ›´çš„ HTML è€Œå·²ï¼Œè¢«å°è£…åœ¨ä¸€ä¸ªå•ç‹¬çš„ tag ä¸­ã€‚ç°åœ¨ï¼Œä¸åƒ RJS å’Œ SJR ï¼Œè°ƒç”¨è‡ªå®šä¹‰çš„ JavaScript å‡½æ•°æ¥ä½œä¸º Turbo Streams è¡Œä¸ºçš„ä¸€éƒ¨åˆ†æ˜¯ä¸å¯èƒ½çš„äº†ã€‚ä½†è¿™æ˜¯ä¸€ä¸ªç‰¹æ€§ï¼Œä¸æ˜¯ bugã€‚å½“å‘é€å¤ªå¤š JavaScript è·Ÿå“åº”ä¸€èµ·æ—¶ï¼Œè¿™äº›æŠ€æœ¯å¾ˆå®¹æ˜“æœ€ç»ˆå¯¼è‡´ä¹±ä¸ƒå…«ç³Ÿçš„æ··ä¹±çŠ¶å†µã€‚Turbo ä¸“æ³¨äºä»…æ›´æ–° DOMï¼Œç„¶åå‡è®¾ä½ ä¼šä½¿ç”¨ Stimulus çš„ action å’Œç”Ÿå‘½å‘¨æœŸå›è°ƒæ¥è¿æ¥ä»»ä½•é¢å¤–è¡Œä¸ºã€‚ Turbo Native: Hybrid apps for iOS &amp; Android: Turbo Native æ˜¯æ„å»ºé€‚ç”¨äº iOS å’Œ Android çš„ hybrid apps çš„ç†æƒ³é€‰æ‹©ã€‚ä½ å¯ä»¥ä½¿ç”¨ä½ ç°æœ‰çš„æœåŠ¡ç«¯æ¸²æŸ“çš„ HTML æ¥å¾—åˆ°åœ¨ä¸€ä¸ªåŸç”Ÿå°è£…é‡Œçš„ app åŠŸèƒ½çš„åŸºçº¿èŒƒç•´ã€‚ç„¶åä½ å°±å¯ä»¥æŠŠæ‰€æœ‰èŠ‚çœä¸‹æ¥çš„æ—¶é—´èŠ±åœ¨ä½¿å—ç›Šäºé«˜ä¿çœŸåŸç”Ÿæ§ä»¶çš„å‡ ä¸ªå±å¹•å˜å¾—æ›´å¥½ä¸Šã€‚ åƒ Basecamp è¿™æ ·çš„åº”ç”¨ç”±ä¸Šç™¾ä¸ªå±å¹•ã€‚é‡å†™æ¯ä¸ªå•ç‹¬çš„å±å¹•éƒ½ä¼šæ˜¯ä¸€ä¸ªæ”¶ç›Šæä½çš„å·¨å¤§å·¥ä½œã€‚ä¸ºçœŸæ­£éœ€è¦é«˜ä¿çœŸçš„é‡åº¦äº¤äº’ä¿ç•™â€œç«åŠ›â€æ‰æ›´å¥½ã€‚ä¾‹å¦‚ï¼Œç±»ä¼¼äº Basecamp ä¸­çš„â€œNew For Youâ€ inboxï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨è½»æ‰«æ§åˆ¶éœ€è¦æ°åˆ°å¥½å¤„ã€‚ä½†å¤§å¤šæ•°é¡µé¢ï¼Œæ¯”å¦‚æ˜¾ç¤ºä¸€æ¡å•ç‹¬æ¶ˆæ¯çš„é¡µé¢ï¼Œåˆ™ä¸ä¼šæ¯”å®Œå…¨åŸç”Ÿçš„åšåˆ°æ›´å¥½ã€‚ ä½¿ç”¨ hybrid ä¸ä»…å¯ä»¥åŠ å¿«å¼€å‘è¿‡ç¨‹ï¼Œè¿˜å¯ä»¥è®©ä½ æ‹¥æœ‰æ›´å¤§çš„è‡ªç”±æ¥å‡çº§ appï¼Œè€Œæ— éœ€ç»å†ç¼“æ…¢è€Œç¹ççš„åº”ç”¨å•†åº—å‘å¸ƒè¿‡ç¨‹ã€‚ä»»ä½• HTML åšæˆçš„ä¸œè¥¿éƒ½å¯ä»¥åœ¨ä½ çš„ web åº”ç”¨ç¨‹åºä¸­è¢«æ›´æ”¹ï¼Œå¹¶å³åˆ»ä¸ºæ‰€æœ‰ç”¨æˆ·æ‰€ç”¨ã€‚æ— éœ€ç­‰å¾…æŠ€æœ¯å¤§ç‰›æ¥æ‰¹å‡†ä½ çš„æ›´æ”¹ï¼Œä¹Ÿæ— éœ€è®©ç”¨æˆ·ç­‰å¾…å‡çº§ã€‚ Turbo Native å‡è®¾ä½ æ­£åœ¨ä½¿ç”¨å¯¹äº iOS å’Œ Android æ‰€æ¨èçš„å¯ç”¨çš„å¼€å‘å®è·µã€‚å®ƒä¸æ˜¯ä¸€ä¸ªæŠ½è±¡å‡ºåŸç”Ÿ API æˆ–è€…ç”šè‡³è®©ä½ çš„åŸç”Ÿä»£ç åœ¨å¤šä¸ªå¹³å°ä¹‹é—´å…±äº«çš„æ¡†æ¶ã€‚å…±äº«çš„éƒ¨åˆ†æ˜¯åœ¨æœåŠ¡ç«¯æ¸²æŸ“çš„ HTMLã€‚ä½†æ˜¯åŸç”Ÿçš„æ§åˆ¶æ˜¯ç”±æ‰€æ¨èçš„åŸç”Ÿ API å†™å°±ã€‚ å‚è€ƒ Turbo Native: iOS å’Œ Turbo Native: Android ä»£ç åº“çš„æ›´å¤šæ–‡æ¡£ã€‚å»çœ‹çœ‹ HEY åœ¨ iOS å’Œ Android ä¸Šçš„åŸç”Ÿ app ä»¥æ„Ÿå—ä¸‹ä½¿ç”¨ Turbo æ‰€åˆ¶ä½œçš„ hybrid app æœ‰å¤šä¹ˆå‡ºè‰²å§ã€‚ Integrate with backend frameworks: ä½ ä¸éœ€è¦ä»»ä½•åç«¯æ¡†æ¶å³å¯ä½¿ç”¨ Turboã€‚å®ƒçš„æ‰€æœ‰ç‰¹æ€§éƒ½å¯ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€æ›´å¤šçš„æŠ½è±¡ã€‚ä½†å¦‚æœä½ æœ‰æœºä¼šä½¿ç”¨ä¸€ä¸ªåç«¯æ¡†æ¶æ¥æ•´åˆ Turboï¼Œå°†ä¼šå‘ç°ä¸€åˆ‡å˜å¾—æ›´ç®€å•äº†ã€‚æˆ‘ä»¬å·²ç»ä¸ºä¸ Ruby on Rails åšè¿™æ ·çš„æ•´åˆåˆ›å»ºäº†ä¸€ä»½å®ç°çš„å‚è€ƒã€‚ "
    }, {
    "id": 21,
    "url": "/2021/03/neovim-builtin-lsp-keymappings/",
    "title": "è¡Œäº‘æµæ°´èˆ¬çš„NeoVim Builtin LSPæ“ä½œ",
    "body": "2021/03/06 - æ—¢ç„¶æˆ‘ä»¬çš„ NeoVim å·²ç»é…ç½®å¥½ Builtin LSP çš„ Server å’Œ Clientï¼Œå°±è¯¥æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨å®ƒçš„é—®é¢˜äº†ï¼Œä¹Ÿå°±æ˜¯ç›¸å…³çš„ Keybinding è®¾å®šã€‚å¥½çš„ Keybinding è®¾å®šä¼šè®©äººåœ¨ä½¿ç”¨æ—¶è¿æŒ‡å¦‚é£ã€‚ nvim-lspconfig çš„ Readme æ–‡æ¡£é‡Œå·²ç»ç»™å‡ºäº†å®ƒçš„é»˜è®¤ Keybinding è®¾ç½®ï¼Œæ¯”å¦‚ä¸‹é¢è¿™å‡ ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„ï¼ˆæ›´å¤šå¯å‚è€ƒå®ƒçš„æ–‡æ¡£ï¼‰ï¼š -- æŸ¥çœ‹å‡½æ•°å£°æ˜buf_set_keymap('n', 'gD', '&lt;Cmd&gt;lua vim. lsp. buf. declaration()&lt;CR&gt;', opts)-- æŸ¥çœ‹å‡½æ•°å®šä¹‰buf_set_keymap('n', 'gd', '&lt;Cmd&gt;lua vim. lsp. buf. definition()&lt;CR&gt;', opts)-- æŸ¥çœ‹å‡½æ•°å¸®åŠ©æ–‡æ¡£buf_set_keymap('n', 'K', '&lt;Cmd&gt;lua vim. lsp. buf. hover()&lt;CR&gt;', opts)-- æŸ¥çœ‹å‡½æ•°ç›¸å…³å¼•ç”¨buf_set_keymap('n', 'gr', '&lt;cmd&gt;lua vim. lsp. buf. references()&lt;CR&gt;', opts)-- æŸ¥çœ‹å‰ä¸€å¤„è¯­æ³•é”™è¯¯buf_set_keymap('n', '[d', '&lt;cmd&gt;lua vim. lsp. diagnostic. goto_prev()&lt;CR&gt;', opts)-- æŸ¥çœ‹åä¸€å¤„è¯­æ³•é”™è¯¯buf_set_keymap('n', ']d', '&lt;cmd&gt;lua vim. lsp. diagnostic. goto_next()&lt;CR&gt;', opts)ç„¶è€Œï¼Œè¯•ç”¨ä¹‹åå‘ç°ï¼Œè¿™æ ·çš„é…ç½®ç”¨èµ·æ¥å¹¶ä¸èˆ’æœã€‚è¿™äº›å¿«æ·é”®å®šä¹‰æ‚ä¹±æ— ç« ï¼Œä¸æ–¹ä¾¿è®°å¿†ï¼›å½“ç»“æœæœ‰å¤šä¸ªæ¡ç›®æ—¶ï¼Œå®ƒé»˜è®¤ä½¿ç”¨ Vim çš„ Quickfix çª—å£ï¼Œä¹Ÿä¸æ–¹ä¾¿æŸ¥è¯¢ã€‚ å¯¹äºåè€…ï¼Œ è‡ªç„¶è€Œç„¶å°±ä¼šæƒ³åˆ° FZF è¿™æŠŠçŠ€åˆ©çš„ç‘å£«å†›åˆ€ã€‚Google ä¹‹åï¼Œå‘ç°æ—©å°±æœ‰äººæƒ³åˆ°è¿™ç‚¹ï¼Œå·²ç»åšäº†ä¸€ä¸ªæ’ä»¶ï¼šnvim-lspfuzzyã€‚è¿™ä¸ªæ’ä»¶è®© NeoVim æŠŠ LSP çš„ç»“æœåˆ—è¡¨ä½¿ç”¨ FZF æ¥æ˜¾ç¤ºï¼Œå¹¶å¯è¿›è¡Œé«˜æ•ˆç­›é€‰ä»¥åŠä»£ç è·³è½¬ã€‚è¿™æ˜¯å®ƒçš„ demo æ¼”ç¤ºï¼š å‚ç…§å…¶æ–‡æ¡£å®‰è£…å¥½ä¹‹åï¼Œåœ¨~/. config/nvim/init. nvimä¸­æ·»åŠ ä¸€è¡Œé…ç½®ï¼š require('lspfuzzy'). setup {}ç„¶åæˆ‘åœ¨. vimrcä¸­åšäº†è¿™æ ·çš„ Keybinding è®¾å®šï¼š nnoremap &lt;silent&gt;&lt;leader&gt;ls &lt;cmd&gt;lua vim. lsp. buf. document_symbol()&lt;CR&gt;nnoremap &lt;silent&gt;&lt;leader&gt;ll &lt;cmd&gt;lua vim. lsp. buf. references()&lt;CR&gt;nnoremap &lt;silent&gt;&lt;leader&gt;lg &lt;cmd&gt;lua vim. lsp. buf. definition()&lt;CR&gt;nnoremap &lt;silent&gt;&lt;leader&gt;la &lt;cmd&gt;lua vim. lsp. buf. code_action()&lt;CR&gt;nnoremap &lt;silent&gt;&lt;leader&gt;l; &lt;cmd&gt;lua vim. lsp. diagnostic. goto_prev()&lt;CR&gt;nnoremap &lt;silent&gt;&lt;leader&gt;l, &lt;cmd&gt;lua vim. lsp. diagnostic. goto_next()&lt;CR&gt;å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘æŠŠå…¨éƒ¨å¿«æ·é”®éƒ½å®šä¹‰ä¸ºä»¥&lt;leader&gt;lå¼€å¤´ï¼Œè¿™æ ·å³æœ‰è§„å¾‹ï¼Œä¾¿äºè®°å¿†äº†ã€‚è€Œ FZF çš„åŠ æŒæ›´æ˜¯å¦‚è™æ·»ç¿¼ï¼Œå†™èµ·ä»£ç æ¥è¡Œäº‘æµæ°´ï¼Œæµç•…è‡ªå¦‚ã€‚ ä¸‹ä¸€ç¯‡å†ä»‹ç»å¦ä¸€ä¸ªå¾ˆæ£’çš„ LSP æ’ä»¶ï¼Œè®©äººå†™èµ·ä»£ç æ¥æ›´åŠ èµå¿ƒæ‚¦ç›®ğŸ˜„ "
    }, {
    "id": 22,
    "url": "/2021/02/neovim-builtin-lsp-basic-configuration/",
    "title": "NeoVim Builtin LSPçš„åŸºæœ¬é…ç½®",
    "body": "2021/02/27 - ä¸Šä¸€ç¯‡åšå®¢è¯´è¿‡ï¼Œç°åœ¨å®˜æ–¹å¯¹ NeoVim Builtin LSP çš„é…ç½®å·²ç»åšåˆ°äº†è¶³å¤Ÿç®€æ´æ˜“ç”¨çš„åœ°æ­¥ã€‚è¿™ä¸€ç¯‡å°±æ¥çœ‹çœ‹æ€æ ·æŒ‰ç…§ NeoVim å®˜æ–¹çš„è¯´æ˜ï¼Œä¸€æ­¥ä¸€æ­¥æŠŠ LSP ç»™é…ç½®ä¸ºå¯ç”¨äºå®é™…å¼€å‘ä¸­ã€‚ ä¸ºäº†ç®€åŒ– LSP çš„å®‰è£…å’Œé…ç½®ï¼ŒNeoVim å®˜æ–¹ä¸“é—¨åˆ›å»ºäº† nvim-lspconfig æ’ä»¶æ¥å¸®åŠ©æˆ‘ä»¬ã€‚è¿™ä¸ªæ’ä»¶æŠŠæ‰€æœ‰ LSP èƒŒåçš„ç¹çéƒ½å°è£…åˆ°å…¶å†…éƒ¨ï¼Œè®©ä½¿ç”¨è€…å†ä¹Ÿæ¯‹éœ€æ‹…å¿ƒå‡ºç°è´¹äº†å¤§åŠå¤©åŠŸå¤«ç»“æœä»ç„¶æ— æ³•ç”¨èµ·æ¥çš„äº‹ã€‚ æˆ‘è‡ªå·±çš„æ—¥å¸¸å¼€å‘å·¥ä½œä¸­ä¸»è¦ä¼šç”¨åˆ° Rubyã€JavaScript å’Œ Golang è¿™å‡ ç§ç¼–ç¨‹è¯­è¨€ï¼Œæ‰€ä»¥å½“ç„¶å°±éœ€è¦æŠŠ NeoVim çš„ LSP é…ç½®ä¸ºæ”¯æŒå®ƒä»¬äº†ã€‚ é¦–å…ˆï¼Œå®‰è£…å¥½ nvim-lspconfig æ’ä»¶ï¼š Plug 'neovim/nvim-lspconfig'ç„¶åï¼ŒæŒ‰ç…§ nvim-lspconfig çš„æ–‡æ¡£è¯´æ˜ï¼Œæ‰“å¼€~/. config/nvim/init. vimï¼Œåœ¨å…¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š lua &lt;&lt; EOFrequire'lspconfig'. solargraph. setup{}require'lspconfig'. tsserver. setup{}require'lspconfig'. gopls. setup{}EOFæ¥ä¸‹æ¥çš„æ­¥éª¤æ˜¯â€¦â€¦æ²¡äº†ï¼ğŸ˜„ æˆ‘çš„ Rubyã€JavaScript å’Œ Golang ä¸‰ç§è¯­è¨€åœ¨ NeoVim ä¸Šçš„ LSP æ”¯æŒå°±æ­¤å®Œæˆï¼ å½“ç„¶äº†ï¼Œå…¨éƒ¨å·¥ä½œå…¶å®è¿˜æ²¡å®Œã€‚ä½† NeoVim å±‚é¢çš„éƒ¨åˆ†ç¡®å®å·²ç»ç»“æŸäº†ï¼Œç®—æ˜¯è¶³å¤Ÿç®€æ´äº†å§ï¼Ÿ ä¸Šé¢æˆ‘éƒ½æ˜¯ä½¿ç”¨äº† nvim-lspconfig çš„é»˜è®¤é…ç½®ï¼Œå› ä¸ºè¶³å¤Ÿäº†ã€‚ä½†å¦‚æœä½ æƒ³è¦é’ˆå¯¹æ¯ç§è¯­è¨€å•ç‹¬åšä¸€äº›ç‰¹åˆ«çš„è®¾ç½®ï¼Œé‚£ä¹ˆå¯ä»¥å‚è€ƒ nvim-lspconfig çš„è¿™ä¸ªæ–‡æ¡£ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘è¿˜éœ€è¦åœ¨è‡ªå·±ç³»ç»Ÿä¸ŠæŠŠä¸Šè¿°ä¸‰ç§è¯­è¨€çš„ LSP Server å®‰è£…ä¸Šï¼Œç„¶å NeoVim ä»¥ä¸Šæ‰€é…ç½®å¥½çš„ LSP Client å°±å¯ä»¥æ­£ç¡®åœ°è¿æ¥ä¸Šå®ƒä»¬ã€‚ Ruby çš„ LSP Server æˆ‘ä½¿ç”¨ Solargraphï¼Œé€šè¿‡ Gem å®‰è£…ï¼š gem install solargraphJavaScript çš„ LSP Server æˆ‘ä½¿ç”¨ tsserverï¼Œé€šè¿‡ npm å®‰è£…ï¼š npm install -g typescript typescript-language-serverGolang çš„ LSP Server æˆ‘ä½¿ç”¨ goplsï¼Œé€šè¿‡ go mod å®‰è£…ï¼š go get golang. org/x/tools/gopls@latestå…¨éƒ¨è£…å¥½ä¹‹åï¼Œç”¨ NeoVim æ‰“å¼€ä¸€ä¸ªä¸Šè¿°ä¸‰ç§è¯­è¨€çš„ä»»æ„ä¸€ä¸ªé¡¹ç›®çš„ä»£ç æ–‡ä»¶ï¼Œåœ¨ Vim å‘½ä»¤è¡Œæ¨¡å¼ä¸‹è¾“å…¥:LspInfoï¼Œå›è½¦ï¼Œåº”è¯¥å°±å¯ä»¥çœ‹åˆ°æ‰€æœ‰é…ç½®æˆåŠŸçš„ LSP ä¿¡æ¯äº†ã€‚ "
    }, {
    "id": 23,
    "url": "/2021/02/switch-to-neovim-builtin-lsp/",
    "title": "æ­£å¼åˆ‡æ¢åˆ°NeoVim Builtin LSPäº†ï¼",
    "body": "2021/02/22 - ä» 2019 å¹´èµ·ï¼Œæˆ‘çš„ Vimï¼ˆå®é™…æ˜¯ NeoVimï¼‰éƒ½ä½¿ç”¨ coc. nvimä½œä¸º LSPï¼ˆLanguage Server Protocolï¼Œå¾®è½¯çš„ä¸€å¥—æ ‡å‡†ï¼‰ã€‚ä½†ç°åœ¨ï¼Œæ—¶ä»£å˜äº†ã€‚ ä¸å¯å¦è®¤ï¼Œcoc. nvim åˆšè¯ç”Ÿçš„æ—¶å€™å¾ˆæ˜¯æƒŠè‰³äº†ä¼—äººä¸€æŠŠã€‚ç›®å‰å®ƒä»ç„¶å¾ˆç«ğŸ”¥ï¼ŒGitHub çš„ star æ•°å·²ç»è¾¾åˆ°äº† 15. 2Kã€‚ ä½†æ˜¯ï¼Œç”±äº coc. nvim æ˜¯åŸºäº JS å¼€å‘çš„ï¼Œå®ƒçš„ç”Ÿæ€åœˆï¼ˆå®ƒçš„å„ç§ Pluginï¼‰ä¹Ÿéƒ½æ˜¯JSã€‚è€Œè¦åœ¨ NeoVim ä¹‹å¤–å†ä¾èµ–äºå¦ä¸€å¥—è¯­è¨€çš„Pluginï¼ˆä¸å…‰æ˜¯JSï¼Œæœ‰äº›ä¾èµ–Pythonçš„ä¹Ÿæ˜¯ï¼‰ï¼Œæ€»æ˜¯ä¼šè«åå…¶å¦™åœ°ç»å¸¸å‘ç”Ÿå„ç§é—®é¢˜ã€‚æ¯”å¦‚ï¼Œæœ€è¿‘æˆ‘çš„ coc. nvim çš„è‡ªåŠ¨æç¤ºå°±å‡ºæ¯›ç—…äº†ï¼šåˆšæ‰“å¼€ NeoVim æ—¶ï¼Œæç¤ºèœå•èƒ½å‡ºæ¥ï¼Œä½†å‡ºå»åƒä¸ªåˆé¥­å›æ¥ï¼Œä¸‹åˆå†ç»§ç»­å†™ä»£ç æ—¶ï¼Œå®ƒå°±æ­»æ´»æ²¡å“åº”äº†ï¼ˆæˆ‘çš„ NeoVim ä¸Šç­æ—¶æ‰“å¼€ååŸºæœ¬ä¸€æ•´å¤©éƒ½ä¸ä¼šå…³çš„ï¼‰ã€‚ æœ€è¿‘å®åœ¨å¯¹ coc. nvim çš„å„ç§æ¯›ç—…å¿å—ä¸äº†ï¼Œäºæ˜¯æŠŠç›®å…‰è½¬å‘äº† NeoVim çš„å†…ç½® LSPã€‚ è°ƒç ”äº†ä¸€ä¸‹ï¼Œå‘ç°éšç€ NeoVim 0. 5 ç‰ˆæœ¬æ„ˆæ¥æ„ˆä¸´è¿‘ï¼Œå…¶å†…ç½®çš„ LSP ä¹Ÿæ„ˆåŠ å®Œå–„äº†ã€‚å¦‚æœå®ƒçš„åŸç”Ÿ LSP æ”¯æŒå°±èƒ½æ»¡è¶³æˆ‘çš„æ—¥å¸¸ä½¿ç”¨éœ€æ±‚ï¼Œé‚£ coc. nvim åŠå…¶ç›¸å…³ Plugin æ•´ä¸ªä¸€å¥—éƒ½å¯ä»¥ä¸¢æ‰äº†ã€‚å²‚ä¸ç¾å“‰ï¼ŸğŸ˜„ æ›´ä»¤äººæ¬£å–œåœ°æ˜¯ï¼Œç›®å‰ NeoVim å®˜æ–¹ä¹Ÿè®¤è¯†åˆ°äº† LSP å¯¹äºå¼€å‘è€…çš„é‡è¦æ€§ï¼Œå› æ­¤å¯¹äºå„ç§è¯­è¨€ LSP å¦‚ä½•å®‰è£…å’Œé…ç½®ï¼Œéƒ½é€šè¿‡æ’ä»¶å’Œæ–‡æ¡£çš„å½¢å¼ï¼ŒåŠ›æ±‚è®©ä½¿ç”¨è€…èƒ½å¤Ÿæ¯«ä¸è´¹åŠ›åœ°ç»è¿‡ç®€å•å‡ ä¸ªæ­¥éª¤å°±èƒ½å®Œæˆã€‚éå¸¸è´´å¿ƒï¼å¯ä»¥è¯´ï¼Œæ¯”å½“åˆæˆ‘é…ç½® coc. nvim çš„æ—¶å€™ç®€å•è½»æ¾ä¸€ç™¾å€â¤ï¸ æ¥ä¸‹æ¥ï¼Œåç»­å‡†å¤‡ç”¨å‡ ç¯‡åšå®¢æ¥è¯¦ç»†è®°è¿°ä¸€ä¸‹è‡ªå·±çš„ NeoVim æœ‰å…³ LSP ç›¸å…³é…ç½®çš„å†…å®¹äº†ã€‚ "
    }, {
    "id": 24,
    "url": "/2020/12/how-to-graphql-no-n-plus-one/",
    "title": "GraphQL on Railsâ€”â€”é¿å…N+1é—®é¢˜",
    "body": "2020/12/15 - æœ¬æ–‡å·²è·å¾—åŸä½œè€…ï¼ˆDmitry Tsepelevï¼‰å’Œ Evil Martians æˆæƒè®¸å¯è¿›è¡Œç¿»è¯‘ã€‚åŸæ–‡é‡ç‚¹ä»‹ç»äº†å¦‚ä½•åœ¨ GraphQL çš„ä¸–ç•Œé‡Œé¿å… N + 1 é—®é¢˜â€”â€”ä»¥å…­ç§ä¸åŒçš„æ–¹æ¡ˆã€‚â€œå…­ç³ä¹‹ä¸­è²èŠ±å¼€æ”¾ï¼Œä¸ƒå°ºçº¢ç»«å‡»æ’ç©ºå·¨æµªâ€ã€‚  åŸæ–‡é“¾æ¥ï¼šHow to GraphQL with Ruby, Rails, Active Record, and no N+1 ä½œè€…ï¼šDmitry Tsepelev ç«™ç‚¹ï¼šEvil Martians â€”â€”ä½äºçº½çº¦å’Œä¿„ç½—æ–¯çš„ Ruby on Rails å¼€å‘äººå‘˜åšå®¢ã€‚ å®ƒå‘å¸ƒäº†è®¸å¤šä¼˜ç§€çš„æ–‡ç« ï¼Œå¹¶ä¸”æ˜¯ä¸å°‘ gem çš„èµåŠ©å•†ã€‚ã€æ­£æ–‡å¦‚ä¸‹ã€‘ å¼•è¨€: ä½ å·¥ä½œåœ¨ä¸€ä¸ªæˆç†Ÿçš„ Web åº”ç”¨ç¨‹åºä¸Šï¼Œå…¶è¢«æ‹†åˆ†ä¸ºæ¸…æ™°çš„åç«¯å’Œå‰ç«¯ã€‚æœåŠ¡ç«¯ä»£ç ç”¨ Ruby å†™æˆï¼Œä¸»è¦è´Ÿè´£æŠŠ HTTP è¯·æ±‚ä¼ é€’åˆ° SQL è¯­å¥å†…ï¼ˆåœ¨ ORM çš„å¸®åŠ©ä¸‹ï¼‰ï¼Œæœ‰ä¸°å¯Œä¸”å¾ˆå¥½æ–‡æ¡£çš„ APIã€‚ä½ é€‰æ‹©äº† GraphQL è€Œé REST æ¥ç®€åŒ–ç«¯ç‚¹ï¼Œä½†æ•°æ®åº“å¯¹äºé¢å¤–çš„æŸ¥è¯¢å¹¶ä¸æ»¡æ„ã€‚ç»è¿‡å¤§é‡æœç´¢åï¼Œä½ ä» ä¸€ä¸ªä½¿ç”¨ GraphQL çš„ Rubyist é‚£é‡Œå‘ç°äº†ä¸€ä¸ªæœ‰å…³å¯¹æŠ— N + 1 é—®é¢˜çš„è¯¦å°½æŒ‡å—â€¦â€¦è¯ºï¼Œå®ƒæ¥äº†ï¼ GraphQLå¯ä»¥åœ¨ä»…åç«¯çš„ Rails åº”ç”¨ç¨‹åºä¸­åˆ›é€ å¥‡è¿¹ï¼Œä¸ºä½ çš„å®¢æˆ·ç«¯ï¼ˆæ— è®ºæ˜¯å‰ç«¯æ¡†æ¶è¿˜æ˜¯å…¶ä»– API ä½¿ç”¨è€…ï¼‰æä¾›ä¸€ä¸ªå•ä¸€ç«¯ç‚¹ï¼Œä»¥è·å–ä»–ä»¬å¯èƒ½éœ€è¦çš„ä»»ä½•å½¢å¼å’Œå¤§å°çš„æ•°æ®ã€‚ ä¸è¿‡å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªå¤§é—®é¢˜ã€‚N + 1 çš„å¤§é—®é¢˜ã€‚ å› ä¸ºè¦åŠ è½½çš„å…³è”æ•°æ®æ€»æ˜¯åœ¨ runtime æ—¶æ‰ç¡®å®šçš„ï¼Œå…³äºæŸ¥è¯¢æ•°æ®åº“å¾ˆéš¾åšåˆ°æ™ºèƒ½åŒ–ã€‚ è¦ä¹ˆä½ å¯ä»¥æ¥å—ä»¤äººéš¾è¿‡çš„ç°å®ï¼šä¸€ä¸ªå¤„ç†çˆ¶è®°å½•çš„ query + é’ˆå¯¹æ¯ä¸ªå…³è”è®°å½•çš„ queryï¼ˆæ‰€ä»¥æ˜¯â€œN+1â€ï¼Œå°½ç®¡ä¸¥æ ¼çš„è¯´åº”è¯¥æ˜¯â€œ1+Nâ€ï¼‰â€”â€”è¦ä¹ˆä½ å¯ä»¥ä½¿ç”¨å¯çˆ±çš„ SQL è¯­å¥ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æœ‰å…³è®°å½•ã€‚ä½†å¦‚æœä½ æœ‰ä¸€ä¸ªä¸°å¯Œçš„ schemaï¼Œè€Œå…¶æ­£æ˜¯åˆ‡æ¢åˆ° GraphQL çš„åŸå› ï¼Œé¢„åŠ è½½ä¼šå¯¹æ•°æ®åº“é€ æˆæ›´å¤§çš„å‹åŠ›ï¼Œä¹ƒè‡³è¶…è¿‡ N+1 çš„å‹åŠ›ã€‚å¹¸è¿çš„æ˜¯ï¼Œåœ¨ Ruby-GraphQL ä¸–ç•Œé‡Œæœ‰ä¸€äº›å·¥å…·ï¼Œè®©æˆ‘ä»¬å¯¹äºåŠ è½½ä»€ä¹ˆï¼Œä½•æ—¶åŠ è½½ä»¥åŠå¦‚ä½•åŠ è½½ï¼Œæœ‰äº†æ›´å¤šçš„é€‰æ‹©ï¼Œä¹Ÿæ›´æ™ºèƒ½åŒ–ã€‚ Itâ€™s always better to have an example: è®©æˆ‘ä»¬å‹¾ç”»ä¸€ä¸ªå®ä¾‹ï¼Œå®ƒæœ‰ç®€å•çš„ schemaï¼Œä½œä¸ºç®€å•çš„ Twitter å…‹éš†åº”ç”¨ã€‚è¿™é‡Œçš„ç›®æ ‡ä¸æ˜¯è¦åšåˆ°åŸç”Ÿé‚£æ ·ï¼Œè€Œæ˜¯èƒ½ç«‹å³è·Ÿ types å…³è”èµ·æ¥ã€‚å®ƒä»¬æ˜¯Tweetï¼ŒUserå’ŒViewerã€‚Vieweræ˜¯æŸ¥çœ‹å…¶ä»–ç”¨æˆ·çš„ tweet çš„ç”¨æˆ·ã€‚æˆ‘ä»¬ä¸ºâ€œcurrent userâ€åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ typeï¼Œå› ä¸ºå®ƒå¯ä»¥æš´éœ²å‡ºâ€œgeneralâ€ç”¨æˆ·æ‰€ä¸å¯è®¿é—®çš„é‚£äº›å±æ€§ã€‚ class Types::BaseObject &lt; GraphQL::Schema::Object def current_user  context[:current_user] endendclass Types::Tweet &lt; Types::BaseObject field :content, String, null: false field :author, Types::User, null: falseendclass Types::User &lt; Types::BaseObject field :nickname, String, null: falseendclass Types::Viewer &lt; Types::BaseObject field :feed, [Types::Tweet], null: false def feed  # In this case, FeedBuilder is a query object  # that returns a Tweet relation based on passed params  FeedBuilder. for(current_user) endendclass Types::Query &lt; Types::BaseObject field :viewer, Types::Viewer, null: true, resolver_method: :current_userendclass GraphqlSchema &lt; GraphQL::Schema query Types::Queryendæˆ‘ä¹Ÿå‡†å¤‡äº†ä¸€ä¸ª gistï¼Œåœ¨å•ä¸ªæ–‡ä»¶å†…åŒ…å«äº†æ•´ä¸ª Rails â€œåº”ç”¨â€ã€‚ä½ æ— æ³•è¿è¡Œå®ƒï¼Œä½†å®ƒçš„åŠŸèƒ½è¶³ä»¥é€šè¿‡æˆ‘ä»¬åŒ…å«çš„ç”¨äºæ¯”è¾ƒæœ¬æ–‡ä¸­è®¨è®ºçš„ä¸åŒä¼˜åŒ–æ–¹æ³•çš„ specsã€‚è¦æŸ¥çœ‹ä»£ç å’Œè¿è¡Œ specsï¼Œä½ å¯ä»¥åœ¨ terminal ä¸­çš„ä»»ä½•ä¸´æ—¶ç›®å½•ä¸‹è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š curl  https://gist. githubusercontent. com/DmitryTsepelev/d0d4f52b1d0a0f6acf3c5894b11a52ca/raw/cba338548f3f87c165fc7ec07eb2c5b55120f7a2/2_demo. rb  &gt; demo. rbcreatedb nplusonedb # To create a PostgreSQL test database, requires Postgres installationrspec demo. rb # to run tests that compare different N+1-fighting techniquesè¿™æ®µä»£ç ç›®å‰åŒ…å«ä¸€ä¸ª N + 1 é—®é¢˜ã€‚æŸ¥è¯¢å« tweet ä½œè€…æ˜µç§°çš„ feed å°†ä¼šå¯¹tweetsè¡¨è§¦å‘ä¸€ä¸ªå•ç‹¬çš„ queryï¼Œä»¥åŠåœ¨usersè¡¨ä¸­çš„ N ä¸ª queryã€‚ { query {  viewer {   feed {    content    author {     nickname    }   }  } }}Solution #0: Load all the associations!: è®©æˆ‘ä»¬ä»æ¸…ç†ä»£ç å¹¶æŠŠ feed çš„åŠ è½½è§£æ„åˆ°ä¸€ä¸ª resolver å¼€å§‹â€”â€”resolver æ˜¯ä¸€ä¸ªç‰¹åˆ«çš„ classï¼Œä¸ºæ•°æ®åº“æŸ¥è¯¢é€»è¾‘çš„ä¸€ä¸ªæ¦‚è¿°ã€‚ class Resolvers::FeedResolver &lt; Resolvers::BaseResolver type [Types::Tweet], null: false def resolve  FeedBuilder. for(current_user) endendclass Types::Viewer &lt; Types::BaseObject field :feed, resolver: Resolvers::FeedResolverendå¦‚æœä½ æ„Ÿå…´è¶£ï¼Œä¸‹é¢æ˜¯æˆ‘ä»¬FeedBuilderæ¨¡å—çš„å®šä¹‰ï¼ŒæŠ½è±¡äº†ä¸€äº› Active Record è°ƒç”¨ï¼š module FeedBuilder module_function def for(user)  Tweet. where(author: user. followed_users)     . order(created_at: :desc)     . limit(10) endendæŠŠé€»è¾‘æŠ½å‡ºæ¥æ”¾åˆ° resolver ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿåˆ›å»ºæ›¿ä»£çš„ resolver å¹¶å®æ—¶äº¤æ¢å®ƒä»¬ä»¥æ¯”è¾ƒç»“æœã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªé€šè¿‡é¢„åŠ è½½æ‰€æœ‰å…³è”è®°å½•æ¥è§£å†³ N+1 é—®é¢˜çš„ resolverï¼š class Resolvers::FeedResolverPreload &lt; Resolvers::BaseResolver type [Types::Tweet], null: false def resolve  FeedBuilder. for(current_user). includes(:author) # Use AR eager loading magic endendè¿™ä¸ªè§£å†³åŠæ³•å¾ˆå®¹æ˜“æƒ³åˆ°çš„ï¼Œä½†ä¸é‚£ä¹ˆç†æƒ³ï¼šæˆ‘ä»¬æ€»æ˜¯ä¼šåšä¸€æ¬¡é¢å¤–çš„ SQL æŸ¥è¯¢æ¥é¢„åŠ è½½ usersï¼Œä¸ç®¡ä»€ä¹ˆæƒ…å†µï¼Œç”šè‡³æˆ‘ä»¬åªè¯·æ±‚ tweets è€Œä¸å…³å¿ƒå…¶ä½œè€…æ—¶ä¹Ÿå¦‚æ­¤ï¼ˆæˆ‘çŸ¥é“ï¼Œè¿™éš¾ä»¥æƒ³è±¡ï¼Œä½†å‡è®¾ä¸€ä¸‹åŒ¿åæ•°æ®æŒ–æ˜æ“ä½œï¼‰ã€‚ è¿˜æœ‰ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨é¡¶å±‚ï¼ˆåœ¨Query type æˆ–å±äºå®ƒçš„ resolver å†…éƒ¨ï¼‰å°±å®šä¹‰å…³è”è®°å½•çš„åˆ—è¡¨ã€‚å½“ä¸€ä¸ªæ–°çš„åµŒå¥—å­—æ®µå‡ºç°åœ¨ graph çš„æ·±å¤„æ—¶ï¼Œå¾ˆå®¹æ˜“å¿˜è®°æŠŠæ–°çš„å…³è”å…³ç³»æ·»åŠ åˆ°åˆ—è¡¨é‡Œã€‚ ä¸è¿‡ï¼Œå½“ä½ çŸ¥æ™“å®¢æˆ·ç«¯å¤§å¤šæƒ…å†µä¸‹å°±æ˜¯è¦æ±‚ä½œè€…æ•°æ®æ—¶ï¼Œè¿™ä¸ªæ–¹æ¡ˆå°±å¾ˆæœ‰ç”¨äº†ï¼ˆæ¯”å¦‚ï¼Œå½“ä½ æŒæ§å‰ç«¯ä»£ç æ—¶ï¼‰ã€‚ Solution #1: Lookaheads: åœ¨å¤„ç† query æ—¶ï¼ŒGraphQL çš„ execution engine çŸ¥é“å“ªäº›æ•°æ®è¢«è¯·æ±‚ï¼Œæ‰€ä»¥åœ¨è¿è¡Œæ—¶æ‰¾åˆ°å“ªäº›æ•°æ®åº”è¯¥è¢«åŠ è½½æ˜¯å¯ä»¥åšåˆ°çš„ã€‚graphql-ruby gem è‡ªå¸¦ä¸€ä¸ªå¯çˆ±çš„ Lookahead ç‰¹æ€§ï¼Œå¯ä»¥æå‰å‘ŠçŸ¥æˆ‘ä»¬æŸä¸ªç‰¹å®šå­—æ®µæ˜¯å¦è¢«è¯·æ±‚ã€‚è®©æˆ‘ä»¬åœ¨ä¸€ä¸ªå•ç‹¬çš„ resolver ä¸­è¯•è¯•ï¼š class Resolvers::FeedResolverLookahead &lt; Resolvers::BaseResolver type [Types::Tweet], null: false extras [:lookahead] def resolve(lookahead:)  FeedBuilder. for(current_user)        . merge(relation_with_includes(lookahead)) end private def relation_with_includes(lookahead)  # . selects?(:author) returns true when author field is requested  return Tweet. all unless lookahead. selects?(:author)  Tweet. includes(:author) endendæ­¤å¤„ï¼Œæˆ‘ä»¬ä»…å½“å®¢æˆ·ç«¯è¦æ±‚authorå­—æ®µæ—¶æ‰åœ¨usersè¡¨å†…è¿›è¡ŒæŸ¥è¯¢ã€‚è¿™ä¸ªæ–¹æ¡ˆä»…ä»…åœ¨å…³è”è®°å½•æœ€å°ä¸”æ²¡æœ‰åµŒå¥—æ—¶æ‰èƒ½å¾ˆå¥½åœ°å·¥ä½œã€‚å¦‚æœæˆ‘ä»¬æœ‰ç€æ›´å¤æ‚çš„æ•°æ® modelï¼Œå…¶ä¸­ users æœ‰ avatars å’Œå…¶æ‰€å–œæ¬¢çš„ tweetsï¼Œé‚£ä¹ˆ resolver å¾ˆå¿«å°±ä¼šè„±ç¦»ç°å®äº†ï¼š class Resolvers::FeedResolverLookahead &lt; Resolvers::BaseResolver type [Types::Tweet], null: false extras [:lookahead] def resolve(lookahead:)  scope =   Tweet. where(user: User. followed_by(current_user))      . order(created_at: :desc)      . limit(10)  scope = with_author(scope, lookahead) if lookahead. selects?(:author)  scope = with_liked_by(scope, lookahead) if lookahead. selects?(:liked_by)  scope end private def with_author(scope, lookahead)  if lookahead. selection(:author). selects?(:avatar)   scope. includes(user: :avatar_attachment)  else   scope. includes(:user)  end end def with_liked_by(scope, lookahead)  if lookahead. selection(:liked_by). selects?(:user)   if lookahead. selection(:liked_by). selection(:user). selects?(:avatar)    scope. includes(likes: { user: :avatar_attachment })   else    scope. includes(likes: :user)   end  else   scope. includes(:likes)  end endendæ²¡é”™ï¼Œè¿™ä¸€ç‚¹éƒ½ä¸ä¼˜é›…ï¼æœ‰æ²¡æœ‰ä¸€ç§æ–¹å¼ä»…å½“å…³è”è®°å½•è¢«è®¿é—®æ—¶æ‰åŠ è½½å®ƒä»¬ï¼ŸLazy preloading å°±å¯ä»¥ï¼ Solution #2: Lazy preloading (by Evil Martians): åœ¨ Evil Martian çš„ä¸€äº›åŒäº‹å¸®åŠ©ä¸‹ï¼Œæˆ‘å†™äº†ä¸€ä¸ªåä¸º ar_lazy_preload çš„å° gemï¼Œè®©æˆ‘ä»¬å›é€€åˆ°é¢„åŠ è½½æ–¹æ¡ˆï¼Œä½†æ— éœ€ä»»ä½•é¢å¤–æˆæœ¬å³å¯ä½¿å…¶å˜å¾—æ›´æ™ºèƒ½ã€‚å®ƒä»…åœ¨å…³è”å¯¹è±¡è¢«ç¬¬ä¸€æ¬¡è®¿é—®åï¼Œç”¨ä¸€ä¸ªå•ç‹¬çš„è¯·æ±‚æ¥è·å–æ‰€æœ‰å…³è”å¯¹è±¡ã€‚å½“ç„¶ï¼Œå®ƒä¹Ÿå¯ä»¥åœ¨ GraphQL ç¤ºä¾‹ä¹‹å¤–ä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨ REST API ä¸­æˆ–åœ¨æ„å»ºæœåŠ¡ç«¯æ¸²æŸ“è§†å›¾æ—¶éå¸¸æ–¹ä¾¿ã€‚ä½ åªéœ€æŠŠgem  ar_lazy_preload æ·»åŠ åˆ° Gemfileï¼Œbundle installï¼Œç„¶åå°±å¯ä»¥åƒè¿™æ ·æ¥å†™ resolver äº†ï¼š class Resolvers::FeedResolverLazyPreload &lt; Resolvers::BaseResolver type [Types::Tweet], null: false def resolve  FeedBuilder. for(current_user). lazy_preload(:author) endendè¿™ä¸ª gem æ˜¯åœ¨ æ‡’æƒ° ä¸­åˆ›å»ºå‡ºæ¥çš„ï¼Œæ‰€ä»¥å¦‚æœä½ ç”šè‡³éƒ½æ‡’äºæ•². lazy_preloadè¿™ç‚¹ä»£ç çš„è¯ï¼Œå¯ä»¥åœ¨å…¨å±€é’ˆå¯¹æ‰€æœ‰ Active Record è°ƒç”¨éƒ½å¯ç”¨å®ƒï¼Œåªè¦åœ¨é…ç½®ä¸­æ·»åŠ ä¸‹é¢è¿™è¡Œï¼š ArLazyPreload. config. auto_preload = trueç„¶è€Œï¼Œè¿™ä¸ªæ–¹æ¡ˆæœ‰ä¸€äº›ä¸è¶³ï¼š  æˆ‘ä»¬æœ€ç»ˆå¼•å…¥äº†ç¬¬ä¸€ä¸ªå¤–éƒ¨ä¾èµ–ï¼› æˆ‘ä»¬å¯¹æ‰€åšçš„ query è¯·æ±‚æ— æ³•æœ‰å¤ªå¤šæ§åˆ¶ï¼Œå°†éš¾ä»¥å¯¹å…¶è¿›è¡Œè‡ªå®šä¹‰ï¼› å¦‚æœ lazy preloading è¢«æ‰“å¼€ï¼Œæˆ‘ä»¬ä»ç„¶ä¸å¾—ä¸åœ¨é¡¶å±‚åˆ—ä¸¾æ‰€æœ‰å¯èƒ½çš„å…³è”æ•°æ®ï¼› å¦‚æœä¸€å¼ è¡¨ä»ä¸¤ä¸ªåœ°æ–¹è¢«å¼•ç”¨ï¼Œæˆ‘ä»¬å°±å°†è¯·æ±‚æ•°æ®åº“ä¸¤æ¬¡ã€‚è¿˜æœ‰å…¶ä»–æˆ‘ä»¬èƒ½åšçš„ä¹ˆï¼Ÿ Solution #3: graphql-ruby lazy resolvers: è®©æˆ‘ä»¬åœ¨ Ruby åº”ç”¨ä¸­å¾—ä»¥ç”¨ä¸Š GraphQL çš„graphql-ruby gem å¸¦æ¥äº†ä¸€ç§ä½¿ç”¨ lazy execution çš„æ–¹å¼ï¼š  ä»£ä¹‹ä»¥è¿”å›æ•°æ®ï¼Œä½ å¯ä»¥è¿”å›ä¸€ä¸ªç‰¹åˆ«çš„ lazy objectï¼ˆè¯¥ object ä¼šè®°å¾—å®ƒæ‰€ä»£æ›¿çš„æ•°æ®ï¼‰ï¼› å½“ä¸€ä¸ª lazy value ä» resolver è¢«è¿”å›æ—¶ï¼Œexecution engine åœæ­¢å½“å‰ subtree çš„è¿›ä¸€æ­¥å¤„ç†ï¼› å½“æ‰€æœ‰é lazy values éƒ½è¢« resolved æ—¶ï¼Œexecution engine å†è¦æ±‚å¤„ç† lazy objectï¼› lazy object åŠ è½½å…¶æ‰€éœ€å¤„ç†çš„æ•°æ®ï¼Œå¹¶è¿”å›ç»™æ¯ä¸ª lazy objectã€‚è¿™éœ€è¦èŠ±ä¸€ç‚¹æ—¶é—´æ¥ç†è§£ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥ä¸€æ­¥æ­¥å®ç°ä¸€ä¸ª lazy resolverã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥é‡ç”¨è¿˜æœªåŠ å…¥å…³è”çš„åˆå§‹FeedResolverï¼š class Resolvers::FeedResolver &lt; Resolvers::BaseResolver type [Types::Tweet], null: false def resolve  FeedBuilder. for(current_user) endendç„¶åï¼Œæˆ‘ä»¬å°†ä»Tweet type è¿”å›ä¸€ä¸ª lazy objectã€‚æˆ‘ä»¬éœ€è¦ä¼ é€’ user çš„ ID å’Œ query contextï¼Œå› ä¸ºå°†ç”¨å®ƒæ¥å­˜å‚¨è¦åŠ è½½çš„ ID åˆ—è¡¨ï¼š class Types::Tweet &lt; Types::BaseObject field :content, String, null: false field :author, Types::User, null: false def author  Resolvers::LazyUserResolver. new(context, object. user_id) endendæ¯æ¬¡ä¸€ä¸ªæ–° object è¢«åˆå§‹åŒ–ï¼Œæˆ‘ä»¬éƒ½æ·»åŠ ä¸€ä¸ªå¾…å¤„ç†çš„ user ID åˆ° query contextï¼Œå¹¶ä¸”ï¼Œå½“#userè¢«ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬åšä¸€æ¬¡å•ç‹¬çš„æ•°æ®åº“è¯·æ±‚ä»¥å¾—åˆ°æ‰€æœ‰æ‰€éœ€çš„ usersã€‚ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸ºæ‰€æœ‰ lazy fields å¡«å…… user çš„æ•°æ®äº†ã€‚ä¸‹é¢æ˜¯å¦‚ä½•å®ç°å®ƒçš„ä»£ç ï¼š class Resolvers::LazyUserResolver def initialize(context, user_id)  @user_id = user_id  @lazy_state = context[:lazy_user_resolver] ||= {   user_ids: Set. new,   users_cache: nil  }  @lazy_state[:user_ids] &lt;&lt; user_id end def user  users_cache[@user_id] end private def users_cache  @lazy_state[:users_cache] ||=   begin    user_ids = @lazy_state[:user_ids]. to_a    @lazy_state[:user_ids]. clear    User. where(id: user_ids). index_by(&amp;:id)   end endendæƒ³çŸ¥é“ execution engine æ˜¯å¦‚ä½•åŒºåˆ†å‡ºå¸¸è§„ object ä¸ lazy object ä¹‹é—´çš„ä¸åŒå—ï¼Ÿæˆ‘ä»¬å°†åœ¨ schema ä¸­å®šä¹‰ lazy resolverï¼š class GraphqlSchema &lt; GraphQL::Schema lazy_resolve(Resolvers::LazyUserResolver, :user) query Types::Queryendå®ƒå‘Šè¯‰ execution engineï¼Œå½“Resolvers::LazyUserResolver object è¢«è¿”å›æ—¶åœæ­¢å¤„ç† usersï¼Œå¹¶ä»…å½“æ‰€æœ‰å…¶ä»–é lazy fields è¢« resolved ä¹‹åæ‰å›æ¥å¤„ç†å®ƒã€‚ è¿™æ ·ä¸€åˆ‡è¿è½¬æ­£å¸¸ï¼Œä½†æ˜¯ä½ å¯èƒ½ç»å¸¸éœ€è¦é‡å¤å¾ˆå¤šæ ·æ¿ä»£ç ã€‚æ­¤å¤–ï¼Œå½“æˆ‘ä»¬çš„ lazy resolvers éœ€è¦å¤„ç†å…¶ä»– lazy object æ—¶ï¼Œä»£ç ä¼šå˜å¾—ç›¸å½“å¤æ‚ã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ä¸ªä¸å¤ªå†—é•¿çš„æ›¿ä»£æ–¹æ¡ˆã€‚ Solution #4: Batch loading: æ¥è‡ª Shopify çš„ graphql-batch ä½¿ç”¨äº†ä¸graphql-rubyç›¸åŒçš„ lazy æœºåˆ¶ï¼Œä½†éšè—äº†é‚£äº›ä¸‘é™‹çš„æ ·æ¿ä»£ç éƒ¨åˆ†ã€‚æˆ‘ä»¬æ‰€éœ€åšçš„å°±æ˜¯ç»§æ‰¿GraphQL::Batch::Loaderå¹¶å®ç°performæ–¹æ³•ï¼š class RecordLoader &lt; GraphQL::Batch::Loader def initialize(model)  @model = model end def perform(ids)  @model. where(id: ids). each { |record| fulfill(record. id, record) }  ids. each { |id| fulfill(id, nil) unless fulfilled?(id) } endendè¿™ä¸ª loaderï¼ˆå–è‡ªäºå…¶å®˜æ–¹ repo çš„ examples ç›®å½•ï¼‰æ‰€æœŸæœ›çš„æ˜¯ initializer ä¸­çš„ model classï¼ˆä»¥å†³å®šæ•°æ®å°†ä»å“ªé‡Œè¢«åŠ è½½ï¼‰ã€‚#performæ–¹æ³•è´Ÿè´£è·å–æ•°æ®ï¼Œ#fulfillæ–¹æ³•ç”¨æ¥æŠŠä¸€ä¸ª key è·ŸåŠ è½½çš„æ•°æ®å…³è”èµ·æ¥ã€‚ Batch loader çš„ç”¨æ³•å’Œ lazy ç‰ˆæœ¬æ˜¯ç±»ä¼¼çš„ã€‚æˆ‘ä»¬ä¼ å…¥Useråˆ° initializerï¼Œuser çš„ ID ç”¨æ¥æ‡’å¼åŠ è½½ï¼ˆè¯¥ ID å°†è¢«ç”¨åš key æ¥è·å–å…³è”çš„ userï¼‰ï¼š class Types::Tweet &lt; Types::BaseObject field :content, String, null: false field :author, Types::User, null: false def author  RecordLoader. for(::User). load(object. author_id) endendè·Ÿé€šå¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ schema ä¸­æ‰“å¼€ lazy loadingï¼š class GraphqlSchema &lt; GraphQL::Schema query Types::Query use GraphQL::Batchendè¿™æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿå½“use GraphQL::Batchè¢«æ·»åŠ åˆ° schema æ—¶ï¼ŒPromise#syncå°±è¢«æ³¨å†Œäº†ï¼Œä»è€Œåšåˆ°æ‡’å¼ resolveï¼ˆå…¶åœ¨å¹•åä½¿ç”¨äº† Promise. rbï¼‰ã€‚å½“#loadæ–¹æ³•åœ¨ä¸€ä¸ªç»§æ‰¿è‡ªGraphQL::Batch::Loaderçš„ class ä¸Šè¢«è°ƒç”¨æ—¶ï¼Œå®ƒè¿”å›ä¸€ä¸ªPromise objectâ€”â€”è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ execution engine æŠŠå…¶è§†ä¸ºä¸€ä¸ª lazy valueã€‚ è¿™ä¸ªæ–¹æ¡ˆæœ‰ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„è¾¹é™…æ•ˆåº”â€”â€”ä½ å¯ç”¨å¦‚ä¸‹æ–¹å¼è¿›è¡Œé“¾å¼åŠ è½½ï¼š def product_image(id:) RecordLoader. for(Product). load(id). then do |product|  RecordLoader. for(Image). load(product. image_id) endendSolution #5: Better schema design: ä½†ç”šè‡³å³ä½¿ä½¿ç”¨äº†ä¸Šè¿°çš„æ‰€æœ‰é«˜çº§æŠ€æœ¯ä¹‹åï¼Œè¿˜æ˜¯å¯èƒ½æœ€ç»ˆå‡ºç° N+1 é—®é¢˜ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æ­£åœ¨åŠ ä¸Šä¸€ä¸ªç®¡ç†é¢æ¿ï¼Œåœ¨å…¶ä¸­å¯ä»¥çœ‹åˆ°ä¸€ä¸ª users åˆ—è¡¨ã€‚å½“ä¸€ä¸ª user è¢«é€‰ä¸­æ—¶ï¼Œç”¨æˆ·ä¿¡æ¯å¼¹çª—å¼¹å‡ºï¼Œä½ å¯ä»¥çœ‹åˆ°ä»–çš„ followers åˆ—è¡¨ã€‚åœ¨ GraphQL ä¸–ç•Œé‡Œï¼Œæ•°æ®å°†ä»å…¶æ‰€å±çš„åœ°æ–¹è¢«è®¿é—®ï¼Œæˆ‘ä»¬ä¼šåšç±»ä¼¼å¦‚ä¸‹çš„äº‹æƒ…ï¼š class Types::User &lt; Types::BaseObject field :nickname, String, null: false field :followers, [User], null: false do  argument :limit, Integer, required: true, default_value: 2  argument :cursor, Integer, required: false end def followers(limit:, cursor: nil)  scope = object. followers. order(id: :desc). limit(limit)  scope = scope. where( id &lt; cursor , cursor) if cursor  scope endendclass Types::Query &lt; Types::BaseObject field :users, [User], null: false field :user, User, null: true do  argument :user_id, ID, required: true end def users  ::User. all end def user(user_id:)  ::User. find(user_id) endendç”¨æˆ·åˆ—è¡¨å¯ä½¿ç”¨å¦‚ä¸‹ query æ¥è·å–ï¼š query GetUsers($limit: Int) { users(limit: $limit) {  nickname }}follow ä¸€ä¸ªç‰¹å®šç”¨æˆ·çš„ç”¨æˆ·åˆ—è¡¨å¯ä»¥åƒä¸‹é¢è¿™æ ·æ¥åŠ è½½ï¼š query GetUser($userId: ID, $followersLimit: Int, $followersCursor: ID) { user(userId: $userId) {  followers(limit: $limit, cursor: $followersCursor) {   nickname  } }}å½“æœ‰äººè¯•å›¾åŠ è½½ä¸€ä¸ªç”¨æˆ·åˆ—è¡¨ï¼Œä¸”åœ¨åŒä¸€ä¸ª query ä¸­åŒ…å«å…¶ followers æ—¶ï¼Œé—®é¢˜å°±å‡ºç°äº†ï¼š query GetUsersWithFollowers( $limit: Int $followersLimit: Int $followersCursor: ID) { users(limit: $limit) {  nickname  followers(limit: $limit, cursor: $followersCursor) {   nickname  } }}è¿™ä¸ªåœºæ™¯é‡Œï¼Œæˆ‘ä»¬æ ¹æœ¬æ— æ³•æ‘†è„± N+1ï¼šæˆ‘ä»¬ä¸å¾—ä¸å¯¹æ¯ä¸€ä¸ª user éƒ½åšä¸€æ¬¡æ•°æ®åº“è°ƒç”¨ï¼Œç”±äºåˆ†é¡µæŒ‡é’ˆçš„ç¼˜æ•…ã€‚è¦å¤„ç†è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸é‚£ä¹ˆä¼˜é›…çš„æ–¹æ¡ˆï¼ŒæŠŠåˆ†é¡µç§»è‡³é¡¶å±‚ï¼š class Types::Query &lt; Types::BaseObject field :users, [User], null: false field :user, User, null: true do  argument :user_id, ID, required: true end field :user_followers, [User], null: false do  argument :limit, Integer, required: true, default_value: 2  argument :cursor, Integer, required: false end def users  ::User. all end def user(user_id:)  ::User. find(user_id) end def user_followers(user_id:, limit:, cursor: nil)  scope = UserConnection. where(user_id: user_id). order(user_id: :desc). limit(limit)  scope = scope. where( user_id &lt; cursor , cursor) if cursor  scope endendè¿™ä¸ªè®¾è®¡ä»ç„¶èƒ½å¤ŸåŠ è½½ users åŠå…¶ followersï¼Œä½†äº‹å®è¯æ˜ï¼Œæˆ‘ä»¬æŠŠæœåŠ¡ç«¯çš„ N+1 å˜æˆäº† N+1 ä¸ª HTTP è¯·æ±‚ã€‚è¯¥è§£å†³æ–¹æ¡ˆçœ‹èµ·æ¥å¾ˆå¥½ï¼Œä½†æ˜¯å˜¿ä¼™è®¡ï¼Œæˆ‘ä»¬çƒ­çˆ± GraphQL çš„ logical schema structure å‘€ï¼æˆ‘ä»¬æœŸæœ›ä»User type è·å–åˆ° followersï¼ æ²¡é—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å¤šä¸ª users è¢«è¯·æ±‚æ—¶é™åˆ¶å¯¹followers field çš„è·å–ã€‚å½“å…¶å‘ç”Ÿæ—¶æˆ‘ä»¬æ¥è¿”å›ä¸€ä¸ª errorï¼š class Types::Query &lt; Types::BaseObject field :users, [User], null: false, extras: [:lookahead] field :user, User, null: true do  argument :user_id, ID, required: true end def users(lookahead:)  if lookahead. selects?(:followers)   raise GraphQL::ExecutionError,  followers can be accessed in singular association only   end  ::User. all end def user(user_id:)  ::User. find(user_id) endendä½¿ç”¨è¿™ä¸ª schemaï¼Œè·å–å•ä¸ª user çš„ followers ä¾æ—§æ˜¯å¯ä»¥çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬å®Œå…¨é˜»æ­¢äº†æ‰€ä¸æœŸæœ›çš„åœºæ™¯ã€‚åˆ«å¿˜äº†åœ¨æ–‡æ¡£ä¸­æ³¨æ˜è¿™ç‚¹ï¼ å°±åˆ°è¿™é‡Œäº†ï¼ä½ å·²ç»åˆ°è¾¾äº†æœ¬æŒ‡å—çš„ç»“å°¾ï¼Œç°åœ¨ä½ è‡³å°‘æœ‰å…­ç§ä¸åŒæ–¹æ¡ˆå¯ä»¥åœ¨ Ruby-GrapgQL ä»£ç ä¸­è¯•ç”¨ï¼Œä»¥ä½¿åº”ç”¨ç¨‹åºæ‘†è„± N + 1 é—®é¢˜ã€‚ ä¹Ÿåˆ«å¿˜äº†çœ‹çœ‹æˆ‘ä»¬åšå®¢ä¸Šå…¶ä»–æœ‰å…³ GraphQL å’Œ N+1 é—®é¢˜çš„æ–‡ç« ï¼šä»å¯¹åˆå­¦è€…å‹å¥½ä¸”å¸¦ä»£ç çš„å…³äºä»¥ React å‰ç«¯æ„å»º Rails GraphQL åº”ç”¨çš„æ•™ç¨‹ï¼ˆä¸‰ä¸ªéƒ¨åˆ†ï¼Œä»è¿™é‡Œå¼€å§‹ï¼‰ï¼Œåˆ°æ›´åŠ ç‰¹å®šç”¨ä¾‹çš„ using GraphQL with Active Storage Direct Uploadï¼Œå¤„ç†æ¥è‡ª Apollo çš„ persisted queriesï¼Œä»¥åŠgraphql-rubyä¸­çš„ reporting non-nullable violationsã€‚ æˆ‘ä»¬ä¹Ÿæœ‰ä¸€äº› gems è®©ä½ åœ¨â€œç»å…¸â€ Rails åº”ç”¨ä¸­å¤„ç† N+1 é—®é¢˜æ›´å®¹æ˜“ï¼Œå’Œä¸€äº›ç›¸å…³æ–‡ç« ï¼šSquash N+1 queries early with n_plus_one_control test matchers for Ruby and Rails å’Œ Fighting the Hydra of N+1 queriesã€‚ "
    }, {
    "id": 25,
    "url": "/2020/11/graphql-on-rails-series-3/",
    "title": "GraphQL on Railsâ€”â€”è‡³è‡»",
    "body": "2020/11/28 - æœ¬æ–‡å·²è·å¾—åŸä½œè€…ï¼ˆDmitry Tsepelevï¼‰ã€ï¼ˆPolina Gurtovayaï¼‰å’Œ Evil Martians æˆæƒè®¸å¯è¿›è¡Œç¿»è¯‘ã€‚åŸæ–‡æ˜¯ Rails + React ä½¿ç”¨ GraphQLçš„ç³»åˆ—æ•™ç¨‹ç¬¬ä¸‰ç¯‡ï¼Œä»‹ç»äº†ä»¥ Rails ä½œä¸ºåç«¯ï¼ŒReact + Apollo ä½œä¸ºå‰ç«¯ï¼Œå¦‚ä½•è¿›è¡Œé‡æ„ã€é”™è¯¯å¤„ç†ä»¥åŠå®æ—¶æ›´æ–°ç­‰é«˜çº§ä¸»é¢˜å’ŒæŠ€å·§ã€‚  åŸæ–‡é“¾æ¥ï¼šGraphQL on Rails: On the way to perfection ä½œè€…ï¼šDmitry Tsepelevï¼ŒPolina Gurtovaya ç«™ç‚¹ï¼šEvil Martians â€”â€”ä½äºçº½çº¦å’Œä¿„ç½—æ–¯çš„ Ruby on Rails å¼€å‘äººå‘˜åšå®¢ã€‚ å®ƒå‘å¸ƒäº†è®¸å¤šä¼˜ç§€çš„æ–‡ç« ï¼Œå¹¶ä¸”æ˜¯ä¸å°‘ gem çš„èµåŠ©å•†ã€‚ã€æ­£æ–‡å¦‚ä¸‹ã€‘ å¼•è¨€: è¿™æ˜¯ä¸€ä¸ªåœ¨åç«¯ä½¿ç”¨ Railsã€å‰ç«¯ä½¿ç”¨ React/Apollo æ¥å¼€å‘ GraphQL åº”ç”¨ç¨‹åºçš„æ—…è¡Œè€…æŒ‡å¯¼ã€‚æœ¬æ•™ç¨‹çš„ç¬¬ä¸‰ä¹Ÿæ˜¯æœ€åä¸€éƒ¨åˆ†éƒ½æ˜¯å…³äºå®æ—¶æ›´æ–°çš„å†…å®¹ï¼Œä»¥åŠ DRY ä»£ç å’Œå®ç°æ›´å¥½çš„é”™è¯¯å¤„ç†ã€‚ åœ¨æœ¬æ•™ç¨‹çš„å‰ä¸€éƒ¨åˆ†é‡Œï¼Œæˆ‘ä»¬å·²ç»æ„å»ºäº† Martian Library åº”ç”¨ç¨‹åºçš„åŸå‹ï¼šç”¨æˆ·å¯ä»¥åœ¨ä¸€ä¸ªç°ä»£çš„ SPA é¡µé¢ä¸­åŠ¨æ€åœ°ç®¡ç†æœ‰å…³çº¢è‰²æ˜Ÿçƒçš„åˆ¶å“ã€‚ä½†è¿˜æ²¡åˆ°åä¸‹ä¼‘æ¯æ”¾æ¾çš„æ—¶å€™ï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æœ‰ä¸€äº›é‡æ„è¦åšã€‚ å¦‚æœä½ æ˜¯ä»å‰ä¸¤éƒ¨åˆ†ä¸€è·¯ç¼–å†™äº†ä»£ç â€”â€”å°±ç”¨ä½ è‡ªå·±çš„ä»£ç å³å¯ï¼Œå¦‚æœä¸æ˜¯â€”â€”é‚£ä¹ˆå¯ä»¥ä»è¿™é‡Œæ‹‰å–ã€‚ All you need is DRY: è®©æˆ‘ä»¬ä»åç«¯å¼€å§‹æ¥å¯¹ item çš„ mutationï¼ˆAddItemMutationå’ŒUpdateItemMutationï¼‰è¿›è¡Œ ä¸€äº› DRY å¤„ç†ã€‚æˆ‘ä»¬æœ‰ä¸€äº›éªŒè¯ç”¨æˆ·æ˜¯å¦ç™»å½•çš„é‡å¤ä»£ç ï¼š # app/graphql/mutations/add_item_mutation. rbmodule Mutations class AddItemMutation &lt; Mutations::BaseMutation  # . . .   def resolve   if context[:current_user]. nil?    raise GraphQL::ExecutionError,        You need to authenticate to perform this action    end   save_item  end endendæŠŠå…¶ç§»åˆ°BaseMutationç±»ä¸­ï¼š # app/graphql/mutations/base_mutation. rbmodule Mutations class BaseMutation &lt; GraphQL::Schema::Mutation  def check_authentication!   return if context[:current_user]   raise GraphQL::ExecutionError,       You need to authenticate to perform this action   end endendç»è¿‡è¿™æ ·çš„ä¿®æ”¹ï¼Œä½ å°±å¯ä»¥æŠŠAddItemMutationå’ŒUpdateItemMutationä¸­çš„ä»£ç æ›¿æ¢ä¸ºcheck_authentication!çš„è°ƒç”¨ã€‚è¿™åªæ˜¯ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥å¦‚ä½•ä½¿ç”¨BaseMutationçš„ä¾‹å­ç½¢äº†ã€‚åœ¨çœŸå®çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå®ƒå¯ä»¥åŒ…å«è®¸å¤šé’ˆå¯¹é‡å¤æ€§å·¥ä½œçš„æœ‰ç”¨çš„å¸®åŠ©æ–¹æ³•ã€‚ ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹å‰ç«¯ä»£ç ã€‚è¿™é‡Œæœ‰æ€æ ·çš„ä»£ç é‡å¤å‘¢ï¼Ÿ ä¸‰ä¸ª query çœ‹èµ·æ¥éƒ½éå¸¸ç±»ä¼¼ï¼šåœ¨Item query ä¸­æˆ‘ä»¬æ‰€é€‰æ‹©çš„å­—æ®µå‡ ä¹æ˜¯ä¸€æ ·çš„ã€‚æˆ‘ä»¬å¯ä»¥æ€æ ·é¿å…è¿™äº›é‡å¤ï¼Ÿ å¹¸è¿çš„æ˜¯ï¼ŒGraphQL æœ‰å…¶è‡ªèº«çš„â€œvariablesâ€ï¼Œç§°ä½œ fragments. ã€‚ä¸€ä¸ª fragment å°±æ˜¯ä¸€ä¸ªåœ¨ç‰¹å®šç±»å‹ä¸Šçš„å‘½åå­—æ®µé›†ã€‚ è¯¥æ˜¯åˆ›å»ºæˆ‘ä»¬ç¬¬ä¸€ä¸ª fragment çš„æ—¶å€™äº†ï¼š $ mkdir -p app/javascript/fragments &amp;&amp; touch app/javascript/fragments/Item. graphqlæŠŠæ‰€æœ‰é‡å¤çš„å­—æ®µæ”¾å…¥å…¶ä¸­ï¼š fragment ItemFragment on Item { id title imageUrl description}ç°åœ¨æˆ‘ä»¬éœ€è¦æŠŠ fragment æ·»åŠ åˆ°AddItemFormã€UpdateItemFormå’ŒLibraryä¸­çš„æ‰€æœ‰ operation ä¸Šã€‚ä¾‹å¦‚ï¼ŒLibraryç»„ä»¶ä¸­çš„ query çœ‹èµ·æ¥ä¼šæ˜¯è¿™æ ·ï¼š #app/javascript/components/Library/operations. graphql#import '. . /. . /fragments/Item. graphql'query LibraryQuery { items {  . . . ItemFragment  user {   id   email  } }}Dealing with errors: æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœè¯·æ±‚æ²¡æœ‰å¼•èµ·æœåŠ¡ç«¯æŠ¥é”™çš„è¯ï¼ŒGraphQL æ€»æ˜¯å“åº”ä¸º 200 OKã€‚é€šå¸¸æœ‰ä¸¤ç§ç±»å‹çš„é”™è¯¯å‘ç”Ÿï¼šç”¨æˆ·è¾“å…¥é”™è¯¯ï¼ˆæ ¡éªŒï¼‰å’Œå¼‚å¸¸ã€‚  æ ¡éªŒé”™è¯¯ ä»…å‡ºç°åœ¨ mutation ä¸­ï¼Œå®ƒä»¬è¢«åŒ…å«åœ¨æ‰€è¿”å›çš„æ•°æ®é‡Œã€‚ä¸ºç”¨æˆ·æä¾›æœ‰ç”¨çš„åé¦ˆï¼Œä»¥æ˜¾ç¤ºåœ¨ UI ä¸Šã€‚ å¼‚å¸¸ å¯ä»¥å‡ºç°åœ¨ä»»ä½• query ä¸­ï¼ŒæŒ‡ç¤º query é‡Œæœ‰ä»€ä¹ˆä¸œè¥¿å‡ºé”™äº†ï¼šä¾‹å¦‚ï¼Œèº«ä»½éªŒè¯/æƒé™çš„é—®é¢˜ï¼Œæ— æ³•å¤„ç†çš„è¾“å…¥æ•°æ®ï¼Œç­‰ç­‰ï¼ˆçœ‹åé¢å†…å®¹ï¼‰ã€‚å¦‚æœå“åº”åŒ…å«å¼‚å¸¸ï¼Œå®¢æˆ·ç«¯å°±å¿…é¡»â€œå°½å…¨åŠ›å¤±è´¥â€ï¼ˆæ¯”å¦‚ï¼Œå±•ç¤ºä¸€ä¸ªé”™è¯¯é¡µé¢ï¼‰ã€‚ä»å‰ç«¯è§’åº¦æ¥çœ‹ï¼Œå¯¹äºé”™è¯¯æˆ‘ä»¬å¯ä»¥å¦‚ä½•åšå‘¢ï¼Ÿ é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªé”™è¯¯æ—¥å¿—è®°å½•å™¨ï¼Œæ¥å¿«é€Ÿæ£€æµ‹å¹¶ä¿®å¤é”™è¯¯ï¼ˆæˆ‘ä»¬å·²ç»åœ¨ç¬¬ä¸€éƒ¨åˆ†ä¸­é…ç½®å¥½äº†ï¼‰ã€‚ å…¶æ¬¡ï¼ŒæŠŠç»„ä»¶å°è£…åœ¨é”™è¯¯è¾¹ç•Œå†…æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œå¹¶åœ¨å‡ºç°é—®é¢˜æ—¶ç”¨æ‚²ä¼¤çš„å¼€å‘è€…é¢å­”æ˜¾ç¤ºé”™è¯¯å±å¹•ã€‚ ç¬¬ä¸‰ï¼Œæˆ‘ä»¬åº”è¯¥é€šè¿‡æŸ¥é˜…æ–‡æ¡£æ¥é¿å…å¸¸è§é”™è¯¯ã€‚å½“å¿ƒç‚¹å·å¹¶æ­£ç¡®å¤„ç†é‚£äº›å¯ä¸º null çš„å­—æ®µï¼çœ‹çœ‹ä½ çš„ GraphiQL æ–‡æ¡£ä¸­çš„me queryï¼š æ ¹æ®æ–‡æ¡£ï¼Œmeæ˜¯ä¸€ä¸ªå¯ä¸º null çš„å­—æ®µã€‚æˆ‘ä»¬ä¸èƒ½éšä¾¿ä½¿ç”¨è¯¸å¦‚me. emailçš„è¡¨è¾¾å¼ï¼Œè€Œéœ€è¦ç¡®ä¿ user æ˜¯å­˜åœ¨çš„ã€‚ æœ€åï¼Œæˆ‘ä»¬åº”è¯¥åœ¨ render prop å‡½æ•°å†…å¤„ç† GraphQL é”™è¯¯ã€‚ä¸‹é¢å¾ˆå¿«ä¼šå‘ä½ å±•ç¤ºå¦‚ä½•æ¥åšã€‚ å½“ç”¨æˆ·æäº¤äº†éæ³•æ•°æ®ï¼Œåç«¯è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²çš„é”™è¯¯æ¶ˆæ¯åˆ—è¡¨ã€‚è®©æˆ‘ä»¬æ¥ä¿®æ”¹ä¸‹å¤„ç†é”™è¯¯çš„æ–¹å¼ï¼šå°†ä¼šè¿”å›ä¸€ä¸ª objectï¼ŒåŒ…å«åŒæ ·çš„é”™è¯¯æ¶ˆæ¯åˆ—è¡¨ï¼Œä½†ä¹ŸåŒ…å«ä¸€äº› JSON ç¼–ç çš„ç»†èŠ‚ã€‚ç»†èŠ‚å¯ç”¨äºç”Ÿæˆå®¢æˆ·ç«¯æ¶ˆæ¯ï¼Œæˆ–å‘ç”¨æˆ·æä¾›é¢å¤–çš„åé¦ˆï¼ˆæ¯”å¦‚ï¼Œé«˜äº®éæ³•çš„è¡¨å•å­—æ®µï¼‰ã€‚ é¦–å…ˆï¼Œæ¥å®šä¹‰ä¸€ä¸ªæ–°çš„ValidationErrorsTypeï¼š # app/graphql/types/validation_errors_type. rbmodule Types class ValidationErrorsType &lt; Types::BaseObject  field :details, String, null: false  field :full_messages, [String], null: false  def details   object. details. to_json  end endendç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹AddItemMutationæ¥ä½¿ç”¨æ‰€å®šä¹‰çš„æ–°ç±»å‹ï¼ˆè¯·ä¸ºUpdateItemMutationåšåŒæ ·çš„äº‹ï¼‰ï¼š # app/graphql/mutations/add_item_mutation. rbmodule Mutations class AddItemMutation &lt; Mutations::BaseMutation  argument :title, String, required: true  argument :description, String, required: false  argument :image_url, String, required: false  field :item, Types::ItemType, null: true  field :errors, Types::ValidationErrorsType, null: true # this line has changed  def resolve(title:, description: nil, image_url: nil)   check_authentication!   item = Item. new(    title: title,    description: description,    image_url: image_url,    user: context[:current_user]   )   if item. save    { item: item }   else    { errors: item. errors } # change here   end  end endendæœ€åï¼Œæ¥ä¸º item model æ·»åŠ å¯¹åº”çš„æ ¡éªŒï¼š # app/models/item. rbclass Item &lt; ApplicationRecord belongs_to :user validates :title, presence: true validates :description, length: { minimum: 10 }, allow_blank: trueendç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ¥å£ä¸­ä½¿ç”¨è¿™äº›æ ¡éªŒã€‚æˆ‘ä»¬åº”è¯¥ä¸ºAddItemFormå’ŒUpdateItemFormæ›´æ–°é€»è¾‘ã€‚æˆ‘ä»¬å°†ä¸ºä½ å±•ç¤ºå¯¹AddItemFormå¦‚ä½•åšï¼Œè‡³äºUpdateItemFormçš„ä»£ç ï¼Œå°±ç•™ç»™è¯»è€…ä½œä¸ºä¸€ä¸ªç»ƒä¹ äº†ï¼ˆå½“ç„¶ï¼Œä½ å¯ä»¥åœ¨è¿™å„¿æ‰¾åˆ°è§£å†³åŠæ³•ï¼‰ã€‚ è®©æˆ‘ä»¬å…ˆæ¥ä¸ºoperations. graphqlæ·»åŠ ä¸€ä¸ªerrorså­—æ®µï¼š #/app/javascript/components/AddItemForm/operations. graphql#import '. . /. . /fragments/Item. graphql'mutation AddItemMutation( $title: String! $description: String $imageUrl: String) { addItem(title: $title, description: $description, imageUrl: $imageUrl) {  item {   . . . ItemFragment   user {    id    email   }  }  errors { # new field   fullMessages  } }}ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨AddItemFormåŠå…¶ä¸Šä¸€çº§çš„ProcessItemFormä¸­åšä¸€ç‚¹å°çš„æ”¹åŠ¨ï¼Œä¸ºé”™è¯¯æ·»åŠ ä¸€ä¸ªæ–°å…ƒç´ ï¼š // app/javascript/components/ProcessItemForm/index. jsconst ProcessItemForm = ({ // . . .  errors,}) =&gt; { // . . .  return (  &lt;div className={cs. form}&gt;   {errors &amp;&amp; (    &lt;div className={cs. errors}&gt;     &lt;div className= error &gt;{errors. fullMessages. join('; ')}&lt;/div&gt;    &lt;/div&gt;   )}   {/* . . . */}  &lt;/div&gt; );};export default ProcessItemForm;è€Œåœ¨Mutationç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å°±ä»data property æŠ“å–é”™è¯¯ï¼š // app/javascript/components/AddItemForm/index. js// . . . &lt;Mutation mutation={AddItemMutation}&gt; {(addItem, { loading, data }) =&gt; ( // getting data from response  &lt;ProcessItemForm   buttonText= Add Item    loading={loading}   errors={data &amp;&amp; data. addItem. errors} /&gt;   // . . .   ) }&lt;/Mutation&gt;å¦‚æœä½ æƒ³è¦é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºå¾—æ›´æ¼‚äº®ä¸€ç‚¹ï¼Œå°±åœ¨/app/javascript/components/ProcessItemForm/styles. module. cssæ·»åŠ å¦‚ä¸‹æ ·å¼ï¼š . form { position: relative;}. errors { position: absolute; top: -20px; color: #ff5845;}ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥è°ˆè®ºä¸‹ GraphQL çš„ç¬¬äºŒç§é”™è¯¯ï¼šå¼‚å¸¸ã€‚æ•™ç¨‹çš„å‰ä¸€ç« é‡Œï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†èº«ä»½éªŒè¯ï¼Œä½†æ²¡æœ‰å®ç°ä¸€ç§å¤„ç†ç”¨æˆ·å¸¦ä¸å­˜åœ¨ email çš„æ–¹å¼ã€‚è¿™ä¸æ˜¯æ‰€æœŸæœ›çš„è¡Œä¸ºï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ç¡®ä¿æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼š # app/graphql/mutations/sign_in_mutation. rbmodule Mutations class SignInMutation &lt; Mutations::BaseMutation  argument :email, String, required: true  field :token, String, null: true  field :user, Types::UserType, null: true  def resolve(email:)   user = User. find_by!(email: email)   token = Base64. encode64(user. email)   {    token: token,    user: user   }  rescue ActiveRecord::RecordNotFound   raise GraphQL::ExecutionError,  user not found   end endendæˆ‘ä»¬éœ€è¦æ›´æ”¹å‰ç«¯ä»£ç æ¥ä¼˜é›…å¤„ç†è¿™ç§æƒ…å½¢ã€‚åœ¨UserInfoç»„ä»¶ä¸­æ¥åšã€‚ä» render prop å‡½æ•°æ‰€æä¾›çš„å¯¹è±¡ä¸­ä¸ºMutationç»„ä»¶æŠ“å–é”™è¯¯å‚æ•°ï¼š // app/javascript/components/UserInfo/index. jsconst UserInfo = () =&gt; { // . . .  {(signIn, { loading: authenticating, error /* new key */ }) =&gt; { }} // . . . }å¹¶åœ¨&lt;/form&gt; å‰æ·»åŠ ä¸€ä¸ªå…ƒç´ æ¥æ˜¾ç¤ºé”™è¯¯ï¼š // app/javascript/components/UserInfo/index. jsconst UserInfo = () =&gt; { &lt;form&gt;  // . . .   {error &amp;&amp; &lt;span&gt;{error. message}&lt;/span&gt;} &lt;/form&gt; // . . . }Handling input data: è®©æˆ‘ä»¬å†å›åˆ°AddItemMutationå’ŒUpdateItemMutationã€‚çœ‹çœ‹ argument åˆ—è¡¨ï¼Œé—®é—®ä½ è‡ªå·±ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬æœ‰ä¸¤ä¸ªå‡ ä¹ç›¸åŒçš„åˆ—è¡¨å‘¢ï¼Ÿæ¯æ¬¡æˆ‘ä»¬å‘Item model æ·»åŠ æ–°å­—æ®µï¼Œéƒ½éœ€è¦æ·»åŠ æ–° argument ä¸¤æ¬¡ï¼Œè¿™å¯ä¸å¥½ã€‚ è§£å†³åŠæ³•ç›¸å½“ç®€å•ï¼šä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„ argumentï¼ŒåŒ…å«æ‰€æœ‰éœ€è¦çš„å­—æ®µã€‚graphql-rubyæœ‰ä¸€ä¸ªç§°ä¸ºBaseInputObjectçš„ç‰¹æ®Šäº‹ç‰©ï¼Œç”¨æ¥å®šä¹‰ç±»ä¼¼å¦‚æ­¤çš„ argument ç±»å‹ã€‚æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªåä¸ºitem_attributes. rbçš„æ–‡ä»¶ï¼š # app/graphql/types/item_attributes. rbmodule Types class ItemAttributes &lt; Types::BaseInputObject  description  Attributes for creating or updating an item   argument :title, String, required: true  argument :description, String, required: false  argument :image_url, String, required: false endendè¿™ä¸ªçœ‹èµ·æ¥å¾ˆåƒä¹‹å‰æ‰€åˆ›å»ºçš„ç±»å‹ï¼Œä½†æœ‰ä¸€ä¸ªæ ¹æœ¬çš„åŒºåˆ«ï¼šargumentæ›¿ä»£äº† fieldã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿå› ä¸º GraphQL éµå¾ªäº† CQRS åŸåˆ™ï¼Œä»¥ä¸¤ä¸ªä¸åŒçš„ model æ¥å¤„ç†æ•°æ®ï¼šè¯»çš„ modelï¼ˆtypeï¼‰å’Œå†™çš„ modelï¼ˆinputï¼‰ã€‚ å½“å¿ƒï¼šä½ ä¸èƒ½ä½¿ç”¨å¤æ‚ç±»å‹ä½œä¸º argument ç±»å‹â€”â€”å®ƒåªèƒ½æ˜¯æ ‡é‡ç±»å‹æˆ–å…¶ä»– input ç±»å‹ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ mutation æ›´æ”¹ä¸ºä½¿ç”¨è¿™ä¸ª argument äº†ã€‚æ¥ä»AddItemMutationå¼€å§‹ï¼š # app/graphql/mutations/add_item_mutation. rbmodule Mutations class AddItemMutation &lt; Mutations::BaseMutation  argument :attributes, Types::ItemAttributes, required: true # new argument  field :item, Types::ItemType, null: true  field :errors, Types::ValidationErrorsType, null: true # &lt;= change here  # signature change  def resolve(attributes:)   check_authentication!   item = Item. new(attributes. to_h. merge(user: context[:current_user])) # change here   if item. save    { item: item }   else    { errors: item. errors }   end  end endendå¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªåä¸ºattributesçš„å•ç‹¬ argument æ›¿æ¢äº†æ•´ä¸ª argument åˆ—è¡¨ï¼Œä¿®æ”¹#resolveä»¥æ¥æ”¶å®ƒï¼Œå¹¶ç¨å¾®å˜æ›´äº†æˆ‘ä»¬åˆ›å»º item çš„æ–¹å¼ã€‚è¯·å¯¹UpdateItemMutationè¿›è¡ŒåŒæ ·çš„è°ƒæ•´ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦ä¿®æ”¹å‰ç«¯ä»£ç æ¥é€‚é…è¿™äº›æ”¹åŠ¨äº†ã€‚ æˆ‘ä»¬å”¯ä¸€è¦åšçš„å°±æ˜¯æ·»åŠ ä¸€ä¸ªå•è¯å’Œä¸¤ä¸ªå¤§æ‹¬å·åˆ° mutation ä¸Šï¼ˆå¯¹äºUpdateItemä¹Ÿåº”è¯¥åšåŒæ ·çš„ä¿®æ”¹ï¼‰ï¼š #/app/javascript/components/AddItemForm/operations. graphql#import '. . /. . /fragments/Item. graphql'mutation AddItemMutation( $title: String! $description: String $imageUrl: String) { addItem(  attributes: { # just changing the shape   title: $title   description: $description   imageUrl: $imageUrl  } ) {  item {   . . . ItemFragment   user {    id    email   }  }  errors {   fullMessages  } }}Implementing real-time updates: æœåŠ¡ç«¯å‘èµ·çš„æ›´æ–°åœ¨ç°ä»£åº”ç”¨ä¸­å¾ˆå¸¸è§ï¼šæˆ‘ä»¬çš„åœºæ™¯é‡Œï¼Œå¯¹äºç”¨æˆ·ï¼Œåœ¨æœ‰äººæ·»åŠ æ–° item æˆ–ä¿®æ”¹ç°æœ‰ item æ—¶ï¼Œè®©å…¶åˆ—è¡¨å¾—åˆ°æ›´æ–°æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚è¿™æ­£æ˜¯ GraphQL subscriptions çš„ç›®çš„æ‰€åœ¨ï¼ Subscription æ˜¯ä¸€ç§æŠŠæœåŠ¡ç«¯æ‰€å‘èµ·çš„æ›´æ–°å‘å¸ƒåˆ°å®¢æˆ·ç«¯çš„æœºåˆ¶ã€‚æ¯ä¸ªæ›´æ–°éƒ½è¿”å›ç‰¹åˆ«ç±»å‹çš„æ•°æ®ï¼šä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ª subscriptionï¼Œå½“æœ‰æ–° item è¢«æ·»åŠ æ—¶å°±æé†’å®¢æˆ·ç«¯ã€‚å½“æˆ‘ä»¬å‘é€ Subscription operation åˆ°æœåŠ¡ç«¯æ—¶ï¼Œå®ƒä¼šç»™æˆ‘ä»¬è¿”å›ä¸€ä¸ª Event Streamã€‚ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•æ–¹å¼ï¼ŒåŒ…æ‹¬ postï¼Œæ¥ä¼ è¾“ eventsï¼Œä½† Websockets ç‰¹åˆ«é€‚åˆè¿™ç§æƒ…å½¢ã€‚å¯¹æˆ‘ä»¬çš„ Rails åº”ç”¨è€Œè¨€ï¼Œæ„å‘³ç€å¯ä»¥ä½¿ç”¨ ActionCable æ¥ä¼ è¾“ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„ GraphQL subscription æ‰€å‘ˆç°çš„æ ·å­ï¼š Laying the cable: é¦–å…ˆï¼Œæˆ‘ä»¬è¦åˆ›å»ºapp/graphql/types/subscription_type. rbå¹¶æ³¨å†Œ subscriptionï¼Œä½¿å…¶åœ¨æ–° item è¢«æ·»åŠ æ—¶è§¦å‘ã€‚ # app/graphql/types/subscription_type. rbmodule Types class SubscriptionType &lt; GraphQL::Schema::Object  field :item_added, Types::ItemType, null: false, description:  An item was added   def item_added; end endendå…¶æ¬¡ï¼Œæˆ‘ä»¬è¦é…ç½® schema ä»¥ä½¿ç”¨ActionCableSubscriptionsï¼Œå¹¶èƒ½ä»SubscriptionTypeä¸­æ‰¾åˆ°å¯ç”¨çš„ subscriptionsï¼š # app/graphql/martian_library_schema. rbclass MartianLibrarySchema &lt; GraphQL::Schema use GraphQL::Subscriptions::ActionCableSubscriptions mutation(Types::MutationType) query(Types::QueryType) subscription(Types::SubscriptionType)endç¬¬ä¸‰ï¼Œæˆ‘ä»¬è¦ç”Ÿæˆä¸€ä¸ª ActionCable channel æ¥å¤„ç†å·²è®¢é˜…çš„å®¢æˆ·ç«¯ï¼š $ rails generate channel GraphqlChannelè®©æˆ‘ä»¬ä»æ–‡æ¡£ä¸­å€Ÿç”¨ channel çš„å®ç°ä»£ç ï¼š # app/channels/graphql_channel. rbclass GraphqlChannel &lt; ApplicationCable::Channel def subscribed  @subscription_ids = [] end def execute(data)  result = execute_query(data)  payload = {   result: result. subscription? ? { data: nil } : result. to_h,   more: result. subscription?  }  @subscription_ids &lt;&lt; context[:subscription_id] if result. context[:subscription_id]  transmit(payload) end def unsubscribed  @subscription_ids. each do |sid|   MartianLibrarySchema. subscriptions. delete_subscription(sid)  end end private def execute_query(data)  MartianLibrarySchema. execute(   query: data[ query ],   context: context,   variables: data[ variables ],   operation_name: data[ operationName ]  ) end def context  {   current_user_id: current_user&amp;. id,   current_user: current_user,   channel: self  } endendç¡®è®¤æŠŠ:channelä¼ ç»™äº† contextã€‚è¿˜æœ‰ï¼Œæˆ‘ä»¬ä¼ é€’äº†current_userä½¿å…¶åœ¨ resolvers å†…éƒ¨å¯ç”¨ï¼Œè·Ÿ:current_user_idä¸€æ ·ï¼Œå¯è¢«ç”¨æ¥ä¼ é€’èŒƒå›´å†…çš„ subscriptionsã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ åœ¨ channel ä¸­è·å–å½“å‰ç”¨æˆ·çš„ä¸€ç§æ–¹å¼ã€‚ä»¥å¦‚ä¸‹æ–¹å¼ä¿®æ”¹ApplicationCable::Connectionï¼š # app/channels/application_cable/connection. rbmodule ApplicationCable class Connection &lt; ActionCable::Connection::Base  identified_by :current_user  def connect   self. current_user = current_user  end  private  def current_user   token = request. params[:token]. to_s   email = Base64. decode64(token)   User. find_by(email: email)  end endendè§¦å‘ event ç›¸å½“ç®€å•ï¼šæˆ‘ä»¬åº”ä¼ é€’é©¼å³°å¼çš„å­—æ®µåä½œä¸ºç¬¬ä¸€ä¸ª argumentï¼Œoptions æ˜¯ç¬¬äºŒä¸ª argumentï¼Œè€Œè®¢é˜…çš„æ›´æ–°çš„ root object ä½œä¸ºç¬¬ä¸‰ä¸ª argumentã€‚æŠŠå…¶åŠ åˆ°AddItemMutationï¼š # app/graphql/mutations/add_item_mutation. rbmodule Mutations class AddItemMutation &lt; Mutations::BaseMutation  argument :attributes, Types::ItemAttributes, required: true  field :item, Types::ItemType, null: true  field :errors, [String], null: false  def resolve(attributes:)   check_authentication!   item = Item. new(attributes. merge(user: context[:current_user]))   if item. save    MartianLibrarySchema. subscriptions. trigger( itemAdded , {}, item)    { item: item }   else    { errors: item. errors. full_messages }   end  end endendArgument hash å¯ä»¥åŒ…å« argumentsï¼Œåè€…è¢«å®šä¹‰åœ¨ subscription ä¸­ï¼ˆå…¶å°†è¢«ä½œä¸º resolver arguments ä¼ é€’ï¼‰ã€‚æœ‰ä¸€ä¸ªç§°ä¸º:scopeçš„ç¬¬å››ä¸ªå¯é€‰ argumentï¼Œç”¨æ¥é™åˆ¶ä¼šæ¥æ”¶åˆ°è¿™äº›æ›´æ–°çš„ç”¨æˆ·çš„èŒƒå›´ã€‚ è®©æˆ‘ä»¬æ¥æ·»åŠ å¦ä¸€ä¸ª subscriptionï¼Œè¿™æ¬¡æ˜¯æ›´æ–° itemsï¼š # app/graphql/types/subscription_type. rbmodule Types class SubscriptionType &lt; GraphQL::Schema::Object  field :item_added, Types::ItemType, null: false, description:  An item was added   field :item_updated, Types::ItemType, null: false, description:  Existing item was updated   def item_added; end  def item_updated; end endendä¸‹é¢æ˜¯åœ¨UpdateItemMutationä¸­æˆ‘ä»¬å°†å¦‚ä½•è§¦å‘è¿™ç§ç±»å‹çš„æ›´æ–°ï¼š # app/graphql/mutations/update_item_mutation. rbmodule Mutations class UpdateItemMutation &lt; Mutations::BaseMutation  argument :id, ID, required: true  argument :attributes, Types::ItemAttributes, required: true  field :item, Types::ItemType, null: true  field :errors, [String], null: false  def resolve(id:, attributes:)   check_authentication!   item = Item. find(id)   if item. update(attributes. to_h)    MartianLibrarySchema. subscriptions. trigger( itemUpdated , {}, item)    { item: item }   else    { errors: item. errors. full_messages }   end  end endendæˆ‘ä»¬åº”è¯¥æåˆ°ä¸€ç‚¹ï¼Œè¿™ç§ subscriptions æ–¹å¼æ˜¯åœ¨ graphql-ruby ä¸­ä¸º ActionCable å®ç°çš„ï¼Œä¼šæœ‰æ€§èƒ½ä¸Šçš„ç“¶é¢ˆï¼šå¤§é‡ Redis å¾€è¿”ï¼Œå¹¶å¯¹æ¯ä¸ªè¿æ¥çš„å®¢æˆ·ç«¯è¿›è¡ŒæŸ¥è¯¢é‡æ–°è¯„ä¼°ï¼ˆå¯åœ¨è¿™é‡ŒæŸ¥çœ‹æ›´å¤šæœ‰å…³çš„æ·±åº¦è§£æï¼‰ã€‚ å¯¹ AnyCable ç”¨æˆ·è¿™å·²ç»ä¸å†æ˜¯é—®é¢˜äº†â€”â€”ä»æˆ‘ä»¬ä¸º eBay é¡¹ç›®çš„å·¥ä½œæˆæœä¸­æŠ½å–å‡ºæ¥çš„ graphql-anycable gem å¸¦æ¥äº†é«˜æ•ˆçš„ GraphQL subscriptionsã€‚ Plugging in: è¦è®©æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå‘é€æ•°æ®ç»™ ActionCableï¼Œéœ€è¦ä¸€äº›é…ç½®ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è¦å®‰è£…ä¸€äº›æ–° modules æ¥å¤„ç†é€šè¿‡ ActionCable çš„ Subscriptionsï¼š $ yarn add actioncable graphql-ruby-clientç„¶åï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€äº›æ–°â€œé­”æ³•â€åˆ°/app/javascript/utils/apollo. jsï¼š // /app/javascript/utils/apollo. js. . . import ActionCable from 'actioncable';import ActionCableLink from 'graphql-ruby-client/subscriptions/ActionCableLink';. . . const getCableUrl = () =&gt; { const protocol = window. location. protocol === 'https:' ? 'wss:' : 'ws:'; const host = window. location. hostname; const port = process. env. CABLE_PORT || '3000'; const authToken = localStorage. getItem('mlToken'); return `${protocol}//${host}:${port}/cable?token=${authToken}`;};const createActionCableLink = () =&gt; { const cable = ActionCable. createConsumer(getCableUrl()); return new ActionCableLink({ cable });};const hasSubscriptionOperation = ({ query: { definitions } }) =&gt; definitions. some(  ({ kind, operation }) =&gt;   kind === 'OperationDefinition' &amp;&amp; operation === 'subscription' );//. . // we need to update our link link: ApolloLink. from([  createErrorLink(),  createLinkWithToken(),  ApolloLink. split(   hasSubscriptionOperation,   createActionCableLink(),   createHttpLink(),  ), ]),//. . å°½ç®¡è¿™ä»£ç äº‹å®ä¸Šçœ‹èµ·æ¥æœ‰ç‚¹å¯æ€•ï¼Œä½†æ˜¯æ€è·¯å¾ˆç®€å•ï¼š  æˆ‘ä»¬åœ¨createActionCableLinkå†…ä¸º subscriptions åˆ›å»ºä¸€ä¸ªæ–°çš„ Apollo linkï¼› åœ¨ ApolloLink. split å†…å†³å®šå‘å“ªé‡Œå‘é€æ•°æ®ï¼› å¦‚æœhasSubscriptionOperationè¿”å› trueï¼Œoperation å°±ä¼šè¢«å‘é€åˆ°actionCableLinkã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦ä½¿ç”¨ç”Ÿæˆå™¨åˆ›å»ºä¸€ä¸ªæ–°ç»„ä»¶ï¼š $ npx @hellsquirrel/create-gql-component create /app/javascript/components/Subscriptionè®©æˆ‘ä»¬æ¥æ·»åŠ  subscription åˆ°operations. graphqlï¼š #/app/javascript/components/Subscription/operations. graphql#import '. . /. . /fragments/Item. graphql'subscription ItemSubscription { itemAdded {  . . . ItemFragment  user {   id   email  } } itemUpdated {  . . . ItemFragment  user {   id   email  } }}æ¯«æ— æ–°æ„ï¼Œå¯¹å§ï¼Ÿå†æ¥åˆ›å»ºSubscriptionç»„ä»¶ï¼š // /app/javascript/components/Subscription/index. jsimport React, { useEffect } from 'react';import { ItemSubscription } from '. /operations. graphql';const Subscription = ({ subscribeToMore }) =&gt; { useEffect(() =&gt; {  return subscribeToMore({   document: ItemSubscription,   updateQuery: (prev, { subscriptionData }) =&gt; {    if (!subscriptionData. data) return prev;    const { itemAdded, itemUpdated } = subscriptionData. data;    if (itemAdded) {     const alreadyInList = prev. items. find(e =&gt; e. id === itemAdded. id);     if (alreadyInList) {      return prev;     }     return { . . . prev, items: prev. items. concat([itemAdded]) };    }    if (itemUpdated) {     return {      . . . prev,      items: prev. items. map(el =&gt;       el. id === itemUpdated. id ? { . . . el, . . . itemUpdated } : el      ),     };    }    return prev;   },  }); }, []); return null;};export default Subscription;åˆä¸€ä¸ª hookï¼è¿™é‡Œæ˜¯useEffectã€‚å®ƒåœ¨åˆå§‹æ¸²æŸ“æ—¶è¢«è°ƒç”¨ï¼Œå¹¶åœ¨ç”¨æˆ·æ›´æ”¹æ—¶é‡æ–°è¿è¡Œã€‚ æˆ‘ä»¬è¦æ±‚ hook æ¥è®¢é˜… addå’Œupdate çš„ event streamsã€‚å½“ç›¸åº”äº‹ä»¶è¢«è§¦å‘æ—¶æˆ‘ä»¬å°±æ·»åŠ æˆ–æ›´æ–° itemsã€‚ æœ€åä¸€æ­¥æ˜¯æŠŠSubscriptionç»„ä»¶æ·»åŠ åˆ°Libraryï¼Œåœ¨Queryç»„ä»¶å†…åˆ°æœ€åä¸€ä¸ªdivçš„å°¾éƒ¨ï¼š import Subscription from '. . /Subscription';//. . . const Library = () =&gt; { const [item, setItem] = useState(null); return (  &lt;Query query={LibraryQuery}&gt;   {({ data, loading, subscribeToMore /* we need subscribe to more arg */}) =&gt; (    &lt;div&gt;     // . . .      &lt;Subscription subscribeToMore={subscribeToMore} /&gt;    &lt;/div&gt;   )}  &lt;/Query&gt; );};//. . . react-apollo åº“çš„Queryç»„ä»¶æä¾›äº†ç‰¹åˆ«çš„å‡½æ•°subscribeToMoreï¼Œå…¶è¢«Subscriptionç»„ä»¶æ‰€ä½¿ç”¨ã€‚æˆ‘ä»¬æŠŠè¿™ä¸ªå‡½æ•°ä¼ é€’ç»™äº†Subscriptionç»„ä»¶ã€‚ ç°åœ¨æˆ‘ä»¬å¯ä»¥æ¥æµ‹è¯•è‡ªå·±çš„ subscriptions äº†ï¼è¯•ç€åœ¨ä¸€ä¸ªæµè§ˆå™¨çš„ tab ä¸­æ·»åŠ æ–° item æˆ–è€…ä¿®æ”¹å·²æœ‰çš„â€”â€”ä½ å°†ä¼šçœ‹åˆ°æ‰€æœ‰æ‰“å¼€çš„ tabs ä¸­éƒ½ä¼šå‡ºç°å˜åŒ–ã€‚ ç»“è¯­: ç¥è´ºä½ ï¼ è¿™å°±æ˜¯æˆ‘ä»¬ç©¿è¶Š Ruby-GraphQL-Apollo ä¸–ç•Œçš„ä»¤äººæ¿€åŠ¨çš„å†’é™©ä¹‹æ—…çš„ç»ˆç‚¹äº†ã€‚ä½¿ç”¨ä¸€ä¸ªå°çš„èŒƒä¾‹åº”ç”¨ï¼Œæˆ‘ä»¬å®è·µäº†æ‰€æœ‰çš„åŸºç¡€æŠ€æœ¯ï¼Œå¼ºè°ƒäº†å¸¸è§çš„é—®é¢˜ï¼Œè¿˜ä»‹ç»äº†ä¸€äº›é«˜çº§ä¸»é¢˜ã€‚ è¿™å¯èƒ½æ˜¯ä¸€ä¸ªå…·æœ‰æŒ‘æˆ˜æ€§çš„ç»ƒä¹ ï¼Œä½†æˆ‘ä»¬ç¡®ä¿¡ä½ å°†ä»ä¸­å—ç›Šã€‚æ— è®ºå¦‚ä½•ï¼Œä½ ç°åœ¨éƒ½æœ‰è¶³å¤Ÿçš„ç†è®ºå’Œå®è·µæ¥ä¸ºè‡ªå·±åˆ›å»ºåˆ©ç”¨ä¸Š GraphQL å¼ºå¤§å¨åŠ›çš„ Rails åº”ç”¨äº†ï¼ "
    }, {
    "id": 26,
    "url": "/2020/11/graphql-on-rails-series-2/",
    "title": "GraphQL on Railsâ€”â€”æ›´æ–°",
    "body": "2020/11/24 - æœ¬æ–‡å·²è·å¾—åŸä½œè€…ï¼ˆDmitry Tsepelevï¼‰ã€ï¼ˆPolina Gurtovayaï¼‰å’Œ Evil Martians æˆæƒè®¸å¯è¿›è¡Œç¿»è¯‘ã€‚åŸæ–‡æ˜¯ Rails + React ä½¿ç”¨ GraphQLçš„ç³»åˆ—æ•™ç¨‹ç¬¬äºŒç¯‡ï¼Œä»‹ç»äº†ä»¥ Rails ä½œä¸ºåç«¯ï¼ŒReact + Apollo ä½œä¸ºå‰ç«¯ï¼Œå¦‚ä½•è¿›è¡Œæ•°æ®æ›´æ–°çš„æ•™å­¦ã€‚  åŸæ–‡é“¾æ¥ï¼šGraphQL on Rails: Updating the data ä½œè€…ï¼šDmitry Tsepelevï¼ŒPolina Gurtovaya ç«™ç‚¹ï¼šEvil Martians â€”â€”ä½äºçº½çº¦å’Œä¿„ç½—æ–¯çš„ Ruby on Rails å¼€å‘äººå‘˜åšå®¢ã€‚ å®ƒå‘å¸ƒäº†è®¸å¤šä¼˜ç§€çš„æ–‡ç« ï¼Œå¹¶ä¸”æ˜¯ä¸å°‘ gem çš„èµåŠ©å•†ã€‚ã€æ­£æ–‡å¦‚ä¸‹ã€‘ å¼•è¨€: è¿™æ˜¯ä¸€ä¸ªåœ¨åç«¯ä½¿ç”¨ Railsã€å‰ç«¯ä½¿ç”¨ React/Apollo æ¥å¼€å‘ GraphQL åº”ç”¨ç¨‹åºçš„æ—…è¡Œè€…æŒ‡å¯¼ã€‚æœ¬æ•™ç¨‹çš„ç¬¬äºŒéƒ¨åˆ†å°†æ¶µç›– mutationï¼ˆæ›´æ–°æ•°æ®çš„æ–¹å¼ï¼‰å’Œæœ‰å…³å®¢æˆ·ç«¯ç¼“å­˜çš„é«˜çº§ä¸»é¢˜ åœ¨è¯¥æŒ‡å—çš„ç¬¬ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å­¦åˆ°äº† GraphQL æ˜¯ä»€ä¹ˆï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ª Martian Library åº”ç”¨ç¨‹åºçš„å¾ˆåˆçº§çš„ç‰ˆæœ¬ã€‚å¦‚æœä½ è¿˜æ²¡é˜…è¯»çš„è¯ï¼Œç°åœ¨æ­£å¥½å»çœ‹ä¸€ä¸‹ã€‚ æˆ‘ä»¬å·²ç»é…ç½®äº†graphql-ruby gem å’Œ Apollo æ¡†æ¶ä»¥ç¡®ä¿å®ƒä»¬èƒ½ä¸€èµ·å¾ˆå¥½åœ°å·¥ä½œï¼Œä¹Ÿé€šè¿‡æ·»åŠ ä¸€ä¸ªå¾ˆåˆçº§çš„æŸ¥è¯¢èŠ‚ç‚¹åˆ° schema ä¸Šæ¥å®æˆ˜æ£€éªŒäº†å…¶é…ç½®ã€‚ç°åœ¨è¯¥ç»§ç»­å‰è¡Œäº†ï¼ Introducing mutations: æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œåœ¨ GraphQL ä¸­æœ‰ä¸‰ç§åŸºç¡€ operationâ€”â€” queryï¼Œmutationï¼ŒåŠ subscriptionsã€‚æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç» mutationâ€”â€”ä¸€ç§ä» GraphQL è¿›è¡Œæ•°æ®æ›´æ”¹çš„æœºåˆ¶ã€‚ ä»å®¢æˆ·ç«¯çš„è§’åº¦çœ‹ï¼Œmutation çœ‹èµ·æ¥è·Ÿ query å¾ˆåƒï¼Œåªæœ‰ä¸€ç‚¹ç»†å¾®çš„å·®åˆ«â€”â€”å®ƒä»¬ä»â€œmutationâ€èŠ‚ç‚¹å¼€å§‹ï¼š mutation SignInUser($email: String) { signIn(email: $email) {  id }}ç„¶è€Œï¼Œå…¶ä¸»è¦çš„åŒºåˆ«ï¼Œæ˜¯è¯­ä¹‰ä¸Šçš„ï¼šé¦–å…ˆï¼Œmutation è´Ÿè´£ä¿®æ”¹ï¼ˆæˆ–è½¬å˜ï¼‰æ•°æ®ã€‚åœ¨æ‰§è¡Œå¼•æ“å¤„ç†å®ƒä»¬çš„æ–¹å¼ä¸Šï¼Œä¹Ÿæœ‰ä¸€ä¸ªå·®åˆ«ï¼šæ ¹æ®è§„èŒƒï¼ŒGraphQL æœåŠ¡ç«¯å¿…é¡»ç¡®ä¿ mutation æ˜¯è¢«è¿ç»­æ‰§è¡Œçš„ï¼Œè€Œ query åˆ™èƒ½è¢«å¹¶è¡Œæ‰§è¡Œã€‚ åœ¨ä¸Šé¢çš„ mutation ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ç”¨æˆ·çš„ email å‘æœåŠ¡ç«¯è¯·æ±‚èº«ä»½éªŒè¯ï¼Œä»¥å¦‚ä¸‹æ–¹å¼ï¼š  æˆ‘ä»¬ä»¥ä¸€ä¸ª operation åSignInUserå’Œä¸€ä¸ªå˜é‡$emailï¼ˆæ‰€æœ‰ GraphQL ä¸­çš„å˜é‡éƒ½ä»¥$å¼€å¤´ï¼‰æ¥å®šä¹‰ä¸€ä¸ª mutation å¼€å§‹ã€‚ æˆ‘ä»¬æœ‰ä¸€ä¸ªæƒ³è¦æ‰§è¡Œä¿®æ”¹çš„åˆ—è¡¨åœ¨å¤§æ‹¬å·å†…ï¼ˆè¯¥åˆ—è¡¨ç§°ä½œ selection setï¼‰â€”â€”è¿™é‡Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªå«signInçš„å­—æ®µã€‚ è·Ÿ query ä¸€æ ·ï¼Œåœ¨æ ¹å­—æ®µå†…æˆ‘ä»¬å¯ä»¥æœ‰åµŒå¥—çš„ selection setsï¼ˆå³ï¼Œä» mutation è¿”å›å€¼é€‰æ‹©ç‰¹å®šå­—æ®µï¼‰ã€‚ è¿™äº›å°±æ˜¯ç†è®ºæ–¹é¢æˆ‘ä»¬æ‰€éœ€è¦äº†è§£çš„ä¸œè¥¿äº†ã€‚æ¥ä¸‹æ¥çš„å†…å®¹å°†ä¸“æ³¨äºå®è·µï¼šæˆ‘ä»¬å°†æ·»åŠ  mutation æ¥å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä»¥åŠè®©ç”¨æˆ·æ·»åŠ æ–° items åˆ° Martian libraryã€‚ Housekeeping: å…ˆæ¥å¿«é€Ÿçœ‹ä¸‹åœ¨å‰ä¸€éƒ¨åˆ†æ•™ç¨‹å®Œæˆåæˆ‘ä»¬çš„æˆæœã€‚ä½ å¯åœ¨è¿™é‡Œæ‰¾åˆ°æºç â€”â€”åˆ«å¿˜äº†åœ¨é¦–æ¬¡è¿è¡Œå‰æ‰§è¡Œbundle install &amp;&amp; yarn installã€‚Master åˆ†æ”¯åˆ™ä»£è¡¨äº†è¯¥é¡¹ç›®çš„å½“å‰çŠ¶æ€ã€‚ æˆ‘ä»¬ä½¿ç”¨graphql-tagåº“æ¥æ‰§è¡ŒæŸ¥è¯¢ï¼Œå¹¶ä½¿å®ƒä»¬åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­é è¿‘ç»„ä»¶ï¼š // app/javascript/components/Library/index. jsimport React from  react ;import { Query } from  react-apollo ;import gql from  graphql-tag ;const LibraryQuery = gql` {  items {   id   title   user {    email   }  } }`;export default () =&gt; ( &lt;Query query={LibraryQuery}&gt;  {({ data, loading }) =&gt; (   &lt;div&gt;    {loading     ?  loading. . .       : data. items. map(({ title, id, user }) =&gt; (       &lt;div key={id}&gt;        &lt;b&gt;{title}&lt;/b&gt; {user ? `added by ${user. email}` : null}       &lt;/div&gt;      ))}   &lt;/div&gt;  )} &lt;/Query&gt;);æˆ–è€…ï¼Œä½ å¯ä»¥æŠŠè¿™äº› operation æ”¾åœ¨ä¸åŒçš„æ–‡ä»¶ä¸­ï¼Œä»¥. graphqlï¼ˆæˆ–. gqlï¼‰æ‰©å±•åï¼Œä¿å­˜åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œä½œä¸ºç»„ä»¶å®šä¹‰ã€‚è¿™ç§æ–¹æ¡ˆåœ¨å¼€å‘ä¸­å‹â€”â€”åˆ°å¤§å‹â€”â€”çš„åº”ç”¨ç¨‹åºæ—¶å°¤å…¶æœ‰ç”¨ï¼Œæä¾›äº†æ¸…æ™°çš„é¡¹ç›®ç»“æ„ã€‚æˆ‘ä»¬åœ¨æœ¬æ•™ç¨‹ä¸­å¯¹äºæ‰€æœ‰çš„æ–° operation éƒ½å°†ä½¿ç”¨å®ƒã€‚ è¦è®© Webpack â€œç†è§£â€. gqlæ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨/config/webpack/environment. jsä¸­é…ç½®ä¸€ä¸ªç‰¹åˆ«çš„ loaderï¼š // config/webpack/environment. jsconst { environment } = require( @rails/webpacker );environment. loaders. append( graphql , { test: /\. (graphql|gql)$/, exclude: /node_modules/, loader:  graphql-tag/loader });module. exports = environment;åˆ«å¿˜äº†é‡å¯æ¥è®©é…ç½®ç”Ÿæ•ˆã€‚ ç°åœ¨å·²ç»å‡†å¤‡å¥½å®ç°èº«ä»½éªŒè¯é€»è¾‘äº†ã€‚ Implementing authentication: GraphQL è§„èŒƒæ²¡æœ‰å‘Šè¯‰ä½ å¦‚ä½•å®ç°èº«ä»½éªŒè¯é€»è¾‘ï¼Œç”šè‡³ä¸éœ€è¦ä½ æœ‰è¿™ä¸ªâ€”â€”è¿™å–å†³äºå¼€å‘è€…ã€‚ç„¶è€Œï¼Œä½ å¾ˆéš¾æƒ³è±¡ä¸€ä¸ªçœŸå®çš„åº”ç”¨ç¨‹åºæ²¡æœ‰å®ƒï¼Œæˆ‘ä»¬çš„ Martian Library ä¹Ÿä¸ä¾‹å¤–â€”â€”æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹å¼æ¥è¿½è¸ªæ‰€æœ‰è¢«æ·»åŠ åˆ°å›¾ä¹¦é¦†çš„ items çš„æ‹¥æœ‰è€…ã€‚ æˆ‘ä»¬è®©äº‹æƒ…ç®€å•äº›ï¼Œä»¥ç”¨æˆ·çš„ email è¿›è¡ŒéªŒè¯ï¼Œæ¯‹éœ€å¯†ç ï¼ŒçŸ­ä¿¡ï¼ŒåŠå…¶ä»–ç¡®è®¤æ–¹å¼ã€‚ ä¸‹é¢æ˜¯æˆ‘ä»¬çš„èº«ä»½éªŒè¯æœºåˆ¶çš„æ¦‚è§ˆï¼š  ç”¨æˆ·æä¾› email æ¥å‘èµ·èº«ä»½éªŒè¯è¯·æ±‚ æœåŠ¡ç«¯éªŒè¯è¯¥ç”¨æˆ·å­˜åœ¨å¹¶ä»¥ä¸€ä¸ªèº«ä»½éªŒè¯ tokan è¿”å›å“åº” ç”¨æˆ·æ¯æ¬¡åç»­è¯·æ±‚éƒ½å¸¦ä¸Šè¯¥ tokenï¼ˆæ¯”å¦‚ï¼Œé€šè¿‡ HTTP Headerï¼‰ä»¥è¯æ˜å…¶èº«ä»½æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ª GraphQL mutationï¼ŒsignInï¼Œæ¥æ‰§è¡Œèº«ä»½éªŒè¯ï¼Œå¹¶ä»¥ä¸€ä¸ª base64 åŠ å¯†çš„ email ä½œä¸ºèº«ä»½éªŒè¯ tokenï¼Œä»¥åŠä¸€ä¸ªâ€œAuthorizationâ€ header æ¥ä¼ é€’è¯¥ tokenã€‚æ³¨æ„ï¼Œä½¿ç”¨ GraphQL API æ¥éªŒè¯ç”¨æˆ·å¹¶éæ˜¯å¿…é¡»çš„ï¼šå…¶å¯ä»¥åœ¨â€œå¤–éƒ¨â€å®Œæˆï¼Œæ¯”å¦‚ï¼Œé€šè¿‡ RESTã€‚è¿™åœ¨å½“ä½ ä»…å…è®¸å·²éªŒè¯ç”¨æˆ·è®¿é—® GraphQL API æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚ æˆ‘ä»¬ä¹ŸæœŸæœ›åœ¨ UI ä¸­æŒ‡ç¤ºç”¨æˆ·æ˜¯å¦å·²ç»é€šè¿‡èº«ä»½éªŒè¯ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ª panel ï¼Œå¦‚æœç”¨æˆ·å·²ç™»å½•åˆ™æ˜¾ç¤ºå…¶åç§°ï¼Œå¦åˆ™æ˜¾ç¤ºâ€œSign Inâ€æŒ‰é’®ï¼š Crafting authentication schema: è®©æˆ‘ä»¬å…ˆæ¥æ·»åŠ ä¸€ä¸ª API ä»¥è·å–å½“å‰ç”¨æˆ·çš„ä¿¡æ¯ã€‚ æˆ‘ä»¬æƒ³è®©äº‹æƒ…ç®€å•äº›ï¼šæ·»åŠ ä¸€ä¸ªmeå­—æ®µåˆ° query çš„æ ¹ä¸Šæ¥è¿”å›å…¶ context çš„å½“å‰ç”¨æˆ·ï¼š # app/graphql/types/query_type. rbmodule Types class QueryType &lt; Types::BaseObject  # . . .   field :me, Types::UserType, null: true  def me   context[:current_user]  end endendå¦‚ä½•å¾—åˆ°:current_userï¼Ÿæˆ‘ä»¬æ¥æ·»åŠ ä¸€ä¸ªApplicationController#current_useræ–¹æ³•ï¼Œå®ç°ä¸Šè¿°çš„èº«ä»½éªŒè¯é€»è¾‘ï¼š # app/controllers/application_controller. rbclass ApplicationController &lt; ActionController::Base private def current_user  token = request. headers[ Authorization ]. to_s  email = Base64. decode64(token)  User. find_by(email: email) endendæœ€åï¼Œæˆ‘ä»¬æ›´æ–°GraphqlController#executeæ–¹æ³•ä»¥ä¼ é€’current_useråˆ° context å†…ï¼š # app/controllers/graphql_controller. rbclass GraphqlController &lt; ApplicationController def execute  result = MartianLibrarySchema. execute(   params[:query],   variables: ensure_hash(params[:variables]),   # Only this line has chagned   context: { current_user: current_user },   operation_name: params[:operationName]  )  render json: result end # . . . endæ¼‚äº®ï¼ç°åœ¨æˆ‘ä»¬çš„å®¢æˆ·ç«¯å°±èƒ½æ‹¿åˆ°å½“å‰ç”¨æˆ·çš„ä¿¡æ¯äº†ã€‚ä½†ä¸å¹¸çš„æ˜¯ï¼Œå®ƒæ€»æ˜¯è¿”å›nilâ€”â€”æˆ‘ä»¬è¿˜æ²¡æœ‰åŠ ä¸Šå‘ŠçŸ¥å½“å‰è°æ­£åœ¨ä½¿ç”¨åº”ç”¨çš„æ–¹æ³•ã€‚æ¥ä¿®å¤å®ƒï¼ æ‰“å¼€Mutations::BaseMutationç±»å¹¶ç²˜è´´å¦‚ä¸‹ä»£ç ï¼ˆé»˜è®¤ç”Ÿæˆå™¨ç»§æ‰¿è‡ªæ›´å¤æ‚çš„GraphQL::Schema::RelayClassicMutationç±»ï¼‰ï¼š # app/graphql/mutations/base_mutation. rbmodule Mutations class BaseMutation &lt; GraphQL::Schema::Mutation endendæˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªç±»ä½œä¸ºSignInMutationçš„çˆ¶ç±»ï¼š # app/graphql/mutations/sign_in_mutation. rbmodule Mutations class SignInMutation &lt; Mutations::BaseMutation  argument :email, String, required: true  field :token, String, null: true  field :user, Types::UserType, null: true  def resolve(email:)   user = User. find_by!(email: email)   return {} unless user   token = Base64. encode64(user. email)   {    token: token,    user: user   }  end endendå¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬æŒ‡å®šäº† mutation å¯ä»¥è¿”å›ä¸€ä¸ª token å’Œä¸€ä¸ªå½“å‰çš„ç”¨æˆ·ï¼Œè€Œå”¯ä¸€æ¥æ”¶çš„å‚æ•°æ˜¯emailã€‚åœ¨#resolveæ–¹æ³•å†…ï¼Œæˆ‘ä»¬æŸ¥æ‰¾ç”¨æˆ·ï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œå°±ä»¥ base64 åŠ å¯†çš„ email ä½œä¸º token è¿”å›ï¼Œå¦åˆ™è¿”å›nullã€‚ ç¬¬ä¸€çœ¼çœ‹å»ï¼Œmutation ç±»å°±åƒä¸€ä¸ªå¸¸è§„çš„ Rails controllerï¼Œä½†å®ƒæœ‰ä¸€ä¸ªé‡è¦çš„ä¼˜ç‚¹ï¼šå®ƒæ˜¯å¼ºç±»å‹çš„ï¼Œé€šè¿‡å…¶ schema æ¥éªŒè¯è¾“å…¥çš„æ•°æ®ã€‚ æœ€åï¼Œæˆ‘ä»¬éœ€è¦åœ¨MutationTypeä¸­æš´éœ²è¿™ç¬¬ä¸€ä¸ª mutationï¼š # app/graphql/types/mutation_type. rbmodule Types class MutationType &lt; Types::BaseObject  field :sign_in, mutation: Mutations::SignInMutation endendæ€»ç»“ä¸€ä¸‹ï¼Œä¸ºäº†æ·»åŠ ä¸€ä¸ªæ–° mutationï¼Œä½ éœ€è¦å®Œæˆå¦‚ä¸‹æ­¥éª¤ï¼š  æ·»åŠ ä¸€ä¸ªç±»å®ç° mutation é€»è¾‘ï¼Œå…¶åŒ…å«ï¼š è¾“å…¥å€¼çš„ç±»å‹å®šä¹‰ï¼ˆargumentsï¼‰ï¼› è¿”å›å€¼çš„ç±»å‹å®šä¹‰ï¼› #resolveæ–¹æ³• æ·»åŠ ä¸€ä¸ªæ–°çš„å…¥å£åˆ°MutationTypeä¸­æ³¨æ„ï¼Œæˆ‘ä»¬æ ¹æœ¬æ²¡æœ‰æåˆ° spec æµ‹è¯•ï¼šå¯ä»¥ä½¿ç”¨åœ¨ä¹‹å‰ç¼–å†™çš„ query spec æ‰€ç”¨è¿‡çš„ç›¸åŒæŠ€æœ¯æ¥æ·»åŠ è¿™é‡Œçš„ specã€‚æˆ–è€…å»çœ‹çœ‹æˆ‘ä»¬åœ¨ç¤ºä¾‹ä»£ç åº“ä¸­å†™å¥½çš„æµ‹è¯•ï¼ Adding user info panel: è®©æˆ‘ä»¬æš‚æ—¶å…ˆå¿˜æ‰ Ruby ä¸€ä¼šï¼ŒæŠŠæ³¨æ„åŠ›æ”¾åˆ°å‰ç«¯åº”ç”¨æ¥ã€‚ ç”±äºæˆ‘ä»¬çš„ä»£ç åº“åœ¨ä¸æ–­å¢é•¿ï¼Œæ‰€ä»¥éœ€è¦è€ƒè™‘ä¸€ä¸ªæ›´å¥½çš„ä»£ç ç»„ç»‡æ–¹å¼ã€‚æˆ‘ä»¬å¯¹äº UI ç»„ä»¶æ¨èå¦‚ä¸‹ç»“æ„ï¼š  æ¯ä¸ªç»„ä»¶å­˜æ”¾åˆ°ä¸€ä¸ªå•ç‹¬çš„ç›®å½•ä¸­ï¼ˆæ¯”å¦‚ï¼Œapp/javascript/components/MyComponentï¼‰ index. jsåŒ…å«å®ç°éƒ¨åˆ† query å®šä¹‰åœ¨operations. graphqlä¸­ æ ·å¼æ”¾åˆ°styles. module. cssä¸­ï¼ˆå¦‚æ–‡ä»¶åæ‰€å»ºè®®çš„é‚£æ ·ï¼Œæˆ‘ä»¬ä½¿ç”¨css modulesè€Œæ¯‹éœ€æ‹…å¿ƒæ ·å¼å†²çªï¼‰ä¸ºäº†é¿å…ä¸ºæ¯ä¸ªç»„ä»¶éƒ½æ‰‹åŠ¨åˆ›å»ºè¿™äº›æ–‡ä»¶çš„ç¹çï¼Œæˆ‘ä»¬å†™äº†ä¸€ä¸ªgql-component generatorï¼ˆgraphql ç»„ä»¶ç”Ÿæˆå™¨ï¼‰ã€‚ç”¨å®ƒæ¥åˆ›å»ºä¸€ä¸ªç§°ä¸ºUserInfoçš„ç»„ä»¶å§ï¼š $ npx @hellsquirrel/create-gql-component create app/javascript/components/UserInfoæ³¨æ„ï¼šæ ·å¼ä»£ç åœ¨æœ¬æ–‡ä¸­è¢«å»æ‰äº†ï¼Œä»¥ä¿æŒç®€æ´ï¼Œä½†ä½ å¯ä»¥åœ¨ GitHub çš„ repo ä¸­æ‰¾åˆ°æ‰€æœ‰çš„æ ·å¼æ–‡ä»¶ã€‚å¦‚æœä½ ä½¿ç”¨æˆ‘ä»¬çš„ç”Ÿæˆå™¨ï¼Œæ ·å¼ä¼šè¢«è‡ªåŠ¨æ·»åŠ ã€‚ è¿™å°†æ˜¯ä½ çš„æ–‡ä»¶ç»“æ„çœ‹èµ·æ¥çš„æ ·å­ï¼š UserInfoç»„ä»¶è´Ÿè´£â€œSign Inâ€çš„åŠŸèƒ½ï¼Œä»¥åŠå½“é€šè¿‡èº«ä»½éªŒè¯æ—¶å±•ç¤ºå½“å‰ç”¨æˆ·åã€‚è®©æˆ‘ä»¬æ¥é¦–å…ˆæ·»åŠ è¿™äº›åŠŸèƒ½æ‰€éœ€è¦çš„ API æŸ¥è¯¢åˆ°operations. graphqlä¸­ï¼š query Me { me {  id  fullName }}mutation SignMeIn($email: String!) { signIn(email: $email) {  token  user {   id   fullName  } }}æˆ‘ä»¬å®šä¹‰äº†SignMeIn operationï¼Œå¸¦æ‰€éœ€çš„$emailå‚æ•°ï¼Œä¸ºStringç±»å‹ï¼Œâ€œæ‰§è¡Œâ€signIn mutation å¹¶åœ¨æˆåŠŸæ—¶è¿”å›ä¸€ä¸ªéªŒè¯ token å’Œå½“å‰ç”¨æˆ·ä¿¡æ¯ã€‚ä½ å¯èƒ½æ³¨æ„åˆ°äº†Meå’ŒSignMeIn operationä¸Šçš„æŸäº›é‡å¤â€”â€”åˆ«æ‹…å¿ƒï¼Œç¨åæˆ‘ä»¬ä¼šå±•ç¤ºå¦‚ä½•å¤„ç†å®ƒä»¬ã€‚ å†æ‰“å¼€index. jså¹¶ä½¿ç”¨ä¸Šé¢å®šä¹‰çš„ operation æ¥å®šä¹‰æˆ‘ä»¬çš„ç»„ä»¶ã€‚æˆ‘ä»¬æœŸæœ›å…ˆåŠ è½½ç”¨æˆ·ä¿¡æ¯ï¼Œä¸”ä»…å½“ç”¨æˆ·æ²¡æœ‰è¢«èº«ä»½éªŒè¯æ—¶æ‰å±•ç¤ºâ€œSign Inâ€è¡¨å•ï¼š &lt;Query query={Me}&gt; {({ data, loading }) =&gt; {  if (loading) return  . . . Loading ;  if (!data. me) {   // Show login form   return;  }  const { fullName } = data. me;  return &lt;div className={cs. info}&gt;ğŸ˜ˆ {fullName}&lt;/div&gt;; }}&lt;/Query&gt;è¦æ˜¾ç¤ºè¡¨å•ï¼Œæˆ‘ä»¬åº”å½“ä½¿ç”¨Mutationç»„ä»¶å¹¶ä¼ é€’SignMeIn operation ä¸ºä¸€ä¸ªmutation propertyï¼š &lt;Mutation mutation={SignMeIn}&gt; {(signIn, { loading: authenticating }) =&gt;  authenticating ? (    . . .    ) : (   &lt;form onSubmit={() =&gt; signIn(/* email here */)}&gt;    &lt;input type= email  /&gt;    &lt;input type= submit  value= Sign In  /&gt;   &lt;/form&gt;  ) }&lt;/Mutation&gt;åˆ«å¿˜äº†å¯¼å…¥ userRef hookï¼ŒQueryå’ŒMutationç»„ä»¶ï¼Œè·Ÿè¯¥ç»„ä»¶ä¸­ä½¿ç”¨çš„ query ä¸€èµ·ï¼š import React, { useRef } from 'react';import { Query, Mutation } from  react-apollo ;import { Me, SignMeIn } from  . /operations. graphql ;è¿™æ®µä»£ç çœ‹èµ·æ¥å¾ˆåƒå‰é¢åˆ›å»ºçš„Libraryç»„ä»¶ã€‚Mutationç»„ä»¶çš„ render prop æ¥æ”¶ä¸€ä¸ªæ‰§è¡Œ mutation çš„å‡½æ•°ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆsignInï¼‰ï¼Œè€Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ª mutation ç»“æœ object çš„ objectï¼ŒåŒ…å«è¿”å›çš„æ•°æ®ï¼ŒåŠ è½½çš„çŠ¶æ€ç­‰ç­‰ã€‚ è¦ä¼ é€’ email ç»™ mutationï¼Œæˆ‘ä»¬éœ€è¦ä» inputï¼ˆä½¿ç”¨refï¼‰æ¥è·å–å®ƒï¼ŒæŠŠå®ƒæ”¾å…¥variableå†…ï¼Œå¹¶æ‰§è¡Œ mutationï¼š const UserInfo = () =&gt; { const input = useRef(null); // . . .  return (  &lt;form   onSubmit={event =&gt; {    event. preventDefault();    signIn({     variables: { email: input. current. value }    });   }}  &gt;   &lt;input    ref={input}    type= email     className={cs. input}    placeholder= your email    /&gt;  &lt;/form&gt; );};å½“åœ¨ JavaScript ä¸­è°ƒç”¨ mutation æ—¶ï¼Œæˆ‘ä»¬ä»¥å¦‚ä¸‹æ–¹å¼æŠŠå€¼ç»‘å®šåˆ° variablesï¼šä½¿ç”¨è·Ÿ operation ä¸­åŒæ ·çš„åç§°ï¼Œä½†ä¸è¦$å‰ç¼€ï¼Œæ¯”å¦‚ï¼ŒsignIn({ variables: { email: '. . . ' } })ã€‚ è®©æˆ‘ä»¬ç¡®ä¿æŠŠ token å­˜å‚¨åˆ°æŸä¸ªåœ°æ–¹ä»¥ä¾¿åœ¨éšåçš„è¯·æ±‚å’Œé¡µé¢é‡è½½é‡ç”¨å®ƒï¼š &lt;form onSubmit={event =&gt; {  event. preventDefault();  signIn({   variables: { email: input. current. value },  }). then(({ data: { signIn: { token } } }) =&gt; {   if (token) {    localStorage. setItem('mlToken', token);   }  }); }}&gt;åœ¨æˆ‘ä»¬æ‰§è¡Œâ€œSign Inâ€ä¹‹åï¼Œå°±åº”è¯¥æ›´æ–°ç”¨æˆ·ä¿¡æ¯äº†ï¼ˆé€šè¿‡Me queryï¼‰ã€‚ Dealing with cache: æœ‰ä¸¤ç§é€‰æ‹©å¯ä»¥åšåˆ°è¿™ç‚¹ï¼š  å½“ mutation å®Œæˆæ—¶é‡æ–°è¯·æ±‚me queryï¼ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Mutationç»„ä»¶ä¸ŠrefetchQueries propertyï¼‰â€”â€”è¿™ä¸ªæ˜¯æœ‰ç”¨çš„ï¼Œä½†æœ‰æ›´å¥½çš„æ–¹å¼ã€‚ ç­‰å¾… mutation å®Œæˆå¹¶æ‰‹åŠ¨æ›´æ–°ç¼“å­˜ã€‚apollo-cache-inmemoryä¸ºæ­¤æä¾›äº†writeQueryå‡½æ•°ã€‚è€Œreact-apolloåº“çš„Mutationç»„ä»¶æœ‰ä¸€ä¸ªç§°ä¸ºupdateçš„ç‰¹æ®Š propertyã€‚å®ƒæ¥æ”¶cacheä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œmutation ç»“æœä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚æˆ‘ä»¬æƒ³è¦ä½¿ç”¨writeQueryæ–¹æ³•æ‰‹åŠ¨æ·»åŠ ä¸€ä¸ªæ–°çš„ç¼“å­˜æ•°æ®ã€‚è¿™å°±å¥½æ¯”åœ¨è¯´â€œHeyï¼ŒApolloï¼è¿™å„¿æœ‰ä¸€äº›æ•°æ®ï¼Œå‡è£…ä½ æ˜¯ä»æœåŠ¡ç«¯æ¥æ”¶åˆ°å®ƒä»¬çš„å§ã€‚â€&lt;Mutation mutation={SignMeIn} update={(cache, { data: { signIn } }) =&gt; {  cache. writeQuery({   query: Me,   data: { me: signIn. user },  }); }}&gt;å¦‚ä¸‹å°±æ˜¯UserInfoç»„ä»¶æœ€ç»ˆçœ‹èµ·æ¥çš„æ ·å­ï¼š import React, { useRef } from  react ;import { Query, Mutation } from  react-apollo ;import { Me, SignMeIn } from  . /operations. graphql ;import cs from  . /styles ;const UserInfo = () =&gt; { const input = useRef(null); return (  &lt;div className={cs. panel}&gt;   &lt;Query query={Me}&gt;    {({ data, loading }) =&gt; {     if (loading) return  . . . Loading ;     if (!data. me) {      return (       &lt;Mutation        mutation={SignMeIn}        update={(cache, { data: { signIn } }) =&gt; {         cache. writeQuery({          query: Me,          data: { me: signIn. user }         });        }}       &gt;        {(signIn, { loading: authenticating }) =&gt;         authenticating ? (           . . .           ) : (          &lt;div className={cs. signIn}&gt;           &lt;form            onSubmit={event =&gt; {             event. preventDefault();             signIn({              variables: { email: input. current. value }             }). then(({ data: { signIn: { token } } }) =&gt; {              if (token) {               localStorage. setItem( mlToken , token);              }             });            }}           &gt;            &lt;input             ref={input}             type= email              className={cs. input}             placeholder= your email             /&gt;            &lt;input             type= submit              className={cs. button}             value= Sign In             /&gt;           &lt;/form&gt;          &lt;/div&gt;         )        }       &lt;/Mutation&gt;      );     }     const { fullName } = data. me;     return &lt;div className={cs. info}&gt;ğŸ˜ˆ {fullName}&lt;/div&gt;;    }}   &lt;/Query&gt;  &lt;/div&gt; );};export default UserInfo;æ­å–œï¼æˆ‘ä»¬åˆšåˆšé€šè¿‡æ·»åŠ useRefåˆ°ç»„ä»¶è€Œè´­ä¹°äº†ä¸€å¼ ç§°ä½œâ€œReact Hooksâ€çš„ç«è½¦ç¥¨ã€‚ æ›´å¥½çš„åšæ³•æ˜¯æŠŠUserInfoæ‹†åˆ†ä¸ºä¸¤ä¸ªå•ç‹¬çš„ç»„ä»¶ã€‚ç¬¬ä¸€ä¸ªè´Ÿè´£â€œSign Inâ€é€»è¾‘ï¼Œç¬¬äºŒä¸ªè´Ÿè´£ç”¨æˆ·ä¿¡æ¯å±•ç¤ºã€‚ä½ æ¥è‡ªå·±æå®šå®ƒå§ï¼ åˆ«å¿˜äº†æŠŠç»„ä»¶æ·»åŠ åˆ°/javascript/packs/index. jsï¼š // app/javascript/packs/index. jsimport React from  react ;import { render } from  react-dom ;import Provider from  . . /components/Provider ;import Library from  . . /components/Library ;import UserInfo from  . . /components/UserInfo ;render( &lt;Provider&gt;  &lt;UserInfo /&gt;  &lt;Library /&gt; &lt;/Provider&gt;, document. querySelector( #root ));Adding tokens to Apollo client: è¿è¡Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œè¯•ç€ä½¿ç”¨ä¸€ä¸ªåˆæ³• email ç™»å½•ã€‚ ä¸€åˆ‡æ­£å¸¸ï¼Œé™¤äº†å½“ä½ é‡æ–°åŠ è½½é¡µé¢æ—¶â€”â€”ä½ ä¼šçœ‹åˆ°ç™»å½•è¡¨å•å†æ¬¡å‡ºç°ï¼Œå³ä½¿ä½ ä¹‹å‰å·²æˆåŠŸç™»å½•äº†ï¼è§£é‡Šå¾ˆç®€å•ï¼šæˆ‘ä»¬æŠŠ token å­˜æ”¾åœ¨æµè§ˆå™¨ä¸­ï¼Œä½†æ²¡æœ‰â€œæ•™â€ Apollo ä½¿ç”¨å®ƒã€‚è®©æˆ‘ä»¬æ¥ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼ çœ‹ä¸€ä¸‹utils/apollo. jsï¼š // app/javascript/utils/apollo. js// . . . const getToken = () =&gt; document. querySelector('meta[name= csrf-token ]'). getAttribute( content );const token = getToken();const setTokenForOperation = async operation =&gt; operation. setContext({  headers: {    X-CSRF-Token : token  } });æˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ª CSRF token å‘é€åˆ°æœåŠ¡ç«¯äº†ã€‚å†æ¥æ·»åŠ ä¸€ä¸ªæ–°çš„â€”â€”â€œAuthorizationâ€ tokenï¼š // app/javascript/utils/apollo. js// . . . const getTokens = () =&gt; { const tokens = {   X-CSRF-Token : document   . querySelector('meta[name= csrf-token ]')   . getAttribute( content ) }; const authToken = localStorage. getItem( mlToken ); return authToken ? { . . . tokens, Authorization: authToken } : tokens;};const setTokenForOperation = async operation =&gt; { return operation. setContext({  headers: {   . . . getTokens()  } });};å†ç™»å½•è¯•è¯•ï¼Œé‡è½½é¡µé¢â€”â€”ä½ ä¼šçœ‹åˆ°ä¿¡æ¯æ çš„ç”¨æˆ·åäº†ï¼æˆ‘ä»¬çš„â€œå¹¸è¿ä¹‹è·¯â€çœ‹èµ·æ¥ç•…é€šæ— é˜»ã€‚èº«ä»½éªŒè¯æµç¨‹ âœ… Mutating the library: ç°åœ¨æˆ‘ä»¬è¦æ·»åŠ ä¸€äº›æ›´å¤šçš„ mutation â€”â€”è¿™é‡Œæ²¡ä»€ä¹ˆæ–°ä¸œè¥¿ï¼Œä½†æˆ‘ä»¬éœ€è¦å®ƒæ¥ä½¿èŒƒä¾‹åº”ç”¨çœ‹èµ·æ¥æ›´å¥½ï¼Œå¹¶å¾—åˆ°æ›´å¤šçš„å®è·µæœºä¼šã€‚ æˆ‘ä»¬æ¥å¢åŠ ä¸€ä¸ª mutation ä»¥å‘å›¾ä¹¦é¦†æ·»åŠ æ–° itemã€‚ç…§ä¾‹ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¼ å…¥å‚æ•°å’Œè¿”å›ç±»å‹ï¼š # app/graphql/mutations/add_item_mutation. rbmodule Mutations class AddItemMutation &lt; Mutations::BaseMutation  argument :title, String, required: true  argument :description, String, required: false  argument :image_url, String, required: false  field :item, Types::ItemType, null: true  field :errors, [String], null: false  def resolve(title:, description: nil, image_url: nil)   if context[:current_user]. nil?    raise GraphQL::ExecutionError,        You need to authenticate to perform this action    end   item = Item. new(    title: title,    description: description,    image_url: image_url,    user: context[:current_user]   )   if item. save    { item: item }   else    { errors: item. errors. full_messages }   end  end endendè¿™æ®µä»£ç é‡Œæœ‰å‡ ä¸ªè¦æ³¨æ„çš„åœ°æ–¹ï¼š  æˆ‘ä»¬æ£€æŸ¥context[:current_user]çš„å­˜åœ¨ï¼Œå¦‚æœå…¶æœªè®¾å®šåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ æˆ‘ä»¬è¿”å›çš„ç±»å‹åŒ…å«ä¸¤ä¸ªå­—æ®µï¼šitemå’Œerrorsã€‚ä¸ºä»€ä¹ˆä¸ç”¨save!å¹¶æŠ›å‡ºå¼‚å¸¸ï¼Ÿç”¨æˆ·è¾“å…¥çš„æ ¡éªŒé”™è¯¯ä¸åº”è¯¥è¢«çœ‹ä½œå¼‚å¸¸ï¼›æˆ‘ä»¬çš„å‰ç«¯åº”ç”¨åº”æŠŠå…¶è§†ä¸ºä¸€ç§åˆæ³•å“åº”å¹¶åé¦ˆç»™ç”¨æˆ·ã€‚å…¶ä»–çš„ä¸€åˆ‡éƒ½çœ‹èµ·æ¥åƒæ˜¯å…¸å‹çš„ Rails controller ä¸­çš„æ—§å¼#createè¡Œä¸ºã€‚è€Œå¦‚åŒ#updateçš„ç±»ä¼¼è¡Œä¸ºä¹Ÿéå¸¸ç®€å•ï¼š # app/graphql/mutations/update_item_mutation. rbmodule Mutations class UpdateItemMutation &lt; Mutations::BaseMutation  argument :id, ID, required: true  argument :title, String, required: true  argument :description, String, required: false  argument :image_url, String, required: false  field :item, Types::ItemType, null: true  field :errors, [String], null: false  def resolve(id:, title:, description: nil, image_url: nil)   if context[:current_user]. nil?    raise GraphQL::ExecutionError,        You need to authenticate to perform this action    end   item = Item. find(id)   if item. update(title: title, description: description, image_url: image_url)    { item: item }   else    { errors: item. errors. full_messages }   end  end endendä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°åœ¨è¿™ä¸¤ä¸ªç±»ä¸­æœ‰å¾ˆå¤šé‡å¤â€”â€”ä¸ç”¨æ‹…å¿ƒï¼Œæœ¬ç³»åˆ—çš„ç¬¬ä¸‰éƒ¨åˆ†å°†æ¶µç›–é‡æ„çš„æŠ€æœ¯å†…å®¹æ¥ä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚ æœ€åï¼ŒæŠŠæ–° mutation æ³¨å†Œåˆ°MutationTypeä¸­ï¼š # app/graphql/types/mutation_type. rbmodule Types class MutationType &lt; Types::BaseObject  # . . .   field :add_item, mutation: Mutations::AddItemMutation  field :update_item, mutation: Mutations::UpdateItemMutation endendUpdating Library component: åœ¨å¼€å§‹ä¹‹å‰ï¼Œæ¥é‡æ–°ç”Ÿæˆä¸€ä¸‹æˆ‘ä»¬çš„ library ç»„ä»¶ä»¥éµå¾ªæ–°æ¶æ„ï¼ˆè§£æ„ operationï¼Œæ·»åŠ æ ·å¼ï¼‰ï¼š $ npx @hellsquirrel/create-gql-component create app/javascript/components/LibraryæŠŠå¦‚ä¸‹ query æ”¾å…¥operations. graphqlä¸­ï¼š query LibraryQuery { items {  id  title  imageUrl  description  user {   id   email  } }}å¹¶â€œåˆ·æ–°â€ library ç»„ä»¶çš„å®ç°æ–¹å¼ï¼š // app/javascript/components/Libraryimport React, { useState } from  react ;import { Query } from  react-apollo ;import { LibraryQuery } from  . /operations. graphql ;import cs from  . /styles ;const Library = () =&gt; { const [item, setItem] = useState(null); return (  &lt;Query query={LibraryQuery}&gt;   {({ data, loading }) =&gt; (    &lt;div className={cs. library}&gt;     {loading || !data. items      ?  loading. . .        : data. items. map(({ title, id, user, imageUrl, description }) =&gt; (        &lt;button         key={id}         className={cs. plate}         onClick={() =&gt; setItem({ title, imageUrl, id, description })}        &gt;         &lt;div className={cs. title}&gt;{title}&lt;/div&gt;         &lt;div&gt;{description}&lt;/div&gt;         {imageUrl &amp;&amp; &lt;img src={imageUrl} className={cs. image} /&gt;}         {user ? (          &lt;div className={cs. user}&gt;added by {user. email}&lt;/div&gt;         ) : null}        &lt;/button&gt;       ))}    &lt;/div&gt;   )}  &lt;/Query&gt; );};export default Library;æ³¨æ„ï¼Œæˆ‘ä»¬æŠŠæ¯ä¸ª item éƒ½åŒ…è£¹åœ¨button HTML å…ƒç´ å†…ï¼šæˆ‘ä»¬æœŸæœ›å®ƒä»¬æ˜¯å¯ç‚¹å‡»çš„ï¼Œä»¥å±•ç¤ºæ›´æ–°è¿‡çš„è¡¨å•ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬çš„å‰ç«¯åº”ç”¨çœ‹èµ·æ¥æ¼‚äº®å¤šäº†ã€‚è®©æˆ‘ä»¬æ¥æ·»åŠ ä¸€äº›æ–°çš„äº®ç‚¹å§ï¼ Adding form components: æˆ‘ä»¬æ¥ä¸ºåˆ›å»ºå’Œç¼–è¾‘ item æ·»åŠ æ›´å¤šçš„ç»„ä»¶ã€‚è¿™äº›ç»„ä»¶éƒ½å¾ˆç±»ä¼¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠå¾ˆå¤šé€»è¾‘éƒ½æ”¾åˆ°å¯é‡ç”¨çš„ProcessItemFormç»„ä»¶å†…ã€‚ $ npx @hellsquirrel/create-gql-component create app/javascript/components/ProcessItemFormç»„ä»¶ä»£ç å¦‚ä¸‹ï¼š // app/javascript/components/ProcessItemForm/index. jsimport React, { useState } from  react ;import cs from  . /styles ;const ProcessItemForm = ({ initialTitle =   , initialDescription =   , initialImageUrl =   , onProcessItem, buttonText, loading}) =&gt; { const [title, setTitle] = useState(initialTitle); const [description, setDescription] = useState(initialDescription); const [imageUrl, setImageUrl] = useState(initialImageUrl); return (  &lt;div className={cs. form}&gt;   &lt;input    type= text     placeholder= title     value={title}    className={cs. input}    onChange={e =&gt; setTitle(e. currentTarget. value)}   /&gt;   &lt;input    type= text     placeholder= description     value={description}    className={cs. input}    onChange={e =&gt; setDescription(e. currentTarget. value)}   /&gt;   &lt;input    type= text     placeholder= url     value={imageUrl}    className={cs. input}    onChange={e =&gt; setImageUrl(e. currentTarget. value)}   /&gt;   {loading ? (     . . . Loading    ) : (    &lt;button     onClick={() =&gt; onProcessItem({ title, description, imageUrl })}     className={cs. button}    &gt;     {buttonText}    &lt;/button&gt;   )}  &lt;/div&gt; );};export default ProcessItemForm;æˆ‘ä»¬å”¯ä¸€æ‰€éœ€è¦æ·»åŠ çš„æ˜¯åˆ›å»º item çš„ formâ€”â€”æˆ‘ä»¬æŠŠå…¶ç§°ä¸ºAddItemFormã€‚ $ npx @hellsquirrel/create-gql-component create app/javascript/components/AddItemFormæˆ‘ä»¬è¦æŠŠ AddItemMutation æ·»åŠ åˆ°operations. graphqlï¼š # /app/javascript/components/AddItemForm/operations. graphqlmutation AddItemMutation( $title: String! $description: String $imageUrl: String) { addItem(title: $title, description: $description, imageUrl: $imageUrl) {  item {   id   title   description   imageUrl   user {    id    email   }  } }}å¹¶åœ¨index. jsä¸­ä½¿ç”¨å®ƒï¼š import React from  react ;import { Mutation } from  react-apollo ;import { AddItemMutation } from  . /operations. graphql ;import ProcessItemForm from  . . /ProcessItemForm ;const AddItemForm = () =&gt; ( &lt;Mutation mutation={AddItemMutation}&gt;  {(addItem, { loading }) =&gt; (   &lt;ProcessItemForm    buttonText= Add Item     loading={loading}    onProcessItem={({ title, description, imageUrl }) =&gt;     addItem({      variables: {       title,       description,       imageUrl      }     })    }   /&gt;  )} &lt;/Mutation&gt;);export default AddItemForm;åˆ«å¿˜äº†æ·»åŠ  form åˆ°/javascript/packs/index. jsï¼š import React from  react ;import { render } from  react-dom ;import Provider from  . . /components/Provider ;import Library from  . . /components/Library ;import UserInfo from  . . /components/UserInfo ;import AddItemForm from  . . /components/AddItemForm ;render( &lt;Provider&gt;  &lt;UserInfo /&gt;  &lt;AddItemForm /&gt;  &lt;Library /&gt; &lt;/Provider&gt;, document. querySelector( #root ));ç°åœ¨æˆ‘ä»¬é­é‡äº†è·Ÿåœ¨UserInfoç»„ä»¶ä¸­åŒæ ·çš„é—®é¢˜ã€‚æˆ‘ä»¬éœ€è¦å‘ŠçŸ¥åº”ç”¨ï¼šLibraryQueryåº”è¯¥è¢«æ›´æ–°ã€‚å› æ­¤æˆ‘ä»¬å¿…é¡»åˆ·æ–°ç¼“å­˜ï¼šé€šè¿‡è¯»å–æ•´ä¸ªåˆ—è¡¨å¹¶æŠŠæ–° item åˆå¹¶åˆ°åˆ—è¡¨ä¸Šä»¥è®¾ç½®ä¸€ä¸ªæ–°åˆ—è¡¨ã€‚ æ¥æ”¹ä¸€ä¸‹javascript/components/AddItemForm/index. jsï¼š // javascript/components/AddItemForm/index. js// . . . import { LibraryQuery } from '. . /Library/operations. graphql';// . . . &lt;ProcessItemForm //. . .  // Update library query after Mutation will be finished onProcessItem={({ title, description, imageUrl }) =&gt;  addItem({   variables: {    title,    description,    imageUrl,   },   // adding the second argument to 'addItem' method   update: (cache, { data: { addItem } }) =&gt; {    const item = addItem. item;    if (item) {     const currentItems = cache. readQuery({ query: LibraryQuery });     cache. writeQuery({      query: LibraryQuery,      data: {       items: [item]. concat(currentItems. items),      },     });    }   },  }) } // . . . æå®šï¼ç°åœ¨æˆ‘ä»¬ä¼šçœ‹åˆ°æ–°çš„ item è¢«æ·»åŠ åˆ°é¡µé¢åˆ—è¡¨äº†ã€‚ æ¥ä¸ºæ›´æ–° item å†æ·»åŠ ä¸€ä¸ªç»„ä»¶ï¼Œç§°ä¸ºUpdateItemFormã€‚ä»£ç éå¸¸ç±»ä¼¼äº AddItemFormã€‚è¿è¡Œç”Ÿæˆå™¨ï¼š $ npx @hellsquirrel/create-gql-component create app/javascript/components/UpdateItemFormä¸‹é¢æ˜¯ operations æ–‡ä»¶ä¸­çš„å†…å®¹ï¼š mutation UpdateItemMutation( $id: ID! $title: String! $description: String $imageUrl: String) { updateItem(  id: $id  title: $title  description: $description  imageUrl: $imageUrl ) {  item {   id   title   description   imageUrl  } }}è¿™æ˜¯ç»„ä»¶æ–‡ä»¶ä¸­çš„å†…å®¹ï¼š // /app/javascript/components/UpdateItemFormimport React from  react ;import { Mutation } from  react-apollo ;import { UpdateItemMutation } from  . /operations. graphql ;import ProcessItemForm from  . . /ProcessItemForm ;import cs from  . /styles ;const UpdateItemForm = ({ id, initialTitle, initialDescription, initialImageUrl, onClose}) =&gt; ( &lt;div className={cs. overlay}&gt;  &lt;div className={cs. content}&gt;   &lt;Mutation mutation={UpdateItemMutation}&gt;    {(updateItem, { loading }) =&gt; (     &lt;ProcessItemForm      initialImageUrl={initialImageUrl}      initialTitle={initialTitle}      initialDescription={initialDescription}      buttonText= Update Item       loading={loading}      onProcessItem={({ title, description, imageUrl }) =&gt; {       updateItem({        variables: {         id,         title,         description,         imageUrl        }       });       onClose();      }}     /&gt;    )}   &lt;/Mutation&gt;   &lt;button className={cs. close} onClick={onClose}&gt;    Close   &lt;/button&gt;  &lt;/div&gt; &lt;/div&gt;);export default UpdateItemForm;å¹¶æŠŠ UpdateItemForm æ·»åŠ åˆ° libraryï¼ˆä½äº button ä¹‹åï¼‰ï¼š // /app/javascript/components/Library/index. js//. . . import UpdateItemForm from  . . /UpdateItemForm ;// . . . &lt;button /&gt;;{ item !== null &amp;&amp; (  &lt;UpdateItemForm   id={item. id}   initialTitle={item. title}   initialDescription={item. description}   initialImageUrl={item. imageUrl}   onClose={() =&gt; setItem(null)}  /&gt; )}// . . . ç°åœ¨å¦‚æœæˆ‘ä»¬ç‚¹å‡» item å¹¶ä¿®æ”¹ï¼Œå®ƒå°±ä¼šç¥å¥‡åœ°æ›´æ–°äº†ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ å½“è·å–ä¸€ä¸ª item åˆ—è¡¨æ—¶ï¼Œå“åº”ç»“æœè¢«è§„èŒƒåŒ–ï¼Œä¸”æ¯ä¸ª item éƒ½è¢«æ·»åŠ åˆ°ç¼“å­˜ã€‚apolloä¸ºæ¯ä¸ªæœ‰__typenameå’Œidçš„å®ä½“éƒ½ç”Ÿæˆä¸€ä¸ª keyï¼š${object__typename}:${objectId}ã€‚å½“ mutation å®Œæˆçš„æ—¶å€™ï¼Œæˆ‘ä»¬è·å–åˆ°æœ‰ç›¸åŒ__typenameå’Œidçš„å¯¹è±¡ï¼Œapolloåœ¨ç¼“å­˜ä¸­æ‰¾åˆ°å®ƒï¼Œå¹¶è¿›è¡Œæ›´æ”¹ï¼ˆç»„ä»¶ä¹Ÿè¢«é‡æ–°æ¸²æŸ“ï¼‰ã€‚ æˆ‘ä»¬èƒ½åšå¾—æ›´å¥½ä¸€äº›ä¹ˆï¼Ÿå½“ç„¶ï¼ ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ç­‰å¾…æœåŠ¡ç«¯çš„å“åº”å‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬å¯¹æœåŠ¡ç«¯æœ‰è¶³å¤Ÿçš„ä¿¡å¿ƒï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¹è§‚å¼æ›´æ–°ã€‚è®©æˆ‘ä»¬å†æ·»åŠ ä¸€ä¸ªå‚æ•°åˆ° updateItem å‡½æ•°ï¼š // /app/javascript/components/UpdateItemForm//. . . updateItem({ variables: {  //. . .  }, // adding the second argument to 'updateItem' method optimisticResponse: {  __typename:  Mutation ,  updateItem: {   __typename:  UpdateItemMutationPayload ,   item: {    id,    __typename:  Item ,    title,    description,    imageUrl   }  } }});//. . è¿™äº›å°±æ˜¯æœ¬æ–‡çš„å…¨éƒ¨å†…å®¹äº†ï¼æˆ‘ä»¬å­¦ä¹ äº† mutation å’Œ query ä¹‹é—´çš„åŒºåˆ«ï¼Œå­¦ä¹ äº†åœ¨åç«¯å¦‚ä½•å®ç°å®ƒä»¬ï¼Œä»¥åŠå¦‚ä½•åœ¨å‰ç«¯ä½¿ç”¨å®ƒä»¬ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬çš„åº”ç”¨æ”¯æŒç”¨æˆ·ç™»å½•å’Œå›¾ä¹¦é¦†çš„ç®¡ç†ï¼Œæ‰€ä»¥å‡ ä¹å·²å‡†å¤‡å¥½å‘å¸ƒåˆ° production äº†ï¼ç„¶è€Œï¼Œä»£ç çœ‹èµ·æ¥è¿˜æœ‰äº›ç¬¨æ‹™ï¼Œæœ‰é‡æ„çš„ç©ºé—´â€”â€”è¿™æ­£æ˜¯æˆ‘ä»¬å°†åœ¨ç¬¬ä¸‰éƒ¨åˆ†ä¸­è¦åšçš„ï¼Œå¹¶æ·»åŠ ä¸€äº›å…¶ä»–æ”¹è¿›ï¼Œä¾‹å¦‚å®æ—¶æ›´æ–°å’Œæ›´å¥½çš„é”™è¯¯å¤„ç†ã€‚æ•¬è¯·å…³æ³¨ï¼ "
    }, {
    "id": 27,
    "url": "/2020/11/graphql-on-rails-series-1/",
    "title": "GraphQL on Railsâ€”â€”å¯ç¨‹",
    "body": "2020/11/12 - æœ¬æ–‡å·²è·å¾—åŸä½œè€…ï¼ˆDmitry Tsepelevï¼‰ã€ï¼ˆPolina Gurtovayaï¼‰å’Œ Evil Martians æˆæƒè®¸å¯è¿›è¡Œç¿»è¯‘ã€‚åŸæ–‡æ˜¯ Rails + React ä½¿ç”¨ GraphQLçš„ç³»åˆ—æ•™ç¨‹ç¬¬ä¸€ç¯‡ï¼Œä»‹ç»äº†ä»¥ Rails ä½œä¸ºåç«¯ï¼ŒReact + Apollo ä½œä¸ºå‰ç«¯ï¼Œå¦‚ä½•ç»è¿‡åŸºç¡€çš„é…ç½®ï¼Œæ„å»ºä¸€ä¸ªç®€å•å›¾ä¹¦é¦†åˆ—è¡¨é¡µé¢ã€‚  åŸæ–‡é“¾æ¥ï¼šGraphQL on Rails: From zero to the first query ä½œè€…ï¼šDmitry Tsepelevï¼ŒPolina Gurtovaya ç«™ç‚¹ï¼šEvil Martians â€”â€”ä½äºçº½çº¦å’Œä¿„ç½—æ–¯çš„ Ruby on Rails å¼€å‘äººå‘˜åšå®¢ã€‚ å®ƒå‘å¸ƒäº†è®¸å¤šä¼˜ç§€çš„æ–‡ç« ï¼Œå¹¶ä¸”æ˜¯ä¸å°‘ gem çš„èµåŠ©å•†ã€‚ã€æ­£æ–‡å¦‚ä¸‹ã€‘ å¼•è¨€: è¿™æ˜¯ä¸€ä¸ªåœ¨åç«¯ä½¿ç”¨ Railsã€å‰ç«¯ä½¿ç”¨ React/Apollo æ¥å¼€å‘ GraphQL åº”ç”¨ç¨‹åºçš„æ—…è¡Œè€…æŒ‡å¯¼ã€‚è·Ÿéšè¯¥ç³»åˆ—æ•™ç¨‹å¯é€šè¿‡èŒƒä¾‹å­¦åˆ°æ—¢æœ‰åŸºç¡€çš„ã€ä¹Ÿæœ‰é«˜çº§çš„ä¸»é¢˜å†…å®¹ï¼Œè®©ä½ é¢†ç•¥ç°ä»£æŠ€æœ¯çš„å¨åŠ›ã€‚ GraphQL æ˜¯æˆ‘ä»¬åœ¨ä»»ä½•åœ°æ–¹ï¼ˆåšå®¢ã€ä¼šè®®ã€æ’­å®¢ï¼Œç”šè‡³æŠ¥çº¸ï¼‰éƒ½èƒ½è§åˆ°çš„æ–°é¢–äº‹ç‰©ä¹‹ä¸€ã€‚å¬èµ·æ¥ä½ åº”è¯¥æŠ“ç´§æ—¶é—´ï¼Œå°½å¿«å¼€å§‹ä»¥ GraphQL è€Œé REST æ¥é‡å†™åº”ç”¨ç¨‹åºï¼Œå¯¹å§ï¼Ÿäº‹å®å¹¶éå¦‚æ­¤ã€‚è®°ä½ï¼šæ²¡æœ‰é“¶å¼¹ã€‚åœ¨è¿›è¡Œå†³ç­–ä¹‹å‰ç†è§£è¯¥æŠ€æœ¯çš„ä¼˜åŠ£æ˜¯å®Œå…¨æœ‰å¿…è¦çš„ã€‚ æœ¬ç³»åˆ—ä¸­ï¼Œæˆ‘ä»¬å°†ç»™ä½ ä¸€ä¸ª GraphQL åº”ç”¨ç¨‹åºå¼€å‘çš„ç®€æ´æŒ‡å—ï¼Œä¸æ­¢è°ˆåˆ°å…¶ä¼˜ç‚¹ï¼Œä¹Ÿä¼šè®¨è®ºå…¶æ³¨æ„äº‹é¡¹ä¹ƒè‡³é™·é˜±ï¼ˆå½“ç„¶ï¼Œè¿˜æœ‰å¦‚ä½•å¤„ç†å®ƒä»¬çš„æ–¹æ³•ï¼‰ã€‚ GraphQL in a nutshell: æ ¹æ®è§„èŒƒï¼ŒGraphQLæ˜¯ä¸€ç§æŸ¥è¯¢è¯­è¨€å’Œ runtimeï¼ˆæˆ–æ‰§è¡Œå¼•æ“ï¼‰ã€‚æŸ¥è¯¢è¯­è¨€ï¼ŒæŒ‰ç…§å®šä¹‰ï¼Œæè¿°äº†å¦‚ä½•ä¸ä¸€ä¸ªä¿¡æ¯ç³»ç»Ÿè¿›è¡Œé€šä¿¡ã€‚Runtime åˆ™è´Ÿè´£å®ç°æ•°æ®çš„æŸ¥è¯¢ã€‚ æ¯ä¸ª GraphQL åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒéƒ½åœ¨äºä¸€ä¸ª schemaï¼šå®ƒä»¥æœ‰å‘å›¾çš„å½¢å¼æè¿°åº•å±‚æ•°æ®ã€‚Runtime å¿…é¡»æ ¹æ®è¯¥ schemaï¼ˆåŠè§„èŒƒä¸­çš„ä¸€äº›é€šç”¨è§„åˆ™ï¼‰æ¥æ‰§è¡ŒæŸ¥è¯¢ã€‚è¿™æ„å‘³ç€ï¼Œæ¯ä¸ªæœ‰æ•ˆçš„ GraphQL æœåŠ¡ç«¯éƒ½ä»¥ç›¸åŒçš„æ–¹å¼è¿è¡ŒæŸ¥è¯¢ï¼Œå¹¶ä»¥ç›¸åŒçš„æ ¼å¼è¿”å›ç›¸åŒ schema çš„æ•°æ®ã€‚æ¢å¥è¯è¯´ï¼Œschema å°±æ˜¯å®¢æˆ·ç«¯åº”äº†è§£åˆ°çš„å…³äº API çš„ä¸€åˆ‡ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ GraphQL æŸ¥è¯¢çš„ä¾‹å­ï¼š query getProduct($id: Int!) { product(id: $id) {  id  title  manufacturer {   name  } }}è®©æˆ‘ä»¬æ¥ä¸€è¡Œä¸€è¡Œè§£æå®ƒï¼š  æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå…·åæŸ¥è¯¢ï¼ˆgetProductæ˜¯æ“ä½œåï¼‰ï¼Œæ¥æ”¶å•ç‹¬ä¸€ä¸ªå‚æ•°ï¼ˆ$idï¼‰ã€‚æ“ä½œåæ˜¯å¯é€‰çš„ï¼Œä½†å®ƒä¼šå¯¹å¯è¯»æ€§æœ‰æ‰€å¸®åŠ©ï¼Œä¹Ÿèƒ½ç”¨äºå‰ç«¯è¿›è¡Œç¼“å­˜ã€‚ æˆ‘ä»¬ä» schema çš„â€œæ ¹â€ä¸Šâ€œé€‰æ‹©â€äº†productå­—æ®µï¼Œå¹¶ä¼ é€’$idå€¼ä½œä¸ºå‚æ•°ã€‚ æˆ‘ä»¬æè¿°äº†æœŸæœ›è·å–çš„é‚£äº›å­—æ®µï¼šè¯¥åœºæ™¯ä¸­ï¼Œæ˜¯æƒ³è¦å¾—åˆ° product çš„idå’Œtitleï¼Œä»¥åŠ manufacturer çš„nameã€‚æœ¬è´¨ä¸Šï¼Œä¸€ä¸ªæŸ¥è¯¢ä»£è¡¨äº† schema çš„ä¸€ä¸ªå­å›¾ï¼Œè¿™å¸¦æ¥äº† GraphQL çš„ç¬¬ä¸€ä¸ªå¥½å¤„â€”â€”æˆ‘ä»¬å¯ä»¥åœ¨å•ä¸ªæŸ¥è¯¢ä¸­ï¼Œä»…è·å–è‡ªå·±æ‰€éœ€è¦çš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥è·å–ä¸€æ¬¡æ‰€éœ€çš„æ‰€æœ‰æ•°æ®ã€‚ è¿™æ ·ï¼Œæˆ‘ä»¬å°±è§£å†³äº†ä¼ ç»Ÿ REST API çš„ä¸€ä¸ªå¸¸è§é—®é¢˜â€”â€”overfetchingï¼ˆè¿‡é‡è·å–ï¼‰ã€‚ å¦ä¸€ä¸ªå…³äº GraphQL schema çš„æ˜æ˜¾ç‰¹æ€§æ˜¯å®ƒä»¬ä¸ºå¼ºç±»å‹çš„ï¼ˆstrongly typedï¼‰ï¼šå®¢æˆ·ç«¯å’Œ runtime ä¸¤è¾¹éƒ½ç¡®ä¿äº†ä»åº”ç”¨ç¨‹åºçš„ç±»å‹ç³»ç»Ÿè§’åº¦çœ‹ï¼Œæ‰€ä¼ é€’çš„æ•°æ®æ˜¯åˆæ³•çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœ‰äººé”™è¯¯ä¼ é€’äº†ä¸€ä¸ªå­—ç¬¦ä¸²çš„å€¼ä½œä¸º$idç»™ä¸Šé¢çš„æŸ¥è¯¢ï¼Œå®¢æˆ·ç«¯å°±ä¼šå› æŠ›å‡ºå¼‚å¸¸è€Œå¤±è´¥ï¼Œç”šè‡³ä¸ä¼šå°è¯•æ‰§è¡ŒæŸ¥è¯¢ã€‚ æœ€åä½†å¹¶éæœ€ç»ˆçš„ä¸€ä¸ªå¥½å¤„æ˜¯ schema çš„è‡ªçœï¼šå®¢æˆ·ç«¯å¯ä»¥ä» schema è‡ªèº«æ¥å­¦ä¹  APIï¼Œè€Œæ— éœ€ä»»ä½•é¢å¤–çš„æ–‡æ¡£èµ„æºã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº† GraphQL çš„ä¸å°‘ç†è®ºéƒ¨åˆ†ã€‚ç°åœ¨è¯¥æ¥åšä¸€äº›ä»£ç ç»ƒä¹ äº†ï¼Œä»¥ç¡®ä¿ä½ ä¸ä¼šæ˜æ—©èµ·æ¥å°±å¿˜æ‰ä¸€åˆ‡ã€‚ What are we going to build?: é€šè¿‡è¿™ä¸ªç³»åˆ—ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªä»£è¡¨â€œMartian Libraryâ€çš„åº”ç”¨ç¨‹åºâ€”â€”ä¸€ä¸ªå½±è§†ã€ä¹¦ç±åŠå…¶ä»–ä¸ã€Šçº¢è‰²æ˜Ÿçƒã€‹æœ‰å…³çš„äº‹ç‰©çš„ä¸ªäººåœ¨çº¿æ”¶è—ã€‚ å¯¹äºæœ¬æ•™ç¨‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ï¼š  åç«¯ä½¿ç”¨Ruby 2. 6 å’Œ Rails 6ï¼ˆRC ç‰ˆæœ¬åœ¨æ­¤ï¼‰ã€è¯‘è€…æ³¨ï¼šRails 6 æ­£å¼ç‰ˆç›®å‰å·²ç»å‘å¸ƒäº†ã€‘ å‰ç«¯ä½¿ç”¨ Node. js 9+ï¼ŒReact 16. 3+ï¼Œå’Œ Apolloï¼ˆå®¢æˆ·ç«¯ç‰ˆæœ¬ 2+ï¼‰ï¼Œè¦ç¡®ä¿ä½ å·²ç»æ ¹æ®æŒ‡å¯¼å®‰è£…äº† yarnã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æºç â€”â€”åˆ«å¿˜äº†åœ¨é¦–æ¬¡è¿è¡Œå‰æ‰§è¡Œbundle install &amp;&amp; yarn installã€‚Master åˆ†æ”¯æ˜¯è¯¥é¡¹ç›®çš„å½“å‰æœ€æ–°çŠ¶æ€ã€‚ Setting up a new Rails project: å¦‚æœé˜…è¯»æœ¬æ–‡çš„æ—¶å€™ Rails 6. 0 è¿˜æ²¡æœ‰å‘å¸ƒï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦å…ˆå®‰è£… rc ç‰ˆæœ¬ï¼š $ gem install rails --pre$ rails -v=&gt; Rails 6. 0. 0. rc1ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥æ¥è¿è¡Œä¸‹é¢è¿™ä¸ªè¶…çº§é•¿çš„rails newå‘½ä»¤äº†ï¼š $ rails new martian-library -d postgresql --skip-action-mailbox --skip-action-text --skip-spring --webpack=react -T --skip-turbolinksæ¯”èµ· Rails å®˜æ–¹çš„â€œä¸»å¨ç²¾é€‰â€ï¼Œæˆ‘ä»¬æ›´å–œæ¬¢è‡ªå·±æ¥å®šåˆ¶ï¼šç•¥å»æ‰€ä¸éœ€è¦çš„æ¡†æ¶å’Œåº“ï¼Œé€‰æ‹© PostgreSQL ä½œä¸ºæ•°æ®åº“ï¼Œä»¥é¢„é…ç½®çš„ Webpacker æ¥ä½¿ç”¨ Reactï¼Œå»æ‰äº†æµ‹è¯•ï¼ˆåˆ«æ‹…å¿ƒâ€”â€”æˆ‘ä»¬ä¼šå¾ˆå¿«åŠ ä¸Š RSpec çš„ï¼‰ã€‚ åœ¨ä½ å¼€å§‹ä¹‹å‰ï¼Œå¼ºçƒˆå»ºè®®å…³é—­config/application. rbå†…æ‰€æœ‰ä¸å¿…è¦çš„ç”Ÿæˆå™¨ï¼š config. generators do |g| g. test_framework false g. stylesheets   false g. javascripts   false g. helper     false g. channel     assets: falseendPreparing the data model: æˆ‘ä»¬éœ€è¦è‡³å°‘ä¸¤ä¸ª modelï¼š  ç”¨Itemæ¥æè¿°ä»»ä½•æˆ‘ä»¬æƒ³è¦å­˜å‚¨åœ¨å›¾ä¹¦é¦†ä¸­çš„å®ä½“ï¼ˆä¹¦ç±ã€ç”µå½±ç­‰ï¼‰ã€‚ ç”¨Useræ¥ä»£è¡¨åº”ç”¨ç¨‹åºé‡Œèƒ½å¤Ÿç®¡ç†æ”¶è—å“ä¸­è¿™äº› items çš„ç”¨æˆ·ã€‚è®©æˆ‘ä»¬æ¥ç”Ÿæˆå®ƒä»¬ï¼š $ rails g model User first_name last_name email$ rails g model Item title description:text image_url user:referencesåˆ«å¿˜äº†æ·»åŠ has_many :itemsçš„å…³è”å…³ç³»åˆ°app/models/user. rbï¼š # app/models/user. rbclass User &lt; ApplicationRecord has_many :items, dependent: :destroyendæ¥æ·»åŠ ä¸€äº›é¢„ç”Ÿæˆçš„æ•°æ®åˆ°db/seeds. rbï¼š # db/seeds. rbjohn = User. create!( email:  john. doe@example. com , first_name:  John , last_name:  Doe )jane = User. create!( email:  jane. doe@example. com , first_name:  Jane , last_name:  Doe )Item. create!( [  {   title:  Martian Chronicles ,   description:  Cult book by Ray Bradbury ,   user: john,   image_url:  https://upload. wikimedia. org/wikipedia/en/4/45/The-Martian-Chronicles. jpg   },  {   title:  The Martian ,   description:  Novel by Andy Weir about an astronaut stranded on Mars trying to survive ,   user: john,   image_url:  https://upload. wikimedia. org/wikipedia/en/c/c3/The_Martian_2014. jpg   },  {   title:  Doom ,   description:  A group of Marines is sent to the red planet via an ancient   \           Martian portal called the Ark to deal with an outbreak of a mutagenic virus ,   user: jane,   image_url:  https://upload. wikimedia. org/wikipedia/en/5/57/Doom_cover_art. jpg   },  {   title:  Mars Attacks! ,   description:  Earth is invaded by Martians with unbeatable weapons and a cruel sense of humor ,   user: jane,   image_url:  https://upload. wikimedia. org/wikipedia/en/b/bd/Mars_attacks_ver1. jpg   } ])æœ€åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ¥åˆå§‹åŒ–æ•°æ®åº“äº†ï¼š $ rails db:create db:migrate db:seedç°åœ¨æˆ‘ä»¬å·²ç»å¾€è‡ªå·±çš„ç³»ç»Ÿé‡Œå¡å…¥äº†ä¸€äº›å†…å®¹ï¼Œé‚£å°±æ¥æ·»åŠ è®¿é—®å®ƒä»¬çš„æ–¹å¼å§ï¼ Adding a GraphQL endpoint: ä¸ºäº†â€œåˆ¶ä½œâ€æˆ‘ä»¬çš„ GraphQL APIï¼Œå°†ä½¿ç”¨graphql-ruby gemï¼š # First, add it to the Gemfile$ bundle add graphql --version= ~&gt; 1. 9 # Then, run the generator$ rails generate graphql:installä½ å¯èƒ½ä¼šæƒŠè®¶äºä¸€ä¸ªæœ€å°åŒ–çš„graphql-rubyåº”ç”¨ç¨‹åºæ‰€éœ€æ–‡ä»¶çš„æ•°é‡ï¼šå¦‚ä¸‹çš„æ ·æ¿å°±æ˜¯æˆ‘ä»¬ä¸ºä¸Šè¿°æ‰€æœ‰ç‰©å“æ‰€æ”¯ä»˜çš„ä»£ä»·ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ schemaï¼Œmartian_library_schema. rbï¼š # app/graphql/martian_library_schema. rbclass MartianLibrarySchema &lt; GraphQL::Schema query(Types::QueryType) mutation(Types::MutationType)endè¯¥ schema å®£å¸ƒäº†æ‰€æœ‰ query éƒ½åº”è¯¥åœ¨Types::QueryTypeï¼Œè€Œæ‰€æœ‰ mutation éƒ½åº”è¯¥åœ¨Types::MutationTypeã€‚æˆ‘ä»¬å°†åœ¨æœ¬ç³»åˆ—æ•™ç¨‹çš„ç¬¬äºŒéƒ¨åˆ†æ¥æ·±å…¥æ¢è®¨ mutationã€‚æœ¬æ–‡çš„ç›®æ ‡åˆ™æ˜¯å­¦ä¹ å¦‚ä½•ç¼–å†™å’Œæ‰§è¡Œ queryã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬æ‰“å¼€types/query_type. rb ç±»â€”â€”å®ƒæ˜¯æ‰€æœ‰ query çš„å…¥å£ã€‚é‡Œé¢æœ‰ä»€ä¹ˆå‘¢ï¼Ÿ # app/graphql/types/query_type. rbmodule Types class QueryType &lt; Types::BaseObject  # Add root-level fields here.   # They will be entry points for queries on your schema.   # TODO: remove me  field :test_field, String, null: false,   description:  An example field added by the generator   def test_field    Hello World!   end endendè¿™è¯æ˜äº†QueryTypeå°±æ˜¯ä¸€ä¸ªé€šç”¨ typeï¼šå…¶ç»§æ‰¿äºTypes::BaseObjectï¼ˆæˆ‘ä»¬ä¼šæŠŠå®ƒç”¨ä½œæ‰€æœ‰ type çš„åŸºæœ¬ç±»ï¼‰ï¼Œå¹¶ä¸”å®ƒæœ‰ field å®šä¹‰â€”â€”æˆ‘ä»¬æ•°æ®å›¾çš„èŠ‚ç‚¹ã€‚å”¯ä¸€ä½¿å¾—QueryTypeæœ‰æ‰€ä¸åŒçš„æ˜¯ GraphQL éœ€è¦è¿™ä¸ª type å¿…é¡»å­˜åœ¨ï¼ˆè€Œmutationå’Œsubscription ä¸¤ç§ type æ˜¯å¯é€‰è€Œéå¿…é¡»ï¼‰ã€‚ æ³¨æ„åˆ°ä¸Šé¢çš„ä»£ç å®é™…ä¸Šä»…æ˜¯ä¸€ä¸ªâ€hello worldâ€äº†å—ï¼Ÿåœ¨ç»§ç»­å¾€ä¸‹èµ°ä¹‹å‰ï¼ˆä¸”å¤§é‡çš„ä»£ç ä½¿ä½ åŒå€¦ï¼‰ï¼Œæˆ‘ä»¬ä¼šå‘ä½ å±•ç¤ºå¦‚ä½•åœ¨æµè§ˆå™¨ä¸­è·å–è¯¥â€œhello worldâ€çš„å†…å®¹ã€‚ è®©æˆ‘ä»¬æ¥çœ‹ä¸‹ç”Ÿæˆå™¨å·²ç»å¾€config/routes. rbä¸­æ·»åŠ äº†ä»€ä¹ˆï¼š # config/routes. rbRails. application. routes. draw do mount GraphiQL::Rails::Engine, at:  /graphiql , graphql_path:  /graphql  if Rails. env. development? post  /graphql , to:  graphql#execute endMount çš„GraphiQL::Rails::Engineè®©æˆ‘ä»¬èƒ½ä½¿ç”¨ä¸€ä¸ªç§°ä¸º GraphiQL çš„ web ç•Œé¢æ¥æµ‹è¯•è‡ªå·±çš„ query å’Œ mutationã€‚å¦‚å‰æ‰€è¿°ï¼Œschema æ˜¯å¯è¢«æ£€æŸ¥çš„ï¼Œè€Œ GraphiQL åˆ™ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ä¸ºæˆ‘ä»¬æ¥æ„å»ºäº¤äº’æ–‡æ¡£ã€‚æ¥è¯•ä¸€è¯•å§ï¼ # Let's run a Rails web server$ rails såœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ http://localhost:3000/graphiqlï¼š åœ¨å·¦ä¾§çª—å£ï¼Œä½ å¯ä»¥è¾“å…¥ä¸€ä¸ª query æ¥æ‰§è¡Œï¼Œç„¶åç‚¹å‡»â€œplayâ€æŒ‰é’®ï¼ˆæˆ–æŒ‰ä¸‹Ctrl/Cmd+Enterï¼‰ï¼Œå³å¯åœ¨å³ä¾§çª—å£çœ‹åˆ°å“åº”ç»“æœã€‚ç‚¹å‡»å³ä¸Šè§’çš„â€œDocsâ€é“¾æ¥ï¼Œä½ å°±å¯ä»¥æµè§ˆ schemaã€‚ æ¥çœ‹ä¸‹æ—¥å¿—â€”â€”æˆ‘ä»¬æƒ³è¦çŸ¥é“å½“æŒ‰ä¸‹æ‰§è¡ŒæŒ‰é’®æ—¶å‘ç”Ÿäº†ä»€ä¹ˆã€‚ è¯·æ±‚è¢«å‘é€åˆ°GraphlControllerï¼Œå…¶ä¹Ÿæ˜¯ç”±graphql gem çš„ç”Ÿæˆå™¨æ·»åŠ åˆ°åº”ç”¨ç¨‹åºçš„ã€‚ çœ‹ä¸€çœ¼GraphlController#executeæ–¹æ³•ï¼š # app/controllers/graphql_controller. rbdef execute variables = ensure_hash(params[:variables]) query = params[:query] operation_name = params[:operationName] context = {  # Query context goes here, for example:  # current_user: current_user, } result = GraphqlSchema. execute(  query,  variables: variables,  context: context,  operation_name: operation_name ) render json: resultrescue StandardError =&gt; e raise e unless Rails. env. development? handle_error_in_development eendè¯¥æ–¹æ³•è°ƒç”¨äº†GraphqlSchema#executeæ–¹æ³•ï¼Œä»¥å¦‚ä¸‹å‚æ•°ï¼š  queryå’Œvariablesåˆ†åˆ«ä»£è¡¨ä¸€ä¸ª query å­—ç¬¦ä¸²å’Œå®¢æˆ·ç«¯å‘é€çš„å‚æ•°ï¼› contextæ˜¯ä¸€ä¸ªä»»æ„ hashï¼Œåœ¨ query æ‰§è¡Œçš„ä»»ä½•åœ°æ–¹éƒ½æ˜¯å¯ç”¨çš„ï¼› operation_nameä»è¿›æ¥çš„è¯·æ±‚ä¸­å–å‡ºä¸€ä¸ªå‘½åæ“ä½œæ¥æ‰§è¡Œï¼ˆå¯ä»¥ä¸ºç©ºï¼‰ã€‚æ‰€æœ‰çš„é­”æ³•éƒ½å‘ç”Ÿåœ¨è¿™ä¸ªæ–¹æ³•å†…ï¼šå®ƒè§£æ queryï¼Œæ£€æµ‹æ‰€æœ‰å°†è¢«ç”¨æ¥æ„å»ºå“åº”çš„ typeï¼Œå¹¶å†³å®šæ‰€æœ‰è¢«è¯·æ±‚åˆ°çš„å­—æ®µã€‚æˆ‘ä»¬å”¯ä¸€éœ€è¦åšçš„äº‹å°±æ˜¯å®šä¹‰è¿™äº› typeï¼Œå¹¶å£°æ˜å­—æ®µåº”è¯¥è¢«æ€æ ·å†³å®šã€‚ Whatâ€™s in the Martian Library?: è®©æˆ‘ä»¬ä»â€œhello worldâ€è½¬åˆ°æ›´çœŸå®çš„ä¸œè¥¿ï¼šä»Types::QueryTypeç§»é™¤èŒƒä¾‹å†…å®¹å¹¶æ³¨å†Œä¸€ä¸ªç§°ä¸º:itemsçš„å­—æ®µï¼Œå…¶å°†è¿”å›æ‰€æœ‰å›¾ä¹¦é¦†çš„ itemsã€‚æˆ‘ä»¬ä¹Ÿéœ€è¦ä¸ºè¯¥å­—æ®µæ·»åŠ ä¸€ä¸ª resolver æ–¹æ³•ï¼ˆresolver æ–¹æ³•åå¿…é¡»åŒ¹é…å­—æ®µåï¼‰ï¼š # app/graphql/types/query_type. rbmodule Types class QueryType &lt; Types::BaseObject  field :items,     [Types::ItemType],     null: false,     description:  Returns a list of items in the martian library   def items   Item. all  end endendæ¯ä¸ªå­—æ®µå®šä¹‰éƒ½åŒ…å«ä¸€ä¸ªåç§°ï¼Œä¸€ä¸ªå…¶ç»“æœç±»å‹ï¼ŒåŠä¸€äº›é€‰é¡¹ã€‚:nullæ˜¯éœ€è¦çš„ï¼Œå¿…é¡»è®¾ä¸ºtrueæˆ–è€…falseã€‚æˆ‘ä»¬ä¹Ÿå®šä¹‰äº†å¯é€‰çš„:descriptionâ€”â€”ä¸ºå­—æ®µæ·»åŠ æ˜“äºé˜…è¯»çš„ä¿¡æ¯æ˜¯ä¸€ç§å¥½çš„å®è·µï¼šå®ƒä¼šè¢«è‡ªåŠ¨æ·»åŠ åˆ°æ–‡æ¡£ä¸­ï¼Œä¸ºå¼€å‘è€…æä¾›æ›´å¤šç›¸å…³ä¿¡æ¯ã€‚å¯¹äºç»“æœç±»å‹çš„æ•°ç»„è¡¨ç¤ºï¼Œ[Types::ItemType]ï¼Œæ„å‘³ç€å­—æ®µçš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¸”å…¶æ¯ä¸ªå…ƒç´ éƒ½å¿…é¡»æ˜¯Types::ItemTypeç±»å‹ã€‚ ä½†æˆ‘ä»¬è¿˜æ²¡æœ‰å®šä¹‰ItemTypeï¼Œå¯¹å§ï¼Ÿå¹¸è¿çš„æ˜¯ï¼Œgraphql gem ç»™äº†ä¸€ä¸ªæ–¹ä¾¿çš„ç”Ÿæˆå™¨ï¼š $ rails g graphql:object itemç°åœ¨æˆ‘ä»¬å°±å¯ä»¥ä¿®æ”¹æ–°åˆ›å»ºçš„app/graphql/types/item_type. rbä¸ºæƒ³è¦çš„æ ·å­äº†ã€‚ # app/graphql/types/item_type. rbmodule Types class ItemType &lt; Types::BaseObject  field :id, ID, null: false  field :title, String, null: false  field :description, String, null: true  field :image_url, String, null: true endendå¦‚ä¸Šæ‰€è§ï¼Œæˆ‘ä»¬åœ¨ItemTypeä¸­æš´éœ²äº†ä¸‰ä¸ªå­—æ®µï¼š  é null çš„å­—æ®µï¼Œidå’Œtitle å¯ä¸º null çš„å­—æ®µdescriptionæˆ‘ä»¬çš„æ‰§è¡Œå¼•æ“è§£æå†³å®šå­—æ®µæ—¶æ˜¯ä½¿ç”¨å¦‚ä¸‹ç®—æ³•ï¼ˆç•¥æœ‰ç®€åŒ–ï¼‰ï¼š  é¦–å…ˆï¼Œå®ƒåœ¨ type ç±»è‡ªèº«å†…æŸ¥æ‰¾åŒåå®šä¹‰çš„æ–¹æ³•ï¼ˆå¦‚åŒå‰é¢æˆ‘ä»¬åœ¨QueryTypeä¸­å¯¹itemsåšçš„ä¸€æ ·ï¼‰ï¼›æˆ‘ä»¬å¯ä»¥ä½¿ç”¨objectæ–¹æ³•æ¥è®¿é—®è¢«è§£æå†³å®šçš„å¯¹è±¡ã€‚ å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¿™æ ·å®šä¹‰çš„æ–¹æ³•ï¼Œå®ƒå°±å°è¯•åœ¨objectä¸Šå»è°ƒç”¨åŒåæ–¹æ³•ã€‚æˆ‘ä»¬åœ¨ type ç±»ä¸­æ²¡æœ‰å®šä¹‰ä»»ä½•æ–¹æ³•ï¼Œå› æ­¤å‡å®šåº•å±‚å®ç°äº†æ‰€æœ‰å­—æ®µçš„æ–¹æ³•ã€‚ å›åˆ°http://localhost:3000/graphiqlï¼Œæ‰§è¡Œå¦‚ä¸‹ queryï¼Œç¡®è®¤åœ¨å“åº”ä¸­è·å–åˆ°äº†æ‰€æœ‰ items çš„åˆ—è¡¨ï¼š { items {  id  title  description }}åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰æ·»åŠ ä»»ä½•ä½“ç° graph å¨åŠ›çš„åŠŸèƒ½â€”â€”å½“å‰çš„ graph æ·±åº¦åªæœ‰ä¸€å±‚ã€‚è®©æˆ‘ä»¬æ¥æ·»åŠ ä¸€ä¸ªéåˆå§‹èŠ‚ç‚¹åˆ°ItemTypeä¸Šï¼Œè®© graph å¤æ‚ä¸€ç‚¹ã€‚æ¯”å¦‚ï¼Œæ·»åŠ ä¸€ä¸ªuserå­—æ®µæ¥ä»£è¡¨ item çš„åˆ›å»ºè€…ï¼š # app/graphql/types/item_type. rbmodule Types class ItemType &lt; Types::BaseObject  # . . .   field :user, Types::UserType, null: false endendé‡å¤ä½¿ç”¨ç›¸åŒçš„ç”Ÿæˆå™¨æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ type ç±»ï¼š $ rails g graphql:object userè¿™ä¸€æ¬¡æˆ‘ä»¬è¿˜æƒ³è¦æ·»åŠ ä¸€ä¸ªè®¡ç®—å­—æ®µâ€”â€”full_nameï¼š # app/graphql/types/user_type. rbmodule Types class UserType &lt; Types::BaseObject  field :id, ID, null: false  field :email, String, null: false  field :full_name, String, null: false  def full_name   # `object` references the user instance   [object. first_name, object. last_name]. compact. join(   )  end endendä½¿ç”¨å¦‚ä¸‹ query æ¥è·Ÿ items ä¸€èµ·è·å– usersï¼š { items {  id  title  user {   id   email  } }}åˆ°è¿™ä¸€æ­¥æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠç›®å…‰ä»åç«¯ç§»åˆ°å‰ç«¯äº†ã€‚è®©æˆ‘ä»¬æ¥ä¸ºè¿™ä¸ª API æ„å»ºä¸€ä¸ªå®¢æˆ·ç«¯å§ï¼ Configuring the frontend application: æ­£å¦‚å·²ç»æåˆ°çš„ï¼Œæˆ‘ä»¬æ¨èä½ å®‰è£…Apollo æ¡†æ¶æ¥å¤„ç†å®¢æˆ·ç«¯çš„ GraphQLã€‚ è¦è®©ä¸€åˆ‡é¡ºåˆ©è¿è½¬ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…æ‰€æœ‰éœ€è¦çš„ä¾èµ–åº“ï¼š $ yarn add apollo-client apollo-cache-inmemory apollo-link-http apollo-link-error apollo-link graphql graphql-tag react-apolloæ¥çœ‹ä¸‹æ‰€å®‰è£…çš„ä¸€äº›åº“ï¼š  æˆ‘ä»¬ä½¿ç”¨graphql-tagæ„å»ºç¬¬ä¸€ä¸ª queryã€‚ apollo-clientæ˜¯ä¸€ä¸ªé€šç”¨çš„ã€ä¸æ¡†æ¶æ— å…³çš„åº“ï¼Œæ¥æ‰§è¡Œå¹¶ç¼“å­˜ GraphQL è¯·æ±‚ã€‚ apollo-cache-inmemoryæ˜¯ä¸€ä¸ª Apollo ç¼“å­˜çš„å­˜å‚¨å®ç°ã€‚ react-apolloåŒ…å«ä¸€å¥— React ç»„ä»¶æ¥å±•ç¤ºæ•°æ®ã€‚ apollo-linkä¸å…¶ä»– links ç»™apollo-clientçš„æ“ä½œï¼ˆä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æ›´å¤šç»†èŠ‚ï¼‰å®ç°äº†ä¸€ä¸ªä¸­é—´ä»¶æ¨¡å¼ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦ä¸ºå‰ç«¯åº”ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ªå…¥å£ã€‚ä»packsç›®å½•ç§»é™¤hello_react. jsxå¹¶æ·»åŠ index. jsï¼š $ rm app/javascript/packs/hello_react. jsx &amp;&amp; touch app/javascript/packs/index. jsä¸ºäº†è°ƒè¯•ç›®çš„ï¼ŒåŠ å…¥å¦‚ä¸‹å†…å®¹ï¼š // app/javascript/packs/index. jsconsole. log('ğŸ‘»');ç”Ÿæˆä¸€ä¸ªç”¨äºå‰ç«¯çš„ controllerï¼š $ rails g controller Library index --skip-routesæ›´æ–°app/views/library/index. html. erbä»¥åŒ…å« React æ ¹å…ƒç´ åŠä¸€ä¸ªåˆ° pack çš„javascript_pack_tagï¼š &lt;!-- app/views/library/index. html. erb --&gt;&lt;div id= root  /&gt;&lt;%= javascript_pack_tag 'index' %&gt;æœ€åï¼Œåœ¨config/routes. rbæ³¨å†Œä¸€ä¸ªæ–°çš„è·¯ç”±ï¼š # config/routes. rbroot 'library#index'é‡å¯ Rails serverï¼Œç¡®è®¤çœ‹åˆ°é‚£ä¸ª ğŸ‘» å‡ºç°åœ¨æµè§ˆå™¨çš„ console ä¸­ã€‚ Configuring Apollo: åˆ›å»ºä¸€ä¸ªæ–‡ä»¶æ¥å­˜å‚¨ Apollo çš„é…ç½®ï¼š $ mkdir -p app/javascript/utils &amp;&amp; touch app/javascript/utils/apollo. jsè¯¥æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æƒ³è¦é…ç½® Apollo åº”ç”¨çš„ä¸¤ä¸ªæ ¸å¿ƒä¸œè¥¿ï¼Œå®¢æˆ·ç«¯å’Œç¼“å­˜ï¼ˆæˆ–æ›´å‡†ç¡®åœ°è¯´ï¼Œæ˜¯åˆ›å»ºäºŒè€…çš„å‡½æ•°ï¼‰ï¼š // app/javascript/utils/apollo. js// clientimport { ApolloClient } from 'apollo-client';// cacheimport { InMemoryCache } from 'apollo-cache-inmemory';// linksimport { HttpLink } from 'apollo-link-http';import { onError } from 'apollo-link-error';import { ApolloLink, Observable } from 'apollo-link';export const createCache = () =&gt; { const cache = new InMemoryCache(); if (process. env. NODE_ENV === 'development') {  window. secretVariableToStoreCache = cache; } return cache;};è®©æˆ‘ä»¬èŠ±ä¸€ç‚¹æ—¶é—´æ¥çœ‹çœ‹ç¼“å­˜æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ æ¯ä¸ª query å“åº”ç»“æœéƒ½è¢«æ”¾åˆ°ç¼“å­˜ä¸­ï¼ˆç›¸åº”çš„è¯·æ±‚é€šå¸¸è¢«ç”¨åšç¼“å­˜çš„ keyï¼‰ã€‚åœ¨è¿›è¡Œè¯·æ±‚ä¹‹å‰ï¼Œapollo-clientç¡®ä¿å“åº”ç»“æœè¿˜æœªè¢«ç¼“å­˜ï¼Œè€Œå¦‚æœå…¶å·²è¢«ç¼“å­˜â€”â€”è¯·æ±‚å°±ä¸ä¼šè¢«æ‰§è¡Œã€‚è¯¥è¡Œä¸ºæ˜¯å¯é…ç½®åŒ–çš„ï¼šæ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæŸä¸€ä¸ªç‰¹åˆ«è¯·æ±‚å…³é—­ç¼“å­˜ï¼Œæˆ–è€…è®©å®¢æˆ·ç«¯æŸ¥æ‰¾ä¸€ä¸ªä¸åŒçš„ query çš„ç¼“å­˜æ•°æ®ã€‚ å…³äºç¼“å­˜æœºåˆ¶ï¼Œå¯¹æœ¬æ•™ç¨‹è€Œè¨€ï¼Œä¸€ä¸ªæˆ‘ä»¬éœ€è¦äº†è§£çš„é‡è¦äº‹æƒ…æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç¼“å­˜çš„ key æ˜¯idå’Œ__typenameçš„ç»„åˆä¸²ã€‚å› æ­¤ï¼Œè·å–åŒæ ·å¯¹è±¡ä¸¤æ¬¡ä¹Ÿåªä¼šå¯¼è‡´ä¸€ä¸ªè¯·æ±‚ã€‚ å›åˆ°ä»£ç ä¸Šæ¥ã€‚ç”±äºæˆ‘ä»¬ä½¿ç”¨ HTTP POST ä½œä¸ºä¼ è¾“ï¼Œæ‰€ä»¥éœ€è¦é™„å¸¦ä¸€ä¸ªé€‚å½“çš„ CSRF token åˆ°æ¯ä¸ªè¯·æ±‚ä¸Šä»¥é€šè¿‡ Rails ä¸­çš„ forgery protection checkã€‚æˆ‘ä»¬å¯ä»¥ä»meta[name= csrf-token ]æ‹¿åˆ°å®ƒï¼ˆå…¶æ˜¯é€šè¿‡&lt;%= csrf_meta_tags %&gt;ç”Ÿæˆçš„ï¼‰ï¼š // app/javascript/utils/apollo. js// . . . // getToken from meta tagsconst getToken = () =&gt; document. querySelector('meta[name= csrf-token ]'). getAttribute('content');const token = getToken();const setTokenForOperation = async operation =&gt; operation. setContext({  headers: {   'X-CSRF-Token': token,  }, });// link with tokenconst createLinkWithToken = () =&gt; new ApolloLink(  (operation, forward) =&gt;   new Observable(observer =&gt; {    let handle;    Promise. resolve(operation)     . then(setTokenForOperation)     . then(() =&gt; {      handle = forward(operation). subscribe({       next: observer. next. bind(observer),       error: observer. error. bind(observer),       complete: observer. complete. bind(observer),      });     })     . catch(observer. error. bind(observer));    return () =&gt; {     if (handle) handle. unsubscribe();    };   }) );æ¥çœ‹ä¸‹æˆ‘ä»¬å¦‚ä½•è®°å½•é”™è¯¯æ—¥å¿—ï¼š // app/javascript/utils/apollo. js//. . . // log erorsconst logError = (error) =&gt; console. error(error);// create error linkconst createErrorLink = () =&gt; onError(({ graphQLErrors, networkError, operation }) =&gt; { if (graphQLErrors) {  logError('GraphQL - Error', {   errors: graphQLErrors,   operationName: operation. operationName,   variables: operation. variables,  }); } if (networkError) {  logError('GraphQL - NetworkError', networkError); }})ç”Ÿäº§ç¯å¢ƒä¸Šï¼Œæ›´å¥½çš„åšæ³•æ˜¯ä½¿ç”¨å¼‚å¸¸è¿½è¸ªæœåŠ¡ï¼ˆexception tracking serviceï¼‰ï¼ˆæ¯”å¦‚ï¼ŒSentry æˆ–è€… Honeybadgerï¼‰ï¼šåªç”¨è¦†ç›–logErrorå‡½æ•°æŠŠé”™è¯¯å‘é€åˆ°å¤–éƒ¨ç³»ç»Ÿå³å¯ã€‚ æ›™å…‰åœ¨å‰äº†â€”â€”è®©æˆ‘ä»¬æŠŠå…¥å£å‘ŠçŸ¥å®¢æˆ·ç«¯ä»¥è¿›è¡ŒæŸ¥è¯¢ï¼š // app/javascript/utils/apollo. js//. . . // http linkconst createHttpLink = () =&gt; new HttpLink({ uri: '/graphql', credentials: 'include',})æœ€åï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»º Apollo å®¢æˆ·ç«¯çš„å®ä¾‹äº†ï¼š // app/javascript/utils/apollo. js//. . . export const createClient = (cache, requestLink) =&gt; { return new ApolloClient({  link: ApolloLink. from([   createErrorLink(),   createLinkWithToken(),   createHttpLink(),  ]),  cache, });};The very first query: æˆ‘ä»¬å°†ä½¿ç”¨provider patternæ¥æŠŠå®¢æˆ·ç«¯å®ä¾‹ä¼ ç»™ React ç»„ä»¶ï¼š $ mkdir -p app/javascript/components/Provider &amp;&amp; touch app/javascript/components/Provider/index. jsè¿™æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡ä½¿ç”¨react-apolloçš„ApolloProviderç»„ä»¶ï¼š // app/javascript/components/Provider/index. jsimport React from 'react';import { ApolloProvider } from 'react-apollo';import { createCache, createClient } from '. . /. . /utils/apollo';export default ({ children }) =&gt; ( &lt;ApolloProvider client={createClient(createCache())}&gt;  {children} &lt;/ApolloProvider&gt;);ä¿®æ”¹index. jsä»¥ä½¿ç”¨æ–°åˆ›å»ºçš„ providerï¼š // app/javascript/packs/index. jsimport React from 'react';import { render } from 'react-dom';import Provider from '. . /components/Provider';render(&lt;Provider&gt;ğŸ‘»&lt;/Provider&gt;, document. querySelector('#root'));å¦‚æœä½ ä½¿ç”¨äº†Webpacker v3ï¼Œåˆ™éœ€è¦å¯¼å…¥babel-polyfillä»¥ç”¨ä¸Šè¯¸å¦‚ async/awaitç­‰å¾ˆé…·çš„ JavaScript ç‰¹æ€§ã€‚ä¸ç”¨æ‹…å¿ƒ polyfill çš„å¤§å°ã€‚babel-preset-envä¼šå¸®ä½ ç§»é™¤æ‰æ‰€ä¸éœ€è¦çš„ä¸€èµ·ã€‚ æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªLibraryç»„ä»¶ï¼Œåœ¨é¡µé¢ä¸Šå±•ç¤º items çš„åˆ—è¡¨ï¼š $ mkdir -p app/javascript/components/Library &amp;&amp; touch app/javascript/components/Library/index. jsæˆ‘ä»¬ä¼šä½¿ç”¨react-apolloçš„Queryç»„ä»¶ï¼Œæ¥æ”¶queryå­—ç¬¦ä¸²ä½œä¸º property ä»¥è·å–æ‰€ mount çš„æ•°æ®ï¼š // app/javascript/components/Library/index. jsimport React from 'react';import { Query } from 'react-apollo';import gql from 'graphql-tag';const LibraryQuery = gql` {  items {   id   title   user {    email   }  } }`;export default () =&gt; ( &lt;Query query={LibraryQuery}&gt;  {({ data, loading }) =&gt; (   &lt;div&gt;    {loading     ? 'loading. . . '     : data. items. map(({ title, id, user }) =&gt; (       &lt;div key={id}&gt;        &lt;b&gt;{title}&lt;/b&gt; {user ? `added by ${user. email}` : null}       &lt;/div&gt;      ))}   &lt;/div&gt;  )} &lt;/Query&gt;);æˆ‘ä»¬å¯ä»¥é€šè¿‡ç›¸åº”çš„loadingå’Œdata property åˆ†åˆ«è®¿é—®è½½å…¥çŠ¶æ€å’Œå·²åŠ è½½æ•°æ®ï¼ˆä½¿ç”¨æ‰€è°“çš„render-props æ¨¡å¼ä¼ é€’ï¼‰ã€‚ åˆ«å¿˜äº†æŠŠç»„ä»¶æ·»åŠ åˆ°ä¸»é¡µé¢ä¸Šï¼š // app/javascript/packs/index. jsimport React from 'react';import { render } from 'react-dom';import Provider from '. . /components/Provider';import Library from '. . /components/Library';render( &lt;Provider&gt;  &lt;Library /&gt; &lt;/Provider&gt;, document. querySelector('#root'));å¦‚æœä½ åˆ·æ–°é¡µé¢ï¼Œå°†ä¼šçœ‹åˆ° items åˆ—è¡¨ï¼Œä»¥åŠæ·»åŠ å®ƒä»¬çš„ç”¨æˆ·çš„ emailï¼š ç¥è´ºä½ ï¼ä½ åˆšåˆšè¿ˆå‡ºäº†é€šå‘ GraphQL çš„ç¬¬ä¸€æ­¥ã€‚å¾ˆæ£’ï¼ â€¦And the very first problem: ä¸€åˆ‡çœ‹èµ·æ¥éƒ½å·¥ä½œå¾—å¾ˆå¥½ï¼Œä½†æ¥çœ‹ä¸€çœ¼æˆ‘ä»¬çš„æœåŠ¡ç«¯æ—¥å¿—ï¼š SQL æŸ¥è¯¢SELECT * FROM users WHERE id = ?è¢«æ‰§è¡Œäº†å››æ¬¡ï¼Œæ„å‘³ç€æˆ‘ä»¬æ’ä¸Šäº†è‘—åçš„ N+1 é—®é¢˜â€”â€”æœåŠ¡ç«¯å¯¹é›†åˆä¸­çš„æ¯ä¸ª item éƒ½è¿›è¡Œäº†ä¸€æ¬¡æŸ¥è¯¢ï¼Œä»¥è·å–ç›¸åº”çš„ç”¨æˆ·ä¿¡æ¯ã€‚ åœ¨ä¿®å¤è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿è¿›è¡Œä»£ç è°ƒæ•´æ˜¯å®‰å…¨çš„ï¼Œä¸ä¼šæåä»»ä½•ä¸œè¥¿â€”â€”æ‰€ä»¥ï¼Œæ¥å†™æµ‹è¯•å§ï¼Œå°‘å¹´ï¼ Writing some specs: ç°åœ¨è¯¥æ¥å®‰è£…é…ç½® RSpec äº†ï¼Œæ›´å‡†ç¡®åœ°è¯´ï¼Œæ˜¯rspec-rails gemï¼š # Add gem to the Gemfile$ bundle add rspec-rails --version= 4. 0. 0. beta2  --group= development,test # Generate the initial configuration$ rails generate rspec:installä¸ºäº†æ˜“äºç”Ÿæˆæµ‹è¯•æ•°æ®ï¼Œä¹Ÿå®‰è£…ä¸Š factory_botï¼š $ bundle add factory_bot_rails --version= ~&gt; 5. 0  --group= development,test ä¸ºäº†è®© factory æ–¹æ³•ï¼ˆcreateï¼Œbuildç­‰ï¼‰åœ¨æµ‹è¯•ä¸­å…¨å±€å¯è§ï¼Œæ·»åŠ config. include FactoryBot::Syntax::Methodsåˆ°rails_helper. rbä¸­ã€‚ ç”±äºæˆ‘ä»¬åœ¨æ·»åŠ  Factory Bot ä¹‹å‰å°±åˆ›å»ºäº† modelï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—æ‰‹åŠ¨ç”Ÿæˆ factoryã€‚å•ç‹¬åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œspec/factories. rbï¼Œå¦‚ä¸‹ï¼š # spec/factories. rbFactoryBot. define do factory :user do  # Use sequence to make sure that the value is unique  sequence(:email) { |n|  user-#{n}@example. com  } end factory :item do  sequence(:title) { |n|  item-#{n}  }  user endendç°åœ¨å·²ç»å‡†å¤‡å¥½å†™æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæµ‹è¯•äº†ã€‚æ¥ä¸ºQueryTypeåˆ›å»ºä¸€ä¸ª spec æ–‡ä»¶ï¼š $ mkdir -p spec/graphql/types$ touch spec/graphql/types/query_type_spec. rbæœ€ç®€å•çš„ query æµ‹è¯•ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š # spec/graphql/types/query_type_spec. rbrequire  rails_helper RSpec. describe Types::QueryType do describe  items  do  let!(:items) { create_pair(:item) }  let(:query) do   %(query {    items {     title    }   })  end  subject(:result) do   MartianLibrarySchema. execute(query). as_json  end  it  returns all items  do   expect(result. dig( data ,  items )). to match_array(    items. map { |item| {  title  =&gt; item. title } }   )  end endendé¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºåœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€å¯¹ itemsã€‚ç„¶åï¼Œå®šä¹‰äº†è¦è¢«æµ‹è¯•çš„ query å’Œsubjectï¼ˆresultï¼‰ï¼Œåè€…é€šè¿‡è°ƒç”¨MartianLibrarySchema. executeæ–¹æ³•æ‰€å¾—åˆ°ã€‚è¿˜è®°å¾—æˆ‘ä»¬åœ¨GraphqlController#executeé‚£é‡Œæœ‰ä¸€è¡Œç±»ä¼¼çš„ä»£ç å—ï¼Ÿ è¿™ä¸ªç”¨ä¾‹éå¸¸ç®€å•ï¼šæˆ‘ä»¬å¯¹executeçš„è°ƒç”¨æ—¢æ²¡æœ‰ä¼ é€’variablesä¹Ÿæ²¡æœ‰ä¼ é€’contextï¼Œå½“ç„¶ï¼Œæœ‰éœ€è¦çš„æ—¶å€™æˆ‘ä»¬æ˜¾ç„¶å¯ä»¥è¿™ä¹ˆåšã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬å°±æœ‰è¶³å¤Ÿè‡ªä¿¡æ¥ä¿®å¤ä¸Šé¢çš„ N+1 é—®é¢˜äº†ï¼ GraphQL vs. N+1 problem: æœ€ç®€å•çš„é¿å… N+1 é—®é¢˜çš„æ–¹å¼æ˜¯ä½¿ç”¨ eager loadingã€‚æˆ‘ä»¬è¿™é‡Œï¼Œéœ€è¦åœ¨è¿›è¡ŒæŸ¥è¯¢ä»¥è·å–QueryTypeä¸­çš„ items æ—¶é¢„åŠ è½½ç”¨æˆ·ï¼š # /app/graphql/types/query_type. rbmodule Types class QueryType &lt; Types::BaseObject  # . . .   def items   Item. preload(:user)  end endendè¿™ä¸ªæ–¹æ¡ˆåœ¨ç®€å•çš„åœºæ™¯ä¸‹æ˜¯æœ‰ç”¨çš„ï¼Œä½†å¹¶éååˆ†é«˜æ•ˆï¼šæ¯”å¦‚ï¼Œå¦‚ä¸‹ä»£ç ä¹Ÿä¼šé¢„åŠ è½½ç”¨æˆ·ï¼Œå³ä½¿å®¢æˆ·ç«¯ä¸éœ€è¦å®ƒä»¬æ—¶ï¼š items { title}è¦è®¨è®ºè§£å†³ N+1 é—®é¢˜çš„å…¶ä»–æ–¹å¼ï¼Œå€¼å¾—å•ç‹¬å†™ä¸€ç¯‡æ–‡ç« ï¼Œå·²ç»è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒç•´ã€‚ å¤§å¤šæ•°è§£å†³æ–¹æ¡ˆéƒ½ä¸å¤–ä¹ä»¥ä¸‹ä¸¤ç§ï¼š  lazy eager loadingï¼ˆæ¯”å¦‚ï¼Œä½¿ç”¨ ar_lazy_preload gemï¼‰ batch loadingï¼ˆæ¯”å¦‚ï¼Œä½¿ç”¨ graphql-batch gemï¼‰æœ¬æ–‡å°±åˆ°è¿™å„¿äº†ï¼æˆ‘ä»¬å­¦ä¹ äº†å…³äº GraphQL çš„å¾ˆå¤šä¸œè¥¿ï¼Œå®Œæˆäº†é…ç½®åç«¯å’Œå‰ç«¯åº”ç”¨ç¨‹åºçš„å¸¸è§„å·¥ä½œï¼Œè¿›è¡Œäº†ç¬¬ä¸€ä¸ªæŸ¥è¯¢ï¼Œç”šè‡³è¿˜å‘ç°å¹¶ä¿®å¤äº†ç¬¬ä¸€ä¸ª bugã€‚è€Œè¿™åªæ˜¯æˆ‘ä»¬æ—…ç¨‹ä¸­å¾®å°çš„ä¸€æ­¥ï¼ˆå°½ç®¡æ–‡ç« çš„ç¯‡å¹…å¹¶ä¸å¾®å°ï¼‰ã€‚æˆ‘ä»¬ä¼šå¾ˆå¿«å›æ¥çš„ï¼Œå±Šæ—¶å°†æ¨å‡ºå¦‚ä½•ä½¿ç”¨ GraphQL çš„ mutation æ¥æ“ä½œæ•°æ®ï¼Œä»¥åŠ subscription æ¥ä½¿æ•°æ®ä¿æŒæœ€æ–°çš„å†…å®¹ã€‚æ•¬è¯·å…³æ³¨ï¼ "
    }, {
    "id": 28,
    "url": "/2020/11/auto-run-mongodb-docker-in-replica-mode-update/",
    "title": "è‡ªåŠ¨è¿è¡ŒMongoDB Dockerä¸ºReplicaæ¨¡å¼ï¼ˆæ–°ï¼‰",
    "body": "2020/11/10 - åœ¨å‰ä¸€ç¯‡åšå®¢ã€Šè‡ªåŠ¨è¿è¡ŒMongoDB Dockerä¸ºReplicaæ¨¡å¼ã€‹ä¸­ï¼Œæåˆ°äº†å¦‚ä½•è‡ªåŠ¨å®ç°è®© MongoDB åœ¨ docker ä¸­ä»¥ Replica æ¨¡å¼è¿è¡Œçš„åšæ³•ã€‚ä½†æœ€è¿‘å‘ç°ï¼Œå½“æ—¶çš„åšæ³•æ˜¯æœ‰ç‚¹é—®é¢˜çš„â€”â€”å¦‚æœè·Ÿå…¶ä»– docker é•œåƒç”¨docker-composeæ­æˆç¯å¢ƒåï¼Œå…¶ä»–çš„ docker å®¹å™¨æ— æ³•æ­£å¸¸è¿æ¥åˆ°è¯¥ MongoDB ä½¿ç”¨ã€‚ ç»è¿‡ä¸€ç•ªæŸ¥è¯¢ï¼Œé—®é¢˜åŸå› å¾ˆç®€å•ã€‚å¤§æ¦‚æ˜¯ç”±äºdocker-compose åœ¨å¯åŠ¨æ‰€æœ‰ docker å®¹å™¨æ—¶ï¼Œæ„å»ºè‡ªèº«æ•´ä½“çš„ Network éœ€è¦ä¸€å®šæ—¶é—´ï¼Œè€Œ MongoDB çš„ Replica è®¾ç½®æ˜¯ç«‹å³è¯»å–ç”Ÿæ•ˆçš„ï¼Œæ‰€ä»¥ MongoDB åœ¨è¢«å¯åŠ¨æ—¶è¿˜ä¸èƒ½æ­£ç¡®è¯»å–åˆ° Network çš„ç¯å¢ƒé…ç½®ï¼Œä»è€Œé€ æˆå…¶ä»–å®¹å™¨æ— æ³•è¿æ¥åˆ°å®ƒã€‚ æœ€åï¼Œæ˜¯é€šè¿‡ä¸€ç§æ¯”è¾ƒå–å·§çš„æ–¹æ³•æ¥ç»•è¿‡äº†è¿™ä¸ªé—®é¢˜ã€‚å³è®© MongoDB å¯åŠ¨åä¸æ–­æ£€æµ‹å…¶ Network ç¯å¢ƒæ˜¯å¦å·²ç»æ­£ç¡®ï¼Œç›´åˆ°å½“å…¶å‡†å¤‡å¥½ä¸ºæ­¢ï¼Œè¿™æ—¶å†è‡ªåŠ¨è§¦å‘è¿è¡Œ Replica æ¨¡å¼çš„ MongoDBï¼Œå°±å¯ä»¥æä¾›æ­£å¸¸çš„æœåŠ¡è¿æ¥äº†ã€‚ ç›¸å…³çš„Dockerfileé…ç½®æ–‡ä»¶å’Œè„šæœ¬å¦‚ä¸‹ï¼š Dockerfile: ARG MONGODB_VERSIONFROM mongo:$MONGODB_VERSIONRUN apt-get update -qq &amp;&amp; apt-get install -yq netcatADD init_replicaset. js /docker-entrypoint-initdb. d/init_replicaset. jsADD resolve_replicaset_host. sh /root/resolve_replicaset_host. shADD https://raw. githubusercontent. com/vishnubob/wait-for-it/master/wait-for-it. sh /usr/local/bin/wait-for-itRUN chmod +x /usr/local/bin/wait-for-itCMD bash -c  mongod --replSet mongoreplset --bind_ip_all &amp;&amp; wait-for-it -t 0 mongo:27017 -- /root/resolve_replicaset_host. sh init_replicaset. js: rs. initiate({'_id':'mongoreplset', members: [{'_id':0, 'host':'127. 0. 0. 1:27017'}]});resolve_replicaset_host. sh: #!/bin/bashmongo --eval  rs. initiate({'_id':'mongoreplset','members':[{'_id':0,'host':'mongo:27017'}]}) è¿™é‡Œç”¨åˆ°äº† https://raw. githubusercontent. com/vishnubob/wait-for-it/master/wait-for-it. sh è¿™ä¸ªå·¥å…·ï¼Œç”¨æ¥ä¸æ–­æµ‹è¯•è¿æ¥mongo:27017æ˜¯å¦å°±ç»ªï¼Œå¦‚æœå¯ä»¥æ­£ç¡®è¿æ¥ï¼Œå°±ä¼šè‡ªåŠ¨è¿è¡Œ/root/resolve_replicaset_host. shè¿™ä¸ªè„šæœ¬ï¼Œè®¾ç½® MongoDB ä»¥ Replica æ¨¡å¼è¿è¡Œèµ·æ¥ã€‚ å½“ç„¶ï¼Œè¿˜æœ‰æœ€åå’Œæœ€é‡è¦çš„ä¸€æ­¥ï¼š ä¿®æ”¹/etc/hostsï¼Œæ·»åŠ å¦‚ä¸‹ä¸€è¡Œ 127. 0. 0. 1 mongoæœ€ç»ˆæµ‹è¯•ç»“æœä¸€åˆ‡å·¥ä½œæ­£å¸¸ã€‚å®Œç¾ï¼ "
    }, {
    "id": 29,
    "url": "/2020/10/squash-n-plus-one-queries-in-rails/",
    "title": "åœ¨Railsä¸­å°½æ—©ç¢¾ç¢N+1æŸ¥è¯¢",
    "body": "2020/10/31 - æœ¬æ–‡å·²è·å¾—åŸä½œè€…ï¼ˆVladimir Dementyevï¼‰å’Œ Evil Martians æˆæƒè®¸å¯è¿›è¡Œç¿»è¯‘ã€‚åŸæ–‡ä»‹ç»äº† å¯¹äº Rails ä¸­ç»å…¸çš„ N+1 é—®é¢˜ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨çš„ Bullet çš„å±€é™æ€§ï¼Œä»¥åŠå¦‚ä½•è¿ç”¨ n_plus_one_control ä»¥æµ‹è¯•çš„æ–¹å¼æ¥å°½æ—©å‘ç° N+1 æŸ¥è¯¢ã€‚  åŸæ–‡é“¾æ¥ï¼šSquash N+1 queries early with n_plus_one_control test matchers for Ruby and Rails ä½œè€…ï¼šVladimir Dementyev ç«™ç‚¹ï¼šEvil Martians â€”â€”ä½äºçº½çº¦å’Œä¿„ç½—æ–¯çš„ Ruby on Rails å¼€å‘äººå‘˜åšå®¢ã€‚ å®ƒå‘å¸ƒäº†è®¸å¤šä¼˜ç§€çš„æ–‡ç« ï¼Œå¹¶ä¸”æ˜¯ä¸å°‘ gem çš„èµåŠ©å•†ã€‚ã€æ­£æ–‡å¦‚ä¸‹ã€‘ å¼•è¨€: å‘ç°ä¸€ç§é¢å‘æµ‹è¯•çš„æ›¿ä»£æ–¹æ¡ˆï¼Œåœ¨å¼€å‘ä¸­çš„å†—ä½™æ•°æ®åº“è°ƒç”¨ä¹‹å‰ï¼Œå°±æ£€æµ‹ä½ çš„ Rails å’Œçº¯ Ruby åº”ç”¨ç¨‹åºä¸­çš„ N+1 æŸ¥è¯¢é—®é¢˜ã€‚n_plus_one_control gem çš„å·¥ä½œæ–¹å¼ä¸ Bullet ç­‰ä¼—æ‰€å‘¨çŸ¥çš„å·¥å…·ä¸åŒï¼Œèƒ½ç¡®ä¿é¢å¤–çš„ SQL æŸ¥è¯¢æ°¸è¿œä¸è¢«å¿½ç•¥ï¼Œä¸”ä¸ä½ å¯¹ ORM å·¥å…·çš„é€‰æ‹©æ— å…³ã€‚ æˆ‘å‡å®šæœ¬æ–‡è¯»è€…æ˜¯äº†è§£ N+1 æŸ¥è¯¢é—®é¢˜çš„ã€‚å¦‚æœä¸æ˜¯ï¼Œå¯ä»æˆ‘ä»¬çš„ä¸€ç¯‡ä»‹ç»æ–‡ç« å¼€å§‹ï¼Œè¯¥æ–‡å±•ç¤ºäº† Evil Martians æ›´æ—©å¼€å‘çš„å¦ä¸€ä¸ªæµ‹è¯•å·¥å…·ã€‚ æ¯ä¸ªä½¿ç”¨ ORMï¼ˆå¦‚ Active Recordï¼‰ä¸æ•°æ®åº“è¿›è¡Œå·¥ä½œçš„åç«¯ Ruby å¼€å‘è€…éƒ½çŸ¥é“ï¼šéœ€è¦å°å¿ƒä½ çš„æ•°æ®åº“æŸ¥è¯¢ï¼Œä»¥å…ç”Ÿæˆå¤ªå¤š Queryã€‚å³ä½¿ N+1 é—®é¢˜ä¼—æ‰€å‘¨çŸ¥ï¼Œä½†æˆ‘ä»¬ä»ç„¶ä¸å¯èƒ½æ¯æ¬¡éƒ½æ¯” ORM èªæ˜ï¼šå³æˆ‘ä»¬éœ€è¦ä¸€ç§è‡ªåŠ¨åŒ–æ–¹å¼æ¥æŒ‡æ˜é—®é¢˜ã€‚ åœ¨è¿‡å»ä¸‰å¹´ï¼Œæˆ‘ä¸€ç›´ä½¿ç”¨è‡ªå·±çš„å°å·¥å…·å°½å¯èƒ½åœ¨æ›´æ—©çš„åœºåˆä¸‹å°±æ£€æµ‹åˆ° N+1 é—®é¢˜ï¼šåœ¨è¿è¡Œ RSpec æˆ– Minitest çš„æ—¶å€™ã€‚æˆ‘çš„ n_plus_one_control gem ä¸€ç›´åœ¨ç¼“æ…¢åœ°é€æ­¥å®Œå–„ï¼Œæœ€è¿‘æ¥åˆ°äº† 0. 5. 0 ç‰ˆæœ¬ï¼Œå› æ­¤æˆ‘è§‰å¾—æ˜¯æ—¶å€™å‘å„ä½å±•ç¤ºå®ƒï¼Œä»¥åŠæˆ‘çš„è§£å†³æ–¹æ¡ˆä¸å…¶ä»–å¸¸è§å·¥å…·çš„ä¸åŒä¹‹å¤„äº†ã€‚ Biting the bullet: ä½ å¯èƒ½æƒ³çŸ¥é“å·²ç»æœ‰äº† Bullet gem ä¸ºä»€ä¹ˆæˆ‘è¿˜è¦åˆ›å»ºå¦ä¸€ä¸ªåº“æ¥æ£€æµ‹ N+1 é—®é¢˜å‘¢ï¼Ÿè®©æˆ‘æ¥åˆ†äº«ä¸€ä¸ªå°æ•…äº‹ã€‚ æˆ‘å·²ä½¿ç”¨ Bullet è®¸å¤šå¹´äº†ï¼šé¦–å…ˆï¼Œæ˜¯åœ¨å¼€å‘ç¯å¢ƒå’Œ staging ç¯å¢ƒä¸­ï¼Œåƒæˆ‘ä»¬å¤§å¤šæ•°äººä¸€æ ·ã€‚ä½†åœ¨æŸä¸ªæ—¶å€™ï¼Œæˆ‘æ„è¯†åˆ°æµ‹è¯•ç¯å¢ƒæ›´é€‚åˆç”¨æ¥æ£€æµ‹å’Œé˜²æ­¢ N+1 é—®é¢˜ã€‚é€šè¿‡ä¸€äº›å°ä¿®å°è¡¥ï¼Œè®© Bullet åœ¨æµ‹è¯•ç¯å¢ƒä¸‹å·¥ä½œèµ·æ¥æ˜¯å¯è¡Œçš„ã€‚å¦‚ä¸‹ä»£ç ç¤ºä¾‹åˆ›å»ºäº†ä¸€ä¸ªå¯ç”¨äº spec çš„bulletifyå¸®åŠ©æ–¹æ³•ã€‚ # spec/shared_contexts/bulletify. rbRSpec. shared_context  bullet  do before(:each) do  Bullet. enable = true  Bullet. bullet_logger = true  Bullet. raise = true # raise an error if N+1 query occurs  Bullet. start_request end after(:each) do  Bullet. perform_out_of_channel_notifications if Bullet. notification?  Bullet. end_request  Bullet. enable = false  Bullet. bullet_logger = false  Bullet. raise = false endendRSpec. configure do |config| config. include_context  bullet , bullet: true config. alias_example_to :bulletify, bullet: trueend# spec/controllers/my_controller_spec. rbcontext  N+1  do bulletify { get :index }endç„¶è€Œåœ¨å¤šä¸ªæˆç†Ÿçš„ Rails åº”ç”¨ç¨‹åºçš„å·¥ä½œä¸­ï¼Œæˆ‘å‘ç°å½“æ•°æ®åº“äº¤äº’è¶…è¶Š Active Record åŠå…¶å…³è”å…³ç³»æ—¶ï¼ŒBullet å¹¶ä¸èƒ½å‘ç°é—®é¢˜ã€‚False positives ä¹Ÿæ˜¯ç›¸å½“çš„å¸¸è§ã€‚ è¿™æœ‰ä¸€ä¸ªèŒƒä¾‹ï¼Œä½¿ç”¨äº†ä¸Šé¢çš„bulletifyæ–¹æ³•ï¼š # user. rbclass User &lt; ApplicationRecord has_many :teams def supports?(team_name)  teams. where(name: team_name). exists? endend&lt;!-- users/index. html. erb --&gt;&lt;% @users. each do |user| %&gt; &lt;li class= &lt;%= user. supports?( FC Spartak Moscow ) &amp;&amp;  red-white  %&gt; &gt;  &lt;%= user. name %&gt; &lt;/li&gt;&lt;% end %&gt;# users_controller_spec. rbdescribe  GET #index  do render_views let!(:users) { create_pair(:user, :with_teams) } bulletify { get :index }endå³ä½¿æˆ‘ä»¬åœ¨è¿™å„¿æ˜æ˜¾æœ‰äº† N+1 æŸ¥è¯¢ï¼ˆæ¥è‡ªäº#supports?æ–¹æ³•ï¼‰ï¼Œæµ‹è¯•å´ä»ç„¶æ˜¯ç»¿è‰²é€šè¿‡çš„ã€‚ Running and counting: æˆ‘å°±å¼€å§‹è€ƒè™‘ä¸€ç§æ£€æµ‹ N+1 æŸ¥è¯¢çš„æ›´å¥å£®çš„æ–¹å¼ï¼Œä¸ Active Record å†…éƒ¨æ— å…³çš„æ–¹å¼ã€‚ è€Œæœ€ç»ˆæˆ‘æ‰¾åˆ°äº†è¿™æ ·çš„æ€è·¯ï¼šå¦‚æœæˆ‘ä»¬è¿è¡ŒåŒæ ·çš„ä»£ç ä¸¤æ¬¡ï¼Œä»¥ä¸åŒæ•°é‡çš„æ•°æ®åº“è®°å½•ï¼Œå¹¶æ¯”è¾ƒæ‰€æ‰§è¡Œ SQL æŸ¥è¯¢çš„æ¬¡æ•°å‘¢ï¼Ÿ å¦‚æœè¿™ä¸ªæ•°å­—ä¸ä¾èµ–äºæµ‹è¯•é›†çš„å¤§å°ï¼Œæˆ‘ä»¬ä¾¿æ²¡æœ‰ï¼ˆN+1ï¼‰é—®é¢˜ã€‚å¦åˆ™ï¼Œçœ‹èµ·æ¥å°±æ˜¯æœ‰ä¸€ä¸ª XN+Y äº†ã€‚ è¿™ä¸ªæƒ³æ³•åœ¨ n_plus_one_control gem ä¸­å¾—ä»¥å®ç°ï¼Œå®ƒä¸ºä½ æ‰€é€‰æ‹©çš„ Ruby æµ‹è¯•æ¡†æ¶æ·»åŠ  N+1 æ£€æµ‹çš„ DSLã€‚ä¸‹é¢æ˜¯ RSpec çš„ç¤ºä¾‹ï¼š context  N+1 , :n_plus_one do # Populate block is called multiple times # with different values of n (2 and 3 by default) populate { |n| create_list(:user, n, :with_teams) } specify do  # The example body is executed  #after each `populate` call  expect { get :index }. to perform_constant_number_of_queries endendè€Œæµ‹è¯•å°†ä»¥å¦‚ä¸‹æ¶ˆæ¯æŠ¥å¤±è´¥ï¼š Expected to make the same number of queries, but got: 3 for N=2 4 for N=3Search and destroy N+1 violations: æœ€æ–°ç‰ˆæœ¬ä¸­ï¼Œæˆ‘æŠŠé‡ç‚¹æ”¾åœ¨äº†å¼€å‘ä½“éªŒä¸Šï¼Œå¸®åŠ©å¼€å‘è€…ä¸ä»…æ£€æµ‹ N+1 é—®é¢˜ï¼Œè¿˜èƒ½æ–¹ä¾¿åœ°åœ¨å¤§å‹åº”ç”¨ç¨‹åºä¸­æ‰¾åˆ°æƒ¹å‡ºé—®é¢˜çš„â€œå…ƒå‡¶â€ã€‚ å½“å¤„ç†ä¼˜åŒ–å·¥ä½œæ—¶ï¼Œæˆ‘è®¤è¯†åˆ°ä»…ä»…æ‹¥æœ‰æµ‹è¯•å›  N+1 è€ŒæŠ¥å¤±è´¥æ˜¯ä¸å¤Ÿçš„ï¼ˆèƒ½çŸ¥é“è¿™é—®é¢˜çš„å­˜åœ¨è¦æ„Ÿè°¢æ€§èƒ½ç›‘æµ‹ç³»ç»Ÿï¼‰ã€‚æ‰€ä»¥ï¼Œæˆ‘å·²ç»å¼€å§‹ä¸ºè¿™ä¸ª gem æ·»åŠ æ–°çš„ç‰¹æ€§ï¼Œå³ä»¥å¦‚ä¸‹è®¡åˆ’å‘ç° N+1 é—®é¢˜ï¼š Step 1: Write a test that fails: åˆ›å»ºä¸€ä¸ªå¥½çš„æ€§èƒ½æµ‹è¯•å¯ä¸å®¹æ˜“ã€‚æˆ‘ä»¬éœ€è¦æ‰€æ¶‰åŠçš„æ•°æ®ï¼Œå„ç§è®¾ç½®ï¼Œæ¥è¦†ç›–å¤šæ•°ä»£ç è·¯å¾„ï¼Œè¿™æ ·æ‰ä¸ä¼šé—å¤±ä»»ä½•ä¸æœŸæœ›çš„æ•°æ®åº“äº¤äº’ã€‚æ¯”å¦‚ï¼š # This example uses Minitestclass PerformanceTest &lt; ApplicationIntegrationTestCase def populate(scale_factor)  scale_factor. times do   # Here, I'm not using create_list but introducing some   # randomness instead.    # That would make our setup less deterministic   # (and, thus, test more valuable)   create(:resource, :with_tags, tags_num: [0, 1, 2]. sample)  end  create_list(:document, scale_factor) end test  should not produce N+1 queries  do  assert_perform_constant_number_of_queries do   get :index  end endendè¾“å‡ºçœ‹èµ·æ¥ä¼šæ˜¯è¿™æ ·ï¼š Expected to make the same number of queries, but got: 10 for N=2 11 for N=3Unmatched query numbers by tables: resources (SELECT): 2 != 3 permissions (SELECT): 4 != 6æ³¨æ„ï¼šå³ä½¿æˆ‘ä»¬æ²¡æœ‰çœ‹åˆ°ä¸Šé¢çš„documents åˆ—è¡¨ï¼Œä¹Ÿä¸è¦ç§»é™¤è®¾ç½®ä¸­çš„è¿™ä¸ªéƒ¨åˆ†ï¼šN+1 é—®é¢˜å¯èƒ½ä¼šåœ¨å°†æ¥é‡åˆ°ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥åšå¥½å‡†å¤‡ã€‚ Step 2: Localize the problem: æ ¹æ®ä¸Šé¢çš„é”™è¯¯ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªå½±å“åˆ°çš„è¡¨ã€‚è®©æˆ‘ä»¬é€šè¿‡ä½¿ç”¨æŸ¥è¯¢ç­›é€‰çš„ç‰¹æ€§ï¼Œæ¥å¯¹æ¯ä¸ªæµ‹è¯•å•ç‹¬é‡æ–°è¿è¡Œã€‚æˆ‘ä»¬ä¹Ÿå¯å¯ç”¨æ˜ç»†è¾“å‡ºæ¨¡å¼ä»¥è·å¾—æ‰€æ”¶é›†åˆ°çš„æŸ¥è¯¢åˆ—è¡¨åŠå…¶æ¥è‡ªå“ªé‡Œï¼š $ NPLUSONE_VERBOSE=1 \ NPLUSONE_FILTER=resources \ bundle exec rails testExpected to make the same number of queries, but got: 2 for N=2 3 for N=3Unmatched query numbers by tables: resources (SELECT): 2 != 3Queries for N=2  SELECT  resources . * FROM  resources  WHERE  resources .  deleted_at  IS NULL  â†³ app/controllers/resources_controller. rb:32:in `index'  . . . Queries for N=3  . . . å†é‡å¤ç¬¬äºŒä¸ªè¡¨çš„ï¼š $ NPLUSONE_VERBOSE=1 \ NPLUSONE_FILTER=permissions \ bundle exec rails testExpected to make the same number of queries, but got: 4 for N=2 6 for N=3Unmatched query numbers by tables: permissions (SELECT): 4 != 6Queries for N=2 SELECT  permissions . * FROM  permissions  WHERE  permissions. user_id  = 42 AND  permissions. resource_id  = 15 AND  permissions. grants  @&gt; '{manage}' â†³ app/policies/resource_policy. rb:41:in `update?' SELECT  permissions . * FROM  permissions  WHERE  permissions. user_id  = 42 AND  permissions. resource_id  = 15 AND  permissions. grants  @&gt; '{invite}' â†³ app/policies/resource_policy. rb:56:in `invite?' . . . Queries for N=3 . . . æœ‰æ—¶ï¼ŒæŸ¥è¯¢ä¼šå¤ªé•¿ï¼Œè®©æˆ‘ä»¬çš„è¾“å‡ºéš¾ä»¥é˜…è¯»ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®NPLUSONE_TRUNCATEç¯å¢ƒå˜é‡åªæ˜¾ç¤ºæŸ¥è¯¢çš„å‰ N ä¸ªå­—ç¬¦ã€‚ è¿˜æœ‰ï¼Œä»…æ˜¾ç¤ºå †æ ˆçš„å•ç‹¬ä¸€è¡Œå¯èƒ½æ²¡é‚£ä¹ˆæœ‰ç”¨ã€‚ä¸ç”¨æ‹…å¿ƒï¼ä½ å¯ä»¥é€šè¿‡NPLUSONE_BACKTRACEå˜é‡æ¥å¢åŠ å †æ ˆè¡Œæ•°æ˜¾ç¤ºçš„æ•°é‡ã€‚ å› æ­¤ï¼Œæœ€ç»ˆçš„å‘½ä»¤çœ‹èµ·æ¥ä¼šæ˜¯è¿™æ ·ï¼š NPLUSONE_VERBOSE=1 \NPLUSONE_FILTER=permissions \NPLUSONE_TRUNCATE=100 \NPLUSONE_BACKTRACE=5 \bundle exec rails testæ€»ç»“ä¸€ä¸‹ï¼Œé€šè¿‡n_plus_one_controlï¼Œä½ å¯ä»¥é€šè¿‡ç¼–å†™æµ‹è¯•å¹¶ä»¥ä¸åŒå‚æ•°è¿è¡Œå¤šæ¬¡æ¥å¿«é€Ÿè¯†åˆ«å‡ºä»»ä½•ä¸€ç§ N+1 æŸ¥è¯¢çš„æ ¹æºã€‚è€Œåœ¨ä½ ä¿®å¤æ‰€æœ‰è¿™äº›é—®é¢˜åï¼Œè¿™ç§æ£€æµ‹å°±æˆä¸ºä¸€ç§å›å½’æµ‹è¯•â€”â€”é˜»æ­¢ä½ çš„ä»£ç åœ¨å°†æ¥å†å‡ºé—®é¢˜çš„æµ‹è¯•ï¼ "
    }, {
    "id": 30,
    "url": "/2020/10/build-docker-with-private-ssh-key/",
    "title": "Build Dockeræ—¶ä½¿ç”¨SSH Private Keyçš„æ–°ç©æ³•",
    "body": "2020/10/17 - åœ¨å®é™…å·¥ä½œä¸­ï¼ŒBuild Docker é•œåƒæ—¶ï¼Œç»å¸¸ç¢°ä¸Šéœ€è¦åœ¨ Docker é•œåƒå†…ç”¨åˆ° SSH Private Key çš„åœºæ™¯ã€‚æ¯”å¦‚ Docker é•œåƒå†…è¦ä» GitHubã€GitLab çš„ç§æœ‰åº“ Clone ä»£ç ï¼Œæˆ–è€…è¦å®‰è£…ç§æœ‰åº“çš„Gemã€NPM Packageç­‰ã€‚è€Œå¦‚æœç›´æ¥æŠŠè‡ªå·±çš„ SSH Private Key æ‰“åŒ…åˆ° Docker é•œåƒä¸­çš„è¯ï¼Œæ˜¯å­˜åœ¨å¾ˆå¤§å®‰å…¨é£é™©çš„ã€‚å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ åœ¨ä¹‹å‰ï¼Œæˆ‘ä»¬å¾€å¾€æ˜¯é€šè¿‡ Squash æˆ–è€… Docker Multi Stage ç­‰æ–¹å¼æ¥å¤„ç†ï¼Œä½†éƒ½æœ‰å„è‡ªä¸è¶³ä¹‹å¤„ã€‚è€Œ Docker åœ¨ 18. 09 ç‰ˆæœ¬åï¼Œæ¨å‡ºäº† BuildKit çš„ SSH mount typeã€‚æˆ‘ä»¬å°±å¯ä»¥ç”¨è¿™ä¸ªç‰¹æ€§æ¥è§£å†³äº†ã€‚ é¦–å…ˆï¼Œéœ€è¦åœ¨ Dockerfile çš„é¡¶éƒ¨æ·»åŠ è¿™æ ·ä¸€è¡Œæ¥å¼€å¯è¯¥å®éªŒç‰¹æ€§ï¼š # syntax=docker/dockerfile:1. 0. 0-experimentalç„¶åï¼Œåœ¨ Dockerfile ä¸­éœ€è¦ä½¿ç”¨ SSH Private Key çš„åœ°æ–¹éƒ½åŠ ä¸Š --mount=type=sshæ¯”å¦‚ï¼ŒRails é¡¹ç›®å®‰è£…æœ‰ç§æœ‰åº“çš„ Gem åŒ…æ—¶ï¼Œå°±å†™æˆè¿™æ ·ï¼š RUN --mount=type=ssh bundle installä»¥æ­¤ç±»æ¨ã€‚Dockerfile å‡†å¤‡å¥½ä¹‹åï¼Œå†è®¾ç½®ä¸€ä¸‹ç¯å¢ƒå˜é‡ä»¥å¯ç”¨ BuildKitï¼š export DOCKER_BUILDKIT=1æœ€åï¼Œå³å¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ¥ Build Docker é•œåƒäº†ï¼š docker build --ssh default=/Users/xxxxx/. ssh/id_rsa -f Dockerfile -t rails-demo-dev:1. 0. 0 . æå®šã€‚ è¿™ç§æ–¹å¼ï¼Œæ—¢èƒ½æ­£å¸¸ä½¿ç”¨ä¸Š SSH Private Keyï¼Œåˆèƒ½ä½¿å…¶åœ¨é•œåƒä¸­ä¸ç•™ç—•è¿¹ã€‚å®Œç¾ï¼ å‚è€ƒé˜…è¯»ï¼š  https://medium. com/@tonistiigi/build-secrets-and-ssh-forwarding-in-docker-18-09-ae8161d066 https://medium. com/@amimahloof/securely-build-small-python-docker-image-from-private-git-repos-c3e6d5da4626"
    }, {
    "id": 31,
    "url": "/2020/09/auto-run-mongodb-docker-in-replica-mode/",
    "title": "è‡ªåŠ¨è¿è¡ŒMongoDB Dockerä¸ºReplicaæ¨¡å¼",
    "body": "2020/09/22 - æœ€è¿‘å·¥ä½œä¸­ç¢°åˆ°ä¸€ä¸ªæœ‰æ„æ€çš„é—®é¢˜ï¼šéœ€è¦è®© MongoDB çš„ Docker é•œåƒä»¥ Replica æ¨¡å¼è¿è¡Œèµ·æ¥ã€‚è€Œå®˜æ–¹ MongoDB çš„ Docker é•œåƒé»˜è®¤æ˜¯å•æœºè€Œé Replica æ¨¡å¼ã€‚å½“ç„¶ï¼Œå¦‚æœä½ å¯åŠ¨ Docker åå†è¿›å…¥å®¹å™¨å†…ï¼Œæ‰‹åŠ¨ä¿®æ”¹é…ç½®ç”Ÿæ•ˆï¼Œè‚¯å®šèƒ½æå®šã€‚ä½†æ¯«æ— ç–‘é—®è¿™æ˜¯æ•ˆç‡å¾ˆä½çš„åšæ³•ã€‚å¦‚ä½•è®©è¿™ä¸€åˆ‡è‡ªåŠ¨å®ç°ï¼Œè€Œä¸æ˜¯æ¯æ¬¡é‡æ–°è¿è¡Œ MongoDB éƒ½æ‰‹å·¥å»æ”¹ï¼Ÿ å…¶å®ï¼Œå®˜æ–¹ MongoDB Docker é¡µé¢å·²ç»æŒ‡å‡ºäº†è§£å†³æ–¹å‘ã€‚å¦‚ä¸‹å›¾ï¼š æ„æ€æ˜¯è¯´åœ¨å¯åŠ¨æ—¶ï¼Œä½äº/docker-entrypoint-initdb. dç›®å½•ä¸‹çš„. sh, . jsæ–‡ä»¶éƒ½ä¼šè¢«è‡ªåŠ¨ä½œä¸ºé…ç½®è¯»å–ç”Ÿæ•ˆã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦æœ¬åœ° Build ä¸€ä¸‹ MongoDBï¼Œå¹¶å…ˆå†™å¥½æ‰€éœ€è¦çš„é…ç½®æ–‡ä»¶ï¼Œåœ¨ Build æ—¶æŠŠè¯¥é…ç½®æ–‡ä»¶æ”¾å…¥ä¸Šè¿°ç›®å½•å†…ï¼Œæœ€åç”Ÿæˆçš„é•œåƒå°±èƒ½å®ç°è‡ªåŠ¨ Replica æ¨¡å¼çš„å¯åŠ¨ã€‚ ç›´æ¥ä¸Šæœ€ç»ˆçš„Dockerfileï¼š ARG MONGODB_VERSIONFROM mongo:$MONGODB_VERSIONADD . /dockerize/mongo/init_replicaset. js /docker-entrypoint-initdb. d/init_replicaset. jsCMD [ mongod ,  --replSet ,  mongoreplset ,  --bind_ip_all ]å’Œé…ç½®æ–‡ä»¶init_replicaset. jsï¼š rs. initiate({'_id':'mongoreplset', members: [{'_id':0, 'host':'127. 0. 0. 1:27017'}]});å°±æ˜¯è¿™æ ·äº†ã€‚ "
    }, {
    "id": 32,
    "url": "/2020/08/testprof-chinese-doc-is-online/",
    "title": "TestProfæ–‡æ¡£ä¸­æ–‡ç‰ˆç¿»è¯‘å®Œæˆä¸Šçº¿",
    "body": "2020/08/18 - æˆ‘åœ¨å‰å‡ ç¯‡åšå®¢ä¸­ç¿»è¯‘æ¨èäº†å…³äº TestProf çš„ä¸€äº›ä½¿ç”¨æ–¹æ³•å’ŒæŠ€å·§ï¼Œè¿™ä¸ª Evil Martins å‡ºå“çš„ Ruby æµ‹è¯•å·¥å…· Gem çš„å¼ºå¤§å’Œæœ‰è¶£ï¼Œä»ä¸­å¯çª¥ä¸€æ–‘ã€‚è¦æƒ³äº†è§£å’Œä½¿ç”¨ TestProf çš„å…¨éƒ¨åŠŸèƒ½ï¼Œå½“ç„¶è¿˜æ˜¯éœ€è¦å»çœ‹å®ƒçš„å®˜æ–¹æ–‡æ¡£ï¼ˆåœ°å€ï¼šhttps://test-prof. evilmartians. ioï¼‰ã€‚é¡ºä¾¿è¯´ä¸€å¥ï¼Œè¿è¿™ä¸ª Gem æ–‡æ¡£çš„ç½‘ç«™éƒ½ç§‰æ‰¿äº† Evil Martins çš„ä¸€è´¯é£æ ¼ï¼ŒåŒæ ·çš„ç²¾è‡´ï¼ŒåŒæ ·çš„è®²ç©¶è®¾è®¡æ„Ÿã€‚ ä¸ºäº†æ›´å¥½åœ°æ¨èç»™å›½å†…çš„ Ruby å¼€å‘è€…ï¼Œäºæ˜¯æˆ‘æœ‰äº†ä¸€ä¸ªå¤§èƒ†çš„æƒ³æ³•ã€‚æˆ‘ç»™ TestProf ä½œè€… Vladimir Dementyev å‘äº†é‚®ä»¶ï¼Œå‘ä»–è¯¢é—®å…³äºæŠŠ TestProf çš„æ–‡æ¡£è¿›è¡Œä¸­æ–‡åŒ–çš„æ„å‘ã€‚Vladimir æŠ€æœ¯å¾ˆå‰å®³ï¼Œæ²¡æƒ³åˆ°äººä¹Ÿéå¸¸å¥½æ²Ÿé€šã€‚ä½œä¸ºä½œè€…ï¼Œå½“ç„¶ä»–ä¹Ÿæ˜¯å¸Œæœ›æŠŠæ–‡æ¡£ç¿»è¯‘æˆæ›´å¤šçš„æœ¬åœ°åŒ–è¯­è¨€ï¼Œå¥½æ¨å¹¿ç»™æ›´å¤šçš„ Ruby å¼€å‘è€…äº†ã€‚ä¸è¿‡ä»–åŒæ—¶å›å¤è¯´æ–‡æ¡£ç½‘ç«™ç›®å‰è¿˜ä¸æ”¯æŒå¤šè¯­è¨€ï¼Œéœ€è¦å…ˆè°ƒç ”ä¸€ä¸‹ï¼Œå°½å¿«å‘Šè¯‰æˆ‘ç»“æœã€‚ è€Œä»–åªç”¨äº†ä¸¤ä¸ªæ™šä¸Šï¼Œå°±æå®šäº†æŠŠåŸæœ¬åªæ”¯æŒè‹±æ–‡çš„æ–‡æ¡£ç½‘ç«™ï¼Œæ‰©å±•å‡çº§ä¸ºæ”¯æŒå¤šè¯­è¨€çš„ç‰ˆæœ¬ï¼Œå¹¶ä¸”æ·»åŠ äº†å…¨éƒ¨æ–‡æ¡£çš„ä¿„è¯­ç‰ˆæœ¬è¿›è¡ŒéªŒè¯ã€‚æ—¢ç„¶æ–‡æ¡£çš„ç½‘ç«™ä¸€åˆ‡å‡†å¤‡å°±ç»ªï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±ç­‰æˆ‘çš„ä¸­æ–‡åŒ–ç¿»è¯‘äº†ã€‚ ç¿»è¯‘å·¥ä½œä» 2020. 07. 24 å¼€å§‹ï¼Œåˆ° 2020. 08. 12 å®Œæˆæœ€åä¸€ç¯‡ï¼Œå…±è€—æ—¶ 12 å¤©ã€‚ ä¸­æ–‡ç‰ˆæœ¬æ¥å¯ä»¥é‚£æ—¶å°±ä¸Šçº¿çš„ï¼Œä¸å·§çš„æ˜¯ï¼Œæ­£å¥½ç¢°ä¸Šæ˜¯ Vladimir çš„å‡æœŸï¼Œåªèƒ½ç­‰ä»–å›æ¥å†å¤„ç†ã€‚ ä»Šå¤©ï¼ŒTestProf æ–‡æ¡£çš„ä¸­æ–‡ç‰ˆç»ˆäºæ­£å¼æ”¾å‡ºï¼Œå¯ä¾›æ‰€æœ‰ Ruby å¼€å‘è€…æŸ¥é˜…äº†ã€‚æ•ˆæœå¦‚ä¸‹ï¼š Vladimir ä¹Ÿåœ¨ Twitter ä¸Šå‘å¸ƒäº†ä¸­æ–‡ç‰ˆæ–‡æ¡£ä¸Šçº¿çš„æ¶ˆæ¯:) è¡·å¿ƒå¸Œæœ› TestProf çš„ä¸­æ–‡æ–‡æ¡£èƒ½å¤Ÿå¸®åŠ©æ‰€æœ‰å›½å†…çš„ Ruby å¼€å‘è€…æŠŠæµ‹è¯•å†™å¾—æ›´åŠ é«˜æ•ˆï¼Œä¹Ÿè®©ç¼–å†™æµ‹è¯•æˆä¸ºä¸€ç§ä¹è¶£ï¼Œä»è€Œè®© Ruby/Rails ç¨‹åºæ›´åŠ å®Œç¾ï¼ é™„æ³¨TestProf ä¸­æ–‡æ–‡æ¡£çš„ GitHub åœ°å€æ˜¯ï¼šhttps://github. com/test-prof/docs-zh-cnï¼Œ æ¬¢è¿å„ä½å°ä¼™ä¼´é’ˆå¯¹æ–‡æ¡£ä¸­ç¿»è¯‘ä¸å‡†ç¡®ç”šè‡³æœ‰è¯¯çš„åœ°æ–¹æ issue ç»™äºˆåé¦ˆã€‚ "
    }, {
    "id": 33,
    "url": "/2020/08/ports-and-adapters-pattern-part3/",
    "title": "â€œç«¯å£â€”é€‚é…å™¨â€æ¨¡å¼çš„æ¦‚å¿µ(3)",
    "body": "2020/08/13 - è¿™æ˜¯â€œç«¯å£â€”é€‚é…å™¨â€æ¨¡å¼çš„æ¦‚å¿µæ¢³ç†ç¬¬ä¸‰éƒ¨åˆ†ã€‚ 6. - PROS AND CONS: æ¨¡å—åŒ–å’Œåº”ç”¨ä¸æŠ€æœ¯çš„è§£è€¦ï¼Œæ˜¯å…­è¾¹å½¢æ¶æ„ä¸¤ä¸ªé‡è¦çš„ç‰¹å¾ã€‚è¿™äº›ç‰¹å¾æ˜¯ä¼˜ç‚¹å’Œç¼ºç‚¹çš„æ¥æºã€‚ä¸‹é¢æ˜¯æˆ‘å‘ç°çš„ä¸€äº›å…³äºå…­è¾¹å½¢æ¶æ„çš„åˆ©ä¸å¼Šã€‚ 6. 1 - PROS: 6. 1. 1 - TESTABILITY IMPROVEMENTè¿™ä¸ªæ¶æ„æ‰€æä¾›çš„ä¸»è¦æ”¶ç›Šå°±æ˜¯èƒ½å¤Ÿç‹¬ç«‹äºå…¶ä¾èµ–çš„å¤–éƒ¨è®¾å¤‡æ¥æµ‹è¯•åº”ç”¨ç¨‹åºã€‚è¿™é€šè¿‡ä¸¤ä»¶äº‹æ¥å®ç°ï¼š  å¯¹äºæ¯ä¸ªé©±åŠ¨è€…ç«¯å£ï¼Œå¼€å‘ä¸€ä¸ªæµ‹è¯•é€‚é…å™¨ä»¥åœ¨è¯¥ç«¯å£ä¸Šæµ‹è¯•å…¶ç”¨ä¾‹ã€‚ å¯¹äºæ¯ä¸ªä»åŠ¨è€…ç«¯å£ï¼Œå¼€å‘ä¸€ä¸ª mock é€‚é…å™¨ã€‚å¯¹å…­è¾¹å½¢åšéš”ç¦»æ€§æµ‹è¯•å¯¹äºè¿™äº›å¾ˆæœ‰ç”¨ï¼š  è¿è¡Œå›å½’æµ‹è¯•ã€‚å½“æºä»£ç å› æŸç§åŸå› å˜æ›´æ—¶ï¼ˆæ·»åŠ äº†æ–°åŠŸèƒ½ï¼Œä¿®å¤äº†ä¸€ä¸ª bugï¼Œç­‰ç­‰ï¼‰ï¼Œè¿™äº›æµ‹è¯•è¿è¡Œæ¥ç¡®ä¿å¦‚ä¸Šæ”¹åŠ¨æ²¡æœ‰åœ¨ä»»ä½•å·²å­˜åœ¨åŠŸèƒ½ä¸Šçš„è¾¹é™…æ•ˆåº”ã€‚è¦è¿è¡Œè¿™äº›æµ‹è¯•ï¼Œé©±åŠ¨è€…é€‚é…å™¨ä½¿ç”¨ä¸€ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ã€‚ åš BDD (è¡Œä¸ºé©±åŠ¨å¼€å‘)ã€‚å¯¹äºæ¯ä¸ªé©±åŠ¨è€…ç«¯å£çš„åŠŸèƒ½ï¼Œä¸€å¥—éªŒæ”¶æ ‡å‡†æ˜¯ç”±ç”¨æˆ·å®šä¹‰çš„ã€‚å½“æ‰€æœ‰éªŒæ”¶æ ‡å‡†éƒ½å»åˆæ—¶ï¼Œè¯¥åŠŸèƒ½å°±è¢«çœ‹ä½œâ€œå®Œæˆäº†â€ã€‚è¿™äº›éªŒæ”¶æ ‡å‡†è¢«ç§°ä¸º scenariosï¼Œå°†è¢«æµ‹è¯•ç”¨ä¾‹é€šè¿‡æµ‹è¯•é€‚é…å™¨æ¥è¿è¡Œã€‚è¦è¿è¡Œè¿™äº›éªŒæ”¶æµ‹è¯•ï¼Œé€‚é…å™¨å¯ä»¥ä½¿ç”¨å¦‚ Cucumber çš„å·¥å…·ã€‚Nat Pryceï¼ˆGrowing Object-Oriented Software, Guided by Tests ä¸€ä¹¦çš„åˆè‘—è€…ï¼‰åœ¨ä»–çš„æ–‡ç«  Visualising Test Terminology ä¸­å®šä¹‰äº†æœ‰å…³å…­è¾¹å½¢æ¶æ„å„ç§ä¸åŒçš„æµ‹è¯•ï¼š  å•å…ƒæµ‹è¯•ï¼ˆUnit Testsï¼‰ï¼šæµ‹è¯•å…­è¾¹å½¢å†…çš„å•ä¸ªå¯¹è±¡ã€‚ é›†æˆæµ‹è¯•ï¼ˆIntegration Testsï¼‰ï¼šæµ‹è¯•é€‚é…å™¨ã€‚å®ƒä»¬ç¡®ä¿åœ¨ç«¯å£å’Œå¤–éƒ¨ä¸–ç•Œä¹‹é—´çš„è½¬æ¢é€šè¿‡é€‚é…å™¨æ­£ç¡®åœ°å®Œæˆäº†ã€‚ éªŒæ”¶æµ‹è¯•ï¼ˆAcceptance Testsï¼‰ï¼šæµ‹è¯•é©±åŠ¨è€…ç«¯å£ï¼Œæ¯”å¦‚ï¼Œéš”ç¦»ä¸­çš„å…­è¾¹å½¢ã€‚å®ƒä»¬æ£€æŸ¥åº”ç”¨ç¨‹åºæœ‰å¦‚ç”¨æˆ·é¢„æœŸé‚£æ ·çš„è¡Œä¸ºï¼Œç¬¦åˆä»–/å¥¹åœ¨ä¹‹å‰ç”¨ä¾‹ä¸­æ‰€å®šä¹‰çš„éªŒæ”¶æ ‡å‡†ã€‚ ç³»ç»Ÿæµ‹è¯•ï¼ˆSystem Testsï¼‰ï¼šä¸€èµ·æµ‹è¯•æ•´ä¸ªç³»ç»Ÿï¼Œé€‚é…å™¨å’Œå…­è¾¹å½¢ã€‚å®ƒä»¬ä¹Ÿæµ‹è¯•ç³»ç»Ÿçš„éƒ¨ç½²å’Œå¯åŠ¨ã€‚6. 1. 2 - MAINTAINABILITY IMPROVEMENTå¯ç»´æŠ¤çš„ç³»ç»Ÿæ˜¯é‚£ç§æ˜“äºä¿®æ”¹çš„ç³»ç»Ÿã€‚å…­è¾¹å½¢æ¶æ„æå‡äº†å¯ç»´æŠ¤æ€§ï¼Œå› ä¸ºå®ƒæä¾›äº†å…³æ³¨ç‚¹è·Ÿä¸šåŠ¡é€»è¾‘è§£è€¦çš„åˆ†ç¦»ï¼Œä½¿å¾—æŸ¥æ‰¾æˆ‘ä»¬è¦æ›´æ”¹çš„ä»£ç æ›´åŠ å®¹æ˜“ã€‚ åº”ç”¨ç¨‹åºçš„å¯ç»´æŠ¤æ€§æ˜¯ä¸æŠ€æœ¯å€ºç›¸å…³çš„é•¿æœŸæ¦‚å¿µã€‚ å¯ç»´æŠ¤æ€§è¶Šé«˜ï¼ŒæŠ€æœ¯å€ºå°±è¶Šå°‘ã€‚å› æ­¤ï¼Œå…­è¾¹å½¢æ¶æ„å‡å°‘äº†æŠ€æœ¯å€ºã€‚ 6. 1. 3 - FLEXIBILITYåœ¨ä¸åŒçš„æŠ€æœ¯ä¹‹é—´åˆ‡æ¢æ˜¯å®¹æ˜“çš„ã€‚å¯¹ä¸€ä¸ªç»™å®šçš„ç«¯å£ï¼Œä½ å¯ä»¥æœ‰å¤šä¸ªé€‚é…å™¨ï¼Œæ¯ä¸ªä½¿ç”¨ç‰¹å®šçš„æŠ€æœ¯ã€‚è¦é€‰æ‹©ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªï¼Œä½ åªç”¨é…ç½®å¥½å“ªä¸ªé€‚é…å™¨ç”¨äºè¯¥ç«¯å£å³å¯ã€‚è¿™ç§é…ç½®å¯ä»¥å¦‚åŒè°ƒæ•´ä¸€ä¸ªå¤–éƒ¨é…ç½®å‚æ•°æ–‡ä»¶ä¸€æ ·å®¹æ˜“ã€‚ä¸ç”¨ä¿®æ”¹æºä»£ç ï¼Œä¸ç”¨é‡æ–°ç¼–è¯‘ï¼Œä¸ç”¨é‡æ–°æ„å»ºã€‚ åŒæ ·åœ°ï¼ŒæŠŠä¸€ä¸ªæ–°çš„ç‰¹å®šæŠ€æœ¯çš„é€‚é…å™¨æ·»åŠ åˆ°ä¸€ä¸ªç«¯å£å¯ä»¥ä¸ç”¨è§¦åŠç°æœ‰ä»£ç å³å¯åšåˆ°ã€‚è¿™ä¸ªé€‚é…å™¨å¼€å‘å’Œç¼–è¯‘å®ƒè‡ªå·±çš„ã€‚è¿è¡Œæ—¶ï¼Œå®ƒä¼šè¢«æ£€æŸ¥å¹¶æ’å…¥åˆ°è¯¥ç«¯å£ã€‚ 6. 1. 4 - APPLICATION IMMUNE TO TECHNOLOGY EVOLUTIONæŠ€æœ¯è¿œæ¯”ä¸šåŠ¡é€»è¾‘æ›´é¢‘ç¹åœ°è¿›åŒ–ç€ã€‚åœ¨ä¸šåŠ¡é€»è¾‘è·ŸæŠ€æœ¯ç»‘åœ¨ä¸€èµ·çš„åº”ç”¨ç¨‹åºä¸­ï¼Œä½ ä¸èƒ½è¿›è¡ŒæŠ€æœ¯å˜æ›´è€Œä¸è§¦ç¢°ä¸šåŠ¡é€»è¾‘ã€‚è¿™å¹¶ä¸å¥½ï¼Œå› ä¸ºä¸šåŠ¡ä¸åº”æ”¹å˜ã€‚ ä½¿ç”¨å…­è¾¹å½¢æ¶æ„ï¼Œä½ æƒ³è¦å‡çº§çš„æŠ€æœ¯æ˜¯ä½äºåº”ç”¨ç¨‹åºå¤–éƒ¨çš„é€‚é…å™¨ä¸­ã€‚ä½ åªç”¨æ›´æ”¹é€‚é…å™¨å°±å¥½ã€‚åº”ç”¨ç¨‹åºæœ¬èº«ä¿æŒä¸å˜æ€§ï¼Œå› ä¸ºå®ƒä¸ä¾èµ–äºé€‚é…å™¨ã€‚ 6. 1. 5 - DELAY TECHNOLOGICAL DECISIONSå½“ä½ å¼€å§‹å¼€å‘å†™ä»£ç æ—¶ï¼Œä¼šåªä¸“æ³¨åœ¨ä¸šåŠ¡é€»è¾‘ä¸Šï¼Œè€Œæ¨è¿Ÿå†³æ–­å°†è¦ä½¿ç”¨å“ªä¸ªæ¡†æ¶å’ŒæŠ€æœ¯ã€‚ä½ å¯ä»¥æ™šä¸€ç‚¹æ¥é€‰æ‹©ä¸€ç§æŠ€æœ¯ï¼Œå¹¶ä¸ºå…¶ç¼–å†™é€‚é…å™¨ã€‚ 6. 2 - CONS: 6. 2. 1 - COMPLEXITYä¸€ä¸ªå®ç°äº†å…­è¾¹å½¢æ¶æ„çš„è½¯ä»¶é¡¹ç›®æœ‰å¤æ‚çš„ç»“æ„ï¼Œä½¿ç”¨äº†å¾ˆå¤šçš„æ¨¡å—å’Œå®šä¹‰åœ¨å®ƒä»¬ä¹‹é—´çš„æ˜ç¡®ä¾èµ–ã€‚æˆ‘æ‰€è¯´çš„æ¨¡å—æ˜¯æŒ‡æºä»£ç å­é¡¹ç›®ï¼ˆæ¯”å¦‚ï¼ŒMaven æ¨¡å—ï¼‰ï¼Œç”¨äºç‰©ç†ä¸Šåˆ†ç¦»æ¶æ„çš„ä¸åŒå…ƒç´ ã€‚ è‡³å°‘ï¼Œä¼šæœ‰ä¸€ä¸ªç”¨äºå…­è¾¹å½¢çš„æ¨¡å—ï¼Œæ¯ä¸ªé€‚é…å™¨ä¸€ä¸ªæ¨¡å—ï¼Œä»¥åŠä¸€ä¸ªæ¨¡å—ç”¨äºå¯åŠ¨æ•´ä¸ªé¡¹ç›®ã€‚ä½ ä¹Ÿå¿…é¡»å®šä¹‰æ¨¡å—ä¹‹é—´çš„ä¾èµ–ï¼šå…­è¾¹å½¢ä¸ä¾èµ–ä»»ä½•ä¸œè¥¿ï¼Œé€‚é…å™¨ä¾èµ–äºå…­è¾¹å½¢ï¼Œè€Œå¯åŠ¨æ˜¯ä¾èµ–æ‰€æœ‰å…¶ä»–ä¸œè¥¿çš„ã€‚ å¦‚æœç¼–ç¨‹è¯­è¨€ä¸å…è®¸å…­è¾¹å½¢åªæš´éœ²ç«¯å£ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰ç”šè‡³æ›´å¤šçš„æ¨¡å—äº†ã€‚ä½ ä¸å¾—ä¸æŠŠå…­è¾¹å½¢æ‹†åˆ†ä¸ºç«¯å£åŠå®ç°ã€‚å…­è¾¹å½¢çš„å®ç°å’Œé€‚é…å™¨å°†ä¾èµ–äºç«¯å£ï¼Œè€Œç«¯å£ä¸ä¾èµ–ä»»ä½•ä¸œè¥¿ã€‚ 6. 2. 2 - BUILD PROCESS PERFORMANCEç”±äºæˆ‘ä»¬å·²ç»çœ‹åˆ°çš„å¤æ‚æ€§ï¼Œå¦‚æœé¡¹ç›®å¤ªå¤§ï¼Œæœ‰å¤ªå¤šé€‚é…å™¨ï¼Œé‚£ä¹ˆç¼–è¯‘ã€è¿è¡Œæµ‹è¯•ã€æŠŠæ‰€æœ‰æ¨¡å—æ„å»ºåˆ°ä¸€èµ·ï¼Œä»¥åŠå¯åŠ¨æ•´ä¸ªé¡¹ç›®çš„è¿‡ç¨‹å°†ä¼šèŠ±è´¹è®¸å¤šè®¸å¤šçš„æ—¶é—´ã€‚ 6. 2. 3 - INDIRECTION AND MAPPINGSé€šè¿‡ç«¯å£å’Œé€‚é…å™¨æŠŠåº”ç”¨ç¨‹åºè·ŸæŠ€æœ¯è§£è€¦ä¼šå¢åŠ é—´æ¥æ€§ï¼Œæ¯”å¦‚ï¼Œå½“é€‚é…å™¨åœ¨ç«¯å£å’Œç‰¹å®šæŠ€æœ¯æ¥å£ä¹‹é—´è½¬æ¢æ—¶å¯¹æ–¹æ³•çš„é¢å¤–è°ƒç”¨ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¯èƒ½è¿˜éœ€è¦åœ¨åº”ç”¨ç¨‹åºè·Ÿå¤–éƒ¨ä¸–ç•Œå¯¹è±¡ä¹‹é—´è¿›è¡Œæ˜ å°„ã€‚ 7. - WHEN TO â€œHEXAGONAL THIS!â€: æˆ–è€…ä½ ä¼šè¿™æ ·è¯´ï¼šâ€œä»€ä¹ˆæ—¶å€™åº”è¯¥åœ¨é¡¹ç›®ä¸Šåº”ç”¨å…­è¾¹å½¢æ¶æ„ï¼Ÿâ€å¥½å§ï¼Œç­”æ¡ˆææ€•ä»¤äººä¸å¿«ï¼šâ€œå¾—çœ‹æƒ…å†µâ€ï¼š  å¯¹äºå°é¡¹ç›®ï¼Œä¹Ÿè®¸â€œæ²»æ„ˆèƒœè¿‡ç–¾ç—…â€ï¼Œæ‰€ä»¥è§£å†³çç¢çš„é—®é¢˜ä¸å€¼å¾—ä½¿ç”¨è¯¥æ¶æ„æ¥å¢åŠ é¢å¤–çš„å¤æ‚æ€§ã€‚ å¯¹äºä¸­ç­‰/å¤§å‹é¡¹ç›®ï¼Œæœ‰å¾ˆé•¿çš„ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨å…¶ç”Ÿæ¶¯ä¸­ä¼šè¿›è¡Œå¤šæ¬¡ä¿®æ”¹ï¼Œä½¿ç”¨å…­è¾¹å½¢æ¶æ„å°±éå¸¸å€¼å¾—ã€‚æœ‰äº›äººå¯èƒ½è¯´å¦‚æœä»–ä»¬ç¡®è®¤é¡¹ç›®ä¸­è¦ç”¨çš„æŠ€æœ¯æˆ–æ¡†æ¶ä¸ä¼šå˜æ›´ï¼ˆæ¯”å¦‚ï¼Œç”±äºæŸäº›åŸå› è¢«ç»‘å®šåˆ°äº†ç‰¹å®šæŠ€æœ¯ï¼‰ï¼Œå°±ä¸éœ€è¦å…­è¾¹å½¢æ¶æ„äº†ã€‚å¥½å§ï¼Œå³ä½¿åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œâ€œç«¯å£-é€‚é…å™¨â€æ¨¡å¼ä¹Ÿå¾ˆæœ‰ç”¨ï¼Œå› ä¸ºä½ å¯ä»¥æ·»åŠ  mock é€‚é…å™¨ï¼Œä»¥ä¾¿åœ¨åº”ç”¨ç¨‹åºæ‰€ä¾èµ–çš„è®¾å¤‡/æœåŠ¡ä¸å¯ç”¨æ—¶ä½¿ç”¨ï¼Œæˆ–è€…ä½ å¯ä»¥ä¸ºä¸åŒçš„è¿è¡Œæ—¶ç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰æ·»åŠ é€‚é…å™¨ã€‚ 8. - IMPLEMENTATION STEPS: èµ·ç‚¹æ˜¯åº”ç”¨ç¨‹åºä½œä¸ºä¸€ä¸ªé»‘ç›’ï¼Œæ‰€å®šä¹‰çš„ç«¯å£æ¥å£å›´ç»•å…¶å››å‘¨ï¼Œæ— è®ºæ˜¯åœ¨é©±åŠ¨è€…ä¾§è¿˜æ˜¯ä»åŠ¨è€…ä¾§ï¼Œä»¥æ­¤ä¸å¤–éƒ¨ä¸–ç•Œè¿›è¡Œäº¤äº’ã€‚ èµ·åˆå¯èƒ½ä½ æ— æ³•å®Œæ•´å®šä¹‰æ¯ä¸ªä»åŠ¨è€…ç«¯å£ï¼Œå› ä¸ºä½ ä»ç„¶ä¸å®Œå…¨äº†è§£åº”ç”¨ç¨‹åºå¯¹ç«¯å£ç”¨é€”çš„æ‰€æœ‰éœ€æ±‚ã€‚æˆ–è€…ä½ å¯èƒ½é”™è¿‡æŸäº›ä»åŠ¨è€…ç«¯å£ã€‚ä½†è¿™äº›éœ€æ±‚å°†ä¼šéšç€å…­è¾¹å½¢å†…çš„å¼€å‘è€Œäº§ç”Ÿï¼Œæ¯”å¦‚ï¼Œé©±åŠ¨è€…ç«¯å£çš„å®ç°ã€‚ æ‰€ä»¥ï¼Œå¯¹äºä»å¤´å¼€å‘ä¸€ä¸ªå…­è¾¹å½¢åº”ç”¨ç¨‹åºï¼Œä¸‹é¢æ˜¯é€‚é…å™¨åœ¨é©±åŠ¨è€…ä¸ä»åŠ¨è€…ä¸¤ä¾§è¢«æ„é€ å’Œæ·»åŠ çš„é¡ºåºï¼Œç›´åˆ°å®Œæˆæ‰€æœ‰å·¥ä½œï¼š 8. 1 - TEST DRIVER ADAPTERS / MOCK DRIVEN ADAPTERS:  é©±åŠ¨è€…ä¾§ï¼ˆDriver sideï¼‰ï¼šå¯¹äºæ¯ä¸ªé©±åŠ¨è€…ç«¯å£ï¼Œæ„é€ ä¸€ä¸ªæµ‹è¯•é€‚é…å™¨ï¼Œå¹¶ç”±æµ‹è¯•æ¥é©±åŠ¨å®ç°è¯¥é©±åŠ¨è€…ç«¯å£ã€‚BDD å¯è¢«ç”¨äºæ­¤å¤„ä»¥å®ç°é©±åŠ¨è€…ç«¯å£ï¼Œè€Œæµ‹è¯•ç”¨ä¾‹ä¼šæ˜¯ GWT scenariosã€‚ ä»åŠ¨è€…ä¾§ï¼ˆDriven sideï¼‰ï¼šå½“åœ¨å®ç°ä¸€ä¸ªé©±åŠ¨è€…ç«¯å£æ—¶ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨ä»åŠ¨è€…ç«¯å£ã€‚è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œä¸ºå…¶æ„é€  mock é€‚é…å™¨ã€‚ä¸€æ—¦ä½ å®ç°äº†æ‰€æœ‰çš„é©±åŠ¨è€…ç«¯å£å’Œ mock ä»åŠ¨è€…ç«¯å£ï¼Œè¿™ä¸€æ­¥å°±å®Œæˆäº†ã€‚ æ­¤æ—¶ï¼Œå…­è¾¹å½¢æ˜¯å®Œæ•´çš„ï¼Œæœ‰æµ‹è¯•åœ¨é©±åŠ¨è€…ä¾§ï¼Œmock åœ¨ä»åŠ¨è€…ä¾§ã€‚åº”ç”¨ç¨‹åºæ˜¯å¯ä»¥è¢«éš”ç¦»æ€§æµ‹è¯•çš„ã€‚ ä¸‹ä¸€æ­¥æ˜¯ä¸ºæ¯ä¸ªç«¯å£æ·»åŠ æ‰€éœ€çš„â€œçœŸå®â€çš„é©±åŠ¨è€…é€‚é…å™¨å’Œä»åŠ¨è€…é€‚é…å™¨ï¼Œè¿™ä¾èµ–äºå¤–éƒ¨ä¸–ç•Œçš„é€šä¿¡éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½éœ€è¦ Web UI å’Œ REST API é€‚é…å™¨åœ¨é©±åŠ¨è€…ä¾§ï¼Œè€Œ SQL æ•°æ®åº“å’Œ app-to-app é€‚é…å™¨åœ¨ä»åŠ¨è€…ä¾§ã€‚ 8. 2 - REAL DRIVER ADAPTERS / MOCK DRIVEN ADAPTERS:  é©±åŠ¨è€…ä¾§ï¼ˆDriver sideï¼‰ï¼šå¯¹äºæ¯ä¸ªé©±åŠ¨è€…ç«¯å£ï¼Œæ„é€ å¹¶æ·»åŠ ä½ éœ€è¦çš„â€œçœŸå®â€çš„é©±åŠ¨è€…é€‚é…å™¨ã€‚ä¾‹å¦‚ï¼ŒWeb UI, REST APIï¼Œç­‰ç­‰ã€‚ ä»åŠ¨è€…ä¾§ï¼ˆDriven sideï¼‰ï¼šä¿ç•™ä½ åœ¨æ­¥éª¤ä¸€ä¸­æ„é€ çš„ mock é€‚é…å™¨ã€‚è¿™æ ·ä½ å°±å¯ä»¥æµ‹è¯•æ–°çš„é©±åŠ¨è€…é€‚é…å™¨äº†ã€‚ 8. 3 - TEST DRIVER ADAPTERS / REAL DRIVEN ADAPTERS:  é©±åŠ¨è€…ä¾§ï¼ˆDriver sideï¼‰ï¼šé…ç½®æ¯ä¸ªé©±åŠ¨è€…ç«¯å£ä»¥ä½¿ç”¨åœ¨æ­¥éª¤ä¸€ä¸­æ„é€ çš„æµ‹è¯•é©±åŠ¨è€…é€‚é…å™¨ã€‚ ä»åŠ¨è€…ä¾§ï¼ˆDriven sideï¼‰ï¼šå¯¹äºæ¯ä¸ªä»åŠ¨è€…ç«¯å£ï¼Œæ„é€ å¹¶æ·»åŠ ä½ éœ€è¦çš„â€œçœŸå®â€çš„ä»åŠ¨è€…é€‚é…å™¨ã€‚ä¾‹å¦‚ï¼Œæ•°æ®åº“é€‚é…å™¨ï¼Œé‚®ä»¶æé†’é€‚é…å™¨ï¼Œç­‰ç­‰ã€‚è¿™æ ·ä½ å°±å¯ä»¥æµ‹è¯•æ–°çš„ä»åŠ¨è€…é€‚é…å™¨äº†ã€‚ 8. 4 - REAL DRIVER ADAPTERS / REAL DRIVEN ADAPTERS:  é©±åŠ¨è€…ä¾§ï¼ˆDriver sideï¼‰ï¼šé…ç½®æ¯ä¸ªé©±åŠ¨è€…ç«¯å£ä½¿ç”¨åœ¨æ­¥éª¤äºŒä¸­æ„é€ çš„â€œçœŸå®â€çš„é©±åŠ¨è€…é€‚é…å™¨ã€‚ ä»åŠ¨è€…ä¾§ï¼ˆDriven sideï¼‰ï¼šé…ç½®æ¯ä¸ªä»åŠ¨è€…ç«¯å£ä½¿ç”¨åœ¨æ­¥éª¤ä¸‰ä¸­æ„é€ çš„â€œçœŸå®â€çš„ä»åŠ¨è€…é€‚é…å™¨ã€‚è¿™æ ·ä½ å°±å¯ä»¥å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œç«¯åˆ°ç«¯æµ‹è¯•äº†ï¼Œåœ¨é©±åŠ¨è€…ä¾§å’Œä»åŠ¨è€…ä¾§éƒ½åŒ…å«â€œçœŸå®â€çš„é€‚é…å™¨ã€‚ åˆ°è¿™ä¸€æ­¥ä½ å°±å…¨éƒ¨å®Œæˆäº†ã€‚ä½ å¯ä»¥ç”¨æœŸæœ›çš„é€‚é…å™¨æ¥é…ç½®æ¯ä¸ªç«¯å£ï¼Œå¹¶ä»¥ç«¯å£ä¸é€‚é…å™¨é…ç½®çš„ä»»æ„ç»„åˆæ¥è¿è¡Œåº”ç”¨ç¨‹åºã€‚ "
    }, {
    "id": 34,
    "url": "/2020/08/ports-and-adapters-pattern-part2/",
    "title": "â€œç«¯å£â€”é€‚é…å™¨â€æ¨¡å¼çš„æ¦‚å¿µ(2)",
    "body": "2020/08/12 - è¿™æ˜¯â€œç«¯å£â€”é€‚é…å™¨â€æ¨¡å¼çš„æ¦‚å¿µæ¢³ç†ç¬¬äºŒéƒ¨åˆ†ã€‚ 3. - CONFIGURABLE DEPENDENCY PATTERN: é…ç½®ä¾èµ– æ˜¯ ä¾èµ–æ³¨å…¥ çš„ä¸€ç§æ¦‚æ‹¬ï¼Œä¹Ÿè¢«ç§°ä¸ºæ§åˆ¶åè½¬ã€‚ å®ƒæ˜¯ Gerard Meszaros èµ·çš„ä¸€ä¸ªæ–°åç§°ã€‚Alistair Cockburn è®¤ä¸ºå®ƒæ˜¯è¯¥æ¨¡å¼çš„æ›´å¥½åç§°ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ç§ç‰¹æ€§ï¼Œä¸€ç§ç‰¹å¾ã€‚â€œä¾èµ–æ³¨å…¥â€ä¸æ˜¯å±æ€§ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ“ä½œï¼Œå®ƒæ˜¯ä½ å®ç°é…ç½®ä¾èµ–çš„ä¸€ç§ä¸œè¥¿ã€‚â€œæ§åˆ¶åè½¬â€æ˜¯ä¸€ä¸ªåŒé‡å¦å®šï¼Œç±»ä¼¼äºå…ˆæŠŠäº‹æƒ…åšé”™ç„¶ååè½¬å®ƒä»¬ã€‚ â€œé…ç½®ä¾èµ–â€ç¬¦åˆæ¨¡å¼çš„å®šä¹‰ï¼š â€œäº‹ç‰©çš„æ¨¡å¼æ˜¯äº‹ç‰©è‰¯å¥½èŒƒä¾‹çš„å…±åŒç‰¹å¾â€ã€‚ æˆ‘ä»¬å¯ä»¥è¯´é…ç½®ä¾èµ–æ˜¯å¯¹è±¡åœ¨æ¥å£ä¹‹ä¸Šçš„ä¸€ç§ä¾èµ–ã€‚è¿™ä¸ªæ¥å£å°†æ˜¯å¯¹è±¡æ„é€ å™¨çš„å‚æ•°ã€‚ç„¶åï¼Œè¿è¡Œæ—¶ï¼Œåœ¨å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™ï¼Œè¯¥æ¥å£çš„ä¸€ä¸ªç‰¹å®šå®ç°è¢«ä¼ ç»™è¯¥æ„é€ å™¨ã€‚ å…­è¾¹å½¢æ¶æ„æŠŠé…ç½®ä¾èµ–æ¨¡å¼åº”ç”¨äºé©±åŠ¨è€…å’Œä»åŠ¨è€…ä¸¤ä¾§ã€‚åœ¨â€œå‚ä¸è€…-åº”ç”¨ç¨‹åºâ€çš„äº¤äº’ä¸­ï¼Œå¼€å§‹å¯¹è¯çš„ä¸€æ–¹å¿…é¡»çŸ¥é“å¦ä¸€æ–¹ï¼Œä»¥ä¾¿äº†è§£è¦è·Ÿè°é€šè¯ï¼Œæ¯”å¦‚ï¼Œå®ƒå¿…é¡»åœ¨å¦ä¸€æ–¹å®ç°çš„æ¥å£ä¸Šå…·æœ‰ä¸€ä¸ªé…ç½®ä¾èµ–ï¼š  é©±åŠ¨è€…ä¾§ï¼šå¯¹è¯ç”±é©±åŠ¨è€…ï¼ˆä¸»è§’å‚ä¸è€…ï¼‰å¼€å§‹ï¼Œæ‰€ä»¥é©±åŠ¨è€…é€‚é…å™¨åœ¨é©±åŠ¨è€…ç«¯å£ä¸Šæœ‰ä¸€ä¸ªé…ç½®ä¾èµ–ï¼Œå…¶æ˜¯ç”±åº”ç”¨ç¨‹åºå®ç°çš„ä¸€ä¸ªæ¥å£ã€‚ ä»åŠ¨è€…ä¾§ï¼šå¯¹è¯ç”±åº”ç”¨ç¨‹åºå¼€å§‹ï¼Œæ‰€ä»¥åº”ç”¨ç¨‹åºåœ¨ä»åŠ¨è€…ç«¯å£ä¸Šæœ‰ä¸€ä¸ªé…ç½®ä¾èµ–ï¼Œå…¶æ˜¯ç”±é…è§’å‚ä¸è€…çš„ä»åŠ¨è€…é€‚é…å™¨å®ç°çš„ä¸€ä¸ªæ¥å£ã€‚æ‰€ä»¥ä¾èµ–å¦‚ä¸‹å›¾è¿™æ ·ï¼š  ä¸€ä¸ªé©±åŠ¨è€…é€‚é…å™¨ä¾èµ–äºå…­è¾¹å½¢ï¼ˆå®ƒä½¿ç”¨ä¸€ä¸ªé©±åŠ¨è€…ç«¯å£çš„æ¥å£ï¼‰ã€‚ ä¸€ä¸ªä»åŠ¨è€…é€‚é…å™¨ä¾èµ–äºå…­è¾¹å½¢ï¼ˆå®ƒå®ç°ä¸€ä¸ªä»åŠ¨è€…ç«¯å£çš„æ¥å£ï¼‰ã€‚ å…­è¾¹å½¢ä¸ä¾èµ–ä»»ä½•ä¸œè¥¿ï¼Œå¯èƒ½åªè·Ÿç¼–ç¨‹è¯­è¨€å·¥å…·æœ‰å…³ã€‚é…ç½®ä¾èµ–æ˜¯â€œç«¯å£â€”é€‚é…å™¨â€æ¶æ„æ‰€åŸºäºçš„æœ€é‡è¦æ¨¡å¼ï¼Œå› ä¸ºå®ƒä½¿å¾—å…­è¾¹å½¢ä¸ä»»ä½•æŠ€æœ¯è§£è€¦ã€‚è€Œè¿™ç§è§£è€¦ä½¿å¾—è¯¥æ¶æ„çš„ä¸»è¦ç›®æ ‡æˆä¸ºå¯èƒ½ï¼Œå°±æ˜¯è¯´ï¼Œæ‹¥æœ‰äº†ä¸€ä¸ªç”±å¤šä¸ªé©±åŠ¨è€…è¿è¡Œï¼Œå¹¶èƒ½ä¸ recipients/repositories è¿›è¡Œéš”ç¦»æ€§æµ‹è¯•çš„åº”ç”¨ç¨‹åºã€‚ 4. - FROM â€œSYMMETRICAL ASYMMETRYâ€ TO â€œASYMMETRICAL SYMMETRYâ€ï¼ˆä»â€œå¯¹ç§°çš„ä¸å¯¹ç§°â€åˆ°â€œä¸å¯¹ç§°çš„å¯¹ç§°â€ï¼‰: å¬èµ·æ¥ç›¸å½“ä»¤äººå›°æƒ‘å§ï¼Ÿå¦‚æœæ˜¯ï¼Œé‚£å°±å¯¹äº†ï¼Œè¿™æ­£æ˜¯æˆ‘æƒ³è¦çš„æ•ˆæœã€‚è®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹ã€‚ å½“è¯¥æ¨¡å¼è¢«å†™äº 2005 å¹´æ—¶ï¼Œä½œè€…æƒ³è¦å±•ç¤ºçš„æ˜¯ä¼ ç»Ÿåˆ†å±‚æ¶æ„çš„ä¸å¯¹ç§°ï¼ˆç”¨æˆ·ä¾§ vs æ•°æ®ä¾§ï¼‰ï¼Œå®é™…ä¸Šæ˜¯å¯¹ç§°çš„ã€‚ä»–é€šè¿‡ç”»å‡ºä¸€ä¸ªå…­è¾¹å½¢å¹¶æŠŠ UI å’Œæ•°æ®åº“ç½®äºå¤–ä¾§æ¥è¡¨ç¤ºè¿™ç§å¯¹ç§°ã€‚æ•°æ®åº“å¦‚åŒ UI ä¸€æ ·ï¼Œåªæ˜¯æŠ€æœ¯ï¼Œåº”ç”¨ç¨‹åºä¸äº†è§£å®ƒï¼Œæ­£å¦‚åŒä¸äº†è§£ UIã€‚ é€šè¿‡ä¸ºå…¶åˆ›å»ºä¸€ä¸ªä»åŠ¨è€…ç«¯å£ï¼Œç„¶åé€šè¿‡åˆ›å»ºä¸€ä¸ªå®ç°è¯¥ç«¯å£çš„ä»åŠ¨è€…é€‚é…å™¨æ¥åº”ç”¨é…ç½®ä¾èµ–æ¨¡å¼ï¼ŒæŠŠåº”ç”¨ç¨‹åºä¸æ•°æ®åº“è§£è€¦ã€‚è¿™æ ·æ•°æ®åº“ä¾èµ–äºåº”ç”¨ç¨‹åºï¼Œè€Œä¸æ˜¯å…¶ä»–æ–¹å¼ã€‚ ç„¶åï¼Œå½“å®ç°å…­è¾¹å½¢æ¶æ„èŒƒä¾‹æ—¶ï¼Œä½œè€…è®¤è¯†åˆ°è¿™ç§å¯¹ç§°å®é™…ä¸Šæ˜¯ä¸å¯¹ç§°çš„ï¼Œå› ä¸ºé…ç½®ä¾èµ–æ¨¡å¼åœ¨ä»åŠ¨è€…ä¾§å’Œé©±åŠ¨è€…ä¾§æ˜¯ä¸åŒçš„ã€‚ åœ¨ä»åŠ¨è€…ä¾§ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»äº†è§£ä»åŠ¨è€…é€‚é…å™¨ï¼Œå› ä¸ºæ˜¯åº”ç”¨ç¨‹åºå¼€å¯å¯¹è¯ã€‚å®ƒå¿…é¡»äº†è§£è¦è·Ÿè°å¯¹è¯ã€‚ è€Œåœ¨å¦ä¸€ä¾§ï¼Œé©±åŠ¨è€…ä¾§ï¼Œæ˜¯å¿…é¡»äº†è§£åº”ç”¨ç¨‹åºçš„é©±åŠ¨è€…é€‚é…å™¨æ¥å¼€å¯å¯¹è¯ã€‚åº”ç”¨ç¨‹åºä¸çŸ¥é“æ˜¯å“ªä¸€ä¸ªé©±åŠ¨è€…æ¥é©±åŠ¨å®ƒçš„ã€‚ æ‰€ä»¥ç»“è®ºæ˜¯ä»€ä¹ˆï¼Ÿâ€œç«¯å£-é€‚é…å™¨â€å¯¹ç§°è¿˜æ˜¯ä¸å¯¹ç§°ï¼Ÿ å…¶å¿…ç„¶ç»“æœå°±æ˜¯â€œå¯¹ç§°â€å’Œâ€œä¸å¯¹ç§°â€å…±å­˜ï¼š  å¯¹ç§°ï¼šæ‰€æœ‰çš„é€‚é…å™¨ï¼ŒåŒ…æ‹¬é©±åŠ¨è€…å’Œä»åŠ¨è€…ï¼Œéƒ½ä¾èµ–äºå…­è¾¹å½¢ã€‚åœ¨ä¸¤ä¾§ï¼Œåº”ç”¨ç¨‹åºéƒ½æ˜¯è·ŸæŠ€æœ¯æ— å…³çš„ã€‚ ä¸å¯¹ç§°ï¼šé…ç½®ä¾èµ–çš„å®ç°åœ¨æ¯ä¸€ä¾§æ˜¯ä¸åŒçš„ã€‚åœ¨é©±åŠ¨è€…ä¾§ï¼Œåº”ç”¨ç¨‹åºä¸äº†è§£æ˜¯å“ªä¸ªé€‚é…å™¨åœ¨é©±åŠ¨å®ƒã€‚ä½†åœ¨ä»åŠ¨è€…ä¾§ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»äº†è§£å®ƒè¦è·Ÿå“ªä¸€ä¸ªä»åŠ¨è€…é€‚é…å™¨å¯¹è¯ã€‚5. - MISCONCEPTIONS: 5. 1 - LAYERED ARCHITECTURE: å¾ˆå¤šæˆ‘è¯»è¿‡çš„å…³äºè¯¥æ¶æ„çš„æ–‡ç« éƒ½è¯´å…¶æ˜¯åˆ†å±‚çš„ã€‚å®ƒä»¬è¯´åˆ°äº†ä¸‰ä¸ªå±‚ï¼šé¢†åŸŸï¼ˆdomainï¼‰ã€ç«¯å£ï¼ˆportsï¼‰ã€é€‚é…å™¨ï¼ˆadaptersï¼‰ã€‚æˆ‘ä¸çŸ¥é“å®ƒä»¬ä¸ºä»€ä¹ˆè¯´è¿™äº›ï¼Œè¿™ä¸ªæ¨¡å¼æ²¡æœ‰è¯´åˆ°ä»»ä½•åˆ†å±‚ã€‚è¯¥æ¨¡å¼åªè¯´æˆ‘ä»¬æœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼ˆå…­è¾¹å½¢ï¼‰ï¼Œå¸¦æœ‰ç»™å®šæ•°é‡çš„ç«¯å£ï¼Œè€Œå¯¹æ¯ä¸ªç«¯å£æˆ‘ä»¬å¯ä»¥æœ‰ä¸åŒçš„é€‚é…å™¨ï¼Œæ¯ä¸ªä½¿ç”¨ä¸€ç§æŠ€æœ¯ã€‚ä¸€ä¸ªå­—éƒ½æ²¡æœ‰è¯´åˆ°åˆ†å±‚ã€‚ 5. 2 - WHY A HEXAGON?: ä¸€äº›äººæƒ³çŸ¥é“ä¸ºä»€ä¹ˆæ˜¯ä¸€ä¸ªå…­è¾¹å½¢ï¼Œå¯èƒ½è®¤ä¸ºè¾¹çš„æ•°é‡å¾ˆé‡è¦ã€‚ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œæ ¹æœ¬ä¸ç”¨åœ¨æ„è¿™ä¸ªã€‚å…­è¿™ä¸ªæ•°å­—å®Œå…¨ä¸é‡è¦ã€‚æ— è®ºå¦‚ä½•ï¼Œå¦‚æœä½ å¥½å¥‡çš„è¯ï¼Œè¿™é‡Œæœ‰ä¸€äº› Alistair Cockburn å…³äºä¸ºä»€ä¹ˆé€‰æ‹©å…­è¾¹å½¢çš„åŸå› ï¼š  ä½ æœ‰äº†è¶³å¤Ÿçš„ç©ºé—´æ¥æç»˜æ‰€éœ€è¦çš„ç«¯å£å’Œé€‚é…å™¨ã€‚ å½¢çŠ¶åº”æŒ‡ç¤ºå†…éƒ¨/å¤–éƒ¨çš„ä¸å¯¹ç§°æ€§ï¼Œè€Œä¸æ˜¯é¡¶éƒ¨/åº•éƒ¨æˆ–å·¦ä¾§/å³ä¾§çš„ã€‚ é‚£ä¹ˆæ­£æ–¹å½¢ä¸åˆé€‚ã€‚ äº”è¾¹å½¢ï¼Œä¸ƒè¾¹å½¢ï¼Œå…«è¾¹å½¢ï¼Œâ€¦â€¦éƒ½å¾ˆéš¾ç»˜åˆ¶ã€‚ å› æ­¤ï¼Œå…­è¾¹å½¢èµ¢äº†ã€‚5. 3 - PORTS OUTSIDE ADAPTERS: æˆ‘çœ‹åˆ°å¾ˆå¤šå›¾æŠŠç«¯å£ç½®äºé€‚é…å™¨ä¹‹å¤–ï¼Œè¿™æ ·å‚ä¸è€…å°±ç›´æ¥ä¸ç«¯å£è¿›è¡Œäº¤äº’ï¼Œè€Œé€‚é…å™¨å°±æ˜¯ç«¯å£è·Ÿå…­è¾¹å½¢ä¹‹é—´çš„ä¸­é—´ä»¶äº†ã€‚è¿™ç§æ–¹å¼ï¼š å‚ä¸è€… ==&gt; ç«¯å£ ==&gt; é€‚é…å™¨ ==&gt; å…­è¾¹å½¢ æ ¹æœ¬æ˜¯ä¸æ­£ç¡®çš„ã€‚ ç«¯å£æ˜¯å…­è¾¹å½¢çš„è¾¹ç•Œã€‚å®é™…ä¸Šï¼Œå®ƒä»¬å±äºå…­è¾¹å½¢ï¼Œæ˜¯å…¶ä¸€éƒ¨åˆ†ï¼Œæ˜¯å…­è¾¹å½¢çš„æ¥å£ã€‚å‚ä¸è€…é€šè¿‡é€‚é…å™¨ä¸å…­è¾¹å½¢ï¼ˆçš„ç«¯å£ï¼‰è¿›è¡Œäº¤äº’ã€‚é€‚é…å™¨æ˜¯å‚ä¸è€…è·Ÿç«¯å£ä¹‹é—´çš„ä¸­é—´ä»¶ã€‚æ­£ç¡®çš„æç»˜æ˜¯ï¼š å‚ä¸è€… ==&gt; é€‚é…å™¨ ==&gt; ï¼ˆç«¯å£ï¼‰å…­è¾¹å½¢ å¯¹äºé©±åŠ¨è€…ä¾§å’Œä»åŠ¨è€…ä¾§éƒ½æ˜¯å¦‚æ­¤ã€‚è¿™å°±æ˜¯â€œç«¯å£-é€‚é…å™¨â€æ¨¡å¼çš„å¯¹ç§°æ€§ã€‚ "
    }, {
    "id": 35,
    "url": "/2020/08/ports-and-adapters-pattern-part1/",
    "title": "â€œç«¯å£â€”é€‚é…å™¨â€æ¨¡å¼çš„æ¦‚å¿µ(1)",
    "body": "2020/08/10 - æœ€è¿‘çœ‹äº†ä¸‹ DDDï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰å’Œåœ¨ Go ä¸­çš„åº”ç”¨ã€‚ç›®å‰çœ‹æ¥ï¼Œæ•´æ´æ¶æ„ï¼ˆClean Architectureï¼‰å’Œ â€œç«¯å£-é€‚é…å™¨æ¶æ„â€ï¼ˆPorts and Adapters Patternï¼Œåˆå«å…­è¾¹å½¢æ¶æ„ Hexagonal Architectureï¼‰æ˜¯ç›¸å¯¹æ¯”è¾ƒæˆç†Ÿçš„æ–¹æ¡ˆäº†ã€‚è€Œåè€…çš„æ¦‚å¿µæ¯”è¾ƒå¤æ‚ä¸€äº›ï¼Œäºæ˜¯åœ¨æ¦‚å¿µä¸Šè¿›è¡Œä¸€äº›æ¢³ç†å’Œæ¾„æ¸…ã€‚æœ¬æ–‡æ˜¯ç¬¬ä¸€éƒ¨åˆ†ã€‚ 1. - INTRODUCTION: â€œç«¯å£â€”é€‚é…å™¨â€æ˜¯ä¸€ä¸ªå¯¹è±¡ç»“æ„æ¨¡å‹ï¼Œç”± Dr. Alistair Cockburn åœ¨ 2005 å¹´æ‰€å†™çš„ä¸€ç¯‡æ–‡ç« ä¸­æå‡ºã€‚ å¦‚æœä½ åœ¨æƒ³â€¦â€¦â€œè¿™æ–‡ç« ä¸ä¼šå¤ªè€äº†ç‚¹å§ï¼Ÿåœ¨è½¯ä»¶å¼€å‘æŒç»­è¿›åŒ–ï¼Œæ–°æŠ€æœ¯æˆ–æ–°æ¡†æ¶æ¯å¤©éƒ½å±‚å‡ºä¸ç©·ï¼Œå¹²æ‰æˆ‘ä»¬æ˜¨å¤©è¿˜åœ¨ç”¨ç€çš„è¿™ä¸ªæ—¶ä»£ï¼Œå®ƒè¿˜æœ‰ä»€ä¹ˆä»·å€¼ï¼Ÿâ€å¾ˆå¥½ï¼Œç­”æ¡ˆå°±åœ¨é—®é¢˜ä¹‹ä¸­ã€‚â€œç«¯å£â€”é€‚é…å™¨â€æ˜¯ä¸€ä¸ªä¿ƒè¿›ä»æŠ€æœ¯å’Œæ¡†æ¶ä¸­è§£è€¦çš„æ¨¡å¼ã€‚æ‰€ä»¥ç­”æ¡ˆæ˜¯ä¸ï¼Œå®ƒå¹¶ä¸è¿‡æ—¶ã€‚å¥½ä¸œè¥¿æ˜¯æ°¸æ’çš„ã€‚å°±åƒé…’ä¸€æ ·ï¼Œæ„ˆé™ˆæ„ˆé¦™ã€‚ â€œç«¯å£â€”é€‚é…å™¨â€çš„ä¸»è¦æ€æƒ³æ˜¯å®šä¹‰äº†åº”ç”¨ç¨‹åºçš„æ¶æ„ï¼Œè¿™æ ·å®ƒå°±èƒ½é€šè¿‡ä¸åŒç±»å‹çš„å®¢æˆ·ç«¯ï¼ˆäººã€æµ‹è¯•ç”¨ä¾‹ã€å…¶ä»–åº”ç”¨ï¼Œç­‰ç­‰ï¼‰æ¥è¿è¡Œï¼Œè€Œä¸”å®ƒèƒ½è¢«ä»åº”ç”¨ç¨‹åºæ‰€ä¾èµ–çš„çœŸå®ä¸–ç•Œçš„å¤–éƒ¨è®¾å¤‡ï¼ˆæ•°æ®åº“ã€æœåŠ¡ç«¯ã€å…¶ä»–åº”ç”¨ç­‰ï¼‰æ¥éš”ç¦»æµ‹è¯•ã€‚ è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ˜¯å¦‚ä½•åšåˆ°çš„ã€‚ 2. - THE ARCHITECTURE: è¿™ä¸€èŠ‚æˆ‘ä»¬ä¼šçœ‹åˆ°â€œç«¯å£â€”é€‚é…å™¨â€æ¨¡å¼çš„è¦ç´ å’Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚ 2. 1 - THE HEXAGON: â€œç«¯å£â€”é€‚é…å™¨â€æ¨¡å¼æŠŠåº”ç”¨ç¨‹åºæè¿°ä¸ºä¸€ä¸ªå°é—­åŒºåŸŸã€‚ è¯¥å°é—­åŒºåŸŸåœ¨ç”± Alistair Cockburn æ¥æç»˜åº”ç”¨ç¨‹åºæ—¶é€‰æ‹©çš„æ˜¯ä¸€ä¸ªå…­è¾¹å½¢ï¼Œè¿™ä¹Ÿæ˜¯è¯¥æ¨¡å¼è¢«ç§°ä¸ºâ€œå…­è¾¹å½¢æ¶æ„â€çš„åŸå› ã€‚ æˆ‘ä¸ªäººæ›´å–œæ¬¢â€œç«¯å£â€”é€‚é…å™¨â€çš„åç§°ï¼Œå› ä¸ºå®ƒæŒ‡å‡ºäº†æ¶æ„çš„å…³é”®è¦ç´ ï¼Œå¦‚åŒæˆ‘ä»¬å°†è¦çœ‹åˆ°çš„ã€‚å¦ä¸€æ–¹é¢ï¼Œç”¨æ¥æç»˜åº”ç”¨ç¨‹åºçš„å›¾å½¢å¹¶ä¸æ˜¯é‚£ä¹ˆé‡è¦ã€‚ç„¶è€Œï¼Œçœ‹èµ·æ¥â€œå…­è¾¹å½¢æ¶æ„â€çš„åç§°æ›´åŠ å¹¿ä¸ºäººçŸ¥ã€‚ å…­è¾¹å½¢æ˜¯åº”ç”¨ç¨‹åºè‡ªèº«ã€‚è¯´â€œå…­è¾¹å½¢â€è·Ÿè¯´â€œåº”ç”¨ç¨‹åºâ€æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Œä»ç°åœ¨èµ·äºŒè€…ä¼šè¢«ä»»æ„ä½¿ç”¨ã€‚ åœ¨å…­è¾¹å½¢å†…ï¼Œæˆ‘ä»¬åªæ”¾ç½®é‚£äº›åº”ç”¨ç¨‹åºå°è¯•è§£å†³çš„é‡è¦ä¸šåŠ¡é—®é¢˜ã€‚ å…­è¾¹å½¢åŒ…å«ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸å…³å¿ƒä»»ä½•æŠ€æœ¯ï¼Œæ¡†æ¶æˆ–è€…çœŸå®ä¸–ç•Œä¸­çš„è®¾å¤‡ã€‚å› æ­¤åº”ç”¨ç¨‹åºæ˜¯ä¸æŠ€æœ¯æ— å…³çš„ã€‚ â€œç«¯å£â€”é€‚é…å™¨â€æ¨¡å¼å¹¶æœªè¯´æ˜å…­è¾¹å½¢å†…éƒ¨ç»“æ„çš„ä»»ä½•ä¸œè¥¿ã€‚ä½ å¯ä»¥ä½¿ç”¨åˆ†å±‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ç‰¹æ€§ç»„ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨æ„å¤§åˆ©é¢æ¡å¼çš„ä»£ç ï¼Œä½ å¯ä»¥ä½¿ç”¨â€œå¤§æ³¥çƒâ€ï¼Œä½ å¯ä»¥ä½¿ç”¨ DDD æˆ˜æœ¯æ¨¡å¼ï¼Œä½ å¯ä»¥ä½¿ç”¨ç®€å•çš„ CRUDã€‚ä¸€åˆ‡å–å†³äºä½ ã€‚ 2. 2 - ACTORS: åœ¨å…­è¾¹å½¢å¤–ï¼Œæ˜¯ä»»ä½•åº”ç”¨ç¨‹åºä¸ä¹‹äº¤äº’çš„çœŸå®ä¸–ç•Œçš„ä¸œè¥¿ã€‚è¿™äº›ä¸œè¥¿åŒ…æ‹¬äººï¼Œå…¶ä»–åº”ç”¨ç¨‹åºï¼Œæˆ–è€…ä»»ä½•ç¡¬ä»¶/è½¯ä»¶è®¾å¤‡ã€‚å®ƒä»¬æ˜¯â€œå‚ä¸è€…â€ã€‚æˆ‘ä»¬å¯ä»¥è¯´è¿™äº›å‚ä¸è€…æ˜¯åº”ç”¨ç¨‹åºçš„ç¯å¢ƒã€‚ å‚ä¸è€…è¢«ç¯ç»•åˆ†å¸ƒåœ¨å…­è¾¹å½¢å¤–ï¼Œæ ¹æ®â€œè°â€è§¦å‘äº†åº”ç”¨ç¨‹åºå’Œå‚ä¸è€…ä¹‹é—´çš„äº¤äº’ï¼š  ä½äºå·¦/ä¸Šä¸€ä¾§çš„å‚ä¸è€…æ˜¯â€œé©±åŠ¨è€…â€ï¼ˆDriversï¼‰ï¼Œæˆ–è€…ä¸»è§’ï¼ˆPrimary Actorsï¼‰ã€‚äº¤äº’ç”±è¯¥å‚ä¸è€…è§¦å‘ã€‚é©±åŠ¨è€…å°±æ˜¯ä¸åº”ç”¨ç¨‹åºäº¤äº’ä»¥è¾¾æˆä¸€ä¸ªç›®æ ‡çš„å‚ä¸è€…ã€‚é©±åŠ¨è€…æ˜¯åº”ç”¨ç¨‹åºçš„ä½¿ç”¨è€…ï¼ˆæ— è®ºäººæˆ–è®¾å¤‡ï¼‰ã€‚ ä½äºå³/ä¸‹ä¸€ä¾§çš„å‚ä¸è€…æ˜¯â€œä»åŠ¨è€…â€ï¼ˆDriven Actorsï¼‰ï¼Œæˆ–è€…é…è§’ï¼ˆSecondary Actorsï¼‰ã€‚äº¤äº’ç”±åº”ç”¨ç¨‹åºæ¥è§¦å‘ã€‚ä»åŠ¨è€…æä¾›åº”ç”¨ç¨‹åºæ‰€éœ€çš„æŸäº›åŠŸèƒ½ä»¥å®ç°ä¸šåŠ¡é€»è¾‘ã€‚æœ‰ä¸¤ç§ç±»å‹çš„ä»åŠ¨è€…ï¼š  Repositoryï¼šåº”ç”¨ç¨‹åºé™¤äº†å‘å…¶å‘é€ä¿¡æ¯å¤–ï¼Œä¹Ÿå¯ä»¥ä»å…¶è·å–ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œæ•°æ®åº“æˆ–ä»»ä½•å…¶ä»–å­˜å‚¨è®¾å¤‡ã€‚ Recipientï¼šåº”ç”¨ç¨‹åºåªå‘å…¶å‘é€ä¿¡æ¯ï¼Œç„¶åå°±å¿˜æ‰å®ƒäº†ã€‚ä¾‹å¦‚ï¼ŒSMTP æœåŠ¡å™¨å‘é€é‚®ä»¶ã€‚ä¸‹å›¾å±•ç¤ºäº†åœ¨é©±åŠ¨å’Œä»åŠ¨ä¸¤ä¾§çš„ä¸€äº›å‚ä¸è€…çš„ç¤ºä¾‹ï¼š è¿™äº›å…³äºä¸»ï¼ˆé©±åŠ¨è€…ï¼‰å’Œæ¬¡ï¼ˆä»åŠ¨è€…ï¼‰å‚ä¸è€…çš„æ¦‚å¿µæ¶‰åŠåˆ°äº†ä½¿ç”¨åœºæ™¯ã€‚ æ‰€ä»¥ï¼Œè¦çŸ¥é“åœ¨åº”ç”¨ç¨‹åºè·Ÿå‚ä¸è€…äº¤äº’ä¸­ï¼Œè¯¥å‚ä¸è€…æ˜¯å“ªç§ç±»å‹ï¼Œé—®é—®ä½ è‡ªå·±ï¼Œâ€œè°â€è§¦å‘äº†å¯¹è¯ã€‚å¦‚æœç­”æ¡ˆæ˜¯å‚ä¸è€…ï¼Œå®ƒå°±æ˜¯é©±åŠ¨è€…ã€‚å¦‚æœç­”æ¡ˆæ˜¯åº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆè¯¥å‚ä¸è€…å°±æ˜¯ä»åŠ¨è€…ã€‚ 2. 3 - PORTS: å‚ä¸è€…ä¸åº”ç”¨ç¨‹åºä¹‹é—´çš„äº¤äº’æ ¹æ®å®ƒä»¬ä¸åº”ç”¨ç¨‹åºäº¤äº’çš„åŸå› è€Œç»„ç»‡åœ¨å…­è¾¹å½¢çš„è¾¹ç•Œå¤„ã€‚ å…·æœ‰ç»™å®šç›®çš„/æ„å›¾çš„æ¯ç»„äº¤äº’å°±æ˜¯ä¸€ä¸ªç«¯å£ã€‚ ç«¯å£åº”æ ¹æ®å…¶ç”¨é€”è€Œä¸æ˜¯ä»»ä½•æŠ€æœ¯æ¥å‘½åã€‚ å› æ­¤ï¼Œä¸ºäº†å‘½åç«¯å£ï¼Œæˆ‘ä»¬åº”ä½¿ç”¨ä»¥â€œingâ€ç»“å°¾çš„åŠ¨è¯ï¼Œå¹¶åº”è¯´â€œæ­¤ç«¯å£ç”¨äºâ€¦ingæŸç‰©â€ã€‚ä¾‹å¦‚ï¼š  è¿™ä¸ªé©±åŠ¨è€…ç«¯å£æ˜¯ç”¨äºâ€œæ·»åŠ ï¼ˆaddingï¼‰å•†å“åˆ°è´­ç‰©è½¦â€ã€‚ è¿™ä¸ªä»åŠ¨è€…ç«¯å£ï¼ˆrepositoryï¼‰æ˜¯ç”¨äºâ€œè·å–ï¼ˆobtainingï¼‰è®¢å•ä¿¡æ¯â€ã€‚ è¿™ä¸ªä»åŠ¨è€…ç«¯å£ï¼ˆrecipientï¼‰æ˜¯ç”¨äºâ€œå‘é€ï¼ˆsendingï¼‰æé†’â€ã€‚ç«¯å£æ˜¯åº”ç”¨ç¨‹åºçš„è¾¹ç•Œï¼Œä¸Šé¢çš„å›¾ä¾‹ä¸­ç«¯å£å°±æ˜¯å…­è¾¹å½¢çš„è¾¹ã€‚ä»å¤–éƒ¨ä¸–ç•Œï¼Œå‚ä¸è€…åªèƒ½è·Ÿå…­è¾¹å½¢çš„ç«¯å£äº¤äº’ï¼Œå®ƒä»¬ä¸åº”è¯¥è®¿é—®åˆ°å…­è¾¹å½¢çš„å†…éƒ¨ã€‚ç«¯å£æ˜¯åº”ç”¨ç¨‹åºæä¾›ç»™å¤–éƒ¨ä¸–ç•Œçš„æ¥å£ï¼Œå…è®¸å‚ä¸è€…ä¸åº”ç”¨ç¨‹åºäº¤äº’ã€‚æ‰€ä»¥ï¼Œåº”ç”¨ç¨‹åºåº”è¯¥éµå¾ªInformation Hiding Principleã€‚ä¸€ä»¶å€¼å¾—æ³¨æ„çš„é‡è¦äº‹æƒ…æ˜¯ï¼Œç«¯å£å±äºåº”ç”¨ç¨‹åºã€‚ é©±åŠ¨è€…ç«¯å£ä¸ºå¤–éƒ¨ä¸–ç•Œçš„é©±åŠ¨è€…æä¾›äº†åº”ç”¨ç¨‹åºçš„åŠŸèƒ½ã€‚å› æ­¤ï¼Œé©±åŠ¨è€…ç«¯å£è¢«è®¤ä¸ºæ˜¯åº”ç”¨ç¨‹åºçš„ç”¨ä¾‹è¾¹ç•Œã€‚ å®ƒä»¬æ˜¯åº”ç”¨ç¨‹åºçš„ APIã€‚ ä¾èµ–äºåŠŸèƒ½åˆ†ç»„æ—¶æ‰€é‡‡ç”¨çš„ç²’åº¦ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ä¸€ä¸ªç«¯å£ä½œä¸ºå¾ˆå¤šç”¨ä¾‹çš„æ¥å£ï¼Œæˆ–åªä½œä¸ºå°‘æ•°ç”¨ä¾‹çš„æ¥å£ã€‚å¦‚æœæˆ‘ä»¬æœŸæœ›éµå¾ªSingle Responsibility Principleï¼Œé‚£ä¹ˆå°†ä¼šæœ‰å¾ˆå¤šç«¯å£ï¼Œæ¯ä¸ªé’ˆå¯¹ä¸€ä¸ªç”¨ä¾‹ã€‚è¿™ç§åœºæ™¯ä¸‹ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©æ˜¯ä¸ºç«¯å£ä½¿ç”¨ command bus è®¾è®¡æ¨¡å¼ï¼Œå¯¹æ¯ä¸ªç”¨ä¾‹ä½¿ç”¨ä¸€ä¸ª command handlerã€‚åŒæ ·çš„æ€æƒ³å¯ä»¥è¢«ç”¨åœ¨æŸ¥è¯¢ä¸Šï¼Œè¿™æ ·æˆ‘ä»¬å°†ä¹Ÿä¼šå–œæ¬¢ CQRS æ¨¡å¼ã€‚æˆ‘ä»¬ä¼šæœ‰ä¸€ä¸ªç«¯å£è´Ÿè´£æ‰§è¡Œå‘½ä»¤ï¼Œå¦ä¸€ä¸ªç«¯å£è´Ÿè´£æ‰§è¡ŒæŸ¥è¯¢ã€‚ ä»åŠ¨è€…ç«¯å£æ˜¯åŠŸèƒ½çš„æ¥å£ï¼Œè¯¥åŠŸèƒ½æ˜¯åº”ç”¨ç¨‹åºå®ç°ä¸šåŠ¡é€»è¾‘æ‰€éœ€çš„ã€‚è¿™äº›åŠŸèƒ½æ˜¯ç”±ä»åŠ¨å‚ä¸è€…æä¾›çš„ã€‚æ‰€ä»¥ä»åŠ¨è€…ç«¯å£æ˜¯åº”ç”¨ç¨‹åºæ‰€éœ€çš„ SPIï¼ˆService Provider Interfaceï¼‰ã€‚ä»åŠ¨è€…ç«¯å£ä¼šç±»ä¼¼äº Required Interfaceã€‚ 2. 4 - ADAPTERS: å‚ä¸è€…é€šè¿‡ä½¿ç”¨ç‰¹å®šæŠ€æœ¯çš„é€‚é…å™¨ä¸å…­è¾¹å½¢çš„ç«¯å£è¿›è¡Œäº¤äº’ã€‚ä¸€ä¸ªé€‚é…å™¨å°±æ˜¯ä¸€ä¸ªè½¯ä»¶ç»„ä»¶ï¼Œå…è®¸ç”¨ä¸€ç§æŠ€æœ¯ä¸å…­è¾¹å½¢çš„ç«¯å£æ¥äº¤äº’ã€‚ç»™å®šä¸€ä¸ªç«¯å£ï¼Œå¯¹äºæˆ‘ä»¬æƒ³è¦ä½¿ç”¨çš„æ¯ç§æŠ€æœ¯éƒ½å¯ä»¥æœ‰ä¸€ä¸ªé€‚é…å™¨ã€‚é€‚é…å™¨æ˜¯åœ¨åº”ç”¨ç¨‹åºå¤–éƒ¨çš„ã€‚ é©±åŠ¨è€…é€‚é…å™¨ä½¿ç”¨é©±åŠ¨è€…ç«¯å£çš„æ¥å£ï¼ŒæŠŠä¸€ç§ç‰¹å®šæŠ€æœ¯çš„è¯·æ±‚è½¬æ¢ä¸ºå¯¹é©±åŠ¨è€…ç«¯å£æŠ€æœ¯æ— å…³çš„è¯·æ±‚ã€‚ ä¸‹å›¾å±•ç¤ºäº†æŸäº›é©±åŠ¨è€…é€‚é…å™¨çš„ç¤ºä¾‹ï¼š  ä¸€ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼šæŠŠæµ‹è¯•ç”¨ä¾‹è½¬æ¢ä¸ºå¯¹é©±åŠ¨è€…ç«¯å£çš„è¯·æ±‚ã€‚ ä¸€ä¸ª CLIï¼šæŠŠè¾“å…¥æ–‡æœ¬è½¬æ¢åˆ° console ä¸­ã€‚ ä¸€ä¸ªæ¡Œé¢åº”ç”¨ç¨‹åº GUIï¼šé€šè¿‡å›¾å½¢ç»„ä»¶è½¬æ¢è¢«è§¦å‘çš„äº‹ä»¶ã€‚ ä¸€ä¸ª MVC Web åº”ç”¨ç¨‹åºï¼šController æ¥æ”¶ä» View ä¸­ç”±ç”¨æˆ·è¯·æ±‚çš„è¡Œä¸ºï¼Œå¹¶æŠŠå…¶è½¬æ¢ä¸ºå¯¹é©±åŠ¨è€…ç«¯å£çš„è¯·æ±‚ã€‚ ä¸€ä¸ª REST API controllerï¼šè½¬æ¢ REST API è¯·æ±‚ã€‚ ä¸€ä¸ªäº‹ä»¶è®¢é˜…è€…ï¼šæŠŠæ¥è‡ªæ¶ˆæ¯é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼ˆäº‹ä»¶ï¼‰è½¬æ¢åˆ°æ‰€è®¢é˜…çš„åº”ç”¨ç¨‹åºã€‚å¯¹äºæ¯ä¸ªé©±åŠ¨è€…ç«¯å£ï¼Œéƒ½åº”è¯¥è‡³å°‘æœ‰ä¸¤ä¸ªç«¯å£ï¼šä¸€ä¸ªç”¨äºçœŸå®é©±åŠ¨è€…çš„æ‰§è¡Œï¼Œå¦ä¸€ä¸ªç”¨äºæµ‹è¯•è¯¥ç«¯å£çš„è¡Œä¸ºã€‚ ä»åŠ¨è€…é€‚é…å™¨å®ç°ä¸€ä¸ªä»åŠ¨è€…ç«¯å£çš„æ¥å£ï¼ŒæŠŠè¯¥ç«¯å£ä¸æŠ€æœ¯æ— å…³çš„æ–¹æ³•è½¬æ¢ä¸ºç‰¹å®šæŠ€æœ¯çš„æ–¹æ³•ã€‚ ä¸‹å›¾å±•ç¤ºäº†ä»åŠ¨é€‚é…å™¨çš„æŸäº›ç¤ºä¾‹ï¼š  ä¸€ä¸ª mock é€‚é…å™¨ï¼šæ¨¡ä»¿çœŸå®é…è§’çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå†…å­˜æ•°æ®åº“ã€‚ ä¸€ä¸ª SQL é€‚é…å™¨ï¼šå®ç°ä¸€ä¸ªä»åŠ¨è€…ç«¯å£ä»¥é€šè¿‡ SQL æ•°æ®åº“æŒä¹…åŒ–æ•°æ®ã€‚ ä¸€ä¸ª email é€‚é…å™¨ï¼šå®ç°ä¸€ä¸ªä»åŠ¨è€…ç«¯å£ä»¥é€šè¿‡å‘é€é‚®ä»¶æé†’äººä»¬ã€‚ ä¸€ä¸ª App-To-App é€‚é…å™¨ï¼šå®ç°ä¸€ä¸ªä»åŠ¨è€…ç«¯å£ä»¥é€šè¿‡å‘è¿œç¨‹åº”ç”¨ç¨‹åºè¯·æ±‚æ¥è·å–æŸäº›æ•°æ®ã€‚ ä¸€ä¸ªäº‹ä»¶å‘å¸ƒè€…ï¼šå®ç°ä¸€ä¸ªä»åŠ¨è€…ç«¯å£ä»¥é€šè¿‡å‘é€äº‹ä»¶åˆ°æ¶ˆæ¯é˜Ÿåˆ—æ¥å‘å¸ƒå®ƒä»¬ï¼Œè¿™æ ·å®ƒä»¬å¯¹è®¢é˜…è€…å°±å¯ç”¨äº†ã€‚å¯¹äºæ¯ä¸ªä»åŠ¨è€…ç«¯å£ï¼Œæˆ‘ä»¬éƒ½åº”è¯¥ç¼–å†™è‡³å°‘ä¸¤ä¸ªé€‚é…å™¨ï¼šä¸€ä¸ªç”¨äºçœŸå®ä¸–ç•Œçš„è®¾å¤‡ï¼Œå¦ä¸€ä¸ªæ˜¯ mockï¼Œç”¨äºæ¨¡æ‹ŸçœŸå®è¡Œä¸ºã€‚ é€‚é…å™¨æœ€ç»ˆæ‰€åšçš„å°±æ˜¯æŠŠä¸€ä¸ªæ¥å£è½¬æ¢åˆ°å¦ä¸€ä¸ªï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Adapter Design Pattern æ¥å®ç°å®ƒã€‚ æ¯ä¸ªç«¯å£è¦ä½¿ç”¨å“ªç§é€‚é…å™¨æ˜¯åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶è¦é…ç½®çš„ã€‚è¿™èµ‹äºˆäº†è¯¥æ¨¡å¼ä»¥çµæ´»æ€§ï¼Œå› æ­¤æˆ‘ä»¬èƒ½å¤Ÿåœ¨æ¯æ¬¡è¿è¡Œåº”ç”¨ç¨‹åºæ—¶ä»ä¸€ç§æŠ€æœ¯åˆ‡æ¢åˆ°å¦ä¸€ç§ã€‚å¦‚æœé’ˆå¯¹ä»åŠ¨è€…ç«¯å£æˆ‘ä»¬é€‰æ‹©äº†ä¸€ä¸ªæµ‹è¯•é©±åŠ¨è€…å’Œ mocks é€‚é…å™¨ï¼Œåº”ç”¨ç¨‹åºå°±å¯ä»¥è¿›è¡Œéš”ç¦»æ€§æµ‹è¯•ã€‚ 2. 5 - SUMMARY: æ­£å¦‚æˆ‘ä»¬çœ‹åˆ°çš„ï¼Œè¯¥æ¶æ„çš„è¦ç´ æœ‰è¿™äº›ï¼š  å…­è¾¹å½¢ ==&gt; åº”ç”¨ç¨‹åº     é©±åŠ¨è€…ç«¯å£ ==&gt; åº”ç”¨ç¨‹åºæä¾›çš„ API   ä»åŠ¨è€…ç«¯å£ ==&gt; åº”ç”¨ç¨‹åºæ‰€éœ€çš„ SPI    å‚ä¸è€… ==&gt; ä¸åº”ç”¨ç¨‹åºäº¤äº’çš„ç¯å¢ƒè®¾å¤‡     é©±åŠ¨è€… ==&gt; åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ï¼ˆæ— è®ºäººè¿˜æ˜¯ç¡¬ä»¶/è½¯ä»¶ è®¾å¤‡ï¼‰   ä»åŠ¨è€… ==&gt; æä¾›åº”ç”¨ç¨‹åºæ‰€éœ€çš„æœåŠ¡    é€‚é…å™¨ ==&gt; è°ƒæ•´ç‰¹å®šæŠ€æœ¯ä»¥é€‚é…åº”ç”¨ç¨‹åº     é©±åŠ¨è€…é€‚é…å™¨ ==&gt; ä½¿ç”¨é©±åŠ¨è€…ç«¯å£   ä»åŠ¨è€…é€‚é…å™¨ ==&gt; å®ç°ä»åŠ¨è€…ç«¯å£   é™¤äº†è¿™äº›è¦ç´ ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ª Composition Rootï¼ˆä¹Ÿè¢« Robert C. Martin ç§°ä¸ºâ€œMain Componentâ€ï¼Œåœ¨ä»–çš„ Clean Architecture: A Craftsmanâ€™s Guide to Software Structure and Design ä¹¦ä¸­ï¼‰ã€‚è¿™ä¸ªç»„ä»¶ä¼šåœ¨å¯åŠ¨æ—¶è¿è¡Œå¹¶æ„å»ºæ•´ä¸ªç³»ç»Ÿï¼Œä¼šåšå¦‚ä¸‹äº‹æƒ…ï¼š  å®ƒåˆå§‹åŒ–å¹¶é…ç½®ç¯å¢ƒï¼ˆæ•°æ®åº“ã€æœåŠ¡ï¼Œç­‰ç­‰ï¼‰ å¯¹äºæ¯ä¸ªä»åŠ¨è€…ç«¯å£ï¼Œå®ƒé€‰æ‹©ä¸€ä¸ªå®ç°äº†è¯¥ç«¯å£çš„ä»åŠ¨è€…é€‚é…å™¨ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªè¯¥é€‚é…å™¨çš„å®ä¾‹ã€‚ å®ƒåˆ›å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºçš„å®ä¾‹ï¼Œå°†ä»åŠ¨è€…é€‚é…å™¨çš„å®ä¾‹æ³¨å…¥åˆ°åº”ç”¨ç¨‹åºæ„é€ å‡½æ•°ä¸­ã€‚ å¯¹äºæ¯ä¸ªé©±åŠ¨è€…ç«¯å£ï¼š     å®ƒé€‰æ‹©ä¸€ä¸ªä½¿ç”¨è¯¥ç«¯å£çš„é©±åŠ¨è€…é€‚é…å™¨ï¼Œå¹¶åˆ›å»ºå…¶å®ä¾‹ï¼ŒæŠŠåº”ç”¨ç¨‹åºçš„å®ä¾‹æ³¨å…¥åˆ°è¯¥é€‚é…å™¨æ„é€ å‡½æ•°ä¸­ã€‚   å®ƒè¿è¡Œè¯¥é©±åŠ¨è€…é€‚é…å™¨çš„å®ä¾‹ã€‚   2. 6 - EXAMPLE: ä¸€ä¸ª Web æ¥å£çš„ç®€å•åº”ç”¨ç¨‹åºï¼Œç”±å…¬å¸é›‡å‘˜ä½¿ç”¨æ¥ç›¸äº’åˆ†é…ä»»åŠ¡ã€‚å½“ä¸€ä¸ªé›‡å‘˜è¢«åˆ†é…ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œåº”ç”¨ç¨‹åºå‘ä»–/å¥¹å‘é€ä¸€å°é‚®ä»¶ã€‚ "
    }, {
    "id": 36,
    "url": "/2020/07/github-special-readme-appear-on-profile/",
    "title": "GitHubä¸ªäººé¡µé¢çš„æ–°ç©æ³•",
    "body": "2020/07/27 - æœ€è¿‘ GitHub æ¨å‡ºäº†ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œè®©ä½ å¯ä»¥å±•ç°æ›´åŠ ä¸ªæ€§çš„ Profile é¡µé¢ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸è‡ªå·± GitHub è´¦å·åŒåã€ä¸”åŒ…å«README. mdçš„ Repoï¼Œé‚£ä¹ˆè¿™ä¸ªREADME. mdçš„å†…å®¹å°†ä¼šè‡ªåŠ¨æ˜¾ç¤ºåœ¨ä½ çš„ä¸ªäºº Profile é¡µé¢ä¸Šï¼Œè€Œä¸”æ˜¯åœ¨é¡¶éƒ¨å±•ç¤ºã€‚è¿™ä¸ªæ–°åŠŸèƒ½ä¸€ä¸‹å­å¼•å‘äº†å¤§é‡å¼€å‘è€…çš„æå¤§å…´è¶£ï¼Œå„è‡ªå…«ä»™è¿‡æµ·å„æ˜¾ç¥é€šï¼ŒæŠŠè¿™ä¸ªä¸œè¥¿ç©å‡ºäº†â€œèŠ±â€ã€‚ æ¯”å¦‚æˆ‘è‡ªå·±çš„ GitHub è´¦å·æ˜¯xfyuanï¼Œå°±å¯ä»¥åœ¨è‡ªå·±è´¦å·ä¸‹åˆ›å»ºä¸€ä¸ªåç§°ä¹Ÿå«xfyuançš„ Repoï¼Œå¹¶ä¸”åŒ…å«ä¸€ä¸ªREADME. mdã€‚è¿™æ—¶å¯ä»¥åœ¨é¡µé¢ä¸Šçœ‹åˆ° GitHub è´´å¿ƒåœ°å‘Šè¯‰ä½ å®ƒçš„ç‰¹åˆ«ç”¨é€”ï¼š å†ç»“åˆåˆ«çš„å¼€å‘è€…æä¾›çš„ä¸€äº› GitHub Actions ç­‰å·¥å…·ï¼Œå°±å¯ä»¥åšåˆ°è®©å…¶å®šæ—¶è‡ªåŠ¨è·å–æˆ‘çš„æœ€æ–°åšå®¢åˆ—è¡¨å¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚è¿˜å¯ä»¥å±•ç¤ºæˆ‘çš„ GitHub å½“å‰çš„å„ç§ç»Ÿè®¡æ•°å­—ï¼Œç”šè‡³å¯ä»¥åˆ—å‡ºæˆ‘è´¦å·ä¸‹æ‰€æœ‰ Repo ç”¨åˆ°çš„å„ç§å¼€å‘è¯­è¨€å æ¯”ï¼Œç­‰ç­‰ã€‚æœ€åï¼Œæ‰“å¼€æˆ‘çš„ GitHub Profile é¡µé¢ï¼Œå°±å˜æˆäº†è¿™æ ·ï¼š æ•ˆæœéå¸¸ä¸é”™ï¼ æœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥ç›´æ¥çœ‹æˆ‘çš„ README. md æ˜¯æ€ä¹ˆåšçš„ã€‚ è¦æ˜¯è¿˜æƒ³æŠŠ GitHub ä¸ªäººé¡µé¢å¼„å¾—å†é…·ç‚«ä¸€äº›çš„è¯ï¼Œè‡ªå·±åˆ°ä¸‹é¢è¿™äº›èµ„æºåˆ—é‡Œç¿»æ‰¾æŠ˜è…¾å§ï¼š  abhisheknaiidu/awesome-github-profile-readmeï¼šå„ç§æ–° README æ”¶é›†å¤§å…¨ï¼Œç‰¹åˆ«æ˜¯ GitHub Actions é‚£éƒ¨åˆ†ï¼Œæœ€æœ‰æŠ€æœ¯å‚è€ƒå«é‡ï¼Œèƒ½ç©å‡ºçš„èŠ±æ ·æœ€å¤šã€‚ GitHub éšè—æ–°åŠŸèƒ½ï¼ä¸ªäººé¡µè¿˜èƒ½è¿™ä¹ˆç©ï¼Ÿ ä½ åœ¨ GitHub ä¸Šçœ‹åˆ°è¿‡çš„æœ€æœ‰æ„æ€çš„é¡¹ç›®æ˜¯ä»€ä¹ˆï¼Ÿ"
    }, {
    "id": 37,
    "url": "/2020/07/became-github-arctic-code-vault-contributor/",
    "title": "æˆä¸º2020 GitHubåŒ—ææºä»£ç ä¿é™©åº“è®¡åˆ’çš„è´¡çŒ®è€…",
    "body": "2020/07/24 - GitHub æœ€è¿‘å…¬å¸ƒäº†ä¸€é¡¹â€œåŒ—ææºä»£ç ä¿é™©åº“è®¡åˆ’â€ï¼Œè¦æŠŠå¼€æºè½¯ä»¶ä»£ç åŸ‹è—åœ¨åŒ—æçš„æ•°ç™¾ç±³åœ°åº•ï¼Œè‡³å°‘ä¿å­˜ 1000 å¹´ã€‚ä» GitHub çš„å®˜æ–¹åšå®¢å…¬å‘Šçœ‹ï¼Œç›®å‰å·²ç»æœ‰æ•°ç™¾ä¸‡å¼€å‘è€…çš„å¼€æºä»£ç è¢«ä¿å­˜åˆ°è¿™ä¸ªâ€œä¿é™©åº“â€ä¸­äº†ã€‚å¯ä»¥åœ¨æ¯ä¸ªäººçš„ GitHub Profile é¡µé¢ä¸­æŸ¥çœ‹åˆ°è‡ªå·±æœ‰æ²¡æœ‰æˆä¸ºå…¶ä¸­ä¹‹ä¸€ã€‚ å¹¸è¿çš„æ˜¯ï¼Œæˆ‘å…¥é€‰äº†ï¼Œè‡ªå·± GitHub ä¸Šçš„éƒ¨åˆ†æºç å·²ç»è¢«å°å­˜åˆ°åŒ—æçš„åœ°ä¸‹:)ã€‚çœ‹åˆ°ä¸‹é¢æˆªå›¾ä¸­å·¦ä¸‹è§’çš„â€œHighlightâ€ä¹ˆï¼Ÿå¦‚æœä½ æœ‰è·Ÿæˆ‘ä¸€æ ·çš„â€œArctic Code Vault Contributorâ€è¿™ä¸€è¡Œï¼Œé‚£å°±æ˜¯äº†ï¼æŠŠé¼ æ ‡ Hover ä¸Šå»ä¼šå‡ºç°ä¸€ä¸ªæµ®åŠ¨çª—å£ï¼Œæ˜¾ç¤ºä½ å…¥é€‰çš„æºç é¡¹ç›®ã€‚ çœ‹æ¥ï¼Œå¯ä»¥ç»™è‡ªå·±çš„ç®€å†åŠ ä¸Šè¿™æ ·ä¸€æ äº†ï¼Œå“ˆå“ˆğŸ˜„ï¼ â€œæˆä¸º 2020 GitHub åŒ—ææºä»£ç ä¿é™©åº“è®¡åˆ’è´¡çŒ®è€…ä¹‹ä¸€â€ "
    }, {
    "id": 38,
    "url": "/2020/07/testprof-factory-therapy-for-ruby-tests/",
    "title": "Rubyæµ‹è¯•çš„â€œå·¥å‚ç–—æ³•â€",
    "body": "2020/07/23 - æœ¬æ–‡å·²è·å¾—åŸä½œè€…ï¼ˆVladimir Dementyevï¼‰å’Œ Evil Martians æˆæƒè®¸å¯è¿›è¡Œç¿»è¯‘ã€‚åŸæ–‡æ˜¯ TestProf è¿™ä¸ª Evil Martians å‡ºå“çš„ Gem ä»‹ç»æ–‡ç« ç³»åˆ—çš„ç¬¬äºŒç¯‡ã€‚ä½œè€…ä»‹ç»äº†é€ æˆ Ruby æ…¢æµ‹è¯•çš„ä¸€ä¸ªä¸»è¦å…ƒå‡¶â€”â€”Factory Cascadeï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨ TestProf æ¥æ¶ˆç­è¿™ä¸ªå…ƒå‡¶ã€‚æ–‡ä¸­ä¹Ÿæåˆ°äº†ä¼—æ‰€å‘¨çŸ¥çš„ Factories vs. Fixtures é—®é¢˜ï¼Œè€Œ TestProf å¯ä»¥åšåˆ°è®©ä½ é±¼å’Œç†ŠæŒå…¼å¾—ã€‚  åŸæ–‡é“¾æ¥ï¼šTestProf II: Factory therapy for your Ruby tests â€” Martian Chronicles, Evil Martiansâ€™ team blog ä½œè€…ï¼šVladimir Dementyev ç«™ç‚¹ï¼šEvil Martians â€”â€”ä½äºçº½çº¦å’Œä¿„ç½—æ–¯çš„ Ruby on Rails å¼€å‘äººå‘˜åšå®¢ã€‚ å®ƒå‘å¸ƒäº†è®¸å¤šä¼˜ç§€çš„æ–‡ç« ï¼Œå¹¶ä¸”æ˜¯ä¸å°‘ gem çš„èµåŠ©å•†ã€‚ã€ä¸‹é¢æ˜¯æ­£æ–‡ã€‘ æ¦‚è¿°: å­¦ä¹ å¦‚ä½•æŠŠä½ çš„ Ruby æµ‹è¯•å¥—ä»¶å¸¦å›åˆ°å¥åº·æ»¡æ»¡ã€é€Ÿåº¦æ»¡æ»¡çš„è·¯ä¸Šï¼Œé€šè¿‡ä½¿ç”¨ TestProfâ€”â€”ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·åŒ…æ¥è¯Šæ–­æ‰€æœ‰è·Ÿæµ‹è¯•æœ‰å…³çš„é—®é¢˜ã€‚è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬æ¥èŠèŠ factoriesï¼šå®ƒä»¬å¦‚ä½•æ‹–æ…¢ä½ çš„æµ‹è¯•ï¼Œå¦‚ä½•æ¥ä¼°é‡é‚£äº›è´Ÿé¢å½±å“ï¼Œå¦‚ä½•é¿å…ï¼Œä»¥åŠå¦‚ä½•è®©ä½ çš„ factories è·Ÿ fixtures ä¸€æ ·å¿«ã€‚ å‰è¨€: TestProfï¼Œç”¨äºå¾ˆå¤š Evil Martians çš„é¡¹ç›®ï¼Œä»¥ç¼©çŸ­ TDD çš„åé¦ˆç¯ï¼Œå¯¹ä»»ä½•å…¶æµ‹è¯•è¿è¡Œæ—¶é—´è¶…è¿‡ä¸€åˆ†é’Ÿçš„ Railsï¼ˆæˆ–å…¶ä»–åŸºäº Ruby çš„ï¼‰åº”ç”¨è€Œè¨€éƒ½æ˜¯ä¸€ä¸ªå¿…å¤‡å·¥å…·ã€‚å®ƒé€šè¿‡æ‰©å±•æœ‰å…³åŠŸèƒ½è€Œå¯¹ RSpec å’Œ minitest å‡å¯é€‚ç”¨ã€‚ åœ¨æˆ‘ä»¬å±•ç¤ºè¯¥å¼€æºé¡¹ç›®çš„ä»‹ç»æ–‡ç« é‡Œï¼Œå½“æ—¶æ‰¿è¯ºä¼šæœ‰ä¸€ç¯‡ä¸“é—¨æ–‡ç« æ¥è®²è¿°åœ¨æµ‹è¯• Ruby Web åº”ç”¨æ—¶è¢«ç»å¸¸å¿½è§†çš„ä¸€ä¸ªé—®é¢˜ï¼šfactory cascadesã€‚æœ¬æ–‡å°±æ˜¯æˆ‘ä»¬æ‰€æ‰¿è¯ºçš„ä¸œè¥¿ã€‚ é€šè¿‡åœ¨ä½ çš„å®é™…æµ‹è¯•ä¸­è¿è¡Œä¸€ä¸‹ TestProf æœ‰ä¸ªæ¦‚è§ˆæ˜¯æ¯”è¾ƒå¥½çš„ã€‚æ‰€ä»¥å¦‚æœä½ æ‰‹è¾¹æ°å¥½æœ‰ä¸€ä¸ª RSpec è¦†ç›–çš„ Rails é¡¹ç›®ï¼Œä¸”ä½¿ç”¨äº† factory_botï¼ˆä¹‹å‰é—»åçš„åå­—å« factory_girlï¼‰çš„ factoriesâ€”â€”æˆ‘ä»¬å»ºè®®ä½ é˜…è¯»ä¸‹å»ä¹‹å‰å®‰è£…è¯¥ gemï¼Œé‚£ä¹ˆè¿™å°†ä¼šæ˜¯ä¸€ä¸ªäº’åŠ¨å¼æ¼”ç»ƒï¼ å®‰è£… TestProf å¾ˆç®€å•ï¼ŒæŠŠä¸‹é¢è¿™è¡Œæ·»åŠ åˆ°ä½ Gemfileçš„:testç»„ï¼š group :test do gem 'test-prof'endCrumbling factories: æ— è®ºä½•æ—¶è¦æµ‹è¯•è‡ªå·±çš„åº”ç”¨æ—¶ï¼Œæˆ‘ä»¬éƒ½éœ€è¦ç”Ÿæˆæµ‹è¯•æ•°æ®â€”â€”ä¸¤ç§å¸¸è§çš„æ–¹å¼å°±æ˜¯ factories å’Œ fixturesã€‚ factory æ˜¯ä¸€ä¸ªå¯ä»¥æ ¹æ®é¢„å®šä¹‰ schema ç”Ÿæˆå…¶ä»–å¯¹è±¡ï¼ˆå¯ä»¥è¢«æŒä¹…åŒ–ï¼Œä¹Ÿå¯ä»¥ä¸ï¼‰å¹¶åŠ¨æ€å®ç°çš„å¯¹è±¡ã€‚ Fixtures ç›¸å½“äºä¸€ä¸ªä¸åŒçš„æ–¹æ¡ˆï¼šå®ƒä»¬å£°æ˜æ•°æ®çš„é™æ€çŠ¶æ€ï¼Œå…¶ä¼šè¢«ç«‹å³åŠ è½½åˆ°æµ‹è¯•æ•°æ®åº“ä¸­ï¼Œä¸”é€šå¸¸åœ¨æµ‹è¯•è¿è¡Œä¹‹é—´ä¿æŒä¸å˜ã€‚ åœ¨ Rails ä¸–ç•Œä¸­ï¼Œæˆ‘ä»¬æœ‰å†…ç½® fixtures å’Œå¹¿å—æ¬¢è¿çš„ç¬¬ä¸‰æ–¹ factory å·¥å…·ï¼ˆæ¯”å¦‚ factory_bot, Fabrication, åŠå…¶ä»–ï¼‰ã€‚ å°½ç®¡å…³äº â€œfactories vs. fixturesâ€ çš„è¾©è®ºçœ‹èµ·æ¥æ°¸è¿œä¸ä¼šåœæ­¢ï¼Œä¸è¿‡æˆ‘ä»¬ä»ç„¶æŠŠ factories è§†ä¸ºä¸€ç§æ›´åŠ çµæ´»ä¹Ÿæ›´æ˜“äºç»´æŠ¤çš„æ–¹å¼æ¥å¤„ç†æµ‹è¯•æ•°æ®ã€‚ ç„¶è€Œï¼Œèƒ½åŠ›è¶Šå¤§è´£ä»»è¶Šå¤§ï¼šfactories æ›´å®¹æ˜“è®©ä½ æ¬èµ·çŸ³å¤´ç ¸è‡ªå·±çš„è„šï¼Œè®©ä½ çš„æµ‹è¯•é™·å…¥å›°å¢ƒã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•åˆ¤æ–­è‡ªå·±æ˜¯å¦æ»¥ç”¨äº†è¿™ç§èƒ½åŠ›å¹¶ä¸”è¯¥æ€ä¹ˆåŠï¼Ÿé¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹æµ‹è¯•å¥—ä»¶è€—è´¹åœ¨ factories ä¸Šçš„æ—¶é—´æœ‰å¤šå°‘ã€‚ å¯¹æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨è¿™ä¸ªâ€œè‰¯åŒ»â€ï¼šTestProfã€‚è¯¥ gem æ˜¯ä¸ªå®Œæ•´çš„è¯Šæ–­å·¥å…·åŒ…ï¼ŒEventProf ä¸ºå…¶ä¸­å·¥å…·ä¹‹ä¸€ã€‚é¡¾åæ€ä¹‰ï¼šå®ƒæ˜¯ä¸€ä¸ªäº‹ä»¶åˆ†æå™¨ï¼Œå¯ä»¥è®©å®ƒè¿½è¸ªfactory. createäº‹ä»¶ï¼Œå®ƒä¼šåœ¨ä½ æ¯æ¬¡è°ƒç”¨FactoryBot. create()æ—¶è¢«è§¦å‘ï¼ŒåŒæ—¶ä¸€ä¸ª factory ç”Ÿæˆçš„å¯¹è±¡è¢«ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚ EventProf å¯¹ RSpec å’Œ minitest éƒ½æ”¯æŒï¼Œæœ‰ä¸€ä¸ªå‘½ä»¤è¡Œç•Œé¢ï¼Œæ‰€ä»¥åœ¨ä»»ä½• Rails é¡¹ç›®ç›®å½•ä¸‹å¯åŠ¨ç»ˆç«¯ï¼ˆå½“ç„¶ï¼Œå®ƒå¿…é¡»å¾—æœ‰æµ‹è¯•å’Œ factoriesï¼Œä¸”æœ¬æ–‡ä¸­æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹éƒ½å‡è®¾ç”¨çš„æ˜¯ RSpecï¼‰å¹¶è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š $ EVENT_PROF= factory. create  bundle exec rspecåœ¨è¾“å‡ºä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°ä» factories åˆ›å»ºæ•°æ®æ‰€èŠ±è´¹çš„æ€»æ—¶é—´ï¼Œä»¥åŠå‰äº”ä¸ªæœ€æ…¢çš„æµ‹è¯•ï¼š [TEST PROF INFO] EventProf results for factory. createTotal time: 03:07. 353Total events: 7459Top 5 slowest suites (by time):UsersController (users_controller_spec. rb:3) â€“ 00:10. 119 (581 / 248)DocumentsController (documents_controller_spec. rb:3) â€“ 00:07. 494 (71 / 24)RolesController (roles_controller_spec. rb:3) â€“ 00:04. 972 (181 / 76)Finished in 6 minutes 36 seconds (files took 32. 79 seconds to load)3158 examples, 0 failures, 7 pendingä»æˆ‘ä»¬é¡¹ç›®ä¹‹ä¸€å–å‡ºçš„ä¸€ä¸ªçœŸå®èŒƒä¾‹ä¸­ï¼ˆé‡æ„ä¹‹å‰ï¼‰ï¼Œåœ¨å…­åˆ†åŠçš„æµ‹è¯•è¿è¡Œæ—¶é—´é‡Œï¼Œè¶…è¿‡ä¸‰åˆ†é’Ÿæ˜¯ç”¨äºç”Ÿæˆæµ‹è¯•æ•°æ®ï¼Œå…¶å‡ ä¹å æ®äº† 50%ã€‚è¿™å¹¶ä¸ä»¤äººæƒŠè®¶ï¼šæˆ‘æ›¾ç»å·¥ä½œè¿‡çš„ä¸€äº›ä»£ç åº“ä¸Šï¼Œä» factories ç”Ÿæˆæ•°æ®èŠ±è´¹äº†å¤šè¾¾ 80% çš„æµ‹è¯•æ—¶é—´ã€‚ å¹³é™ä¸€ä¸‹ï¼Œè¯·ç»§ç»­é˜…è¯»ï¼Œæˆ‘ä»¬æ˜ç™½å¦‚ä½•ä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚ The name of the game is â€œcascadeâ€: æ ¹æ®å¤šå¹´ä»¥æ¥çš„è§‚æµ‹å’Œå¯¹ TestProf çš„å¼€å‘ï¼Œä»¥åŠå¯¹æ‰€æœ‰ä¸æµ‹è¯•æœ‰å…³ä¸œè¥¿çš„åˆ†æï¼Œæ…¢æµ‹è¯•çš„åŸå› é‡Œæœ€å¤§çš„ä¸€ä¸ªæ˜¯â€”â€”factory cascadeã€‚ è®©æˆ‘ä»¬æ¥åšä¸€ä¸ªæ¼”ç¤ºï¼š factory :comment do sequence(:body) { |n|  Awesome comment ##{n}  } author answerendfactory :answer do sequence(:body) { |n|  Awesome answer ##{n}  } author questionendfactory :question do sequence(:title) { |n|  Awesome question ##{n}  } author account # suppose it's our tenant in SaaS applicationendfactory :author do sequence(:name) { |n|  Awesome author ##{n}  } accountendfactory :account do sequence(:name) { |n|  Awesome account ##{n}  }endç°åœ¨ï¼Œè¯•ç€çŒœä¸€ä¸‹ï¼Œä¸€æ—¦ä½ è°ƒç”¨create(:comment)ï¼Œä¼šæœ‰å¤šå°‘æ¡è®°å½•è¢«åˆ›å»ºåˆ°æ•°æ®åº“ä¸­ï¼Ÿå¦‚æœä½ å·²ç»æœ‰äº†ç­”æ¡ˆï¼Œè¯·ç»§ç»­å¾€ä¸‹çœ‹ã€‚  é¦–å…ˆï¼Œæˆ‘ä»¬å¯¹äºcommentç”Ÿæˆäº†ä¸€ä¸ªbodyã€‚ä½†è¿˜æ²¡æœ‰è®°å½•è¢«åˆ›å»ºï¼Œæ‰€ä»¥è¿™æ—¶æ€»æ•°æ˜¯ 0ã€‚ æ¥ä¸‹æ¥ï¼Œå¯¹äºcommentæˆ‘ä»¬éœ€è¦ä¸€ä¸ªauthorã€‚authoråº”è¯¥å±äºaccountï¼Œå› æ­¤æˆ‘ä»¬åˆ›å»ºäº†ä¸¤æ¡è®°å½•ã€‚æ€»æ•°ï¼š2ã€‚ æ¯ä¸ª comment éœ€è¦ä¸€ä¸ªå¯æ³¨é‡Šçš„å¯¹è±¡ï¼Œå¯¹å§ï¼Ÿæˆ‘ä»¬è¿™é‡Œæ˜¯answerã€‚answerè‡ªèº«éœ€è¦ä¸€ä¸ªauthorè·Ÿaccountã€‚è¿™å°±å¤šäº†ä¸‰æ¡è®°å½•ã€‚æ€»æ•°ï¼š2 + 2 = 4ã€‚ã€è¯‘è€…æ³¨ï¼šåŸæ–‡è¿™é‡Œæœ‰ç‚¹æè¿°ä¸æ¸…æ™°ã€‚å‰é¢è¯´â€œä¸‰æ¡è®°å½•â€ï¼Œæ˜¯æŠŠ answerã€authorã€account ä¸€èµ·ç®—ä¸Šçš„ï¼Œåé¢æ€»æ•°è®¡ç®—çš„æ•°å­—åˆæŒ‰ 2 æ¥åŠ ï¼Œåº”è¯¥æ²¡è®¡å…¥ answerã€‚ç»“åˆåæ–‡çœ‹ï¼Œanswer æ˜¯åœ¨æœ€åä¸€æ­¥æ‰è®¡å…¥çš„ï¼Œæ‰€ä»¥è¿™é‡ŒæŒ‰ 2 ç®—æ˜¯å¯¹çš„ã€‚ã€‘ answerä¹Ÿéœ€è¦ä¸€ä¸ªquestionï¼Œå…¶æœ‰è‡ªå·±çš„authorè·Ÿåè€…è‡ªèº«çš„accountã€‚è€Œä¸”ï¼Œæˆ‘ä»¬çš„:question factory ä¹ŸåŒ…å«ä¸€ä¸ªaccountå…³è”ã€‚æ€»æ•°ï¼š4 + 4 = 8 ç°åœ¨æˆ‘ä»¬å¯ä»¥åˆ›å»ºanswerä»¥åŠcommentæœ¬èº«äº†ã€‚æ€»æ•°ï¼š 8 + 2 = 10ã€‚å°±æ˜¯å¦‚æ­¤ï¼ä½¿ç”¨create(:comment)åˆ›å»ºä¸€ä¸ª comment äº§ç”Ÿäº†åæ¡æ•°æ®åº“è®°å½•ã€‚ æˆ‘ä»¬éœ€è¦å¤šä¸ª account å’Œä¸åŒçš„ author æ¥æµ‹è¯•ä¸€ä¸ªå•ç‹¬çš„ comment å—ï¼Ÿä¸å¤ªå¯èƒ½å§ã€‚ ä½ å¯ä»¥æƒ³è±¡å‡ºå½“æˆ‘ä»¬åˆ›å»ºå¤šä¸ª comment æ—¶ï¼Œæ¯”å¦‚create_list(:comment, 10)ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆã€‚ä¼‘æ–¯æ•¦ï¼Œæˆ‘ä»¬ç¢°ä¸Šéº»çƒ¦äº†ã€‚ã€è¯‘è€…æ³¨ï¼šç”µå½±ã€Šé˜¿æ³¢ç½—13ã€‹çš„ç»å…¸å°è¯ã€‘ é­é‡ factory cascadeâ€”â€”ä¸€ä¸ªé€šè¿‡åµŒå¥— factory è°ƒç”¨ç”Ÿæˆè¿‡é‡æ•°æ®çš„æ— æ³•æ§åˆ¶çš„è¿‡ç¨‹ã€‚ æˆ‘ä»¬å¯ä»¥æŠŠ cascade ç”¨ä¸€é¢—æ ‘æ¥æç»˜ï¼š comment||-- author|  ||  |-- account||-- answer   |   |-- author   |  |   |  |-- account   |   |-- question   |  |   |  |-- author   |  |  |   |  |  |-- account   |  |   |  |--accountè®©æˆ‘ä»¬æŠŠè¿™ç§å‘ˆç°å½¢å¼ç§°ä¸º factory æ ‘ã€‚ç¨åä¼šç”¨åœ¨æˆ‘ä»¬çš„åˆ†æä¸­ã€‚ Fire walk with me: EventProf ä»…ä¸ºæˆ‘ä»¬å±•ç¤ºäº†èŠ±è´¹åœ¨ factories ä¸Šçš„æ€»æ—¶é—´ï¼Œä¹Ÿå› æ­¤èƒ½å¤Ÿè¯†åˆ«å‡ºæŸäº›ä¸œè¥¿ä¸å¯¹ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä»ç„¶ä¸çŸ¥é“å®ƒä»¬åœ¨å“ªå„¿ï¼Œé™¤éå»æŒ–æ˜ä»£ç åšçŒœè°œæ¸¸æˆã€‚ä½¿ç”¨ TestProf åŒ»ç–—åŒ…ä¸­çš„å¦ä¸€ä¸ªå·¥å…·ï¼Œå°±ä¸ç”¨è¿™ä¹ˆéº»çƒ¦äº†ã€‚ ç¬¬äºŒä¸ªåˆ†æå™¨ç™»åœºï¼šFactoryProfã€‚ä½ å¯ä»¥è¿™æ ·æ¥è¿è¡Œå®ƒï¼š $ FPROF=1 bundle exec rspecæŠ¥å‘Šç»“æœåˆ—å‡ºäº†æ‰€æœ‰ factories åŠå…¶ä½¿ç”¨æƒ…å†µç»Ÿè®¡ï¼š [TEST PROF INFO] Factories usage total   top-level              name 1298       2             account 1275       69              city  524      516              room  551      549              user  396      117           membership524 examples, 0 failuresè¿™é‡Œçš„totalå’Œtop-levelç»“æœæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿtotalå€¼æ˜¯ä¸€ä¸ª factory è¢«ä½¿ç”¨ç”Ÿæˆæ•°æ®è®°å½•çš„æ¬¡æ•°ï¼Œä¸ç®¡æ˜¾å¼ä½¿ç”¨ï¼ˆé€šè¿‡createè°ƒç”¨ï¼‰ï¼Œè¿˜æ˜¯åœ¨å¦ä¸€ä¸ª factory å†…çš„éšå¼ä½¿ç”¨ï¼ˆé€šè¿‡å…³è”å…³ç³»å’Œå›è°ƒï¼‰ï¼›è€Œtop-levelå€¼ä»…è€ƒè™‘æ˜¾å¼è°ƒç”¨ã€‚ å› æ­¤ï¼Œtop-levelå€¼å’Œtotalå€¼ä¹‹é—´çš„æ˜æ˜¾ä¸åŒå°±å¯èƒ½æŒ‡ç¤ºäº† factory cascadeï¼šå‘ŠçŸ¥æˆ‘ä»¬ä¸€ä¸ª factory æ›´ç»å¸¸ä»å…¶ä»– factories è¢«å¼•ç”¨ï¼Œè€Œéç›´æ¥è°ƒç”¨å…¶è‡ªèº«ã€‚ å¦‚ä½•å‡†ç¡®æ‰¾å‡ºè¿™ä¸ªâ€œå…¶ä»– factoriesâ€ï¼Ÿå°±ç”¨å‰é¢è®¨è®ºè¿‡çš„ factory æ ‘æ¥å¸®å¿™ï¼æˆ‘ä»¬æ¥æŠŠè¿™é¢—æ ‘å¹³é“ºå±•å¼€ï¼ˆä½¿ç”¨ pre-order traversalï¼‰å¹¶æŠŠç»“æœåˆ—è¡¨ç§°ä¸º factory å †æ ˆï¼š // factory stack built from the factory tree above[:comment, :author, :account, :answer, :author, :account, :question, :author, :account, :account]ä¸‹é¢æ˜¯å¦‚ä½•ä»¥ç¼–ç¨‹æ–¹æ³•æ„å»º factory å †æ ˆçš„æ–¹å¼ï¼š  æ¯æ¬¡FactoryBot. create(:thing)è¢«è°ƒç”¨æ—¶ï¼Œä¸€ä¸ªæ–°å †æ ˆå°±è¢«åˆå§‹åŒ–ï¼ˆä½¿ç”¨:smthä½œä¸ºé¦–å…ƒç´ ï¼‰ã€‚ æ¯æ¬¡å¦ä¸€ä¸ª factory åœ¨ä¸€ä¸ª:thingå†…è¢«ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬æŠŠå…¶å‹å…¥å †æ ˆã€‚ä¸ºä»€ä¹ˆå †æ ˆå¾ˆæ£’ï¼Ÿæ­£å¦‚è·Ÿå †æ ˆè°ƒç”¨é‚£æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç»˜åˆ¶ç«ç„°å›¾ï¼è€Œæœ‰ä»€ä¹ˆæ¯”ç«ç„°å›¾æ›´é…·çš„å‘¢ï¼Ÿ FactoryProf äº†è§£å¦‚ä½•ç”Ÿæˆäº¤äº’çš„ HTML ç«ç„°å›¾æŠ¥å‘Šï¼Œå¼€ç®±å³ç”¨ã€‚ä¸‹é¢æ˜¯å¦ä¸€ä¸ªå‘½ä»¤è¡Œè°ƒç”¨ï¼š $ FPROF=flamegraph bundle exec rspecè¾“å‡ºç»“æœåŒ…å«ä¸€ä¸ª HTML æŠ¥å‘Šçš„è·¯å¾„ï¼š [TEST PROF INFO] FactoryFlame report generated: tmp/test_prof/factory-flame. htmlåœ¨ä½ æµè§ˆå™¨ä¸­æ‰“å¼€ï¼Œå¯ä»¥çœ‹åˆ°ç±»ä¼¼è¿™æ ·ï¼š æˆ‘ä»¬æ€æ ·æ¥é˜…è¯»å®ƒï¼Ÿ æ¯ä¸€æ ä»£è¡¨ä¸€ä¸ª factory å †æ ˆã€‚è¯¥æ è¶Šå®½ï¼Œè¯¥å †æ ˆåœ¨æµ‹è¯•ä¸­è€—è´¹çš„æ—¶é—´è¶Šå¤šã€‚rooté‚£æ å±•ç¤ºäº† top-level createè°ƒç”¨çš„æ€»æ•°ã€‚ å¦‚æœä½ çš„ FactoryFlame æŠ¥å‘Šçœ‹èµ·æ¥è±¡çº½çº¦çš„å¤§å¦è½®å»“çº¿é‚£æ ·å‚å·®ä¸é½ï¼Œè¿™å°±æ˜¯æœ‰å¾ˆå¤š factory cascade äº†ï¼ˆæ¯ä¸ªâ€œæ‘©å¤©å¤§æ¥¼â€ä»£è¡¨ä¸€ä¸ª cascadeï¼‰ï¼š å°½ç®¡çœ‹èµ·æ¥æ™¯è‰²å¾ˆç¾ï¼Œä½†è¿™å¹¶éä½ ç†æƒ³çš„æ—  cascade æŠ¥å‘Šåº”æœ‰çš„æ¨¡æ ·ã€‚ç›¸åï¼Œä½ çš„ç›®æ ‡åº”è¯¥æ˜¯è±¡è·å…°ä¹¡æ‘é‚£æ ·å¹³å¦çš„ä¸œè¥¿ï¼š Doctor, am I going to live?: çŸ¥é“å¦‚ä½•å‘ç° cascade æ˜¯ä¸å¤Ÿçš„â€”â€”æˆ‘ä»¬è¿˜éœ€è¦æ¶ˆç­å®ƒä»¬ã€‚è®©æˆ‘ä»¬æ¥è€ƒè™‘æœ‰å…³çš„å‡ ç§æŠ€æœ¯å§ã€‚ Explicit associations: æ¶Œä¸Šå¿ƒå¤´çš„ç¬¬ä¸€ä¸ªåšæ³•å°±æ˜¯ä»æˆ‘ä»¬çš„ factories ç§»é™¤æ‰€æœ‰ï¼ˆæˆ–å‡ ä¹æ‰€æœ‰ï¼‰å…³è”å…³ç³»ï¼š factory :comment do sequence(:body) { |n|  Awesome comment ##{n}  } # do not declare associations # author # answerendé‡‡ç”¨è¿™ä¸ªæ–¹æ¡ˆï¼Œä½ åœ¨ä½¿ç”¨ä¸€ä¸ª factory æ—¶å¿…é¡»æ˜ç¡®æŒ‡å®šæ‰€æœ‰éœ€è¦çš„å…³è”å…³ç³»ï¼š create(:comment, author: user, answer: answer)# But!create(:comment) # =&gt; raises ActiveRecord::InvalidRecordæœ‰äººå¯èƒ½ä¼šé—®ï¼šæˆ‘ä»¬ä½¿ç”¨ factories ä¸å°±æ˜¯ä¸ºäº†æ¯æ¬¡é¿å…æŒ‡å®šæ‰€éœ€çš„å‚æ•°ä¹ˆï¼Ÿå¯¹ï¼Œæ²¡é”™ã€‚ç”¨è¿™ä¸ªæ–¹æ¡ˆï¼Œfactories å˜å¿«äº†ï¼Œä½†ä¹Ÿæ›´æ²¡ç”¨äº†ã€‚ Association inference: æœ‰æ—¶å€™ï¼ˆé€šå¸¸æ˜¯åœ¨å¤„ç† denormalizationæ—¶ï¼‰æ˜¯å¯èƒ½ä»å…¶ä»–å…³ç³»æ¨æ–­å‡ºå…³è”å…³ç³»çš„ï¼š factory :question do sequence(:title) { |n|  Awesome question ##{n}  } author account do  # infer account from author  author&amp;. account endendç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™create(:question)æˆ–create(:question, author: user)è€Œä¸åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ accountã€‚ æˆ‘ä»¬ä¹Ÿèƒ½å¤Ÿä½¿ç”¨ç”Ÿå‘½å‘¨æœŸå›è°ƒï¼š factory :question do sequence(:title) { |n|  Awesome question ##{n}  } transient do  author :undef  account :undef end after(:build) do |question, _evaluator|  # if only author is specified, set account to author's account  question. account ||= author. account unless author == :undef  # if only account is specified, set author to account's owner  question. author ||= account. owner unless account == :undef endendè¿™ä¸ªæ–¹æ¡ˆä¼šå¾ˆæœ‰æ•ˆï¼Œä½†éœ€è¦å¾ˆå¤šé‡æ„ï¼ˆè€Œä¸”ï¼Œå¦ç‡åœ°è®²ï¼Œè®© factories æ›´éš¾é˜…è¯»ï¼‰ã€‚ Factory default: è€Œ TestProf æä¾›äº†å¦ä¸€ç§æ–¹å¼æ¥æ¶ˆé™¤ cascadeâ€”â€”FactoryDefaultã€‚å®ƒæ˜¯ä¸€ä¸ª factory_bot çš„æ‰©å±•ï¼Œé€šè¿‡å…è®¸ä½ éšå¼é‡ç”¨ factory å†…çš„è®°å½•ï¼Œæ¥å¯ç”¨æ›´ç®€æ´å’Œæ›´ä¸æ˜“å‡ºé”™çš„ DSLï¼Œä»¥åˆ›å»ºæœ‰å…³è”å…³ç³»çš„é»˜è®¤å€¼ã€‚è€ƒè™‘å¦‚ä¸‹ç¤ºä¾‹ï¼š describe 'PATCH #update' do let!(:account) { create_default(:account) } let!(:author) { create_deafult(:author) } # implicitly uses account defined above let!(:question) { create_default(:question) } # implicitly uses account and author defined above let(:answer) { create(:answer) } # implicitly uses question and author defined above let(:another_question) { create(:question) } # uses the same account and author let(:another_answer) { create(:answer) } # uses the same question and author # . . . endè¿™ä¸ªæ–¹æ¡ˆçš„ä¸»è¦ä¼˜åŠ¿åœ¨äºä½ ä¸å¿…ä¿®æ”¹è‡ªå·±çš„ factoriesã€‚ä½ æ‰€æœ‰éœ€è¦åšçš„å°±æ˜¯æŠŠæµ‹è¯•ä¸­çš„ä¸€äº›create(â€¦)è°ƒç”¨æ›¿æ¢ä¸ºcreate_default(â€¦)ã€‚ å¦ä¸€æ–¹é¢ï¼Œè¿™ä¸ªç‰¹æ€§ä¹Ÿä¸ºä½ çš„æµ‹è¯•å¸¦æ¥äº†ä¸€äº›é­”æ³•ï¼Œæ‰€ä»¥è¯·è°¨æ…ä½¿ç”¨ï¼Œå› ä¸ºæµ‹è¯•åº”è¯¥å°½å¯èƒ½ä¿æŒå¯è¯»æ€§ã€‚ä»…é’ˆå¯¹ top-level çš„å®ä½“ï¼ˆæ¯”å¦‚å¤šç§Ÿæˆ· App ä¸­çš„ç§Ÿæˆ·ï¼‰ä½¿ç”¨æ˜¯ä¸ªä¸é”™çš„ä¸»æ„ã€‚ Bonus: AnyFixture: åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬åªè®¨è®ºäº† factory cascadeã€‚ä» TestProf æŠ¥å‘Šä¸­æˆ‘ä»¬è¿˜èƒ½çœ‹å‡ºå…¶ä»–ä»€ä¹ˆå‘¢ï¼Ÿ è®©æˆ‘ä»¬å†æ¥çœ‹ä¸€çœ¼ FactoryProf æŠ¥å‘Šï¼š [TEST PROF INFO] Factories usage total   top-level              name 1298       2             account 1275       69              city  524      516              room  551      549              user524 examples, 0 failuresæ³¨æ„åˆ°roomå’Œuser factories è¢«ä½¿ç”¨äº†è·Ÿæµ‹è¯•ç”¨ä¾‹æ€»æ•°å¤§çº¦ç›¸åŒçš„æ¬¡æ•°ã€‚å› æ­¤ï¼Œåœ¨æ¯ä¸ªç”¨ä¾‹ä¸­ä¸¤è€…å¯èƒ½éƒ½éœ€è¦ã€‚å¯¹äºæ‰€æœ‰ç”¨ä¾‹ä¸€æ¬¡æ€§åˆ›å»ºè¿™äº›è®°å½•å‘¢ï¼Ÿé‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ fixturesã€‚ ç”±äºæˆ‘ä»¬å·²ç»æœ‰äº† factoriesï¼Œé‡ç”¨å®ƒä»¬æ¥ç”Ÿæˆ fixtures ä¼šæ˜¯å¾ˆæ£’çš„ã€‚æœ‰è¯· AnyFixture ç™»åœºã€‚ ä½ å¯ä»¥ä¸ºæ•°æ®ç”Ÿæˆä½¿ç”¨ä»»ä½•ä»£ç å—ï¼Œè€Œ AnyFixture ä¼šåœ¨è¿è¡Œç»“æŸæ—¶è´Ÿè´£æ¸…ç†æ•°æ®åº“ã€‚ AnyFixture å¯ä»¥å¾ˆå¥½åœ°è·Ÿ RSpec çš„ shared contexts ä¸€èµ·å·¥ä½œï¼š # Activate AnyFixture DSL (fixture) through refinementsusing TestProf::AnyFixture::DSLshared_context  shared user , user: true do # You should call AnyFixture outside of transaction to re-use the same # data between examples before(:all) do  fixture(:user) { create(:user, room: room) } end let(:user) { fixture(:user) }endç„¶åæ¿€æ´»è¯¥ shared contextï¼š describe CitiesController, :user do before { sign_in user } # . . . endéšç€ AnyFixture çš„å¯ç”¨ï¼ŒFactoryProf æŠ¥å‘Šä¼šçœ‹èµ·æ¥è¿™æ ·ï¼š total   top-level              name 1298       2             account 1275       69              city 8        1              room 2        1              user524 examples, 0 failuresçœ‹èµ·æ¥å®Œç¾ï¼Œä¸æ˜¯ä¹ˆï¼Ÿ å°å­©å­æ‰å¯¹ factories å’Œ fixtures åšé€‰æ‹©ï¼Œæˆ‘ä»¬å…¨éƒ½è¦ï¼ é™„è®°: æ„Ÿè°¢é˜…è¯»ï¼ Factories ä¸ºä½ çš„æµ‹è¯•æ•°æ®ç”Ÿæˆå¸¦æ¥äº†ç®€å•å’Œçµæ´»ï¼Œä½†å®ƒä»¬éå¸¸è„†å¼±â€”â€”cascade å¦‚å¹½çµèˆ¬å‡ºç°ï¼Œè€Œé‡å¤åœ°æ•°æ®åˆ›å»ºä¼šæ¶ˆè´¹å¤§é‡çš„æ—¶é—´ã€‚ ç…§é¡¾å¥½ä½ çš„ factories å§ï¼Œå®šæœŸå¸¦å®ƒä»¬å»çœ‹çœ‹åŒ»ç”Ÿï¼ˆTestProfï¼‰ã€‚è®©æµ‹è¯•æ›´å¿«é€Ÿï¼Œå¼€å‘è€…å°±æ›´å¿«ä¹ï¼ è¯·é˜…è¯» TestProf ä»‹ç»æ–‡ç«  ä»¥äº†è§£æ›´å¤šè¯¥é¡¹ç›®å’Œå…¶ä»–ä½¿ç”¨åœºæ™¯èƒŒåçš„åˆè¡·ã€‚ "
    }, {
    "id": 39,
    "url": "/2020/07/testprof-doctor-for-slow-ruby-tests/",
    "title": "Rubyæ…¢æµ‹è¯•çš„â€œè‰¯åŒ»åœ£æ‰‹â€",
    "body": "2020/07/21 - æœ¬æ–‡å·²è·å¾—åŸä½œè€…ï¼ˆVladimir Dementyevï¼‰å’Œ Evil Martians æˆæƒè®¸å¯è¿›è¡Œç¿»è¯‘ã€‚åŸæ–‡ä»‹ç»äº† TestProf è¿™ä¸ª Evil Martians å‡ºå“çš„å¼ºå¤§ Gemã€‚ä½œè€…é€šè¿‡è¯¦ç»†çš„èŒƒä¾‹åœºæ™¯å’Œä»£ç æ¼”ç¤ºï¼Œè¯´æ˜äº† TestProf æ€æ ·å¯¹ Ruby æµ‹è¯•è¿›è¡Œæ€§èƒ½åˆ†æï¼Œæ‰¾å‡ºæ…¢æµ‹è¯•çš„ç—›ç‚¹ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å…¶æä¾›çš„å·¥å…·ç®±å¯¹æ…¢æµ‹è¯•æ”¹è¿›ï¼Œç¼©çŸ­æµ‹è¯•è¿è¡Œæ—¶é—´ï¼Œè¿›è¡Œä»¤äººæ„‰æ‚¦çš„ Ruby å¼€å‘ã€‚  åŸæ–‡é“¾æ¥ï¼šTestProf: a good doctor for slow Ruby tests â€” Martian Chronicles, Evil Martiansâ€™ team blog ä½œè€…ï¼šVladimir Dementyev ç«™ç‚¹ï¼šEvil Martians â€”â€”ä½äºçº½çº¦å’Œä¿„ç½—æ–¯çš„ Ruby on Rails å¼€å‘äººå‘˜åšå®¢ã€‚ å®ƒå‘å¸ƒäº†è®¸å¤šä¼˜ç§€çš„æ–‡ç« ï¼Œå¹¶ä¸”æ˜¯ä¸å°‘ gem çš„èµåŠ©å•†ã€‚ã€ä¸‹é¢æ˜¯æ­£æ–‡ã€‘ æ¦‚è¿°: ç¼–å†™æµ‹è¯•æ˜¯å¼€å‘è¿‡ç¨‹çš„é‡è¦éƒ¨åˆ†ï¼Œå°¤å…¶æ˜¯åœ¨ Ruby å’Œ Rails ç¤¾åŒºã€‚æˆ‘ä»¬å¹³å¸¸ä¸ä¼šå…³æ³¨æµ‹è¯•ç”¨ä¾‹å¥—ä»¶çš„æ€§èƒ½ï¼Œç›´åˆ°å‘ç°è‡ªå·±åœ¨å¯¹æµ‹è¯•â€œç»¿ç‚¹â€çš„ç­‰å¾…ä¸­å·²ç»è€—è´¹äº†å¤ªå¤šæ—¶é—´ä¸ºæ­¢ã€‚ å‰è¨€: æˆ‘å·²ç»èŠ±è´¹äº†è®¸å¤šæ—¶é—´ç”¨åœ¨åˆ†ææµ‹è¯•å¥—ä»¶çš„æ€§èƒ½ä¸Šï¼Œä¹Ÿå¼€å‘äº†ä¸€äº›å¾ˆæœ‰ç”¨çš„æŠ€æœ¯å’Œå·¥å…·æ¥è®©æµ‹è¯•è·‘å¾—æ›´å¿«ã€‚æˆ‘æŠŠæ‰€æœ‰è¿™äº›é›†åˆåˆ°äº†ä¸€ä¸ªç§°ä¸º TestProf çš„ Gem ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ª Ruby æµ‹è¯•çš„åˆ†æå·¥å…·ç®±ã€‚ The Motivation: æ…¢æµ‹è¯•æµªè´¹ä½ çš„æ—¶é—´ï¼Œé™ä½ä½ çš„æ•ˆç‡ã€‚ ä½ å¯èƒ½åœ¨æ‰ªå¿ƒè‡ªé—®ï¼šâ€œä¸ºä»€ä¹ˆæµ‹è¯•æ€§èƒ½å¾ˆé‡è¦ï¼Ÿâ€ã€‚åœ¨ç»™å‡ºä»»ä½•å»ºè®®ä¹‹å‰ï¼Œè®©æˆ‘å‘ä½ å±•ç¤ºä¸€äº›ç»Ÿè®¡æ•°æ®å§ã€‚ ä»Šå¹´æ—©äº›æ—¶å€™æˆ‘åšè¿‡ä¸€ä¸ªå°è°ƒæŸ¥ï¼Œè¯¢é—®äº† Ruby å¼€å‘è€…å…³äºå…¶æµ‹è¯•åå¥½çš„å†…å®¹ã€‚ é¦–å…ˆâ€”â€”å„ä½ï¼Œå¥½æ¶ˆæ¯æ˜¯â€”â€”äº‹å®è¯æ˜å¤§å¤šæ•° Ruby å¼€å‘è€…éƒ½ç¡®å®ä¼šç¼–å†™æµ‹è¯•ï¼ˆå¦ç‡åœ°è¯´ï¼Œæˆ‘å¹¶ä¸æ„Ÿåˆ°æƒŠè®¶ï¼‰ã€‚é¡ºä¾¿è¯´ä¸€å¥ï¼Œè¿™å°±æ˜¯æˆ‘ä¹‹æ‰€ä»¥å¦‚æ­¤å–œæ¬¢ Ruby ç¤¾åŒºçš„åŸå› ã€‚ æ ¹æ®è¿™ä¸ªè°ƒæŸ¥ï¼Œæ‰€æœ‰æµ‹è¯•å¥—ä»¶åªæœ‰å››åˆ†ä¹‹ä¸€å…¶è¿è¡Œæ—¶é—´è¶…è¿‡ 10 åˆ†é’Ÿâ€”â€”åŒæ—¶åªæœ‰ä¸€åŠæ˜¯è¿è¡Œå°‘äº 5 åˆ†é’Ÿã€‚ çœ‹èµ·æ¥æƒ…å†µè¿˜ä¸åï¼Œå¯¹å§ï¼Ÿé‚£è®©æˆ‘ä»¬åªæ¥çœ‹æ‹¥æœ‰è¶…è¿‡ 1000 ä¸ªæµ‹è¯•ç”¨ä¾‹çš„æƒ…å†µã€‚ ç°åœ¨çœ‹èµ·æ¥å°±å·®å¤šäº†ï¼šå°†è¿‘ä¸€åŠçš„æµ‹è¯•å¥—ä»¶è¿è¡Œéƒ½è¶…è¿‡äº† 10 åˆ†é’Ÿï¼Œè€Œå‡ ä¹ 30%â€”â€”æ›´æ˜¯è¶…è¿‡äº† 20 åˆ†é’Ÿã€‚ é¡ºä¾¿è¯´ä¸€å¥ï¼Œæˆ‘ä¸€ç›´å·¥ä½œç€çš„ä¸€ä¸ªå…¸å‹ Rails åº”ç”¨æœ‰ç€ 6000 ï½ 10000 ä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚ å½“ç„¶ï¼Œä½ ä¸æ˜¯æ¯æ¬¡è¿›è¡Œä¸€ä¸ªæ”¹åŠ¨åéƒ½å¿…é¡»è¿è¡Œæ•´ä¸ªæµ‹è¯•å¥—ä»¶ã€‚é€šå¸¸ï¼Œå½“æˆ‘åšä¸€ä¸ªä¸­ç­‰å¤§å°çš„åŠŸèƒ½æ—¶ï¼Œæ¯æ¬¡æäº¤ä¹‹å‰ä¼šè¿è¡Œå¤§çº¦ 100 ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œè€Œè¿™åªèŠ±è´¹ä¸€åˆ†é’Ÿå·¦å³ã€‚ä½†å³ä½¿è¿™æ ·çš„â€œä¸€åˆ†é’Ÿâ€ä¹Ÿå½±å“åˆ°äº†æˆ‘çš„åé¦ˆç¯ï¼ˆå‚çœ‹ Justin Searls çš„æ¼”è®²ï¼‰ä»è€Œæµªè´¹äº†æˆ‘çš„æ—¶é—´ã€‚ å°½ç®¡å¦‚æ­¤ï¼Œåœ¨éƒ¨ç½²å‘¨æœŸä¹‹å†…ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¿…é¡»åœ¨ä½¿ç”¨ CI æœåŠ¡æ—¶è¿è¡Œæ‰€æœ‰æµ‹è¯•ã€‚ä½ æ˜¯å¦æ„¿æ„ç­‰å¾…å¥½å‡ ååˆ†é’Ÿï¼ˆå¦‚æœé˜Ÿåˆ—ä¸­æœ‰å¤§é‡çš„æ„å»ºï¼Œç”šè‡³è¦æ•°å°æ—¶ï¼‰æ¥éƒ¨ç½²ä¸€ä¸ª hotfixï¼Ÿ æˆ‘å¾ˆæ€€ç–‘ã€‚ å¹¶å‘åœ°æ„å»ºä¼šæœ‰æ‰€å¸®åŠ©ï¼Œä½†å®ƒä»¬æ˜¯æœ‰ä»£ä»·çš„ã€‚çœ‹çœ‹ä¸‹é¢çš„æŸ±çŠ¶å›¾ï¼š ä¾‹å¦‚ï¼Œæˆ‘å½“å‰çš„é¡¹ç›®ä¸Šï¼Œæˆ‘ä»¬æœ‰ 5 ä¸ªå¹¶è¡Œæ„å»ºï¼Œè€Œå¹³å‡ï¼ˆæ¯ä¸ª jobï¼‰RSpec è€—æ—¶æ˜¯ 2 åˆ† 30 ç§’äº 1250 ä¸ªæµ‹è¯•ç”¨ä¾‹ä¸Šã€‚è¿™æ„å‘³ç€æˆ‘ä»¬çš„ EPMï¼ˆexamples per minuteï¼‰ç­‰äº 500. åœ¨æœªä¼˜åŒ–ä¹‹å‰ï¼Œ800 ä¸ªæµ‹è¯•ç”¨ä¾‹è€—æ—¶ 4 åˆ†é’Ÿâ€”â€”è¿™ä»…ä»… 200 EPMï¼ç°åœ¨æ¯æ¬¡æ„å»ºæˆ‘ä»¬èŠ‚çœäº† 3ï½4 åˆ†é’Ÿã€‚ æ‰€ä»¥ï¼Œæ¯«æ— ç–‘é—®ï¼Œæ…¢æµ‹è¯•æµªè´¹ä½ çš„æ—¶é—´ï¼Œæ‹‰ä½ä½ çš„å·¥ä½œæ•ˆç‡ã€‚ The Toolbox: å¥½ï¼Œä½ å·²ç»è®¤è¯†åˆ°äº†è‡ªå·±çš„æµ‹è¯•å¥—ä»¶å¾ˆæ…¢ã€‚å¦‚ä½•æ‰¾å‡ºå®ƒä»¬æ…¢çš„åŸå› ï¼Ÿ è®©æˆ‘ç•¥è¿‡è¿™ä¸ªä»‹ç»è§†é¢‘çš„æ‰€æœ‰è¯´è¾ç›´æ¥å‘ä½ ä»‹ç» TestProfâ€”â€”ä¸€ä¸ª Ruby æµ‹è¯•åˆ†æå·¥å…·ç®±ã€‚ TestProf æ—¨åœ¨å¸®ä½ è¯†åˆ«æµ‹è¯•å¥—ä»¶çš„ç“¶é¢ˆï¼Œå¹¶ä¸ºä½ æä¾›ä¿®å¤å®ƒä»¬çš„â€œé…æ–¹â€ã€‚ æˆ‘æ¥ç»™ä½ å±•ç¤ºä¸‹è‡ªå·±æ˜¯å¦‚ä½•ä½¿ç”¨å®ƒæ¥åˆ†æå¹¶ä¸”æ”¹è¿›æµ‹è¯•çš„ã€‚ General Profiling: åœ¨æ·±å…¥æŒ–æ˜æ•´ä¸ªæµ‹è¯•å¥—ä»¶ä¹‹å‰ï¼Œæ”¶é›†ä¸€äº›å¸¸è§„ä¿¡æ¯é€šå¸¸å¾ˆæœ‰ç”¨ã€‚ å°è¯•å›ç­”å¦‚ä¸‹é—®é¢˜ï¼š  åœ¨å“ªäº›åœ°æ–¹ä½ çš„æµ‹è¯•èŠ±è´¹äº†æ›´å¤šçš„æ—¶é—´ï¼šcontrollersã€modelsã€services æˆ–è€… jobsï¼Ÿ æœ€è€—æ—¶é—´çš„ module/method æ˜¯ä»€ä¹ˆï¼Ÿå¹¶éé‚£ä¹ˆå®¹æ˜“ï¼Œå¯¹å§ï¼Ÿ è¦å›ç­”ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥ä½¿ç”¨ TestProf çš„ Tag Profilerï¼Œå®ƒè®©ä½ å¯ä»¥æ”¶é›†åˆ°æ ¹æ®ç‰¹åˆ«çš„ RSpec tag å€¼è¿›è¡Œåˆ†ç»„çš„ç»Ÿè®¡ä¿¡æ¯ã€‚RSpec ä¸ºæµ‹è¯•ç”¨ä¾‹è‡ªåŠ¨æ·»åŠ äº†typeçš„ tagï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¿™æ ·ä½¿ç”¨å®ƒï¼š TAG_PROF=type rspec[TEST PROF INFO] TagProf report for type     type     time  total %total  %time      avg  controller   08:02. 721  2822  39. 04  34. 29   00:00. 171    service   05:56. 686  1363  18. 86  25. 34   00:00. 261     model   04:26. 176  1711  23. 67  18. 91   00:00. 155      job   01:58. 766   327  4. 52  8. 44   00:00. 363    request   01:06. 716   227  3. 14  4. 74   00:00. 293     form   00:37. 212   218  3. 02  2. 64   00:00. 170     query   00:19. 186   75  1. 04  1. 36   00:00. 255    facade   00:18. 415   95  1. 31  1. 31   00:00. 193  serializer   00:10. 201   19  0. 26  0. 72   00:00. 536    policy   00:06. 023   65  0. 90  0. 43   00:00. 092   presenter   00:05. 593   42  0. 58  0. 40   00:00. 133    mailer   00:04. 974   41  0. 57  0. 35   00:00. 121    . . . ç°åœ¨è¦æŸ¥æ‰¾ç“¶é¢ˆå³å¯åªå…³æ³¨æŸäº›æµ‹è¯•ç±»å‹å°±å¤Ÿäº†ã€‚ ä½ å¯èƒ½å·²ç»äº†è§£äº†å¸¸è§„çš„ Ruby åˆ†æå™¨ï¼Œä¾‹å¦‚ RubyProf å’Œ StackProfã€‚ TestProf å¸®åŠ©ä½ åœ¨æµ‹è¯•å¥—ä»¶ä¸Šæ— éœ€ä»»ä½•è°ƒæ•´å°±èƒ½è¿è¡Œå®ƒä»¬ï¼š TEST_RUBY_PROF=1 bundle exec rake test# orTEST_STACK_PROF=1 rspecè¿™äº›åˆ†æå™¨ç”Ÿæˆçš„æŠ¥å‘Šå¯ä»¥å¸®ä½ è¯†åˆ«æœ€çƒ­çš„å †æ ˆè·¯å¾„ï¼Œä»è€Œå›ç­”ç¬¬äºŒä¸ªé—®é¢˜ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œè¿™ç§ç±»å‹çš„åˆ†æéœ€è¦å¤§é‡èµ„æºï¼Œè®©ä½ æœ¬æ¥å°±ä¸é‚£ä¹ˆå¿«çš„æµ‹è¯•å¥—ä»¶æ„ˆåŠ è¿Ÿç¼“ã€‚ä½ ä¸å¾—ä¸åœ¨æµ‹è¯•çš„ä¸€å°éƒ¨åˆ†ä¸Šæ¥è¿è¡Œå®ƒï¼Œä½†å¦‚ä½•é€‰æ‹©æ˜¯å“ªä¸€å°éƒ¨åˆ†ï¼Ÿå¥½å§ï¼Œåªèƒ½éšæœºäº†ï¼ TestProf åŒ…å«ä¸€ä¸ªç‰¹åˆ«çš„è¡¥ä¸ï¼Œè®©ä½ å¯ä»¥è¿è¡Œéšæœºçš„ RSpec ç”¨ä¾‹ç»„ï¼ˆæˆ– Minitest çš„ï¼‰ï¼š SAMPLE=10 bundle exec rspecç°åœ¨å°è¯•åœ¨ä½  controller æµ‹è¯•çš„ä¸€ä¸ªæ ·ä¾‹ä¸Šè¿è¡Œ StackProfï¼ˆå› ä¸ºæ ¹æ®ä¸Šé¢ TestProf å®ƒä»¬æ˜¯æœ€æ…¢çš„ï¼‰çœ‹çœ‹è¾“å‡ºç»“æœã€‚å½“æˆ‘åœ¨è‡ªå·±çš„ä¸€ä¸ªé¡¹ç›®ä¸Šè¿™æ ·åšä¹‹åï¼Œçœ‹åˆ°äº†å¦‚ä¸‹å†…å®¹ï¼š %self   calls name20. 85    721  &lt;Class::BCrypt::Engine&gt;#__bc_crypt 2. 31   4690 *ActiveSupport::Notifications::Instrumenter#instrument 1. 12   47489  Arel::Visitors::Visitor#dispatch 1. 04  205208  String#to_s 0. 87  531377  Module#=== 0. 87  117109 *Class#newäº‹å®è¯æ˜æˆ‘ä»¬ Sorcery çš„ encryption é…ç½®åœ¨æµ‹è¯•ç¯å¢ƒè·Ÿåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸€æ ·ä¸¥æ ¼ã€‚ ä¸€ä¸ªå…¸å‹çš„ Rails åº”ç”¨ä¸­ï¼Œå…³äºæ—¶é—´ä½ ä¼šåœ¨æŠ¥å‘Šå†…çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„ä¸€äº›å†…å®¹ï¼š TOTAL  (pct)   SAMPLES  (pct)   FRAME  205 (48. 6%)     96 (22. 7%)   ActiveRecord::PostgreSQLAdapter#exec_no_cache  41  (9. 7%)     22  (5. 2%)   ActiveModel::AttributeMethods::#define_proxy_call  20  (4. 7%)     14  (3. 3%)   ActiveRecord::LazyAttributeHash#[]å¤§é‡ActiveRecordçš„ä¸œè¥¿â€”â€”æ„å‘³ç€å¤§é‡çš„æ•°æ®åº“æ“ä½œã€‚æƒ³çŸ¥é“å¦‚ä½•å¤„ç†ï¼Ÿç»§ç»­å¾€ä¸‹çœ‹ã€‚ Database Interactions: çŸ¥é“ä½ çš„æµ‹è¯•å¥—ä»¶åœ¨æ•°æ®åº“ä¸ŠèŠ±è´¹äº†å¤šå°‘æ—¶é—´å—ï¼Ÿå…ˆçŒœçŒœçœ‹ï¼Œç„¶åä½¿ç”¨ TestProf æ¥è®¡ç®—ä¸€ä¸‹ã€‚ æˆ‘ä»¬å·²ç»æ‰©å±•äº† Rails ä¸­çš„ instrumentationï¼ˆActiveSupport çš„ Notification å’Œ Instrumentation åŠŸèƒ½ï¼‰ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ç•¥è¿‡åŸºç¡€æ¥ä»‹ç» Event Profilerã€‚ EventProf åœ¨ä½ çš„æµ‹è¯•å¥—ä»¶è¿è¡Œä¸­æ”¶é›†æ£€æµ‹æŒ‡æ ‡ï¼Œå¹¶æä¾›åŒ…å«å¸¸è§„ä¿¡æ¯çš„æŠ¥å‘Šä»¥åŠä¸æŒ‡å®šæŒ‡æ ‡æœ‰å…³çš„å‰ N ä¸ªæœ€æ…¢çš„ç»„å’Œç”¨ä¾‹ã€‚ç›®å‰ï¼Œå®ƒè‡ªå¸¦çš„ä»…æ”¯æŒActiveSupport::Notificationsï¼Œä½†å…¶å¾ˆå®¹æ˜“è·Ÿä½ è‡ªå·±çš„è§£å†³æ–¹æ¡ˆé›†æˆã€‚ è¦è·å–æœ‰å…³æ•°æ®åº“ä½¿ç”¨æƒ…å†µçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨sql. active_recordäº‹ä»¶ã€‚ç„¶åæŠ¥å‘Šçœ‹èµ·æ¥ä¼šæ˜¯è¿™æ ·ï¼ˆå¾ˆç±»ä¼¼äºrspec --profileï¼‰ï¼š EVENT_PROF=sql. active_record rspec . . . [TEST PROF INFO] EventProf results for sql. active_recordTotal time: 00:05. 045Total events: 6322Top 5 slowest suites (by time):MessagesController (. /spec/controllers/messages_controller_spec. rb:3)â€“00:03. 253 (4058 / 100)UsersController (. /spec/controllers/users_controller_spec. rb:3)â€“00:01. 508 (1574 / 58)Confirm (. /spec/services/confirm_spec. rb:3)â€“00:01. 255 (1530 / 8)RequestJob (. /spec/jobs/request_job_spec. rb:3)â€“00:00. 311 (437 / 3)ApplyForm (. /spec/forms/apply_form_spec. rb:3)â€“00:00. 118 (153 / 5)å¯¹äºæˆ‘ç›®å‰çš„é¡¹ç›®ï¼Œè€—è´¹åœ¨ DB ä¸Šçš„æ—¶é—´é‡å¤§çº¦æ˜¯ 20%â€”â€”è€Œè¿™å·²ç»æ˜¯åœ¨å¯¹å…¶è¿›è¡Œäº†å¤§é‡ä¼˜åŒ–ä¹‹åï¼èµ·åˆï¼Œå…¶è€—è´¹æ—¶é—´è¶…è¿‡äº† 30%ã€‚ è¿™ä¸ªæŒ‡æ ‡å¯¹äºæ¯ä¸ªé¡¹ç›®æ²¡æœ‰ä¸€ä¸ªå•ä¸€çš„æœ€ä¼˜æ•°å­—ã€‚å®ƒé«˜åº¦ä¾èµ–äºä½ çš„æµ‹è¯•é£æ ¼ï¼šç¼–å†™æ›´å¤šçš„å•å…ƒæµ‹è¯•è¿˜æ˜¯é›†æˆæµ‹è¯•ã€‚ æˆ‘ä»¬ä¸»è¦ç¼–å†™é›†æˆæµ‹è¯•ï¼Œé¡ºä¾¿è¯´ä¸€å¥â€”â€”20%å¹¶ä¸å·®ï¼ˆä½†è¿˜èƒ½æ›´å¥½ï¼‰ã€‚ ä»€ä¹ˆæ˜¯æ•°æ®åº“è€—æ—¶åé«˜çš„å…¸å‹åŸå› å‘¢ï¼Ÿä¸€è¨€éš¾å°½ï¼Œæˆ‘æ¥æ‹ä¸€æ‹å…¶ä¸­çš„éƒ¨åˆ†ï¼š  æ— ç”¨çš„æ•°æ®ç”Ÿæˆ è¿‡é‡çš„æµ‹è¯•å‡†å¤‡ï¼ˆbefore/setup hooksï¼‰ Factory cascadesç¬¬ä¸€ä¸ªæ˜¯è‘—åçš„Model. new vs. Model. createé—®é¢˜ï¼ˆæˆ–è€…build_stubbed vs. createåœ¨ FactoryBot ä¸­çš„åŒºåˆ«ï¼‰â€”â€”ä½ åœ¨å¯¹ model çš„å•å…ƒæµ‹è¯•ä¸­å¯èƒ½ä¸éœ€è¦å†™å…¥æ•°æ®åº“ã€‚æ‰€ä»¥åˆ«é‚£æ ·åšï¼Œå¥½å§ï¼Ÿ ä½†å¦‚æœå·²ç»é‚£æ ·åšäº†æ€ä¹ˆåŠï¼Ÿå¦‚ä½•æ‰¾å‡ºå“ªäº›æµ‹è¯•ä¸éœ€è¦æŒä¹…åŒ–æ•°æ®ï¼Ÿè¿™å°±è¯¥ Factory Doctor ç™»åœºäº†ã€‚ å½“ä½ åˆ›å»ºä¸å¿…è¦çš„æ•°æ®æ—¶ï¼ŒFactoryDoctor ä¼šé€šçŸ¥ä½ ï¼š FDOC=1 rspec[TEST PROF INFO] FactoryDoctor reportTotal (potentially) bad examples: 2Total wasted time: 00:13. 165User (. /spec/models/user_spec. rb:3) validates name (. /spec/user_spec. rb:8)â€“1 record created, 00:00. 114 validates email (. /spec/user_spec. rb:8)â€“2 records created, 00:00. 514ä¸å¹¸çš„æ˜¯ï¼ŒFactoryDoctor ä¸æ˜¯é­”æœ¯å¸ˆï¼ˆå®ƒè¿˜åœ¨å­¦ä¹ ä¸­ï¼‰ï¼Œæœ‰æ—¶å®ƒä¹Ÿä¼šå‘ç”Ÿâ€œè¯¯è¯Šâ€çš„äº‹æƒ…ã€‚ ç¬¬äºŒä¸ªé—®é¢˜æ¯”è¾ƒæ£˜æ‰‹ã€‚è€ƒè™‘è¿™ä¸ªä¾‹å­ï¼š describe BeatleSearchQuery do # We want to test our searching feature, # so we need some data for every example let!(:paul) { create(:beatle, name: 'Paul') } let!(:ringo) { create(:beatle, name: 'Ringo') } let!(:george) { create(:beatle, name: 'George') } let!(:john) { create(:beatle, name: 'John') } # and about 15 examples hereendä½ å¯èƒ½ä¼šæƒ³ï¼šâ€œè¿™é‡Œç”¨ fixture å°±è¡Œäº†å‘—â€ã€‚è¿™è²Œä¼¼ä¸ªå¥½ä¸»æ„ï¼Œä¸è¿‡å½“ä½ æ­£åœ¨åšä¸€ä¸ªæ¯å¤©éƒ½è¦æ›´æ”¹æ•°åä¸ª model çš„å¤§å‹é¡¹ç›®æ—¶ï¼Œå°±ä¸æ˜¯é‚£ä¹ˆå›äº‹å„¿äº†ã€‚ å¦å¤–ä¸€ä¸ªè€ƒè™‘æ˜¯ç”¨before(:all) hook ä»…ç”Ÿæˆæ•°æ®ä¸€æ¬¡ã€‚ä½†è¿™é‡Œè¦æè¯·æ³¨æ„â€”â€”æˆ‘ä»¬ä¸å¾—ä¸æ‰‹åŠ¨æ¸…ç†æ•°æ®åº“ï¼Œå› ä¸ºbefore(:all)æ˜¯åœ¨äº‹åŠ¡å¤–è¿è¡Œçš„ã€‚ æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ•´ä¸ªç»„éƒ½æ‰‹åŠ¨åŒ…åœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œï¼è¿™æ­£æ˜¯ TestProf çš„ before_all helper æ‰€åšçš„ï¼š describe BeatleSearchQuery do before_all do  @paul = create(:beatle, name: 'Paul')  @ringo = create(:beatle, name: 'Ringo')  @george = create(:beatle, name: 'George')  @john = create(:beatle, name: 'John') end # and about 15 examples hereendå¦‚æœä½ æƒ³è¦åœ¨ä¸åŒçš„ç»„ï¼ˆæ–‡ä»¶ï¼‰ä¹‹é—´å…±äº« contextï¼Œè€ƒè™‘ä½¿ç”¨ Any Fixtureï¼Œå…¶è®©ä½ èƒ½ä»ä»£ç ç”Ÿæˆ fixtureï¼ˆæ¯”å¦‚ï¼Œä½¿ç”¨ factoriesï¼‰ã€‚ Factory Cascades: Factory cascade æ˜¯ä¸€ä¸ªéå¸¸æ™®éä½†å¾ˆå°‘è§£å†³çš„é—®é¢˜ï¼Œå®ƒä¼šè®©ä½ çš„æ•´ä¸ªæµ‹è¯•å¥—ä»¶é™·å…¥å›°å¢ƒã€‚ ç®€è€Œè¨€ä¹‹ï¼Œå®ƒæ˜¯é€šè¿‡åµŒå¥— factory è°ƒç”¨è€Œç”Ÿæˆè¿‡åº¦æ•°æ®çš„ä¸å¯æ§è¿›ç¨‹ã€‚TestProf çŸ¥é“å¦‚ä½•å¤„ç†å®ƒï¼Œæˆ‘ä»¬å·²ç»å†™äº†ä¸€ç¯‡ä¸“æ æ–‡ç« æ¥å•ç‹¬è®¨è®ºè¿™ä¸ªä¸»é¢˜â€”â€”ä½ å€¼å¾—çœ‹ä¸€ä¸‹ã€‚ Background Jobs: é™¤å»æ•°æ®åº“ç“¶é¢ˆä¹‹å¤–ï¼Œå½“ç„¶è¿˜æœ‰å¾ˆå¤šå…¶ä»–ç“¶é¢ˆã€‚æˆ‘ä»¬æ¥è¯´è¯´å…¶ä¸­ä¸€ä¸ªã€‚ åœ¨æµ‹è¯•ä¸­æœ‰ä¸€ä¸ª inline åå°ä»»åŠ¡çš„æ™®éåšæ³•ï¼ˆä¾‹å¦‚ï¼ŒSidekiq::Testing. inline!ï¼‰ã€‚ é€šå¸¸ï¼Œæˆ‘ä»¬æŠŠä¸€äº›ç¹é‡çš„äº‹æƒ…ä¸¢è¿›åå°ä»»åŠ¡ä¸­ï¼Œå› æ­¤æ— æ¡ä»¶åœ°è¿è¡Œæ‰€æœ‰ä»»åŠ¡ä¼šæ‹–æ…¢è¿è¡Œæ—¶é—´ã€‚ TestProf æ”¯æŒå¯¹åå°ä»»åŠ¡è€—è´¹æ—¶é—´çš„åˆ†æï¼ˆç›®å‰ï¼Œä»…å¯¹ Sidekiqï¼‰ã€‚åªéœ€å‘Šè¯‰å®ƒè¦åˆ†æsidekiq. inlineï¼š EVENT_PROF=sidekiq. inline bundle exec rspecç°åœ¨å½“ä½ çŸ¥é“äº†æ‰€è€—è´¹çš„å‡†ç¡®æ—¶é—´ä¹‹åï¼Œæ¥ä¸‹æ¥è¦åšä»€ä¹ˆï¼Ÿç®€å•åœ°å…³é—­ inline æ¨¡å¼å¾ˆå¯èƒ½ä¼šç ´åå¾ˆå¤šæµ‹è¯•ç”¨ä¾‹â€”â€”å¤ªå¤šå¤ªå¤šä»¥è‡³äºæ— æ³•å¿«é€Ÿä¿®å¤ã€‚ è§£å†³æ–¹æ¡ˆå°±æ˜¯å…¨å±€å…³é—­ inline æ¨¡å¼ï¼Œä»…åœ¨å¿…è¦æ—¶æ‰ä½¿ç”¨å®ƒã€‚å¦‚æœä½ åœ¨ç”¨ RSpecï¼Œåˆ™å¯ä»¥è¿™æ ·åšï¼š # Add a shared contextshared_context  sidekiq:inline , sidekiq: :inline do around(:each) { |ex| Sidekiq::Testing. inline!(&amp;ex) }end# And use it when necessaryit  do some bg , sidekiq: :inline do # . . . endé‚£è¿˜æ˜¯å¾—å¿…é¡»æŠŠè¿™äº› tag æ·»åŠ åˆ°æ¯ä¸ªå¤±è´¥çš„ç”¨ä¾‹ä¸Šï¼Œä¸æ˜¯ä¹ˆï¼ŸæŠ±æ­‰ï¼Œæœ‰ TestProf åœ¨ï¼Œä½ ç¡®å®ä¸å¿…ã€‚ åœ¨ TestProf çš„å·¥å…·ç®±ä¸­ï¼Œæœ‰ä¸€ä¸ªç§°ä¸º RSpec Stamp çš„ç‰¹æ®Šå·¥å…·ã€‚å®ƒå¯ä»¥è‡ªåŠ¨åœ°æ·»åŠ æŒ‡å®šçš„ tagï¼š RSTAMP=sidekiq:inline rspecé¡ºä¾¿è¯´ä¸€å¥ï¼ŒRSpec Stamp åœ¨å…¶ä¹‹ä¸‹æ˜¯ç”¨äº† Ripper æ¥è§£ææºæ–‡ä»¶å¹¶å‡†ç¡®æ’å…¥ tag çš„ã€‚ åœ¨æˆ‘ä»¬çš„æŒ‡å—é‡Œå¯ä»¥é˜…è¯»åˆ°å…³äºå¦‚ä½•ä»inline!è¿ç§»åˆ°fake!çš„å®Œæ•´è¯´æ˜ã€‚ é™„è®°: TestProf å·²ç»å‘å¸ƒåœ¨ GitHub å’Œ rubygems. orgï¼Œå¯éšæ—¶ç”¨åœ¨ä½ çš„åº”ç”¨ä¸­ï¼Œå¸®åŠ©ä½ æå‡æµ‹è¯•å¥—ä»¶çš„æ€§èƒ½ã€‚ æœ¬æ–‡åªæ˜¯ä¸€ä¸ª TestProf çš„ç®€ä»‹ï¼Œå¹¶æœªæ¶µç›–å…¶æ‰€æœ‰ç‰¹æ€§ã€‚å¯ä»¥è·³è½¬åˆ°è¯¥ç³»åˆ—çš„ä¸‹ä¸€ç¯‡ï¼šTestProf II: Factory therapy for your Ruby tests æ¥å­¦ä¹ æ›´å¤šå…³äº TestProf â€œåŒ»ç”Ÿâ€çš„å·¥å…·åŒ…ï¼Œå®ƒä»¬èƒ½ä½¿ä½ çš„æµ‹è¯•æ›´åŠ æ¼‚äº®ä¼˜é›…ï¼Œä½ çš„ TDD åé¦ˆç¯æ›´çŸ­æ›´å¿«ï¼Œä»è€Œè®©ä½ æˆä¸ºä¸€ä¸ªå¿«ä¹çš„ Ruby å¼€å‘è€…ã€‚ è¿™é‡Œæ˜¯ä¸€äº›é¢å¤–çš„èµ„æºåˆ—è¡¨ï¼š  TestProf æ–‡æ¡£ 2017 å¹´ RailsClub Moscow çš„â€œFaster Testsâ€ æ¼”è®²ï¼ˆè§†é¢‘[ä¿„è¯­]ï¼Œslidesï¼‰ 2017 å¹´ RubyConfBy çš„â€œRun Test Runâ€ æ¼”è®²ï¼ˆè§†é¢‘ï¼Œslidesï¼‰ Benoit Tigeot å‘è¡¨çš„ â€œTips to improve speed of your test suiteâ€"
    }, {
    "id": 40,
    "url": "/2020/07/programming-elixir-1-6-chapter-5/",
    "title": "ã€ŠProgramming Elixir >= 1.6ã€‹ç¬¬äº”ç« ï¼šåŒ¿åå‡½æ•°",
    "body": "2020/07/20 - å‡½æ•°æ˜¯ Elixir çš„æ•°æ®è½¬æ¢åŸºçŸ³çš„é‡è¦å¼•æ“ä¹‹ä¸€ã€‚Elixir å‡½æ•°åˆåˆ†ä¸ºåŒ¿åå‡½æ•°å’Œå…·åå‡½æ•°ã€‚ã€ŠProgramming Elixir &gt;= 1. 6ã€‹ç”¨æ•´ä¸ªç¬¬äº”ç« ä¸“é—¨è®²è¿°äº†â€œåŒ¿åå‡½æ•°â€çš„æ¦‚å¿µï¼Œå¯è§å…¶é‡è¦æ€§ã€‚å¦‚æœæ˜¯å†™è¿‡ JavaScript çš„æœ‹å‹ï¼Œå¯¹â€œåŒ¿åå‡½æ•°â€çš„æ¦‚å¿µä¸€å®šä¸é™Œç”Ÿã€‚è€Œ Elixir çš„â€œåŒ¿åå‡½æ•°â€åˆ°åº•æ€æ ·ï¼Œçœ‹è¿™ä¸€ç« å°±èƒ½å®Œå…¨äº†è§£ã€‚ ã€ä¸‹é¢æ˜¯æ­£æ–‡ã€‘ 5. Anonymous Functions: Elixir æ˜¯å‡½æ•°å¼è¯­è¨€ï¼Œæ‰€ä»¥æ¯«ä¸æ„å¤–å‡½æ•°æ˜¯ä¸€ä¸ªåŸºç¡€ç±»å‹ã€‚ ä¸€ä¸ªåŒ¿åå‡½æ•°ä½¿ç”¨å…³é”®å­—fnæ¥åˆ›å»ºã€‚ fn parameter-list -&gt; body parameter-list -&gt; bodyendå¯ä»¥æŠŠfn. . . endæƒ³åƒæˆæœ‰ç‚¹åƒåŒ…è£¹å­—ç¬¦ä¸²å­—é¢é‡çš„åŒå¼•å·ï¼Œåªæ˜¯è¿™é‡ŒæŠŠä¸€ä¸ªå‡½æ•°è€Œéå­—ç¬¦ä¸²ä½œä¸ºè¿”å›å€¼ã€‚æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªè¿”å›çš„å‡½æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°ï¼Œä¹Ÿå¯ä»¥å‘å®ƒä¼ å‚æ¥è¿è¡Œã€‚ æœ€ç®€å•çš„æ˜¯ï¼Œå‡½æ•°æœ‰ä¸€ä¸ªå‚æ•°åˆ—è¡¨å’Œä¸€ä¸ªå‡½æ•°ä½“ï¼Œç”¨-&gt;åˆ†éš”ã€‚ ä¾‹å¦‚ï¼Œä¸‹é¢å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶æŠŠå…¶ç»‘å®šåˆ°å˜é‡sumï¼Œç„¶åè°ƒç”¨å®ƒï¼š iex&gt; sum = fn (a, b) -&gt; a + b end#Function&lt;12. 17052888 in :erl_eval. expr/5&gt;iex&gt; sum. (1, 2)3ç¬¬ä¸€è¡Œä»£ç åˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°ï¼Œå¸¦ä¸¤ä¸ªå‚æ•°ï¼ˆåä¸º a å’Œ bï¼‰ã€‚å‡½æ•°çš„å®ç°æ–¹æ³•ä½äº-&gt;ä¹‹åï¼ˆæœ¬ä¾‹ä¸­åªæ˜¯ç®€å•æŠŠä¸¤ä¸ªå‚æ•°ç›¸åŠ ï¼‰ï¼Œåˆ°å…³é”®å­—endä¸ºæ­¢ã€‚æˆ‘ä»¬æŠŠè¯¥å‡½æ•°å­˜åˆ°å˜é‡sumä¸Šã€‚ ç¬¬äºŒè¡Œä»£ç ä½¿ç”¨è¯­å¥sum. (1, 2)æ‰§è¡Œäº†è¿™ä¸ªå‡½æ•°ã€‚ç‚¹. è¯­æ³•è¡¨ç¤ºè°ƒç”¨å‡½æ•°ï¼Œä¸”ä¼ é€’çš„å‚æ•°æ”¾åœ¨æ‹¬å·ä¸­ã€‚ï¼ˆä½ å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨å…·åå‡½æ•°æ—¶å¹¶æ²¡æœ‰ä½¿ç”¨ç‚¹è¯­æ³•â€”â€”è¿™æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°å’Œå…·åå‡½æ•°çš„å·®åˆ«ã€‚ï¼‰ å¦‚æœå‡½æ•°ä¸å¸¦ä»»ä½•å‚æ•°ï¼Œä»éœ€è¦ä½¿ç”¨æ‹¬å·æ¥è°ƒç”¨å®ƒï¼š iex&gt; greet = fn -&gt; IO. puts  Hello  end#Function&lt;12. 17052888 in :erl_eval. expr/5&gt;iex&gt; greet. ()Hello:okç„¶è€Œï¼Œå¯ä»¥åœ¨å®šä¹‰å‡½æ•°æ—¶ä¸è¦æ‹¬å·ï¼š iex&gt; f1 = fn a, b -&gt; a * b end#Function&lt;12. 17052888 in :erl_eval. expr/5&gt;iex&gt; f1. (5,6)30iex&gt; f2 = fn -&gt; 99 end#Function&lt;12. 17052888 in :erl_eval. expr/5&gt;iex&gt; f2. ()99Functions and Pattern Matching: å½“æˆ‘ä»¬è°ƒç”¨sum. (2, 3)æ—¶ï¼Œå¾ˆè‡ªç„¶ä¼šè®¤ä¸ºæ˜¯ç®€å•åœ°æŠŠ 2 èµ‹äºˆå‚æ•° aã€3 èµ‹äºˆå‚æ•° bã€‚ä½†æ˜¯è¿™ä¸ªè¯ï¼Œèµ‹äºˆï¼Œåº”å½“ç»™æˆ‘ä»¬æ•²å“è­¦é’Ÿã€‚Elixir æ²¡æœ‰èµ‹å€¼ï¼Œè€Œæ˜¯è¯•å›¾æŠŠå€¼å’Œæ¨¡å¼è¿›è¡ŒåŒ¹é…ã€‚ï¼ˆè¿™äº›æˆ‘ä»¬å·²ç»åœ¨å‰é¢çš„ã€ŠPattern Matchingã€‹ä¸€ç« ä¸­è®²è¿‡äº†ã€‚ï¼‰ å½“æˆ‘ä»¬å†™ä¸‹ a = 2Elixir ä¼šé€šè¿‡æŠŠ a ç»‘å®šåˆ° 2 æ¥è¿›è¡Œæ¨¡å¼åŒ¹é…ã€‚è¿™æ‰æ˜¯åˆšæ‰çš„sumå‡½æ•°è¢«è°ƒç”¨æ—¶å‘ç”Ÿçš„äº‹ã€‚å¦‚æœæˆ‘ä»¬ä¼ é€’ 2 å’Œ 3ä½œä¸ºå‚æ•°æ—¶ï¼ŒElixir ä¼šè¯•å›¾æŠŠä¼ å…¥çš„å‚æ•°å’Œå®šä¹‰çš„å‚æ•° a å’Œ b è¿›è¡ŒåŒ¹é…ï¼ˆè¿™æ ·å°±ç»‘å®š a ä¸º 2ä»¥åŠ b ä¸º 3ï¼‰ã€‚è¿™ç­‰åŒäºï¼š {a, b} = {2, 3}è¿™æ„å‘³ç€æˆ‘ä»¬åœ¨è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶å¯ä»¥è¿›è¡Œæ›´å¤æ‚çš„æ¨¡å¼åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„å‡½æ•°æŠŠä¸€ä¸ªäºŒå…ƒå…ƒç»„ä¸­çš„ä¸¤ä¸ªå…ƒç´ é¢ å€’äº†é¡ºåºï¼š iex&gt; swap = fn { a, b } -&gt; { b, a } end#Function&lt;12. 17052888 in :erl_eval. expr/5&gt;iex&gt; swap. ( { 6, 8 } ){8, 6}ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°é€šè¿‡åˆ©ç”¨æ¨¡å¼åŒ¹é…çš„å¨åŠ›æ¥è¾¾åˆ°å‡½æ•°çš„å¤šç§å®ç°æ–¹å¼ã€‚ One Function, Multiple Bodies: å•ä¸ªå‡½æ•°å®šä¹‰å…è®¸ä½ å®šä¹‰ä¸åŒçš„å®ç°ï¼Œå…·ä½“å–å†³äºä¼ é€’çš„å‚æ•°çš„ç±»å‹å’Œå†…å®¹ã€‚ï¼ˆä½ æ— æ³•æ ¹æ®å‚æ•°çš„æ•°é‡è¿›è¡Œé€‰æ‹© - å‡½æ•°å®šä¹‰ä¸­æ¯ä¸ªå­å¥å¿…é¡»å…·æœ‰ç›¸åŒæ•°é‡çš„å‚æ•°ã€‚ï¼‰ æœ€ç®€å•çš„ï¼Œæˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨æ¨¡å¼åŒ¹é…æ¥é€‰æ‹©å“ªä¸ªå­å¥è¢«æ‰§è¡Œã€‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œç”±äºæˆ‘ä»¬çŸ¥é“File. openåœ¨æˆåŠŸæ‰“å¼€æ–‡ä»¶æ—¶ä¼šè¿”å›ä¸€ä¸ªé¦–å…ƒç´ ä¸º :ok çš„å…ƒç»„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œè¦ä¹ˆæ˜¾ç¤ºæ‰“å¼€æ–‡ä»¶çš„ç¬¬ä¸€è¡Œï¼Œè¦ä¹ˆåœ¨æ–‡ä»¶æ— æ³•æ‰“å¼€æ—¶æ˜¾ç¤ºä¸€ä¸ªç®€å•çš„é”™è¯¯ä¿¡æ¯ã€‚ iex&gt; handle_open = fn. . . &gt; {:ok, file} -&gt;  Read data: #{IO. read(file, :line)} . . . &gt; {_, error} -&gt;  Error: #{:file. format_error(error)} . . . &gt; end#Function&lt;12. 17052888 in :erl_eval. expr/5&gt;iex&gt; handle_open. (File. open( code/intro/hello. exs )) Read data: IO. puts \ Hello, World!\ \n iex&gt; handle_open. (File. open( nonexistent )) Error: no such file or directory æ¥çœ‹ä¸€ä¸‹å‡½æ•°å®šä¹‰çš„å†…éƒ¨ã€‚2ã€3è¡Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªå•ç‹¬çš„å‡½æ•°ä½“ï¼Œæ¯ä¸ªéƒ½ç”¨ä¸€ä¸ªå…ƒç»„ä½œä¸ºå‚æ•°ã€‚ç¬¬ä¸€ä¸ªéœ€è¦å…ƒç»„çš„é¦–å…ƒç´ ä¸º :okï¼Œç¬¬äºŒä¸ªä½¿ç”¨ç‰¹åˆ«çš„å˜é‡_ï¼ˆä¸‹åˆ’çº¿ï¼‰æ¥åŒ¹é…ä»»ä½•å…¶ä»–çš„å€¼ä½œä¸ºé¦–å…ƒç´ ã€‚ å†çœ‹ç¬¬6è¡Œï¼Œæˆ‘ä»¬è°ƒç”¨äº†è¯¥å‡½æ•°ï¼Œä¸”æŠŠä½¿ç”¨File. openæ‰“å¼€ä¸€ä¸ªå·²å­˜åœ¨æ–‡ä»¶çš„ç»“æœä¼ é€’ç»™å®ƒã€‚è¿™æ„å‘³ç€å®ƒæ¥æ”¶åˆ°çš„æ˜¯å…ƒç»„{:ok, file}ï¼Œè¿™æ­£å¥½åŒ¹é…äº†ç¬¬2è¡Œçš„å‡½æ•°å­—å¥ã€‚ç›¸åº”åœ°è°ƒç”¨IO. readè¯»å–è¯¥æ–‡ä»¶çš„ç¬¬ä¸€è¡Œã€‚ æ¥ç€æˆ‘ä»¬å†æ¬¡è°ƒç”¨handle_oepnï¼Œè¿™æ¬¡å°è¯•æ‰“å¼€ä¸€ä¸ªä¸å­˜åœ¨æ–‡ä»¶ã€‚è¿”å›çš„å…ƒç»„ï¼ˆ{:error, :enoent}ï¼‰è¢«ä¼ é€’ç»™å®ƒï¼Œå¹¶å¯»æ‰¾ä¸€ä¸ªå¯åŒ¹é…çš„å­å¥ã€‚ç¬¬2è¡Œä¼šç”±äºé¦–å…ƒç´ ä¸æ˜¯ :ok è€ŒåŒ¹é…å¤±è´¥ï¼Œä½†ä¸‹ä¸€è¡Œèƒ½åŒ¹é…æˆåŠŸã€‚error æ°å¥½èƒ½å®Œç¾å¥‘åˆè¯¥å­å¥çš„ä»£ç æ ¼å¼ã€‚ ç•™æ„ä¸€ä¸‹ä»£ç çš„å…¶ä»–éƒ¨åˆ†ã€‚ç¬¬3è¡Œæˆ‘ä»¬è°ƒç”¨äº†:file. format_errorï¼Œ:fileéƒ¨åˆ†è¡¨ç¤ºäº†åº•å±‚ Erlang çš„Fileæ¨¡å—ï¼Œå› æ­¤æˆ‘ä»¬èƒ½è°ƒç”¨å…¶format_errorå‡½æ•°ã€‚ä¸ç¬¬6è¡Œçš„File. openè°ƒç”¨å¯¹æ¯”ä¸€ä¸‹ï¼Œé‚£é‡Œçš„Fileéƒ¨åˆ†å¯¹åº”çš„æ˜¯ Elixir çš„å†…å»ºæ¨¡å—ã€‚è¿™æ˜¯ä¸€ä¸ª Elixir ä»£ç ä¸­ä½¿ç”¨åº•å±‚ç¯å¢ƒï¼ˆå‡½æ•°ï¼‰çš„å¥½ä¾‹å­ã€‚å¾ˆæ£’çš„æ˜¯ï¼Œä½ èƒ½ä½¿ç”¨å…¨éƒ¨ç°æœ‰çš„ Erlang åº“â€”â€”æœ‰æˆåƒä¸Šä¸‡ç»è¿‡äº†æ—¶é—´æ£€éªŒçš„ä»£ç ä»»ä½ å–ç”¨ã€‚ä½†è¿™ä¹Ÿæœ‰ç‚¹å¤æ‚äº†ï¼Œä½ åœ¨è°ƒç”¨æ—¶å°†ä¸å¾—ä¸åœ¨ Erlang çš„å‡½æ•°å’Œ Elixir çš„å‡½æ•°ä¸­è¿›è¡ŒåŒºåˆ†ã€‚ æœ€åï¼Œä¸Šä¾‹ä¸­å±•ç¤ºäº† Elixir çš„å­—ç¬¦ä¸²æ’å€¼ã€‚åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œ#{. . . }çš„å†…å®¹ä¼šè¢«è§£æå¹¶ä½¿ç”¨å…¶ç»“æœæ¥ä»£æ›¿ã€‚ Functions Can Return Functions: è¿™å„¿æœ‰ä¸€äº›å¥‡æ€ªçš„ä»£ç ï¼š iex&gt; fun1 = fn -&gt; fn -&gt;  Hello  end end#Function&lt;12. 17052888 in :erl_eval. expr/5&gt;iex&gt; fun1. ()#Function&lt;12. 17052888 in :erl_eval. expr/5&gt;iex&gt; fun1. (). () Hello å¥‡æ€ªçš„åœ°æ–¹åœ¨äºç¬¬ä¸€è¡Œã€‚å®ƒå¾ˆéš¾ç†è§£ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠå®ƒå±•å¼€æ¥çœ‹ã€‚ fun1 = fn -&gt;					fn -&gt;						 Hello 					end				endå˜é‡fun1è¢«ç»‘å®šåˆ°ä¸€ä¸ªå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°ä¸å¸¦å‚æ•°ï¼Œå…¶å‡½æ•°ä½“æ˜¯ç¬¬äºŒä¸ªå‡½æ•°å®šä¹‰ã€‚ç¬¬äºŒä¸ªå‡½æ•°ä¹Ÿä¸å¸¦å‚æ•°ï¼Œè¿”å›å­—ç¬¦ä¸²â€œHelloâ€ã€‚ å½“æˆ‘ä»¬è°ƒç”¨å¤–å±‚å‡½æ•°ï¼ˆä½¿ç”¨fun1. ()ï¼‰ï¼Œå®ƒè¿”å›å†…å±‚å‡½æ•°ã€‚è¿™ä¸ªè¿”å›å€¼å½“æˆ‘ä»¬å†è°ƒç”¨ï¼ˆfun1. (). ()ï¼‰æ—¶å†…å±‚å‡½æ•°å³è¢«æ‰§è¡Œï¼Œâ€œHelloâ€è¢«è¿”å›ã€‚ ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ä¸ä¼šå†™å‡ºç±»ä¼¼fun1. (). ()è¿™æ ·çš„ä»£ç ã€‚ç„¶è€Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨å¤–å±‚å‡½æ•°å¹¶ç»‘å®šç»“æœç»™ä¸€ä¸ªå˜é‡ã€‚è¿˜å¯ä»¥ç”¨æ‹¬å·æŠŠå†…å±‚å‡½æ•°æ‹¬èµ·æ¥ä½¿å…¶ä¸æ˜“æ··æ·†ã€‚ iex&gt; fun1 = fn -&gt; (fn -&gt;  Hello  end) end#Function&lt;12. 17052888 in :erl_eval. expr/5&gt;iex&gt; other = fun1. ()#Function&lt;12. 17052888 in :erl_eval. expr/5&gt;iex&gt; other. () Hello Functions Remember Their Original Environment: è®©æˆ‘ä»¬æ›´æ·±å…¥åœ°çœ‹ä¸‹åµŒå¥—å‡½æ•°ã€‚ iex&gt; greeter = fn name -&gt; (fn -&gt;  Hello #{name}  end) end #Function&lt;12. 17052888 in :erl_eval. expr/5&gt;iex&gt; dave_greeter = greeter. ( Dave )#Function&lt;12. 17052888 in :erl_eval. expr/5&gt;iex&gt; dave_greeter. () Hello Dave å½“æˆ‘ä»¬è°ƒç”¨å¤–å±‚å‡½æ•°ï¼Œå…¶è¿”å›å†…å±‚çš„å‡½æ•°å®šä¹‰ã€‚è¿™æ—¶å¹¶æ²¡æœ‰æŠŠ name æ›¿æ¢æˆå­—ç¬¦ä¸²ã€‚ç„¶è€Œå½“æˆ‘ä»¬è°ƒç”¨å†…å±‚å‡½æ•°ï¼ˆdave_greeter. ()ï¼‰æ—¶ï¼Œæ›¿æ¢å‘ç”Ÿäº†ï¼Œç»“æœæ˜¾ç¤ºå‡ºæ¥ã€‚ æœ‰äº›å¥‡æ€ªçš„äº‹æƒ…å‘ç”Ÿäº†ã€‚å†…å±‚å‡½æ•°ä½¿ç”¨å¤–å±‚å‡½æ•°çš„nameå‚æ•°ã€‚åœ¨greeter. ( Dave )æ‰§è¡Œå¹¶è¿”å›æ—¶ï¼Œå¤–å±‚å‡½æ•°å·²ç»ç»“æŸï¼Œå‚æ•°å·²ä¸åœ¨å®šä¹‰åŸŸäº†ã€‚ä½†æ˜¯å½“æˆ‘ä»¬è¿è¡Œå†…å±‚å‡½æ•°ï¼Œå®ƒåˆä½¿ç”¨äº†è¿™ä¸ªå‚æ•°çš„å€¼ã€‚ è¿™ä¹‹æ‰€ä»¥èƒ½æ­£å¸¸è¿è¡Œæ˜¯ç”±äºåœ¨ Elixir ä¸­å‡½æ•°ä¼šè‡ªåŠ¨æºå¸¦å˜é‡çš„ç»‘å®šï¼ŒåŒ…æ‹¬å…¶åœ¨å®šä¹‰æ—¶çš„åŸŸã€‚ä¸Šé¢ä¾‹å­ä¸­ï¼Œå˜é‡nameæ˜¯åœ¨å¤–å±‚å‡½æ•°çš„åŸŸä¸­è¢«ç»‘å®šã€‚å½“å†…å±‚å‡½æ•°å®šä¹‰æ—¶ï¼Œå®ƒç»§æ‰¿äº†è¿™ä¸ªåŸŸï¼Œä¸”æŠŠnameç›¸å…³çš„ç»‘å®šä¸€èµ·å¸¦ä¸Šäº†ã€‚è¿™å°±æ˜¯é—­åŒ…â€”â€”å®ƒçš„åŸŸä¼šåŒ…å«å…¶å˜é‡çš„ç»‘å®šï¼Œå¹¶æŠŠè¿™äº›ç»‘å®šæ‰“åŒ…æˆå¯ä»¥ä¿å­˜å¹¶åœ¨ä»¥åä½¿ç”¨çš„ä¸œè¥¿ã€‚ æ¥çœ‹çœ‹æ›´å¤šçš„ç©æ„å„¿ã€‚ Parameterized Functions: ä¸Šä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œå¤–å±‚å‡½æ•°å¸¦ä¸€ä¸ªå‚æ•°ï¼Œå†…å±‚å‡½æ•°åˆ™æ²¡æœ‰ã€‚ç°åœ¨è¯•è¯•éƒ½å¸¦å‚æ•°çš„æƒ…å†µã€‚ iex&gt; add_n = fn n -&gt; (fn other -&gt; n + other end) end #Function&lt;12. 17052888 in :erl_eval. expr/5&gt;iex&gt; add_two = add_n. (2)#Function&lt;12. 17052888 in :erl_eval. expr/5&gt;iex&gt; add_five = add_n. (5)#Function&lt;12. 17052888 in :erl_eval. expr/5&gt;iex&gt; add_two. (3)5iex&gt; add_five. (7)12è¿™é‡Œå†…å±‚å‡½æ•°æŠŠå…¶å‚æ•°otheråŠ åˆ°å¤–å±‚å‡½æ•°çš„å‚æ•°nä¸Šã€‚æ¯æ¬¡è°ƒç”¨å¤–å±‚å‡½æ•°ï¼Œæˆ‘ä»¬ä¼ ä¸€ä¸ªå€¼ç»™å…¶å‚æ•°nï¼Œå®ƒè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æŠŠnå’Œå…¶è‡ªå·±çš„å‚æ•°ç›¸åŠ ã€‚ Passing Functions as Arguments: å‡½æ•°å°±æ˜¯å€¼ï¼Œæ‰€ä»¥å¯ä»¥æŠŠå®ƒä»¬ä¼ ç»™å…¶ä»–å‡½æ•°ã€‚ iex&gt; times_2 = fn n -&gt; n * 2 end#Function&lt;12. 17052888 in :erl_eval. expr/5&gt;iex&gt; apply = fn (fun, value) -&gt; fun. (value) end #Function&lt;12. 17052888 in :erl_eval. expr/5&gt;iex&gt; apply. (times_2, 6)12è¿™é‡Œï¼Œapplyæ˜¯ä¸€ä¸ªå¸¦ç¬¬äºŒä¸ªå‡½æ•°å’Œä¸€ä¸ªå€¼çš„å‡½æ•°ã€‚å®ƒè¿”å›çš„æ˜¯ç¬¬äºŒä¸ªå‡½æ•°ä»¥é‚£ä¸ªå€¼ä½œä¸ºå‚æ•°è¿è¡Œçš„ç»“æœã€‚ åœ¨ Elixir ä¸­ï¼Œè¿™ç§å‡½æ•°ä¼ é€’çš„èƒ½åŠ›å‡ ä¹åœ¨åˆ°å¤„éƒ½è¢«æ¼‚äº®åœ°ä½¿ç”¨ç€ã€‚ä¾‹å¦‚ï¼Œå†…ç½®çš„Enumæ¨¡å—æœ‰ä¸€ä¸ªmapå‡½æ•°ï¼Œä½¿ç”¨ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªé›†åˆå’Œä¸€ä¸ªå‡½æ•°ã€‚å®ƒè¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œæ˜¯åœ¨é‚£ä¸ªé›†åˆçš„æ¯ä¸ªå…ƒç´ ä¸Šéƒ½è°ƒç”¨é‚£ä¸ªå‡½æ•°åçš„ç»“æœã€‚ iex&gt; list = [1, 3, 5, 7, 9][1, 3, 5, 7, 9]iex&gt; Enum. map list, fn elem -&gt; elem * 2 end[2, 6, 10, 14, 18]iex&gt; Enum. map list, fn elem -&gt; elem * elem end[1, 9, 25, 49, 81]iex&gt; Enum. map list, fn elem -&gt; elem &gt; 6 end[false, false, false, true, true]Pinned Values and Function Parameters: æˆ‘ä»¬ä¹‹å‰çœ‹æ¨¡å¼åŒ¹é…æ—¶ï¼Œçœ‹åˆ°è¿‡ pin æ“ä½œç¬¦ï¼ˆ^ï¼‰å…è®¸åœ¨æ¨¡å¼ä¸­ä½¿ç”¨ä¸€ä¸ªå˜é‡çš„å½“å‰å€¼ã€‚è¿™ç§æ–¹å¼ä¹Ÿèƒ½ç”¨åœ¨å‡½æ•°å‚æ•°ä¸Šã€‚ defmodule Greeter do def for(name, greeting) do  fn   (^name) -&gt;  #{greeting} #{name}    (_) -&gt;  I don't know you   end endendmr_valim = Greeter. for( JosÃ© ,  Oi! )IO. puts mr_valim. ( JosÃ© ) # =&gt; Oi! JosÃ©IO. puts mr_valim. ( Dave ) # =&gt; I don't know youè¿™é‡Œï¼ŒGreeter. forå‡½æ•°è¿”å›ä¸€ä¸ªå¸¦ä¸¤ä¸ª head çš„å‡½æ•°ï¼ˆè¿˜è®°å¾—åˆ—è¡¨çš„å¤´å’Œå°¾å—ï¼Ÿï¼‰ã€‚å½“ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºä¼ ç»™forçš„ name çš„å€¼æ—¶ï¼Œç¬¬ä¸€ä¸ª head å°±èƒ½åŒ¹é…ä¸Šã€‚ The &amp; Notation: åˆ›å»ºçŸ­å°å¸®åŠ©å‡½æ•°çš„ç­–ç•¥æ˜¯å¦‚æ­¤æ™®éï¼Œæ‰€ä»¥ Elixir æä¾›äº†ä¸€ç§å¿«æ·æ–¹å¼ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ã€‚ iex&gt; add_one = &amp;(&amp;1 + 1) # same as add_one = fn (n) -&gt; n + 1 end#Function&lt;6. 17052888 in :erl_eval. expr/5&gt;iex&gt; add_one. (44)45iex&gt; square = &amp;(&amp;1 * &amp;1)#Function&lt;6. 17052888 in :erl_eval. expr/5&gt;iex&gt; square. (8)64iex&gt; speak = &amp;(IO. puts(&amp;1))&amp;IO. puts/1iex&gt; speak. ( Hello )Hello:ok&amp;æ“ä½œç¬¦æŠŠå…¶åçš„è¡¨è¾¾å¼è½¬æ¢ä¸ºä¸€ä¸ªå‡½æ•°ã€‚åœ¨è¡¨è¾¾å¼å†…ï¼Œ&amp;1, &amp;2ç­‰ç±»ä¼¼çš„å ä½ç¬¦ä¾æ¬¡å¯¹åº”ç¬¬ä¸€ä¸ªã€ç¬¬äºŒä¸ªç­‰å‡½æ•°çš„å‚æ•°ã€‚æ‰€ä»¥&amp;(&amp;1 + &amp;2)ä¼šè¢«è½¬æ¢ä¸ºfn p1, p2 -&gt; p1 + p2 endã€‚ å¦‚æœä½ è§‰å¾—è¿™ç§åšæ³•å¾ˆèªæ˜ï¼Œé‚£æˆ‘ä»¬å†æ¥çœ‹çœ‹ä¸Šé¢ä»£ç ä¸­æœ‰speakçš„é‚£ä¸€è¡Œã€‚ä¸€èˆ¬æ¥è¯´ Elixir ä¼šç”Ÿæˆä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œæ‰€ä»¥&amp;(IO. puts(&amp;1))ä¼šå˜æˆfn x -&gt; IO. puts(x) endã€‚ç„¶è€Œ Elixir æ³¨æ„åˆ°åŒ¿åå‡½æ•°çš„å‡½æ•°ä½“æ˜¯ä¸€ä¸ªç®€å•å…·åå‡½æ•°ï¼ˆIO æ¨¡å—çš„ puts å‡½æ•°ï¼‰çš„è°ƒç”¨ï¼Œä¸”å…¶å‚æ•°æŒ‰æ­£ç¡®çš„é¡ºåºå¯¹åº”ï¼ˆæ„æ€æ˜¯ï¼ŒåŒ¿åå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯å…·åå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä»¥æ­¤ç±»æ¨ï¼‰ã€‚å› æ­¤ Elixir å°±ä¼šä¼˜åŒ–è¿™ä¸ªåŒ¿åå‡½æ•°ï¼Œç”¨å…·åå‡½æ•°ï¼ˆIO. puts/1ï¼‰çš„ä¸€ä¸ªç›´æ¥å¼•ç”¨æ¥ä»£æ›¿å®ƒã€‚ è¦ä½¿å…¶æ­£å¸¸å·¥ä½œï¼Œå‚æ•°å¿…é¡»ä¿æŒæ­£ç¡®çš„é¡ºåºï¼š iex&gt; rnd = &amp;(Float. round(&amp;1, &amp;2))&amp;Float. round/2iex&gt; rnd = &amp;(Float. round(&amp;2, &amp;1))#Function&lt;12. 17052888 in :erl_eval. expr/5&gt;å½“ç”¨è¿™ç§æ–¹å¼å®šä¹‰å‡½æ•°æ—¶ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°å¯¹ Erlang çš„å¼•ç”¨è¹¦å‡ºæ¥ï¼Œè¿™æ˜¯å› ä¸º Elixir è¿è¡Œåœ¨ Erlang VM ä¸Šçš„ç¼˜æ•…ã€‚å½“ä½ å°è¯•æ›´å¤šå¦‚&amp;abs(&amp;1)çš„ä¸œè¥¿æ—¶ï¼Œå¯ä»¥çœ‹åˆ°è¿™ç§è¡Œä¸ºçš„æ›´å¤šä½“ç°ã€‚è¿™é‡Œ Elixir æŠŠå¯¹äº abs å‡½æ•°çš„ä½¿ç”¨ç›´æ¥æ˜ å°„åˆ°åº•å±‚çš„ Erlang åº“ï¼Œè¿”å›&amp;:erlang. abs/1ã€‚ å› ä¸º[]å’Œ{}åœ¨ Elixir ä¸­éƒ½æ˜¯æ“ä½œç¬¦ï¼Œåˆ—è¡¨å’Œå…ƒç»„çš„å­—é¢é‡ä¹Ÿèƒ½è¢«è½¬æ¢ä¸ºå‡½æ•°ã€‚ä¸‹é¢è¿™ä¸ªå‡½æ•°ç”¨æ¥è¿”å›ä¸€ä¸ªå…ƒç»„ï¼Œå…¶å…ƒç´ åŒ…å«ä¸¤ä¸ªæ•´æ•°ç›¸é™¤åçš„å•†å’Œä½™æ•°ï¼š iex&gt; divrem = &amp;{ div(&amp;1,&amp;2), rem(&amp;1,&amp;2) } #Function&lt;12. 17052888 in :erl_eval. expr/5&gt;iex&gt; divrem. (13, 5){2, 3}æœ€åï¼Œ&amp;æ“ä½œç¬¦ä¹Ÿå¯ç”¨äºå­—ç¬¦ä¸²ï¼ˆæˆ–ç±»ä¼¼å­—ç¬¦ä¸²ï¼‰çš„å­—é¢é‡ï¼š iex&gt; s = &amp; bacon and #{&amp;1} #Function&lt;6. 99386804/1 in :erl_eval. expr/5&gt;iex&gt; s. ( custard ) bacon and custard iex&gt; match_end = &amp;~r/. *#{&amp;1}$/#Function&lt;6. 99386804/1 in :erl_eval. expr/5&gt;iex&gt;  cat  =~ match_end. ( t )trueiex&gt;  cat  =~ match_end. ( ! )falseè¿˜æœ‰ç¬¬äºŒç§&amp;å‡½æ•°æ•è·æ“ä½œç¬¦çš„ä½¿ç”¨æ–¹å¼ã€‚ä½ èƒ½ä¼ ç»™å®ƒä¸€ä¸ªå·²æœ‰å‡½æ•°çš„åç§°å’Œå…ƒæ•°ï¼ˆå‚æ•°çš„ä¸ªæ•°ï¼‰ï¼Œå®ƒè¿”å›çš„åŒ¿åå‡½æ•°ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚ä¼ é€’ç»™åŒ¿åå‡½æ•°çš„å‚æ•°ä¼šä¾æ¬¡ä¼ ç»™è¿™ä¸ªå…·åå‡½æ•°ã€‚æˆ‘ä»¬å·²ç»çœ‹åˆ°è¿‡äº†ï¼šå½“ä½ åœ¨ iex ä¸­è¾“å…¥&amp;(IO. puts(&amp;1))ï¼Œçœ‹åˆ°æ˜¾ç¤ºçš„ç»“æœæ˜¯&amp;IO. puts/1ã€‚è¿™é‡Œputsæ˜¯ IO æ¨¡å—çš„å‡½æ•°ï¼Œå¸¦ä¸€ä¸ªå‚æ•°ã€‚åœ¨ Elixir ä¸­å¯¹å…¶çš„å‘½åæ–¹å¼ä¸ºIO. puts/1ã€‚å½“æŠŠ&amp;æ”¾åœ¨å®ƒçš„å‰é¢æ—¶ï¼Œæˆ‘ä»¬æ˜¯æŠŠå®ƒå°è£…ä¸ºäº†ä¸€ä¸ªå‡½æ•°ã€‚å†çœ‹çœ‹å…¶ä»–çš„ä¾‹å­ï¼š iex&gt; l = &amp;length/1&amp;:erlang. length/1iex&gt; l. ([1,3,5,7])4iex&gt; len = &amp;Enum. count/1&amp;Enum. count/1iex&gt; len. ([1,2,3,4])4iex&gt; m = &amp;Kernel. min/2 # This is an alias for the Erlang function&amp;:erlang. min/2iex&gt; m. (99,88)88è¿™ç§æ–¹å¼å¯¹äºæˆ‘ä»¬è‡ªå·±å†™çš„å…·åå‡½æ•°ä¹Ÿæ˜¯é€‚ç”¨çš„ï¼ˆå°½ç®¡æˆ‘ä»¬è¿˜æ²¡æœ‰è®²æ€æ ·å†™å…·åå‡½æ•°ï¼‰ã€‚ &amp;å¿«æ·æ–¹å¼ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§ç»å¦™çš„æ–¹å¼æ¥æŠŠå‡½æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°ã€‚ iex&gt; Enum. map [1,2,3,4], &amp;(&amp;1 + 1)[2, 3, 4, 5]iex&gt; Enum. map [1,2,3,4], &amp;(&amp;1 * &amp;1)[1, 4, 9, 16]iex&gt; Enum. map [1,2,3,4], &amp;(&amp;1 &lt; 3)[true, true, false, false]Functions Are the Core: æœ¬ä¹¦å¼€å¤´ï¼Œæˆ‘ä»¬è¯´è¿‡ç¼–ç¨‹çš„åŸºçŸ³æ˜¯æ•°æ®çš„è½¬æ¢ã€‚å‡½æ•°æ˜¯ æä¾›è¿™ç§è½¬æ¢çš„å¾®å°å¼•æ“ã€‚å®ƒä»¬å±…äº Elixir çš„æœ€ä¸­å¿ƒã€‚ è‡³æ­¤æˆ‘ä»¬å·²ç»é¢†ç•¥äº†åŒ¿åå‡½æ•°â€”â€”å°½ç®¡æˆ‘ä»¬èƒ½æŠŠå®ƒä»¬å’Œå˜é‡ç»‘å®šï¼Œä½†è¿™äº›å‡½æ•°è‡ªå·±å¹¶æ²¡æœ‰åç§°ã€‚Elixir ä¹Ÿæœ‰å…·åå‡½æ•°ã€‚ä¸‹ä¸€ç« å°±ä¼šè®²åˆ°å®ƒä»¬ã€‚ "
    }, {
    "id": 41,
    "url": "/2020/07/proper-browser-testing-in-rails/",
    "title": "2020æ—¶ä»£çš„Railsç³»ç»Ÿæµ‹è¯•",
    "body": "2020/07/16 - æœ¬æ–‡å·²è·å¾—åŸä½œè€…ï¼ˆVladimir Dementyevï¼‰å’Œ Evil Martians æˆæƒè®¸å¯è¿›è¡Œç¿»è¯‘ã€‚åŸæ–‡ä»‹ç»äº†åœ¨æ–°çš„ 2020 æ—¶ä»£ï¼Œæ‘’å¼ƒäº†åŸºäº Java çš„ç¬¨é‡ Selenium ä¹‹åï¼Œå¦‚ä½•åœ¨ Rails ä¸‹æ„å»ºåŸºäºæµè§ˆå™¨çš„é«˜æ•ˆç³»ç»Ÿæµ‹è¯•ã€‚ä½œè€…å¯¹äºç³»ç»Ÿæµ‹è¯•æ¦‚å¿µè¿›è¡Œäº†è¯¦ç»†é˜è¿°ï¼Œæ¼”ç¤ºäº†å…·ä½“é…ç½®çš„èŒƒä¾‹å’Œè¿è¡Œæ•ˆæœï¼Œå¯¹ Docker å¼€å‘ç¯å¢ƒä¹Ÿæœ‰ä¸“ä¸šçº§åˆ«çš„æ¶µç›–ã€‚éå¸¸æ¨èã€‚  åŸæ–‡é“¾æ¥ï¼šSystem of a test:Proper browser testing in Ruby on Rails â€” Martian Chronicles, Evil Martiansâ€™ team blog ä½œè€…ï¼šVladimir Dementyev ç«™ç‚¹ï¼šEvil Martians â€”â€”ä½äºçº½çº¦å’Œä¿„ç½—æ–¯çš„ Ruby on Rails å¼€å‘äººå‘˜åšå®¢ã€‚ å®ƒå‘å¸ƒäº†è®¸å¤šä¼˜ç§€çš„æ–‡ç« ï¼Œå¹¶ä¸”æ˜¯ä¸å°‘ gem çš„èµåŠ©å•†ã€‚ã€ä¸‹é¢æ˜¯æ­£æ–‡ã€‘ å‘ç° Ruby on Rails åº”ç”¨ä¸­ç«¯åˆ°ç«¯æµè§ˆå™¨æµ‹è¯•çš„æœ€ä½³å®è·µé›†åˆï¼Œå¹¶åœ¨ä½ çš„é¡¹ç›®ä¸Šé‡‡ç”¨å®ƒä»¬ã€‚äº†è§£å¦‚ä½•æ‘’å¼ƒåŸºäº Java çš„ Seleniumï¼Œè½¬è€Œä½¿ç”¨æ›´åŠ ç²¾ç®€çš„ Ferrum-Cuprite ç»„åˆï¼Œå®ƒä»¬èƒ½ç›´æ¥é€šè¿‡çº¯ Ruby æ–¹å¼æ¥ä½¿ç”¨ Chrome DevTools çš„åè®®ã€‚å¦‚æœä½ åœ¨ä½¿ç”¨ Docker å¼€å‘ç¯å¢ƒâ€”â€”æœ¬æ–‡ä¹Ÿæœ‰æ¶µç›–ã€‚ Ruby ç¤¾åŒºå¯¹äºæµ‹è¯•é¥±å«æ¿€æƒ…ã€‚æˆ‘ä»¬æœ‰æ•°ä¸èƒœæ•°çš„æµ‹è¯•åº“ï¼Œæœ‰æˆåƒä¸Šä¸‡ç¯‡å…³äºæµ‹è¯•ä¸»é¢˜çš„åšå®¢æ–‡ç« ï¼Œç”šè‡³ä¸ºæ­¤æœ‰ä¸€ä¸ªä¸“é—¨çš„æ’­å®¢ã€‚æ›´å¯æ€•çš„æ˜¯ï¼Œä¸‹è½½é‡æ’åœ¨å‰ä¸‰åçš„ Gem ä¹Ÿéƒ½æ˜¯æœ‰å…³ RSpec æµ‹è¯•æ¡†æ¶çš„ï¼ æˆ‘ç›¸ä¿¡ï¼ŒRailsï¼Œæ˜¯ Ruby æµ‹è¯•å…´ç››èƒŒåçš„åŸå› ä¹‹ä¸€ã€‚è¿™ä¸ªæ¡†æ¶è®©æµ‹è¯•çš„ç¼–å†™å°½å¯èƒ½åœ°æˆä¸ºä¸€ç§äº«å—äº†ã€‚å¤šæ•°æƒ…å†µä¸‹ï¼Œè·Ÿéšç€ Rails æµ‹è¯•æŒ‡å—çš„æ•™å¯¼å°±å·²è¶³å¤Ÿï¼ˆèµ·ç åœ¨åˆšå¼€å§‹çš„æ—¶å€™ï¼‰ã€‚ä½†äº‹æƒ…æ€»æœ‰ä¾‹å¤–ï¼Œè€Œåœ¨æˆ‘ä»¬è¿™é‡Œï¼Œå°±æ˜¯ç³»ç»Ÿæµ‹è¯•ã€‚ å¯¹ Rail åº”ç”¨è€Œè¨€ï¼Œç¼–å†™å’Œç»´æŠ¤ç³»ç»Ÿæµ‹è¯•å¾ˆéš¾è¢«ç§°ä¸ºâ€œæƒ¬æ„çš„â€ã€‚æˆ‘åœ¨å¤„ç†è¿™ä¸ªé—®é¢˜ä¸Šï¼Œè‡ª 2013 å¹´çš„ç¬¬ä¸€æ¬¡ Cucumber é©±åŠ¨æµ‹è¯•ç®—èµ·ï¼Œå·²ç»é€æ­¥æ”¹è¿›äº†å¤ªå¤šã€‚è€Œä»Šå¤©ï¼Œåˆ°äº† 2020 å¹´ï¼Œæˆ‘ç»ˆäºå¯ä»¥æ¥è·Ÿå¤§å®¶åˆ†äº«ä¸€ä¸‹è‡ªå·±å½“å‰ï¼ˆå…³äºæµ‹è¯•ï¼‰çš„è®¾ç½®äº†ã€‚æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†ä¼šè®¨è®ºä»¥ä¸‹å‡ ç‚¹ï¼š  ç³»ç»Ÿæµ‹è¯•æ¦‚è¿° ä½¿ç”¨ Cuprite è¿›è¡Œç°ä»£ç³»ç»Ÿæµ‹è¯• é…ç½®èŒƒä¾‹ Docker åŒ–çš„ç³»ç»Ÿæµ‹è¯•ç³»ç»Ÿæµ‹è¯•æ¦‚è¿°: â€œç³»ç»Ÿæµ‹è¯•â€æ˜¯ Rails ä¸–ç•Œä¸­å¯¹äºè‡ªåŠ¨åŒ–ç«¯åˆ°ç«¯æµ‹è¯•çš„ä¸€ç§é€šå¸¸ç§°è°“ã€‚åœ¨ Rails é‡‡ç”¨è¿™ä¸ªåç§°ä¹‹å‰ï¼Œæˆ‘ä»¬ä½¿ç”¨è¯¸å¦‚åŠŸèƒ½æµ‹è¯•ã€æµè§ˆå™¨æµ‹è¯•ã€ç”šè‡³éªŒæ”¶æµ‹è¯•ç­‰å„ç§å«æ³•ï¼ˆå°½ç®¡åè€…åœ¨æ„æ€ä¸Šæœ‰æ‰€ä¸åŒï¼‰ã€‚ å¦‚æœæˆ‘ä»¬å›å¿†ä¸‹æµ‹è¯•é‡‘å­—å¡”ï¼ˆæˆ–è€…å°±é‡‘å­—å¡”ï¼‰ï¼Œç³»ç»Ÿæµ‹è¯•æ˜¯å¤„äºéå¸¸é ä¸Šçš„ä½ç½®ï¼šå®ƒä»¬æŠŠæ•´ä¸ªç¨‹åºè§†ä¸ºä¸€ä¸ªé»‘ç›’ï¼Œé€šå¸¸æ¨¡æ‹Ÿç»ˆç«¯ç”¨æˆ·çš„è¡Œä¸ºå’Œé¢„æœŸã€‚è€Œè¿™å°±æ˜¯åœ¨ Web åº”ç”¨ç¨‹åºæƒ…å†µä¸‹ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦æµè§ˆå™¨æ¥è¿è¡Œè¿™äº›æµ‹è¯•çš„åŸå› ï¼ˆæˆ–è€…è‡³å°‘æ˜¯ç±»ä¼¼ Rack Test çš„æ¨¡æ‹Ÿå™¨ï¼‰ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸‹å…¸å‹çš„ç³»ç»Ÿæµ‹è¯•æ¶æ„ï¼š æˆ‘ä»¬éœ€è¦ç®¡ç†è‡³å°‘ä¸‰ä¸ªâ€œè¿›ç¨‹â€ï¼ˆå®ƒä»¬æœ‰äº›å¯ä»¥æ˜¯ Ruby çº¿ç¨‹ï¼‰ï¼šä¸€ä¸ª è¿è¡Œæˆ‘ä»¬åº”ç”¨çš„ Web æœåŠ¡ç«¯ï¼Œä¸€ä¸ªæµè§ˆå™¨ï¼Œå’Œä¸€ä¸ªæµ‹è¯•è¿è¡Œå™¨ã€‚è¿™æ˜¯æœ€ä½è¦æ±‚ã€‚å®é™…æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€šå¸¸è¿˜éœ€è¦å¦ä¸€ä¸ªå·¥å…·æä¾› API æ¥æ§åˆ¶æµè§ˆå™¨ï¼ˆæ¯”å¦‚ï¼ŒChromeDriverï¼‰ã€‚ä¸€äº›å·¥å…·å°è¯•é€šè¿‡æ„å»ºç‰¹å®šæµè§ˆå™¨ï¼ˆä¾‹å¦‚ capybara-webkit å’Œ PhantomJSï¼‰æ¥ç®€åŒ–æ­¤è®¾ç½®ï¼Œå¹¶æä¾›å¼€ç®±å³ç”¨çš„æ­¤ç±» APIï¼Œä½†å®ƒä»¬åœ¨å¯¹çœŸæ­£æµè§ˆå™¨çš„å…¼å®¹æ€§â€œç«äº‰â€ä¸­éƒ½è´¥ä¸‹é˜µæ¥ï¼Œæ²¡èƒ½å¹¸å…äºéš¾ã€‚ å½“ç„¶ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ å°‘é‡ Ruby Gem æµ‹è¯•ä¾èµ–åº“â€”â€”æ¥æŠŠæ‰€æœ‰ç¢ç‰‡éƒ½ç²˜åˆèµ·æ¥ã€‚æ›´å¤šçš„ä¾èµ–åº“ä¼šå¸¦æ¥æ›´å¤šçš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼ŒDatabase Cleaner åœ¨å¾ˆé•¿æ—¶é—´å†…éƒ½æ˜¯ä¸€ä¸ªå¿…å¤‡çš„åº“ï¼šæˆ‘ä»¬ä¸èƒ½ä½¿ç”¨äº‹åŠ¡æ¥è‡ªåŠ¨å›æ»šæ•°æ®åº“çŠ¶æ€ï¼Œå› ä¸ºæ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯ç”¨è‡ªå·±ç‹¬ç«‹çš„è¿æ¥ã€‚æˆ‘ä»¬ä¸å¾—ä¸é’ˆå¯¹æ¯å¼ è¡¨ä½¿ç”¨TRUNCATE . . . æˆ–DELETE FROM . . . æ¥ä»£æ›¿ï¼Œè¿™ä¼šç›¸å½“æ…¢ã€‚æˆ‘ä»¬é€šè¿‡åœ¨æ‰€æœ‰çº¿ç¨‹ä¸­ä½¿ç”¨ä¸€ä¸ªå…±äº«è¿æ¥è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼ˆä½¿ç”¨ TestProf extensionï¼‰ã€‚Rails 5. 1 ä¹Ÿå‘å¸ƒäº†ä¸€ä¸ªç°æˆçš„ç±»ä¼¼åŠŸèƒ½ã€‚ è¿™æ ·ï¼Œé€šè¿‡æ·»åŠ ç³»ç»Ÿæµ‹è¯•ï¼Œæˆ‘ä»¬å¢åŠ äº†å¼€å‘ç¯å¢ƒå’Œ CI ç¯å¢ƒçš„ç»´æŠ¤æˆæœ¬ï¼Œä»¥åŠå¼•å…¥äº†æ½œåœ¨çš„æ•…éšœæˆ–ä¸ç¨³å®šå› ç´ ï¼šç”±äºå¤æ‚çš„è®¾ç½®ï¼Œflakiness æ˜¯ç«¯åˆ°ç«¯æµ‹è¯•ä¸­æœ€å¸¸è§çš„é—®é¢˜ã€‚è€Œå¤§å¤šæ•°è¿™äº› flakiness æ¥è‡ªäºè·Ÿæµè§ˆå™¨çš„é€šä¿¡ã€‚ å°½ç®¡é€šè¿‡åœ¨ Rails 5. 1 ä¸­å¼•å…¥ç³»ç»Ÿæµ‹è¯•ç®€åŒ–äº†æµè§ˆå™¨æµ‹è¯•ï¼Œå®ƒä»¬ä»ç„¶éœ€è¦ä¸€äº›é…ç½®æ‰èƒ½å¹³æ»‘è¿è¡Œï¼š  ä½ éœ€è¦å¤„ç† Web driversï¼ˆRails å‡è®¾ä½ ä½¿ç”¨ Seleniumï¼‰ã€‚ ä½ å¯ä»¥è‡ªå·±åœ¨å®¹å™¨åŒ–ç¯å¢ƒä¸­é…ç½®ç³»ç»Ÿæµ‹è¯•ï¼ˆä¾‹å¦‚ï¼Œè±¡è¿™ç¯‡æ–‡ç« ä¸­çš„åšæ³•ï¼‰ã€‚ é…ç½®ä¸å¤Ÿçµæ´»ï¼ˆä¾‹å¦‚ï¼Œå±å¹•å¿«ç…§çš„è·¯å¾„ï¼‰è®©æˆ‘ä»¬æ¥è½¬åˆ°ä»£ç å±‚é¢å§ï¼Œçœ‹çœ‹åœ¨ 2020 æ—¶ä»£å¦‚ä½•è®©ä½ çš„ç³»ç»Ÿæµ‹è¯•æ›´æœ‰ä¹è¶£ï¼ ä½¿ç”¨ Cuprite è¿›è¡Œç°ä»£ç³»ç»Ÿæµ‹è¯•: é»˜è®¤æƒ…å†µä¸‹ï¼ŒRails å‡è®¾ä½ ä¼šä½¿ç”¨ Selenium æ¥è·‘ç³»ç»Ÿæµ‹è¯•ã€‚Selenium æ˜¯ä¸€ä¸ªå®æˆ˜éªŒè¯è¿‡çš„ Web æµè§ˆå™¨è‡ªåŠ¨åŒ–è½¯ä»¶ã€‚å®ƒæ—¨åœ¨ä¸ºæ‰€æœ‰æµè§ˆå™¨æä¾›ä¸€ä¸ªé€šç”¨ API ä»¥åŠæœ€çœŸå®çš„ä½“éªŒã€‚åœ¨æ¨¡æ‹Ÿç”¨æˆ·æµè§ˆå™¨äº¤äº’æ–¹é¢ï¼Œå”¯æœ‰æœ‰è¡€æœ‰è‚‰çš„çœŸäººæ‰æ¯”å®ƒåšå¾—æ›´å¥½äº›ã€‚ ä¸è¿‡ï¼Œè¿™ç§èƒ½åŠ›ä¸æ˜¯æ²¡æœ‰ä»£ä»·çš„ï¼šä½ éœ€è¦å®‰è£…ç‰¹å®šæµè§ˆå™¨çš„é©±åŠ¨ï¼Œç°å®äº¤äº’çš„å¼€é”€åœ¨è§„æ¨¡ä¸Šæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼ˆä¾‹å¦‚ï¼ŒSelenium çš„æµ‹è¯•é€šå¸¸éƒ½ç›¸å½“æ…¢ï¼‰ã€‚ Selenium å·²ç»æ˜¯å¾ˆä¹…ä»¥å‰å‘å¸ƒçš„äº†ï¼Œé‚£æ—¶æµè§ˆå™¨è¿˜ä¸æä¾›ä»»ä½•å†…ç½®è‡ªåŠ¨åŒ–æµ‹è¯•å…¼å®¹æ€§ã€‚è¿™ä¹ˆå¤šå¹´è¿‡å»äº†ï¼Œç°åœ¨çš„æƒ…å†µå·²ç»å¤§ä¸ç›¸åŒï¼ŒChrome å¼•å…¥äº† CDP åè®®ã€‚ä½¿ç”¨ CDPï¼Œä½ å¯ä»¥ç›´æ¥æ“ä½œæµè§ˆå™¨çš„ Sessionï¼Œä¸å†éœ€è¦ä¸­é—´çš„æŠ½è±¡å±‚å’Œå·¥å…·ã€‚ ä»é‚£ä»¥åï¼Œæ¶Œç°äº†å¥½å¤šåˆ©ç”¨ CDP çš„é¡¹ç›®ï¼ŒåŒ…æ‹¬æœ€è‘—åçš„â€”â€”Puppeteerï¼Œä¸€ä¸ª Node. js çš„æµè§ˆå™¨è‡ªåŠ¨åŒ–åº“ã€‚é‚£ä¹ˆ Ruby ä¸–ç•Œå‘¢ï¼Ÿæ˜¯ Ferrumï¼Œä¸€ä¸ª Ruby çš„ CDP åº“ï¼Œå°½ç®¡è¿˜ç›¸å½“å¹´è½»ï¼Œä¹Ÿæä¾›äº†ä¸é€Šè‰²äº Puppeteer çš„ä½“éªŒã€‚è€Œå¯¹æˆ‘ä»¬æ›´é‡è¦çš„æ˜¯ï¼Œå®ƒå¸¦æ¥äº†ä¸€ä¸ªç§°ä¸º Cuprite çš„ä¼™ä¼´é¡¹ç›®â€”â€”ä½¿ç”¨ CDP çš„çº¯ Ruby Capybara é©±åŠ¨ã€‚ æˆ‘ä» 2020 å¹´åˆæ‰å¼€å§‹ç§¯æä½¿ç”¨ Cuprite çš„ï¼ˆä¸€å¹´å‰æˆ‘å°è¯•è¿‡ï¼Œä½†åœ¨ Docker ç¯å¢ƒä¸‹æœ‰äº›é—®é¢˜ï¼‰ï¼Œä»æœªè®©æˆ‘åæ‚”è¿‡ã€‚è®¾ç½®ç³»ç»Ÿæµ‹è¯•å˜å¾—å¼‚å¸¸ç®€å•ï¼ˆå…¨éƒ¨æ‰€éœ€ä»… Chrome è€Œå·²ï¼‰ï¼Œè€Œä¸”æ‰§è¡Œæ˜¯å¦‚æ­¤ä¹‹å¿«ï¼Œä»¥è‡³äºåœ¨ä» Selenium è¿ç§»è¿‡æ¥ä¹‹åæˆ‘çš„ä¸€äº›æµ‹è¯•éƒ½å¤±è´¥äº†ï¼šå®ƒä»¬ç¼ºä¹åˆé€‚çš„å¼‚æ­¥æœŸæœ›æ–­è¨€ï¼Œåœ¨ Selenium ä¸­èƒ½é€šè¿‡ä»…ä»…æ˜¯å› ä¸º Selenium å¤ªæ…¢ã€‚ è®©æˆ‘ä»¬æ¥çœ‹ä¸‹æˆ‘æœ€è¿‘å·¥ä½œä¸Šæ‰€ç”¨åˆ° Cuprite çš„ç³»ç»Ÿæµ‹è¯•é…ç½®ã€‚ æ³¨é‡Šè¿‡çš„é…ç½®èŒƒä¾‹: è¿™ä¸ªèŒƒä¾‹æ¥è‡ªäºæˆ‘æœ€è¿‘çš„å¼€æº Ruby on Rails é¡¹ç›®â€”â€”AnyCable Rails Demoã€‚å®ƒæ—¨åœ¨æ¼”ç¤ºå¦‚ä½•è·Ÿ Rails åº”ç”¨ä¸€èµ·ä½¿ç”¨åˆšåˆšå‘å¸ƒçš„ AnyCable 1. 0ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ç”¨äºæœ¬æ–‡â€”â€”å®ƒæœ‰å¾ˆå¥½çš„ç³»ç»Ÿæµ‹è¯•è¦†ç›–ç€ã€‚ è¿™ä¸ªé¡¹ç›®ä½¿ç”¨ RSpec åŠå…¶ç³»ç»Ÿæµ‹è¯•å°è£…å™¨ã€‚å…¶å¤§éƒ¨åˆ†ä¹Ÿæ˜¯å¯ä»¥ç”¨åœ¨ Minitest ä¸Šçš„ã€‚ è®©æˆ‘ä»¬ä»ä¸€ä¸ªè¶³ä»¥åœ¨æœ¬åœ°æœºå™¨ä¸Šè¿è¡Œçš„æœ€å°ç¤ºä¾‹å¼€å§‹ã€‚å…¶ä»£ç æ”¾åœ¨ AnyCable Rails Demo çš„ demo/dockerless åˆ†æ”¯ä¸Šã€‚ é¦–å…ˆæ¥å¿«é€Ÿçœ‹ä¸€çœ¼ Gemfileï¼š group :test do gem 'capybara' gem 'selenium-webdriver' gem 'cuprite'endä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦selenium-webdriverï¼Œå¦‚æœæˆ‘ä»¬æ ¹æœ¬ä¸ç”¨ Selenium çš„è¯ï¼Ÿäº‹å®è¯æ˜ï¼ŒRails è¦æ±‚è¿™ä¸ª gem ç‹¬ç«‹äºä½ æ‰€ä½¿ç”¨çš„é©±åŠ¨è€Œå­˜åœ¨ã€‚å¥½æ¶ˆæ¯æ˜¯ï¼Œè¿™å·²ç»è¢«ä¿®å¤äº†ï¼Œæˆ‘ä»¬æœ‰æœ›åœ¨ Rails 6. 1 ä¸­ç§»é™¤è¿™ä¸ª gemã€‚ æˆ‘æŠŠç³»ç»Ÿæµ‹è¯•çš„é…ç½®æ”¾åœ¨å¤šä¸ªæ–‡ä»¶å†…ï¼Œä½äºspec/system/supportç›®å½•ï¼Œä½¿ç”¨ä¸“é—¨çš„system_helper. rbæ¥åŠ è½½å®ƒä»¬ï¼š spec/ system/  support/   better_rails_system_tests. rb   capybara_setup. rb   cuprite_setup. rb   precompile_assets. rb   . . .  system_helper. rbæˆ‘ä»¬æ¥çœ‹ä¸‹ä¸Šé¢è¿™ä¸ªåˆ—è¡¨ä¸­çš„æ¯ä¸ªæ–‡ä»¶éƒ½æ˜¯å¹²å˜›çš„ã€‚ system_helper. rb: system_helper. rbæ–‡ä»¶åŒ…å«ä¸€äº›é’ˆå¯¹ç³»ç»Ÿæµ‹è¯•çš„é€šç”¨ RSpec é…ç½®ï¼Œä¸è¿‡ï¼Œé€šå¸¸è€Œè¨€ï¼Œéƒ½å¦‚ä¸‹é¢è¿™æ ·ç®€å•ï¼š # Load general RSpec Rails configurationrequire  rails_helper. rb # Load configuration files and helpersDir[File. join(__dir__,  system/support/**/*. rb )]. sort. each { |file| require file }ç„¶åï¼Œåœ¨ä½ çš„ç³»ç»Ÿæµ‹è¯•ä¸­ï¼Œä½¿ç”¨require  system_helper æ¥æ¿€æ´»è¯¥é…ç½®ã€‚ æˆ‘ä»¬ä¸ºç³»ç»Ÿæµ‹è¯•ä½¿ç”¨äº†ä¸€ä¸ªå•ç‹¬çš„ helper æ–‡ä»¶å’Œä¸€ä¸ª support æ–‡ä»¶å¤¹ï¼Œä»¥é¿å…åœ¨æˆ‘ä»¬åªéœ€è¿è¡Œä¸€ä¸ªå•å…ƒæµ‹è¯•æ—¶åŠ è½½æ‰€æœ‰å¤šä½™çš„é…ç½®ã€‚ capybara_setup. rb: è¿™ä¸ªæ–‡ä»¶åŒ…å«é’ˆå¯¹ Capybara æ¡†æ¶çš„é…ç½®ï¼š # spec/system/support/capybara_setup. rb# Usually, especially when using Selenium, developers tend to increase the max wait time. # With Cuprite, there is no need for that. # We use a Capybara default value here explicitly. Capybara. default_max_wait_time = 2# Normalize whitespaces when using `has_text?` and similar matchers,# i. e. , ignore newlines, trailing spaces, etc. # That makes tests less dependent on slightly UI changes. Capybara. default_normalize_ws = true# Where to store system tests artifacts (e. g. screenshots, downloaded files, etc. ). # It could be useful to be able to configure this path from the outside (e. g. , on CI). Capybara. save_path = ENV. fetch( CAPYBARA_ARTIFACTS ,  . /tmp/capybara )è¯¥æ–‡ä»¶ä¹ŸåŒ…å«ä¸€ä¸ªå¯¹äº Capybara å¾ˆæœ‰ç”¨çš„è¡¥ä¸ï¼Œå…¶ç›®çš„æˆ‘ä»¬ç¨åæ­ç¤ºï¼š # spec/system/support/capybara_setup. rbCapybara. singleton_class. prepend(Module. new do attr_accessor :last_used_session def using_session(name, &amp;block)  self. last_used_session = name  super ensure  self. last_used_session = nil endend)Capybara. using_sessionè®©ä½ èƒ½å¤Ÿæ“ä½œä¸åŒçš„æµè§ˆå™¨ sessionï¼Œä»è€Œåœ¨å•ä¸ªæµ‹è¯•åœºæ™¯å†…æ“ä½œå¤šä¸ªç‹¬ç«‹ sessionã€‚è¿™åœ¨æµ‹è¯•å®æ—¶åŠŸèƒ½æ—¶å°¤å…¶æœ‰ç”¨ï¼Œä¾‹å¦‚ä½¿ç”¨ WebSocket çš„åŠŸèƒ½ã€‚ è¯¥è¡¥ä¸è·Ÿè¸ªä¸Šæ¬¡ä½¿ç”¨çš„ session åç§°ã€‚æˆ‘ä»¬ä¼šç”¨è¿™ä¸ªä¿¡æ¯æ¥æ”¯æŒåœ¨å¤š session æµ‹è¯•ä¸­è·å–å¤±è´¥æƒ…å†µä¸‹çš„å±å¹•å¿«ç…§ã€‚ cuprite_setup. rb: è¿™ä¸ªæ–‡ä»¶è´Ÿè´£é…ç½® Cupriteï¼š # spec/system/support/cuprite_setup. rb# First, load Cuprite Capybara integrationrequire  capybara/cuprite # Then, we need to register our driver to be able to use it later# with #driven_by method. Capybara. register_driver(:cuprite) do |app| Capybara::Cuprite::Driver. new(  app,  **{   window_size: [1200, 800],   # See additional options for Dockerized environment in the respective section of this article   browser_options: {},   # Increase Chrome startup wait time (required for stable CI builds)   process_timeout: 10,   # Enable debugging capabilities   inspector: true,   # Allow running Chrome in a headful mode by setting HEADLESS env   # var to a falsey value   headless: !ENV[ HEADLESS ]. in?(%w[n 0 no false])  } )end# Configure Capybara to use :cuprite driver by defaultCapybara. default_driver = Capybara. javascript_driver = :cupriteæˆ‘ä»¬ä¹Ÿä¸ºå¸¸ç”¨ Cuprite API æ–¹æ³•å®šä¹‰äº†ä¸€äº›å¿«æ·æ–¹å¼ï¼š module CupriteHelpers # Drop #pause anywhere in a test to stop the execution.  # Useful when you want to checkout the contents of a web page in the middle of a test # running in a headful mode.  def pause  page. driver. pause end # Drop #debug anywhere in a test to open a Chrome inspector and pause the execution def debug(*args)  page. driver. debug(*args) endendRSpec. configure do |config| config. include CupriteHelpers, type: :systemendä¸‹é¢ä½ å¯ä»¥çœ‹åˆ°ä¸€ä¸ª#debugå¸®åŠ©æ–¹æ³•å¦‚ä½•å·¥ä½œçš„æ¼”ç¤ºï¼š better_rails_system_tests. rb: è¿™ä¸ªæ–‡ä»¶åŒ…å«ä¸€äº›æœ‰å…³ Rails ç³»ç»Ÿæµ‹è¯•å†…éƒ¨çš„è¡¥ä¸ä»¥åŠé€šç”¨é…ç½®ï¼ˆä»£ç æ³¨é‡Šæœ‰è¯¦ç»†è§£é‡Šï¼‰ï¼š # spec/system/support/better_rails_system_tests. rbmodule BetterRailsSystemTests # Use our `Capybara. save_path` to store screenshots with other capybara artifacts # (Rails screenshots path is not configurable https://github. com/rails/rails/blob/49baf092439fc74fc3377b12e3334c3dd9d0752f/actionpack/lib/action_dispatch/system_testing/test_helpers/screenshot_helper. rb#L79) def absolute_image_path  Rails. root. join( #{Capybara. save_path}/screenshots/#{image_name}. png ) end # Make failure screenshots compatible with multi-session setup.  # That's where we use Capybara. last_used_session introduced before.  def take_screenshot  return super unless Capybara. last_used_session  Capybara. using_session(Capybara. last_used_session) { super } endendRSpec. configure do |config| config. include BetterRailsSystemTests, type: :system # Make urls in mailers contain the correct server host.  # It's required for testing links in emails (e. g. , via capybara-email).  config. around(:each, type: :system) do |ex|  was_host = Rails. application. default_url_options[:host]  Rails. application. default_url_options[:host] = Capybara. server_host  ex. run  Rails. application. default_url_options[:host] = was_host end # Make sure this hook runs before others config. prepend_before(:each, type: :system) do  # Use JS driver always  driven_by Capybara. javascript_driver endendprecompile_assets. rb: è¿™ä¸ªæ–‡ä»¶è´Ÿè´£åœ¨è¿è¡Œç³»ç»Ÿæµ‹è¯•ä¹‹å‰é¢„ç¼–è¯‘ assetsï¼ˆæˆ‘ä¸åœ¨è¿™å„¿ç²˜è´´å®ƒçš„å®Œæ•´ä»£ç ï¼Œåªç»™å‡ºæœ€æœ‰è¶£çš„éƒ¨åˆ†ï¼‰ï¼š RSpec. configure do |config| # Skip assets precompilcation if we exclude system specs.  # For example, you can run all non-system tests via the following command: # #  rspec --tag ~type:system # # In this case, we don't need to precompile assets.  next if config. filter. opposite. rules[:type] ==  system  || config. exclude_pattern. match?(%r{spec/system}) config. before(:suite) do  # We can use webpack-dev-server for tests, too!  # Useful if you working on a frontend code fixes and want to verify them via system tests.   if Webpacker. dev_server. running?   $stdout. puts  \nâš™ï¸ Webpack dev server is running! Skip assets compilation. \n    next  else   $stdout. puts  \nğŸ¢ Precompiling assets. \n    # The code to run webpacker:compile Rake task   # . . .   end endendä¸ºä»€ä¹ˆè¦æ‰‹åŠ¨é¢„ç¼–è¯‘ assets å‘¢ï¼Œå¦‚æœ Rails èƒ½å¤Ÿè‡ªåŠ¨ä¸ºä½ åšè¿™äº‹çš„è¯ï¼Ÿé—®é¢˜åœ¨äº Rails é¢„ç¼–è¯‘ assets æ˜¯æƒ°æ€§çš„ï¼ˆæ¯”å¦‚ï¼Œåœ¨ä½ é¦–æ¬¡è¯·æ±‚ä¸€ä¸ª asset çš„æ—¶å€™ï¼‰ï¼Œè¿™ä¼šä½¿ä½ çš„ç¬¬ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹éå¸¸éå¸¸æ…¢ï¼Œç”šè‡³ç¢°åˆ°éšæœºè¶…æ—¶çš„å¼‚å¸¸ã€‚ å¦ä¸€ä¸ªæˆ‘æƒ³æè¯·æ³¨æ„çš„æ˜¯ä½¿ç”¨ Webpack dev server è¿›è¡Œç³»ç»Ÿæµ‹è¯•çš„èƒ½åŠ›ã€‚è¿™åœ¨å½“ä½ è¿›è¡Œè‰°è‹¦çš„å‰ç«¯ä»£ç é‡æ„æ—¶ç›¸å½“æœ‰ç”¨ï¼šä½ å¯ä»¥æš‚åœä¸€ä¸ªæµ‹è¯•ï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œç¼–è¾‘å‰ç«¯ä»£ç å¹¶çœ‹åˆ°å®ƒè¢«çƒ­åŠ è½½äº†ï¼ Docker åŒ–çš„ç³»ç»Ÿæµ‹è¯•: è®©æˆ‘ä»¬æŠŠè‡ªå·±çš„é…ç½®æå‡åˆ°æ›´é«˜çš„å±‚æ¬¡ï¼Œä½¿å…¶å…¼å®¹æˆ‘ä»¬çš„ Docker å¼€å‘ç¯å¢ƒã€‚Docker åŒ–ç‰ˆæœ¬çš„æµ‹è¯•è®¾ç½®åœ¨ AnyCable Rails Demo ä»£ç åº“çš„é»˜è®¤åˆ†æ”¯ä¸Šï¼Œå¯éšæ„æŸ¥çœ‹ï¼Œä¸è¿‡ä¸‹é¢æˆ‘ä»¬æ‰“ç®—æ¶µç›–é‚£äº›æœ‰æ„æ€çš„å†…å®¹ã€‚ Docker ä¸‹è®¾ç½®çš„ä¸»è¦åŒºåˆ«æ˜¯æˆ‘ä»¬åœ¨ä¸€ä¸ªå•ç‹¬çš„å®¹å™¨ä¸­è¿è¡Œæµè§ˆå™¨å®ä¾‹ã€‚å¯ä»¥æŠŠ Chrome æ·»åŠ åˆ°ä½ çš„åŸºç¡€ Rails é•œåƒä¸Šï¼Œæˆ–è€…å¯èƒ½çš„è¯ï¼Œç”šè‡³ä»å®¹å™¨å†…ä½¿ç”¨ä¸»æœºçš„æµè§ˆå™¨ï¼ˆè¿™å¯ä»¥ç”¨ Selenium and ChromeDriver åšåˆ°ï¼‰ã€‚ä½†æ˜¯ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œä¸ºdocker-compose. ymlå®šä¹‰ä¸€ä¸ªä¸“ç”¨çš„æµè§ˆå™¨ service æ˜¯ä¸€ç§æ›´æ­£ç¡®çš„ Docker å¼æ–¹å¼æ¥å¹²è¿™ä¸ªã€‚ ç›®å‰ï¼Œæˆ‘ç”¨çš„æ˜¯æ¥è‡ª browserless. io çš„ Chrome Docker é•œåƒã€‚å®ƒå¸¦æœ‰ä¸€ä¸ªå¥½ç”¨çš„ Debug æŸ¥çœ‹å™¨ï¼Œè®©ä½ èƒ½å¤Ÿè°ƒè¯• headless çš„æµè§ˆå™¨ sessionï¼ˆæœ¬æ–‡æœ€åæœ‰ä¸€ä¸ªç®€çŸ­çš„è§†é¢‘æ¼”ç¤ºï¼‰ï¼š services: # . . .  chrome:  image: browserless/chrome:1. 31-chrome-stable  ports:   -  3333:3333   environment:   # By default, it uses 3000, which is typically used by Rails.    PORT: 3333   # Set connection timeout to avoid timeout exception during debugging   # https://docs. browserless. io/docs/docker. html#connection-timeout   CONNECTION_TIMEOUT: 600000æŠŠCHROME_URL: http://chrome:3333æ·»åŠ åˆ°ä½ çš„ Rails service ç¯å¢ƒå˜é‡ï¼Œä»¥åå°æ–¹å¼è¿è¡Œ Chromeï¼š docker-compose up -d chromeç°åœ¨ï¼Œå¦‚æœæä¾›äº† URLï¼Œæˆ‘ä»¬å°±éœ€è¦é…ç½® Cuprite ä»¥å’Œè¿œç¨‹æµè§ˆå™¨ä¸€èµ·å·¥ä½œï¼š # cuprite_setup. rb# Parse URL# NOTE: REMOTE_CHROME_HOST should be added to Webmock/VCR allowlist if you use any of those. REMOTE_CHROME_URL = ENV[ CHROME_URL ]REMOTE_CHROME_HOST, REMOTE_CHROME_PORT = if REMOTE_CHROME_URL  URI. parse(REMOTE_CHROME_URL). yield_self do |uri|   [uri. host, uri. port]  end end# Check whether the remote chrome is running. remote_chrome = begin  if REMOTE_CHROME_URL. nil?   false  else   Socket. tcp(REMOTE_CHROME_HOST, REMOTE_CHROME_PORT, connect_timeout: 1). close   true  end rescue Errno::ECONNREFUSED, Errno::EHOSTUNREACH, SocketError  false endremote_options = remote_chrome ? { url: REMOTE_CHROME_URL } : {}ä¸Šé¢çš„é…ç½®å‡è®¾å½“CHROME_URLæœªè¢«è®¾ç½®æˆ–è€…æµè§ˆå™¨æœªå“åº”æ—¶ï¼Œä½¿ç”¨è€…æƒ³ä½¿ç”¨æœ¬åœ°å®‰è£…çš„ Chromeã€‚ æˆ‘ä»¬è¿™æ ·åšä»¥ä¾¿è®©é…ç½®å‘ä¸‹å…¼å®¹æœ¬åœ°çš„é…ç½®ï¼ˆæˆ‘ä»¬ä¸€èˆ¬ä¸å¼ºè¿«æ¯ä¸ªäººéƒ½ä½¿ç”¨ Docker ä½œä¸ºå¼€å‘ç¯å¢ƒï¼›è®©æ‹’ç»ä½¿ç”¨ Docker è€…ä¸ºå…¶ç‹¬ç‰¹çš„æœ¬åœ°è®¾ç½®è€Œå—è‹¦å§ğŸ˜ˆï¼‰ã€‚ æˆ‘ä»¬çš„é©±åŠ¨æ³¨å†Œç°åœ¨çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š # spec/system/support/cuprite_setup. rbCapybara. register_driver(:cuprite) do |app| Capybara::Cuprite::Driver. new(  app,  **{   window_size: [1200, 800],   browser_options: remote_chrome ? {  no-sandbox  =&gt; nil } : {},   inspector: true  }. merge(remote_options) )endæˆ‘ä»¬ä¹Ÿéœ€è¦æ›´æ–°è‡ªå·±çš„#debugå¸®åŠ©æ–¹æ³•ä»¥æ‰“å° Debug æŸ¥çœ‹å™¨çš„ URLï¼Œè€Œä¸æ˜¯å°è¯•å»æ‰“å¼€æµè§ˆå™¨ï¼š module CupriteHelpers # . . .  def debug(binding = nil)  $stdout. puts  ğŸ” Open Chrome inspector at http://localhost:3333   return binding. pry if binding  page. driver. pause endendç”±äºæµè§ˆå™¨æ˜¯è¿è¡Œåœ¨ä¸€ä¸ªä¸åŒçš„â€œæœºå™¨â€ä¸Šï¼Œå› æ­¤å®ƒåº”è¯¥çŸ¥é“å¦‚ä½•åˆ°è¾¾æµ‹è¯•æœåŠ¡ç«¯ï¼ˆå…¶ä¸å†æ˜¯localhostï¼‰ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦é…ç½® Capybara æœåŠ¡ç«¯çš„ hostï¼š # spec/system/support/capybara_setup. rb# Make server accessible from the outside worldCapybara. server_host =  0. 0. 0. 0 # Use a hostname that could be resolved in the internal Docker network# NOTE: Rails overrides Capybara. app_host in Rails &lt;6. 1, so we have# to store it differentlyCAPYBARA_APP_HOST = `hostname`. strip&amp;. downcase ||  0. 0. 0. 0 # In Rails 6. 1+ the following line should be enough# Capybara. app_host =  http://#{`hostname`. strip&amp;. downcase ||  0. 0. 0. 0 } æœ€åï¼Œè®©æˆ‘ä»¬å¯¹better_rails_system_tests. rbåšä¸€äº›è°ƒæ•´ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬æ¥è®© VS Code ä¸­çš„å±å¹•å¿«ç…§é€šçŸ¥å˜å¾—å¯ç‚¹å‡»ğŸ™‚ï¼ˆDocker ç»å¯¹è·¯å¾„ä¸ä¸»æœºç³»ç»Ÿæ˜¯ä¸åŒçš„ï¼‰ï¼š # spec/system/support/better_rails_system_tests. rbmodule BetterRailsSystemTests # . . .  # Use relative path in screenshot message def image_path  absolute_image_path. relative_path_from(Rails. root). to_s endendå…¶æ¬¡ï¼Œç¡®ä¿æµ‹è¯•éƒ½ä½¿ç”¨äº†æ­£ç¡®çš„æœåŠ¡ç«¯ hostï¼ˆè¿™åœ¨ Rails 6. 1 ä¸­å·²ç»è¢«ä¿®å¤äº†ï¼‰ï¼š # spec/system/support/better_rails_system_tests. rbconfig. prepend_before(:each, type: :system) do # Rails sets host to `127. 0. 0. 1` for every test by default.  # That won't work with a remote browser.  host! CAPYBARA_APP_HOST # Use JS driver always driven_by Capybara. javascript_driverendIn too Dip: å¦‚æœä½ ä½¿ç”¨ Dip æ¥ç®¡ç† Docker å¼€å‘ç¯å¢ƒï¼ˆæˆ‘å¼ºçƒˆå»ºè®®ä½ è¿™ä¹ˆåšï¼Œå®ƒä½¿ä½ è·å¾—å®¹å™¨çš„å¼ºå¤§èƒ½åŠ›ï¼Œè€Œæ— éœ€è®°å¿†æ‰€æœ‰ Docker CLI å‘½ä»¤çš„æˆæœ¬ä»˜å‡ºï¼‰ï¼Œé‚£ä¹ˆä½ å¯ä»¥é€šè¿‡åœ¨dip. ymlä¸­æ·»åŠ è‡ªå®šä¹‰å‘½ä»¤å’Œåœ¨docker-compose. ymlä¸­æ·»åŠ ä¸€ä¸ªé¢å¤– service å®šä¹‰ï¼Œæ¥é¿å…æ‰‹åŠ¨åŠ è½½chrome serviceï¼š # docker-compose. yml# Separate definition for system tests to add Chrome as a dependencyrspec_system: &lt;&lt;: *backend depends_on:  &lt;&lt;: *backend_depends_on  chrome:   condition: service_started# dip. ymlrspec: description: Run Rails unit tests service: rails environment:  RAILS_ENV: test command: bundle exec rspec --exclude-pattern spec/system/**/*_spec. rb subcommands:  system:   description: Run Rails system tests   service: rspec_system   command: bundle exec rspec --pattern spec/system/**/*_spec. rbç°åœ¨ï¼Œæˆ‘ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ¥è¿è¡Œç³»ç»Ÿæµ‹è¯•ï¼š dip rspec systemå°±æ˜¯è¿™æ ·äº†ï¼ æœ€åï¼Œè®©æˆ‘å‘ä½ å±•ç¤ºä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ Browserless. io çš„ Docker é•œåƒçš„ Debug æŸ¥çœ‹å™¨è¿›è¡Œè°ƒè¯•ï¼š "
    }, {
    "id": 42,
    "url": "/2020/07/vim-mac-dictionary-plugin/",
    "title": "å®ç°åœ¨Vimå†…ç›´æ¥æŸ¥è¯¢macOSè¯å…¸çš„Plugin",
    "body": "2020/07/15 - æˆ‘æ¯å¤©éƒ½ä¼šä½¿ç”¨ Vimã€‚ç”¨ Vim ä¸è®ºç¼–å†™è‡ªå·±çš„ä»£ç è¿˜æ˜¯é˜…è¯»åˆ«äººçš„ä»£ç ï¼Œè¿™ä¸­é—´è‡ªç„¶éƒ½ä¼šç¢°åˆ°ä¸€äº›ä¸è®¤è¯†çš„è‹±æ–‡è¯æ±‡ï¼Œè‡ªå·±å°±æ€»ä¼šä¹ æƒ¯æ€§åœ°æƒ³éšæ‰‹æŸ¥ä¸€ä¸‹å•è¯çš„ä¸­æ–‡é‡Šä¹‰ã€‚è€Œå¦‚ä½•æœ€é«˜æ•ˆåœ°è§£å†³è¿™ä¸ªé—®é¢˜ä¾¿æˆäº†ä¸€ä¸ªæœ‰è¶£çš„äº‹æƒ…ã€‚ æœ€æ—©çš„æ—¶å€™ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ç”¨é¼ æ ‡ç‚¹å¼€ macOS çš„è¯å…¸ Appï¼Œè¾“å…¥è¦æŸ¥è¯¢çš„å•è¯ï¼ŒæŸ¥çœ‹ç»“æœã€‚å¦‚æœä¸€å¤©ä¸­åªä¸è¿‡å¶å°”ä¸ºä¹‹ï¼Œé‚£å½“ç„¶ä¸æ˜¯é—®é¢˜ã€‚ä½†æœ‰æ—¶éš¾å…ä¼šæœ‰é¢‘ç¹ç¢°åˆ°é™Œç”Ÿè¯æ±‡çš„æ—¶å€™ï¼Œæ¯ä¸ªè¦æŸ¥çš„è¯éƒ½å¾—æ‰‹åŠ¨è¾“å…¥ï¼Œè¿™æ ·ç¹ççš„åšæ³•è‡ªç„¶å°±ä¸å¯å–äº†ã€‚ ç„¶åå°±ç”¨ä¸Šäº† macOS ä¸Šå¤§åé¼é¼çš„ Alfred è¿™ä¸ª Appã€‚GitHub ä¸Šæœ‰ä¸€ä¸ªç»™å®ƒå†™çš„ workflowï¼Œè®©ä½ å¯ä»¥åœ¨ Alfred çš„å¼¹å‡ºçª—å£ä¸­è¾“å…¥è¦æŸ¥çš„å•è¯ï¼Œä¸‹æ–¹è‡ªåŠ¨æ˜¾ç¤ºæŸ¥è¯¢ç»“æœã€‚è¿™åœ¨æ•ˆç‡ä¸Šå·²ç»æ˜¯å‰è¿›äº†ä¸€å¤§æ­¥ï¼ŒåŸºæœ¬è¶³å¤Ÿåº”å¯¹ç»å¤§å¤šæ•°çš„åœºæ™¯ã€‚ä½†ç”¨çš„æ—¶é—´é•¿äº†ï¼Œè¿˜æ˜¯å‘ç°å®ƒæœ‰ä¸è¶³çš„åœ°æ–¹ã€‚å› ä¸º Alfred æ˜¾ç¤ºæŸ¥è¯¢ç»“æœæ—¶åªèƒ½åœ¨ä¸€è¡Œä¸­ï¼Œè€Œå¾ˆå¤šæ—¶å€™ä¸€ä¸ªå•è¯çš„é‡Šä¹‰å†…å®¹å¾ˆé•¿ï¼Œä¸€è¡Œæ ¹æœ¬æ˜¾ç¤ºä¸å®Œã€‚è¿™æ—¶å°±åªèƒ½è¿˜æ˜¯å†æ•²ä¸€ä¸‹å›è½¦é”®æ‰“å¼€è¯å…¸æŸ¥çœ‹ã€‚æ¯”å¦‚ä¸‹å›¾ä¸­çš„ Service é‡Šä¹‰ï¼Œå®é™…å†…å®¹å¯è¿œè¿œä¸æ­¢æˆªå›¾ä¸­è¿™ä¹ˆä¸€ç‚¹ï¼š å‰å‡ å¤©ï¼Œåˆç¢°åˆ°äº†è¿™æ ·çš„åœºæ™¯ï¼Œå¤šæ¬¡ä¸æ–­æ‰“å¼€åˆå…³é—­ macOS è‡ªå¸¦è¯å…¸ä¹‹åï¼Œæˆ‘å°±åœ¨è€ƒè™‘èƒ½å¦æ¢ä¸ªæ€è·¯å®Œå…¨è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ æ—¢ç„¶è‡ªå·±ä¸»è¦éƒ½æ˜¯åœ¨ Vim å†…æ‰æœ‰è¿™ä¸ªâ€œéœ€æ±‚â€ï¼Œå¹³æ—¶ä¸€èˆ¬çš„åœºæ™¯ç”¨ Alfred ä¾¿è¶³å¤Ÿå¯¹ä»˜äº†ï¼Œé‚£ä¹ˆå°±é‡ç‚¹æƒ³æƒ³åœ¨ Vim å†…çš„è§£å†³æ–¹æ¡ˆå¥½äº†ã€‚è¿™ä¹ˆä¸€æƒ³ï¼Œè‡ªç„¶é¦–å…ˆè€ƒè™‘ Vim çš„ Plugin äº†ã€‚Vim çš„ Plugin ç”Ÿæ€åœˆè¶³å¤Ÿå¤§ï¼Œè¯´ä¸å®šæœ‰äººæ—©å°±ç¢°åˆ°ç±»ä¼¼é—®é¢˜ï¼Œå·²ç»å†™äº† Plugin æ¥å®ç°å‘¢ã€‚ ä¸Š GitHub ä¸€æœï¼Œè¿˜çœŸè¢«æˆ‘æ‰¾åˆ°è¿™ä¹ˆä¸€ä¸ªï¼švim-mac-dictionaryã€‚ä¸è¿‡çœ‹æäº¤å†å²ï¼Œæœ€è¿‘ä¸€æ¬¡è¿˜æ˜¯åœ¨ 2018 å¹´ï¼Œè²Œä¼¼ä½œè€…å·²ç»æ²¡ç®¡äº†ã€‚æœ¬åœ°å®‰è£…è¯•äº†ä¸‹ï¼Œå€’æ˜¯èƒ½å·¥ä½œã€‚ä½†æˆ‘ä¸æ»¡æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå®ƒæŠŠæŸ¥è¯¢ç»“æœéƒ½æ˜¾ç¤ºåœ¨ä¸‹æ–¹çš„å¼¹å‡º quickfix çª—å£å†…ï¼Œè€Œä¸”é»˜è®¤é«˜åº¦ä¸å¤Ÿï¼Œé‡Šä¹‰æ–‡æœ¬ç¨å¾®å¤šä¸€äº›å°±çœ‹ä¸å®Œï¼Œè¿˜å¾—æŠŠå…‰æ ‡ç§»è¿‡å»ï¼Œæ‰‹åŠ¨ç¿»é¡µæŸ¥çœ‹ã€‚ä½¿ç”¨ä½“éªŒå¹¶ä¸å¥½ã€‚ ç°åœ¨å·²ç»æ˜¯ 9012 å¹´äº†ï¼Œæˆ‘æ—©å·²ç”¨ä¸Šäº† NeoVimï¼Œå…¶å¾ˆæ£’çš„ä¸€ä¸ªç‰¹æ€§å°±æ˜¯æ”¯æŒ Floating Windowã€‚é‚£ä¹ˆç”¨ Floating Window æ¥æ˜¾ç¤ºè¯å…¸é‡Šä¹‰ï¼Œæ˜¾ç¤ºé¢ç§¯è¶³å¤Ÿå¤§ï¼Œçœ‹å®Œé‡Šä¹‰åå†å¿«æ·é”®å¿«é€Ÿå…³é—­å¼¹çª—ï¼Œç»§ç»­åœ¨åŸæ¥çª—å£å†…å·¥ä½œï¼Œè¿™æ ·çš„å·¥ä½œæµæ—¢é¡ºç•…åˆè‡ªç„¶ï¼Œå²‚ä¸ç¾å“‰ï¼Ÿ äºæ˜¯å°±æŒ‰è¿™ä¸ªæ€è·¯æ¥å§ã€‚å…·ä½“å®ç°è¿‡ç¨‹å¹¶æ²¡å•¥å¤ªç‰¹åˆ«çš„åœ°æ–¹ï¼Œè¿™é‡Œä¸èµ˜è¿°äº†ã€‚åæ­£æœ€åä¸Šè¿°æƒ³æ³•å¾—ä»¥å®Œç¾å®ç°ï¼Œæˆ‘çš„è¿™ä¸ª Vim Plugin å·²ç»æ”¾åˆ°äº† GitHub ä¸Šï¼Œç›®å‰è€Œè¨€ï¼Œå®é™…ä½“éªŒè‡ªå·±æ„Ÿè§‰å¾ˆæ»¡æ„ã€‚ é™„ä¸€ä¸ªåŠ¨æ€æ•ˆæœå›¾ï¼š "
    }, {
    "id": 43,
    "url": "/2020/07/dip-introduction/",
    "title": "è®©Docker-Composeå¦‚è™æ·»ç¿¼çš„DIP",
    "body": "2020/07/13 - å‰ä¸€ç¯‡åšå®¢â€œéª‘é²¸ä¹‹è·¯â€”â€”Dockeræ¨¡å¼ä¸‹çš„Railså¼€å‘ç¯å¢ƒæ„ç­‘ï¼ˆç¿»è¯‘ï¼‰â€çš„æ–‡ç« æœ«å°¾ï¼Œä½œè€…æåˆ°äº†ä¸€ä¸ªå« Dip çš„å·¥å…·ï¼Œå¼•èµ·äº†æˆ‘çš„å…´è¶£ã€‚ä½œä¸º Evil Martions çš„å¼€æºä½œå“ï¼Œå“è´¨åº”è¯¥æ˜¯æœ‰ä¿è¯çš„ï¼Œå€¼å¾—ä¸€è¯•ã€‚æˆ‘ç»è¿‡å‡ å¤©çš„è¯•ç”¨åï¼Œæ„Ÿè§‰å¾ˆæ˜¯â€œæƒŠè‰³â€ï¼Œè§‰å¾—å®Œå…¨æŠŠå®ƒçœ‹ä½œ Docker æœ¬åœ°å¼€å‘ç¯å¢ƒçš„ä¸¤å¤§æ€æ‰‹çº§ç”Ÿäº§åŠ›å·¥å…·ï¼šDocker-Compose + Dipï¼Œç§°ä¸ºâ€œå¸å›½åŒç’§â€äº¦ä¸ä¸ºè¿‡ã€‚è¿™ç¯‡åšå®¢å°±æ¥ç®€å•ä»‹ç»ä¸‹ Dip çš„ä½¿ç”¨ã€‚ è¦è¯´ Dipï¼Œå¾—å…ˆè¯´ Docker-Compose è¿™ä¸ª Docker å®¹å™¨çš„ç¼–æ’å·¥å…·ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªé¡¹ç›®éƒ½ä¼šç”±å¤šä¸ª Docker å®¹å™¨ç»„æˆï¼ˆå‡ ä¹ä¸å¯èƒ½åªæœ‰å•ä¸ªå®¹å™¨ï¼‰ï¼Œæ¯”å¦‚â€œRails + DB + Redis + ElasticSearchâ€è¿™æ ·ã€‚è€Œ Docker-Compose åˆ™é€šè¿‡è®¾å®šä¸€ä¸ªç§°ä¸ºdocker-compose. ymlçš„é…ç½®æ–‡ä»¶ï¼Œæä¾›äº†æŠŠå¤šä¸ªå®¹å™¨â€œä¸²è”â€èµ·æ¥çš„èƒ½åŠ›ï¼Œè®©æˆ‘ä»¬ä¸ç”¨æ‰‹å·¥è¾“å…¥ç¹ççš„ Docker å‘½ä»¤å»ä¸€ä¸ªä¸ªå•ç‹¬å¯åŠ¨å®¹å™¨ï¼Œè¿™å·²ç»å¤§å¹…åº¦æé«˜äº†æˆ‘ä»¬ä½¿ç”¨ Docker çš„æ–¹ä¾¿æ€§ã€‚ä¸‹é¢æ˜¯ä¸ªdocker-compose. ymlçš„ä¾‹å­ï¼š version: '2'services: app:  image: ruby:2. 4-buster  environment:   - GEM_HOME=/bundle   - BUNDLE_PATH=/bundle   - HISTFILE=/app/tmp/. bash_history  working_dir: /app  volumes:   - . :/app   - bundle:/bundlevolumes: bundle:ä½†æ˜¯ï¼Œå½“ä½¿ç”¨ Docker-Compose ç¨å¾®é•¿ä¸€ç‚¹æ—¶é—´åï¼Œä½ å¯èƒ½å°±ä¼šå‘ç°ä¾ç„¶å­˜åœ¨ä¸€äº›è®©ä½ éš¾å—çš„åœ°æ–¹ã€‚ æ¯”å¦‚ï¼Œå½“æ¯æ¬¡è¦ä½¿ç”¨å®ƒæ—¶ï¼Œéƒ½å¾—æ•²ä¸‹é¢è¿™æ ·çš„å‘½ä»¤ï¼š docker-compose run --rm web bundle exec rails cdocker-composeè¿™ä¸ªå‘½ä»¤æœ¬èº«å°±å¤ªé•¿ï¼Œä¸ä¾¿äºè¾“å…¥ã€‚å½“ç„¶ï¼Œä½ å¯ä»¥ç»™å®ƒè®¾ç½®ä¸€ä¸ª aliasï¼ˆä¾‹å¦‚æˆ‘æœ¬åœ°å°±è®¾ä¸ºdpï¼‰ã€‚ç„¶è€Œåé¢é‚£ä¸€é•¿ä¸²åˆæ€ä¹ˆåŠå‘¢ï¼Ÿæƒ³æƒ³æ¯å¤©çš„æ—¥å¸¸å¼€å‘ï¼Œå¯èƒ½è¿™ç§ç±»ä¼¼çš„å‘½ä»¤è¦è¾“å…¥å¥½å‡ åæ¬¡ï¼Œæ— è®ºå¯¹æ‰‹æŒ‡è¿˜æ˜¯å¿ƒç†ï¼Œéƒ½æ˜¯ä¸€ç§æŠ˜ç£¨-_- å†æ¯”å¦‚ï¼Œä½¿ç”¨äº† Docker å®¹å™¨ä½œä¸ºå¼€å‘ç¯å¢ƒï¼Œç”±äºä»£ç çš„è¿è¡Œã€æ•°æ®åº“çš„å­˜å‚¨ç­‰å°±éƒ½æ˜¯åœ¨å®¹å™¨ä¸­äº†ï¼Œé‚£ä¹ˆè¦è¿è¡Œæµ‹è¯•æˆ–è€…æŸ¥çœ‹æ•°æ®åº“å†…è¡¨ä¸­æ•°æ®æ—¶ï¼Œå°±éƒ½å¾—å…ˆä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›å…¥å®¹å™¨ï¼š docker-compose run --rm app bashç„¶ååœ¨å®¹å™¨å†…æ‰èƒ½å†è¿è¡Œæ‰€éœ€è¦çš„å‘½ä»¤ï¼š 8523c2:/# bundle exec rspecæŠŠä¸€ä»¶äº‹éå¾—åˆ†æˆå¥½å‡ æ­¥æ¥æ“ä½œï¼Œè¿™å½“ç„¶æ˜¾å¾—è¿‡äºç¹çç´¯èµ˜äº†ï¼Œä¸€ç‚¹ä¹Ÿä¸ç®€æ´é«˜æ•ˆã€‚ Evil Martins çš„å¼€å‘è€…ä»¬ä¹Ÿå‘ç°äº†è¿™ä¸€ç‚¹ã€‚è€Œä»–ä»¬åˆ™æ˜¯æƒ³åŠæ³•æ¥å°è¯•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ‰€ä»¥ï¼ŒDip å°±åº”è¿è€Œç”Ÿã€‚ Dip çš„å®‰è£…å¾ˆç®€å•ï¼Œæœ‰ä¸‰ç§æ–¹å¼ï¼Œä»»é€‰å…¶ä¸€å³å¯ï¼š    Homebrew å®‰è£…ï¼šHomebrew install dip     Gem å®‰è£…ï¼šgem install dip     ç›´æ¥ä¸‹è½½å·²ç¼–è¯‘ç‰ˆæœ¬ï¼š   curl -L https://github. com/bibendi/dip/releases/download/v6. 0. 0/dip-`uname -s`-`uname -m` &gt; /usr/local/bin/dip chmod +x /usr/local/bin/dip å®‰è£…å¥½ä¹‹åï¼Œå°±å¯ä»¥é’ˆå¯¹ä½ é¡¹ç›®ä¸‹çš„docker-compose. ymlï¼Œåœ¨åŒçº§ç›®å½•ä¸‹æ·»åŠ  Dip çš„é…ç½®æ–‡ä»¶dip. ymlã€‚ æ¯”å¦‚å¯¹äºä¸Šé¢çš„docker-compose. ymlä¾‹å­ï¼Œå¯¹åº”çš„dip. ymlå¯ä»¥æ˜¯è¿™æ ·çš„ï¼š version: '4'compose: files:  - docker-compose. ymlinteraction: bash:  description: Open the Bash shell in app's container  service: app  command: /bin/bash pry:  description: Open Pry console  service: app  command: . /bin/console bundle:  description: Run Bundler commands  service: app  command: bundle rspec:  description: Run Rspec commands  service: app  command: bundle exec rspec rubocop:  description: Run Rubocop commands  service: app  command: bundle exec rubocopprovision: - rm -rf Gemfile. lock - dip bundle installdip. ymlé…ç½®å¦¥å½“åï¼Œå°±å¯ä»¥å¼€å§‹â€œæ„‰å¿«â€åœ°ä½¿ç”¨ Dip äº†ã€‚ é¦–å…ˆï¼Œä½ èƒ½éšæ—¶ä½¿ç”¨dip lsï¼Œæ˜¾ç¤ºé…ç½®å¥½çš„å¯ç”¨å‘½ä»¤ï¼Œè€Œæ— éœ€æ¯æ¬¡éƒ½å»æ‰“å¼€æ–‡ä»¶æŸ¥æ‰¾æœ‰å“ªäº›ã€‚æ˜¾ç¤ºæ•ˆæœç±»ä¼¼è¿™æ ·ï¼š bash   # Open the Bash shell in app's containerpry   # Open Pry consolebundle  # Run Bundler commandsrspec  # Run Rspec commandsrubocop # Run Rubocop commandsè€Œè±¡ä¸Šæ–‡æåˆ°çš„æµ‹è¯•åœºæ™¯ï¼Œæœ‰äº† Dipï¼Œåªéœ€è¾“å…¥è¿™ä¸ªå‘½ä»¤ï¼š dip rspecå³å¯éšæ—¶è¿è¡Œæ‰€æœ‰æµ‹è¯•ã€‚ é‡è¦çš„æ˜¯ï¼ŒDip ä¼šåœ¨è¿è¡Œå‘½ä»¤æ—¶ï¼Œé¦–å…ˆè‡ªåŠ¨æ‰¾åˆ°docker-compose. ymlä¸­ç›¸åº”çš„ Serviceï¼Œè‡ªåŠ¨å¯åŠ¨å…¶å®¹å™¨ï¼ˆè¿™é‡Œæ˜¯appï¼Œå¦‚æœæœ‰ä¾èµ–çš„å®¹å™¨ä¹Ÿä¼šè‡ªåŠ¨å¯åŠ¨ï¼‰ï¼Œç„¶ååœ¨å®¹å™¨å†…è¿è¡Œè®¾å®šå¥½çš„å‘½ä»¤ï¼ˆbundle exec rspecï¼‰ã€‚åœ¨å‘½ä»¤è¿è¡Œç»“æŸä¹‹åï¼ŒDip è¿˜ä¼šè´´å¿ƒåœ°è‡ªåŠ¨å…³é—­åˆšæ‰å¯åŠ¨çš„æ‰€æœ‰å®¹å™¨ï¼Œå‡å°‘ç³»ç»Ÿèµ„æºçš„å ç”¨ã€‚ ç”±æ­¤å¯ä»¥çœ‹åˆ°ï¼ŒDip é’ˆå¯¹ä¸Šé¢æåˆ°çš„â€œç—›ç‚¹â€ï¼Œè®©æˆ‘ä»¬ä¸ç”¨ç™»å…¥å®¹å™¨å°±å¯ä»¥è¿›è¡Œå„ç§å·¥ä½œï¼Œä¹Ÿä¸ç”¨å†æ‹…å¿ƒå®¹å™¨çš„å¯åŠ¨çŠ¶æ€ï¼ŒæŠŠé‚£äº›ç¹ççš„æ“ä½œæ­¥éª¤è¿›è¡Œäº†å®Œç¾çš„ç²¾ç®€ï¼Œè²Œä¼¼å·²ç»å°‘åˆ°â€œå‡æ— å¯å‡â€çš„åœ°æ­¥äº†ã€‚ ä½†ä½œè€…è®¤ä¸ºè¿™è¿˜ä¸å¤Ÿï¼Œå¹¶ä¸æ»¡è¶³äºæ­¤ï¼Œæ‰€ä»¥ä»–ç»™ Dip æ·»åŠ äº†ä¸€ä¸ªæ›´åŠ â€œé»‘ç§‘æŠ€â€çš„æŠ€èƒ½ç‚¹ã€‚å½“ä½ åœ¨è‡ªå·±çš„. bashrcæˆ–. zshrcä¸­åªè¦å†åŠ ä¸Šè¿™ä¸€è¡Œï¼š eval  $(dip console) ç”šè‡³å°±å¯ä»¥æŠŠä¸Šé¢é‚£äº›å‘½ä»¤ä¸­çš„dipéƒ½çœæ‰ï¼æ¯”å¦‚dip rspecç›´æ¥æ•²rspecå°±å¯ä»¥äº†ã€‚è¿™æ ·åœ¨é¡¹ç›®ä¸‹ï¼Œä½ å¯ä»¥éšæ—¶ç›´æ¥è¿è¡Œè¿™äº›å‘½ä»¤ï¼š bundle installrails srake routes | grep adminrspec spec/models/user_spec. rb:16è€Œåªçœ‹è¿™äº›å‘½ä»¤ï¼Œåˆ«äººè¿˜ä¼šä»¥ä¸ºä½ å®Œå…¨å°±æ˜¯åœ¨åŸç”Ÿç¯å¢ƒè€Œé Docker ç¯å¢ƒä¸‹å¼€å‘å‘¢ï¼è®©ä½ ä½¿ç”¨æ—¶æ ¹æœ¬æ„Ÿè§‰ä¸åˆ°æ˜¯åœ¨ Docker ç¯å¢ƒä¸‹ï¼Œè¿™ç®—æ˜¯çœŸæ­£çš„å¤§é“è‡³ç®€äº†ã€‚ é™¤æ­¤ä¹‹å¤–ï¼ŒDip è¿˜æä¾›äº†è¯¸å¦‚dip sshã€dip nginxã€dip dnsä¹‹ç±»çš„é«˜çº§åŠŸèƒ½ï¼Œæœ¬æ–‡è¿™é‡Œå°±æš‚ä¸è®¨è®ºäº†ï¼Œè¯»è€…å¯ä»¥å‚çœ‹å®ƒçš„å®˜æ–¹æ–‡æ¡£è‡ªè¡Œå°è¯•ã€‚ æ€»è€Œè¨€ä¹‹ï¼Œå°±åƒæœ¬æ–‡æ ‡é¢˜æ‰€è¯´çš„é‚£æ ·ï¼ŒDip è®© Docker-Compose æ›´åŠ å¦‚è™æ·»ç¿¼ï¼Œä¹Ÿè®©æœ¬åœ°ä»¥ Docker ä½œä¸ºå¼€å‘ç¯å¢ƒçš„ä½“éªŒæ›´åŠ é«˜æ•ˆæµç•…ã€ä¸èˆ¬é¡ºæ»‘ã€‚ä½œä¸ºæˆ‘ä¸ªäººè€Œè¨€ï¼Œå·²ç»æŠŠ Dip ä½œä¸ºå¿…å¤‡å·¥å…·åŠ å…¥è‡ªå·±çš„æ—¥å¸¸å¼€å‘å·¥å…·ç®±äº†ã€‚ "
    }, {
    "id": 44,
    "url": "/2020/07/dockeerizing-rails-development/",
    "title": "éª‘é²¸ä¹‹è·¯â€”â€”Dockeræ¨¡å¼ä¸‹çš„Railså¼€å‘ç¯å¢ƒæ„ç­‘ï¼ˆç¿»è¯‘ï¼‰",
    "body": "2020/07/10 - æœ¬æ–‡å·²è·å¾—åŸä½œè€…ï¼ˆVladimir Dementyevï¼‰å’Œ Evil Martians æˆæƒè®¸å¯è¿›è¡Œç¿»è¯‘ã€‚åŸæ–‡ä»‹ç»äº†ä¸€å¥—æˆç†Ÿçš„ Rails é¡¹ç›®çš„ Docker åŒ–å¼€å‘ç¯å¢ƒå¦‚ä½•æ­å»ºï¼Œæ€æ ·é€šè¿‡ä¸€äº›é…ç½®æŠ€å·§è®©å…¶é«˜æ•ˆè¿è¡Œã€‚ä¹Ÿè°ˆåˆ°äº†è¿™ç§æ¨¡å¼ä¸‹çš„å¼€å‘æµç¨‹å’Œè¯€çªç­‰é—®é¢˜ã€‚å…³äº Docker ä½œä¸ºå¼€å‘ç¯å¢ƒçš„åšæ³•æ—©å·²ä¸æ˜¯æ–°é²œäº‹ï¼Œç›¸å…³æ–‡ç« æ›´æ˜¯æœ‰éå¸¸å¤šäº†ã€‚ä½†æœ¬æ–‡æ˜¯ä¸€åå“è¶Šçš„ Ruby å¼€å‘è€…åœ¨ä¸¤å¹´å¼€å‘å®è·µä¸­æç‚¼å‡ºçš„çœŸæ­£ç»éªŒä¹‹è°ˆï¼Œè§£ç­”äº†ä¹‹å‰è‡ªå·±å¯¹ Docker å¼€å‘ç¯å¢ƒæ¨¡å¼çš„ç§ç§ç–‘æƒ‘ï¼Œå› æ­¤è§‰å¾—å¾ˆæœ‰ä»·å€¼ï¼Œé‚æˆæ­¤æ–‡ã€‚  åŸæ–‡é“¾æ¥ï¼šRuby on Whales: Dockerizing Ruby and Rails development â€” Martian Chronicles, Evil Martiansâ€™ team blog ä½œè€…ï¼šVladimir Dementyev ç«™ç‚¹ï¼šEvil Martians â€”â€”ä½äºçº½çº¦å’Œä¿„ç½—æ–¯çš„ Ruby on Rails å¼€å‘äººå‘˜åšå®¢ã€‚ å®ƒå‘å¸ƒäº†è®¸å¤šä¼˜ç§€çš„æ–‡ç« ï¼Œå¹¶ä¸”æ˜¯ä¸å°‘ gem çš„èµåŠ©å•†ã€‚ã€ä¸‹é¢æ˜¯æ­£æ–‡ã€‘ è¿™ç¯‡æ–‡ç« æ˜¯å¯¹æˆ‘åœ¨ RailsConf 2019 ä¸Šæ¼”è®²â€œTerraforming legacy Rails applicationsâ€çš„æ•´ç†ã€‚ä»Šå¤©æˆ‘ä¸æ˜¯è¦è¯´æœä½ æŠŠåº”ç”¨ç¨‹åºå¼€å‘åˆ‡æ¢åˆ° Dockerï¼ˆä¸è¿‡ä½ å¯ä»¥å»çœ‹ä¸€ä¸‹å½“æ—¶ RailsConf çš„è§†é¢‘äº†è§£æ›´å¤šï¼‰ã€‚æˆ‘çš„ç›®çš„æ˜¯åˆ†äº«ç›®å‰è‡ªå·±åœ¨ Rails é¡¹ç›®ä¸Šä½¿ç”¨çš„é…ç½®ï¼Œå…¶è¯ç”Ÿäº Evil Martians çš„å¼€å‘å·¥ä½œä¸­ã€‚å°½æƒ…äº«ç”¨å®ƒå§ï¼ å£°æ˜ï¼šæœ¬æ–‡ä¼šæ ¹æ®æœ€ä½³å®è·µè¿›è¡Œå®šæœŸæ›´æ–°ï¼Œå‚çœ‹æœ€åçš„ Changelog éƒ¨åˆ†ã€‚ æˆ‘ä»ä¸‰å¹´å‰å°±å¼€å§‹åœ¨è‡ªå·±çš„å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨ Docker äº†ï¼ˆä»£æ›¿äº† Vagrantï¼Œåè€…å¯¹äºæˆ‘çš„ 4GB å†…å­˜ç¬”è®°æœ¬æ¥è¯´å®åœ¨å¤ªé‡äº†ï¼‰ã€‚ä¸€å¼€å§‹ï¼Œè¿™å½“ç„¶å¹¶éé‚£ä¹ˆä»¤äººæ„‰æ‚¦â€”â€”æˆ‘èŠ±äº†ä¸¤å¹´æ—¶é—´æ¥å°è¯•ä¸ºè‡ªå·±æ›´ä¸ºå›¢é˜Ÿæ‰¾åˆ°ä¸€ä¸ªè¶³å¤Ÿå¥½çš„é…ç½®ã€‚ è®©æˆ‘åœ¨è¿™é‡Œæ¥ä¸ºä½ å±•ç¤ºè¿™ä¸ªé…ç½®ï¼Œå¹¶è§£é‡Šå…¶ï¼ˆå‡ ä¹ï¼‰æ¯ä¸€è¡Œå§ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»çœ‹åˆ°å¤ªå¤šé‚£äº›å…³äº Docker çš„æ™¦æ¶©éš¾æ‡‚çš„æ•™ç¨‹äº†ã€‚ ç›¸å…³æºä»£ç å¯ä»¥åœ¨ GitHub çš„ evilmartians/terraforming-rails ä¸Šæ‰¾åˆ°ã€‚ æˆ‘ä»¬åœ¨ä¸‹é¢èŒƒä¾‹ä¸­ä½¿ç”¨äº†è¿™äº›æŠ€æœ¯æ ˆï¼š  Ruby 2. 6. 3 PostgreSQL 11 NodeJS 11 &amp; Yarn (for Webpacker-backed assets compilation)Dockerfile: Dockerfile å®šä¹‰äº†æˆ‘ä»¬ Ruby åº”ç”¨çš„ç¯å¢ƒï¼šè¿™æ˜¯æˆ‘ä»¬ä½œä¸ºå¼€å‘è€…è¿è¡Œ serversã€consoleï¼ˆrails cï¼‰ã€testsã€Rake tasks ä»¥åŠä¸ä»£ç è¿›è¡Œäº¤äº’çš„åœ°æ–¹ã€‚ ARG RUBY_VERSION# See explanation belowFROM ruby:$RUBY_VERSION-slim-busterARG PG_MAJORARG NODE_MAJORARG BUNDLER_VERSIONARG YARN_VERSION# Common dependenciesRUN apt-get update -qq \ &amp;&amp; DEBIAN_FRONTEND=noninteractive apt-get install -yq --no-install-recommends \  build-essential \  gnupg2 \  curl \  less \  git \ &amp;&amp; apt-get clean \ &amp;&amp; rm -rf /var/cache/apt/archives/* \ &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* \ &amp;&amp; truncate -s 0 /var/log/*log# Add PostgreSQL to sources listRUN curl -sSL https://www. postgresql. org/media/keys/ACCC4CF8. asc | apt-key add - \ &amp;&amp; echo 'deb http://apt. postgresql. org/pub/repos/apt/ buster-pgdg main' $PG_MAJOR &gt; /etc/apt/sources. list. d/pgdg. list# Add NodeJS to sources listRUN curl -sL https://deb. nodesource. com/setup_$NODE_MAJOR. x | bash -# Add Yarn to the sources listRUN curl -sS https://dl. yarnpkg. com/debian/pubkey. gpg | apt-key add - \ &amp;&amp; echo 'deb http://dl. yarnpkg. com/debian/ stable main' &gt; /etc/apt/sources. list. d/yarn. list# Application dependencies# We use an external Aptfile for that, stay tunedCOPY . dockerdev/Aptfile /tmp/AptfileRUN apt-get update -qq &amp;&amp; DEBIAN_FRONTEND=noninteractive apt-get -yq dist-upgrade &amp;&amp; \ DEBIAN_FRONTEND=noninteractive apt-get install -yq --no-install-recommends \  libpq-dev \  postgresql-client-$PG_MAJOR \  nodejs \  yarn=$YARN_VERSION-1 \  $(cat /tmp/Aptfile | xargs) &amp;&amp; \  apt-get clean &amp;&amp; \  rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* &amp;&amp; \  truncate -s 0 /var/log/*log# Configure bundlerENV LANG=C. UTF-8 \ BUNDLE_JOBS=4 \ BUNDLE_RETRY=3# Uncomment this line if you store Bundler settings in the project's root# ENV BUNDLE_APP_CONFIG=. bundle# Uncomment this line if you want to run binstubs without prefixing with `bin/` or `bundle exec`# ENV PATH /app/bin:$PATH# Upgrade RubyGems and install required Bundler versionRUN gem update --system &amp;&amp; \  gem install bundler:$BUNDLER_VERSION# Create a directory for the app codeRUN mkdir -p /appWORKDIR /appè¿™ä¸ªé…ç½®ä»…åŒ…å«äº†å¿…ä¸å¯å°‘çš„éƒ¨åˆ†ï¼Œå¯ä»¥è¢«ç”¨ä½œä¸€ä¸ªèµ·ç‚¹ã€‚æˆ‘æ¥è¯´æ˜ä¸‹è¿™é‡Œåšäº†ä»€ä¹ˆã€‚ å¤´ä¸¤è¡Œçœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ªï¼š ARG RUBY_VERSIONFROM ruby:$RUBY_VERSION-slim-busterä¸ºä»€ä¹ˆä¸ä½¿ç”¨FROM ruby:2. 6. 3æˆ–è€…ä»»ä½• Ruby çš„ç¨³å®šç‰ˆæœ¬å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬æƒ³ä½¿ç¯å¢ƒæ˜¯å¯ä»å¤–éƒ¨è¿›è¡Œé…ç½®çš„ï¼Œä»¥ä¾¿æŠŠ Dockerfile ä½œä¸ºä¸€ç§æ¨¡æ¿ï¼š  æ˜ç¡®çš„è¿è¡Œæ—¶ç‰ˆæœ¬å€šèµ–ä¼šåœ¨docker-compose. ymlä¸­æŒ‡å®šï¼ˆè§åé¢ï¼‰ï¼› aptçš„å®‰è£…ä¾èµ–åˆ—è¡¨å­˜æ”¾äºä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶é‡Œï¼ˆè§åé¢ï¼‰æˆ‘ä»¬ä¹Ÿæ˜ç¡®æŒ‡å®šäº† Debian å‘è¡Œç‰ˆï¼ˆbusterï¼‰ä»¥ç¡®ä¿ä¸ºå…¶ä»–ä¾èµ–ï¼ˆæ¯”å¦‚ PostgreSQLï¼‰æ·»åŠ æ­£ç¡®çš„æºã€‚ ä¸‹é¢å››è¡Œå®šä¹‰äº† PostgreSQLã€NodeJSã€Yarn å’Œ Bundler çš„ç‰ˆæœ¬ï¼š ARG PG_MAJORARG NODE_MAJORARG BUNDLER_VERSIONARG YARN_VERSIONå› ä¸ºæˆ‘ä»¬ä¸æœŸæœ›ä»»ä½•äººä¸é€šè¿‡ Docker Compose æ¥ä½¿ç”¨è¯¥ Dockerfileï¼Œæ‰€ä»¥å°±ä¸æä¾›é»˜è®¤å€¼äº†ã€‚ ç„¶åå°±æ˜¯å®é™…çš„é•œåƒ build è¿‡ç¨‹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å®‰è£…ä¸€äº›é€šç”¨çš„ç³»ç»Ÿä¾èµ–åº“ï¼ˆGitï¼ŒcURLç­‰ï¼‰ï¼Œå› ä¸ºä½¿ç”¨äº† slim åŸºç¡€é•œåƒä»¥ç¼©å°ä½“ç§¯ï¼š # Common dependenciesRUN apt-get update -qq \ &amp;&amp; DEBIAN_FRONTEND=noninteractive apt-get install -yq --no-install-recommends \  build-essential \  gnupg2 \  curl \  less \  git \ &amp;&amp; apt-get clean \ &amp;&amp; rm -rf /var/cache/apt/archives/* \ &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* \ &amp;&amp; truncate -s 0 /var/log/*logæˆ‘ä»¬ä¼šåœ¨ä¸‹é¢è§£é‡Šæ‰€æœ‰è¿™äº›å®‰è£…çš„ç³»ç»Ÿä¾èµ–åº“çš„ç»†èŠ‚ï¼Œå½“è°ˆåˆ°åº”ç”¨ç¨‹åºç‰¹å®šéƒ¨åˆ†çš„æ—¶å€™ã€‚ é€šè¿‡aptå®‰è£… PostgreSQLã€NodeJSã€Yarn éœ€è¦æ·»åŠ å®ƒä»¬ deb åŒ…çš„ repos åˆ°æºçš„åˆ—è¡¨ä¸­ã€‚ å¯¹äº PostgreSQLï¼ˆåŸºäºå®˜æ–¹æ–‡æ¡£ï¼‰ï¼š RUN curl -sSL https://www. postgresql. org/media/keys/ACCC4CF8. asc | apt-key add - \ &amp;&amp; echo 'deb http://apt. postgresql. org/pub/repos/apt/ buster-pgdg main' $PG_MAJOR &gt; /etc/apt/sources. list. d/pgdg. listæ³¨æ„ï¼šè¿™å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆä¸º buster çš„åŸå› ã€‚ å¯¹äº NodeJSï¼ˆæ ¹æ® NodeSource repoï¼‰ï¼š RUN curl -sL https://deb. nodesource. com/setup_$NODE_MAJOR. x | bash -å¯¹äº Yarnï¼ˆæ ¹æ®å®˜æ–¹ç½‘é¡µï¼‰ï¼š RUN curl -sS https://dl. yarnpkg. com/debian/pubkey. gpg | apt-key add - \ &amp;&amp; echo 'deb http://dl. yarnpkg. com/debian/ stable main' &gt; /etc/apt/sources. list. d/yarn. listç°åœ¨è¯¥æ¥å®‰è£…é‚£äº›ä¾èµ–åº“äº†ï¼Œä¾‹å¦‚ï¼Œè¿è¡Œapt-get installï¼š COPY . dockerdev/Aptfile /tmp/AptfileRUN apt-get update -qq &amp;&amp; DEBIAN_FRONTEND=noninteractive apt-get -yq dist-upgrade &amp;&amp; \ DEBIAN_FRONTEND=noninteractive apt-get install -yq --no-install-recommends \  libpq-dev \  postgresql-client-$PG_MAJOR \  nodejs \  yarn \  $(cat /tmp/Aptfile | xargs) &amp;&amp; \  apt-get clean &amp;&amp; \  rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* &amp;&amp; \  truncate -s 0 /var/log/*logé¦–å…ˆï¼Œæˆ‘ä»¬æ¥è¯´ä¸‹å…³äº Aptfile çš„æŠ€å·§ï¼š COPY . dockerdev/Aptfile /tmp/AptfileRUN apt-get install \  $(cat /tmp/Aptfile | xargs)è¿™æ˜¯æˆ‘ä» heroku-buildpack-apt å€Ÿé‰´åˆ°çš„ï¼Œå®ƒå…è®¸åœ¨ Heroku ä¸Šå®‰è£…å…¶ä»–åŒ…ã€‚å¦‚æœä½ ä½¿ç”¨è¿™ä¸ª buildpackï¼Œç”šè‡³èƒ½ä¸ºæœ¬åœ°å’Œçº¿ä¸Šç¯å¢ƒé‡ç”¨ç›¸åŒçš„ Aptfileï¼ˆå°½ç®¡ buildpack æä¾›äº†æ›´å¤šçš„åŠŸèƒ½ï¼‰ã€‚ æˆ‘ä»¬çš„é»˜è®¤ Aptfile ä»…åŒ…å«äº†ä¸€ä¸ªå•ç‹¬çš„åŒ…ï¼ˆå› ä¸ºè¦ä½¿ç”¨ Vim æ¥ç¼–è¾‘ Rails çš„ Credentialsï¼‰ï¼š vimåœ¨æˆ‘å·¥ä½œè¿‡çš„å‰ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ LaTeX å’Œ TexLive æ¥ç”Ÿæˆ PDFã€‚æˆ‘ä»¬çš„ Aptfile çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼ˆé‚£æ—¶æˆ‘è¿˜æ²¡æœ‰è¿ç”¨è¿™ä¸ªæŠ€å·§ï¼‰ï¼š vimtexlivetexlive-latex-recommendedtexlive-fonts-recommendedtexlive-lang-cyrillicé€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬æŠŠæ‰€éœ€è¦çš„ä¾èµ–åº“æ”¾åœ¨ä¸€ä¸ªå•ç‹¬æ–‡ä»¶ä¸­ï¼Œä½¿å¾—è‡ªå·±çš„ Dockerfile æ›´åŠ é€šç”¨ã€‚ å¯¹äºDEBIAN_FRONTEND=noninteractiveï¼Œæˆ‘å»ºè®®å»çœ‹ä¸‹ answer on Ask Ubuntuã€‚ è€Œ--no-install-recommendsåˆ™é€šè¿‡ä¸å®‰è£…æ¨èçš„åŒ…æ¥å¸®åŠ©æˆ‘ä»¬èŠ‚çœä¸€äº›ç©ºé—´ï¼ˆè®©é•œåƒæ›´åŠ è‹—æ¡ï¼‰ã€‚å¯ä»¥å‚çœ‹è¿™å„¿ã€‚ æœ€åçš„éƒ¨åˆ†RUN (apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* &amp;&amp; truncate -s 0 /var/log/*log)ä¹Ÿä¸ºäº†åŒæ ·çš„ç›®çš„â€”â€”æ¸…ç†æ‰€æ¥æ”¶åˆ°çš„åŒ…æ–‡ä»¶ï¼ˆå…¨éƒ¨éƒ½å®‰è£…å¥½äº†ï¼Œè¿™äº›ä¸å†éœ€è¦äº†ï¼‰ï¼Œä»¥åŠåœ¨å®‰è£…æœŸé—´æ‰€åˆ›å»ºçš„ä¸´æ—¶æ–‡ä»¶å’Œæ—¥å¿—ã€‚æˆ‘ä»¬éœ€è¦åœ¨åŒä¸€ä¸ªRUNè¯­å¥ä¸­åšè¿™äº›æ¸…ç†ï¼Œä»¥ç¡®ä¿è¿™ä¸ªDocker layerä¸åŒ…å«ä»»ä½•åƒåœ¾ã€‚ æœ€åçš„éƒ¨åˆ†å‡ ä¹éƒ½æ˜¯ç”¨äº Bundlerï¼š # Configure bundlerENV LANG=C. UTF-8 \ BUNDLE_JOBS=4 \ BUNDLE_RETRY=3 \# Uncomment this line if you store Bundler settings in the project's root# ENV BUNDLE_APP_CONFIG=. bundle# Uncomment this line if you want to run binstubs without prefixing with `bin/` or `bundle exec`# ENV PATH /app/bin:$PATH# Upgrade RubyGems and install required Bundler versionRUN gem update --system &amp;&amp; \  gem install bundler:$BUNDLER_VERSIONLANG=C. UTF-8è®¾ç½®é»˜è®¤ä¸º UTF-8ï¼Œå¦åˆ™ Ruby ä¼šå¯¹å­—ç¬¦ä¸²ä½¿ç”¨ US-ASCII ç¼–ç ï¼Œä½ å†ä¹Ÿä¸èƒ½ä½¿ç”¨é‚£äº›å¯çˆ±çš„ emojis ğŸ‘‹ å¦‚æœä½ ä½¿ç”¨&lt;root&gt;/. bundleç›®å½•æ¥å­˜æ”¾é¡¹ç›®ç‰¹å®šçš„ Bundler è®¾ç½®ï¼ˆä¾‹å¦‚ï¼Œé’ˆå¯¹ç§æœ‰ gems çš„ credentialsï¼‰ï¼Œé‚£ä¹ˆå°±éœ€è¦è®¾ç½®BUNDLE_APP_CONFIGã€‚Ruby çš„é»˜è®¤é•œåƒå°±å®šä¹‰äº†è¿™ä¸ªå˜é‡ä»¥ä½¿å¾— Bundler ä¸å›é€€åˆ°æœ¬åœ°é…ç½®ã€‚ ä½ å¯ä»¥é€‰æ‹©æ€§åœ°æŠŠ&lt;root&gt;/binç›®å½•æ·»åŠ åˆ°PATHï¼Œä»¥ä¾¿è¿è¡Œå‘½ä»¤æ—¶æ— éœ€å¸¦ä¸Šbundle execå‰ç¼€ã€‚æˆ‘ä»¬è¿™é‡Œé»˜è®¤æ²¡æœ‰åŠ ä¸Šï¼Œå› ä¸ºåœ¨å¤šé¡¹ç›®ç¯å¢ƒä¸‹å®ƒå¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œï¼ˆæ¯”å¦‚ï¼Œå½“ä½ åœ¨ Rails åº”ç”¨ä¸­æœ‰æœ¬åœ° gems æˆ– engines çš„æ—¶å€™ï¼‰ã€‚ docker-compose. yml: Docker Compose æ˜¯ä¸€ä¸ªç¼–æ’å®¹å™¨ç¯å¢ƒçš„å·¥å…·ã€‚å®ƒä½¿æˆ‘ä»¬èƒ½å¤Ÿç›¸äº’é“¾æ¥å®¹å™¨ã€å®šä¹‰æŒä¹…åŒ– volumes å’Œ servicesã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹ Rails åº”ç”¨ç¨‹åºå¼€å‘ç¯å¢ƒçš„ compose æ–‡ä»¶ï¼Œä½¿ç”¨ PostgreSQL ä½œä¸ºæ•°æ®åº“ï¼ŒSidekiq ä½œä¸ºåå°ä»»åŠ¡å¤„ç†å™¨ï¼š version: '2. 4'services: app: &amp;app  build:   context: .    dockerfile: . /. dockerdev/Dockerfile   args:    RUBY_VERSION: '2. 6. 3'    PG_MAJOR: '11'    NODE_MAJOR: '11'    YARN_VERSION: '1. 13. 0'    BUNDLER_VERSION: '2. 0. 2'  image: example-dev:1. 0. 0  tmpfs:   - /tmp backend: &amp;backend  &lt;&lt;: *app  stdin_open: true  tty: true  volumes:   - . :/app:cached   - rails_cache:/app/tmp/cache   - bundle:/usr/local/bundle   - node_modules:/app/node_modules   - packs:/app/public/packs   - . dockerdev/. psqlrc:/root/. psqlrc:ro  environment:   - NODE_ENV=development   - RAILS_ENV=${RAILS_ENV:-development}   - REDIS_URL=redis://redis:6379/   - DATABASE_URL=postgres://postgres:postgres@postgres:5432   - BOOTSNAP_CACHE_DIR=/usr/local/bundle/_bootsnap   - WEBPACKER_DEV_SERVER_HOST=webpacker   - WEB_CONCURRENCY=1   - HISTFILE=/app/log/. bash_history   - PSQL_HISTFILE=/app/log/. psql_history   - EDITOR=vi  depends_on:   postgres:    condition: service_healthy   redis:    condition: service_healthy runner:  &lt;&lt;: *backend  command: /bin/bash  ports:   - '3000:3000'   - '3002:3002' rails:  &lt;&lt;: *backend  command: bundle exec rails server -b 0. 0. 0. 0  ports:   - '3000:3000' sidekiq:  &lt;&lt;: *backend  command: bundle exec sidekiq -C config/sidekiq. yml postgres:  image: postgres:11. 1  volumes:   - . psqlrc:/root/. psqlrc:ro   - postgres:/var/lib/postgresql/data   - . /log:/root/log:cached  environment:   - PSQL_HISTFILE=/root/log/. psql_history  ports:   - 5432  healthcheck:   test: pg_isready -U postgres -h 127. 0. 0. 1   interval: 5s redis:  image: redis:3. 2-alpine  volumes:   - redis:/data  ports:   - 6379  healthcheck:   test: redis-cli ping   interval: 1s   timeout: 3s   retries: 30 webpacker:  &lt;&lt;: *app  command: . /bin/webpack-dev-server  ports:   - '3035:3035'  volumes:   - . :/app:cached   - bundle:/usr/local/bundle   - node_modules:/app/node_modules   - packs:/app/public/packs  environment:   - NODE_ENV=${NODE_ENV:-development}   - RAILS_ENV=${RAILS_ENV:-development}   - WEBPACKER_DEV_SERVER_HOST=0. 0. 0. 0volumes: postgres: redis: bundle: node_modules: rails_cache: packs:æˆ‘ä»¬å®šä¹‰äº†å…«ä¸ª serviceã€‚ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå¤šï¼Ÿå…¶ä¸­ä¸€äº›åªæ˜¯ç”¨æ¥å®šä¹‰å…±äº«é…ç½®ç»™åˆ«çš„ service ç”¨è€Œå·²ï¼ˆæŠ½è±¡ serviceï¼Œä¾‹å¦‚ï¼Œappå’Œbackendï¼‰ï¼Œå…¶ä»–åˆ™ç”¨äºä½¿ç”¨åº”ç”¨ç¨‹åºå®¹å™¨ï¼ˆä¾‹å¦‚ï¼Œrunnerï¼‰çš„ç‰¹å®šå‘½ä»¤ã€‚ ä½¿ç”¨è¿™ç§æ–¹æ¡ˆï¼Œæˆ‘ä»¬å°±ä¸å¿…ä½¿ç”¨docker-compose upå‘½ä»¤æ¥è¿è¡Œåº”ç”¨ç¨‹åºäº†ï¼Œè€Œæ˜¯æ€»èƒ½æŒ‡å®šè‡ªå·±æœŸæœ›è¿è¡Œçš„ç¡®å®š service æ¥è¿è¡Œï¼ˆæ¯”å¦‚ï¼Œdocker-compose up railsï¼‰ã€‚è¿™åœ¨å¼€å‘æ—¶å¾ˆæœ‰ç”¨ï¼Œä½ å¾ˆå°‘éœ€è¦æ‰€æœ‰ service åŒæ—¶å¯åŠ¨å’Œè¿è¡Œï¼ˆWebpackerã€Sidekiq ç­‰ç­‰ï¼‰ã€‚ è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ¯ä¸ª serviceã€‚ app: è¯¥ service çš„ä¸»è¦ç›®çš„æ˜¯æä¾›æ‰€æœ‰éœ€è¦çš„ä¿¡æ¯ä»¥æ„å»ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå®¹å™¨ï¼ˆå®šä¹‰åœ¨ Dockerfile ä¸Šæ–¹çš„éƒ¨åˆ†ï¼‰ï¼š build: context: .  dockerfile: . /. dockerdev/Dockerfile args:  RUBY_VERSION: '2. 6. 3'  PG_MAJOR: '11'  NODE_MAJOR: '11'  YARN_VERSION: '1. 13. 0'  BUNDLER_VERSION: '2. 0. 2'contextä¸º Docker å®šä¹‰äº† build contextï¼šç±»ä¼¼äº build è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼Œä¾‹å¦‚ï¼Œå®ƒä¼šè¢«COPYå‘½ä»¤ç”¨åˆ°ã€‚ æˆ‘ä»¬æ˜ç¡®æŒ‡å®šäº† Dockerfile çš„è·¯å¾„ï¼Œå› ä¸ºå¹¶æ²¡æœ‰æŠŠå®ƒæ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œè€Œæ˜¯æŠŠæ‰€æœ‰ Docker æœ‰å…³çš„æ–‡ä»¶ä¸€èµ·æ”¾åœ¨ä¸€ä¸ªéšè—ç›®å½•. dockerdevå†…ã€‚ å¹¶ä¸”ï¼Œå¦‚å‰æ‰€è¿°ï¼Œæˆ‘ä»¬æŒ‡å®šäº†é‚£äº›ä¾èµ–åº“çš„ç¡®åˆ‡ç‰ˆæœ¬ï¼Œå®ƒä»¬åœ¨ Dockerfile ä¸­ç”¨argsæ‰€å£°æ˜çš„ã€‚ ä¸€ä¸ªæˆ‘ä»¬åº”è¯¥æ³¨æ„çš„åœ°æ–¹æ˜¯æˆ‘ä»¬å¯¹é•œåƒæ‰“ä¸Š tag çš„æ–¹å¼ï¼š image: example-dev:1. 0. 0åœ¨å¼€å‘ä¸­ä½¿ç”¨ Docker çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯åœ¨å›¢é˜Ÿé‡Œè‡ªåŠ¨åŒæ­¥è¿™äº›é…ç½®çš„å˜åŠ¨çš„èƒ½åŠ›ã€‚ä½ åªéœ€è¦æ¯æ¬¡å¯¹æœ¬åœ°é•œåƒè¿›è¡Œæ”¹åŠ¨æ—¶å‡çº§å…¶ç‰ˆæœ¬ï¼ˆæˆ–è€…åœ¨ arguments æˆ–è€…åœ¨æ‰€ä¾èµ–çš„æ–‡ä»¶ï¼‰å³å¯ã€‚æœ€ç³Ÿç³•çš„åˆ™æ˜¯ä½¿ç”¨example-dev:latestä½œä¸ºä½ çš„ tagã€‚ ä¿ç•™é•œåƒç‰ˆæœ¬è¿˜æœ‰åŠ©äºåœ¨ä¸¤ç§ä¸åŒçš„ç¯å¢ƒä¸‹å·¥ä½œï¼Œè€Œä¸ä¼šå¸¦æ¥ä»»ä½•å…¶ä»–éº»çƒ¦ã€‚æ¯”å¦‚ï¼Œå½“ä½ åœ¨ä¸€ä¸ªé•¿æœŸçš„â€œchore/upgrade-to-ruby-3â€åˆ†æ”¯ä¸Šå·¥ä½œæ—¶ï¼Œèƒ½å¤Ÿå¾ˆå®¹æ˜“å°±åˆ‡æ¢åˆ°masteråˆ†æ”¯å¹¶ä½¿ç”¨å¸¦æ—§ Ruby ç‰ˆæœ¬çš„æ—§é•œåƒï¼Œè€Œæ— éœ€é‡æ–°æ„å»ºä»»ä½•ä¸œè¥¿ã€‚ æœ€ç³Ÿç³•çš„å°±æ˜¯åœ¨ä½ çš„docker-compose. ymlä¸­å¯¹é•œåƒä½¿ç”¨latestçš„ tagã€‚ æˆ‘ä»¬ä¹Ÿå‘ŠçŸ¥ Docker åœ¨ä¸€ä¸ªå®¹å™¨å†…ä¸º/tmpç›®å½•ä½¿ç”¨ tmpfs ä»¥åŠ å¿«é€Ÿåº¦ï¼š tmpfs: - /tmpbackend: æˆ‘ä»¬æ¥åˆ°äº†è¿™ç¯‡åšå®¢ä¸­æœ€æœ‰è¶£çš„éƒ¨åˆ†ã€‚ è¯¥ service å®šä¹‰äº†å…³äºæ‰€æœ‰ Ruby service çš„å…±äº«è¡Œä¸ºã€‚ æˆ‘ä»¬æ¥å…ˆçœ‹ä¸‹ volumesï¼š volumes: - . :/app:cached - bundle:/usr/local/bundle - rails_cache:/app/tmp/cache - node_modules:/app/node_modules - packs:/app/public/packs - . dockerdev/. psqlrc:/root/. psqlrc:roè¯¥ volumes åˆ—è¡¨çš„ç¬¬ä¸€æ¡æ˜¯æŒ‚è½½å½“å‰å·¥ä½œç›®å½•ï¼ˆé¡¹ç›®æ ¹ç›®å½•ï¼‰åˆ°å®¹å™¨å†…çš„/appç›®å½•ï¼Œå¹¶ä½¿ç”¨äº†cachedç­–ç•¥ã€‚è¯¥/cachedä¿®é¥°å™¨æ˜¯åœ¨ macOS ä¸Šæé«˜ Docker å¼€å‘æ•ˆç‡çš„å…³é”®ã€‚æœ¬æ–‡ä¸­æˆ‘ä»¬ä¸æ·±å…¥è®¨è®ºè¿™ä¸ªï¼ˆæˆ‘ä»¬æ­£åœ¨å°±æ­¤ä¸»é¢˜å†™å¦ä¸€ç¯‡æ–‡ç« ğŸ˜‰ï¼‰ï¼Œä½†ä½ å¯ä»¥çœ‹çœ‹è¿™ä¸ªæ–‡æ¡£ã€‚ ä¸‹ä¸€è¡Œå‘Šè¯‰å®¹å™¨ä½¿ç”¨ä¸€ä¸ªåä¸ºbundleçš„ volume æ¥å­˜å‚¨/usr/local/bundleçš„å†…å®¹ï¼ˆè¿™æ˜¯é»˜è®¤å­˜æ”¾ gems çš„åœ°æ–¹ï¼‰ã€‚é€šè¿‡è¿™ç§æ–¹å¼æˆ‘ä»¬æŠŠ gems æ•°æ®åœ¨è¿è¡ŒæœŸé—´è¿›è¡ŒæŒä¹…åŒ–ï¼šæ‰€æœ‰å®šä¹‰åœ¨docker-compose. ymlä¸­çš„ volumes å°†ä¿æŒ put çŠ¶æ€ï¼Œç›´åˆ°æˆ‘ä»¬è¿è¡Œdocker-compose down --volumesä¸ºæ­¢ã€‚ ä¸‹é¢ä¸‰è¡Œä¹Ÿæ˜¯ä¸ºäº†æ‘†è„±â€œDocker åœ¨ Mac ä¸Šæ…¢â€çš„è¯…å’’ã€‚æˆ‘ä»¬æŠŠæ‰€æœ‰ç”Ÿæˆçš„æ–‡ä»¶æ”¾ç½®åˆ° Docker çš„ volumes ä¸­ä»¥é¿å…åœ¨ host æœºå™¨ä¸€æ–¹çš„ç¹é‡ç£ç›˜æ“ä½œï¼š - rails_cache:/app/tmp/cache- node_modules:/app/node_modules- packs:/app/public/packsè¦è®© Docker åœ¨ macOS ä¸Šè¶³å¤Ÿå¿«ï¼Œéµå¾ªä¸‹é¢ä¸¤æ¡è§„åˆ™ï¼šä½¿ç”¨:cachedæ¥æŒ‚è½½æºæ–‡ä»¶å’Œé’ˆå¯¹ç”Ÿæˆçš„å†…å®¹ï¼ˆassetsã€bundle ç­‰ç­‰ï¼‰ä½¿ç”¨ volumesã€‚ æœ€åä¸€è¡Œæ·»åŠ äº†ä¸€ä¸ªç‰¹å®šçš„psqlé…ç½®åˆ°å®¹å™¨ã€‚æˆ‘ä»¬ç»å¸¸éœ€è¦ä¿å­˜å…¶å†å²å‘½ä»¤ï¼Œè¿™é‡Œå­˜å‚¨åˆ°äº† app çš„log/. psql_historyæ–‡ä»¶ã€‚ä¸ºä»€ä¹ˆè¦åœ¨ Ruby å®¹å™¨å†…æ‰§è¡Œpsqlï¼Ÿå½“ä½ è¿è¡Œrails dbconsoleæ—¶åœ¨å†…éƒ¨å°±ä¼šç”¨åˆ°ã€‚ æˆ‘ä»¬çš„. psqlrcæ–‡ä»¶åŒ…å«ä¸‹é¢çš„æŠ€å·§æ¥ä½¿å…¶é€šè¿‡ç¯å¢ƒå˜é‡æŒ‡å®šå†å²æ–‡ä»¶è·¯å¾„æˆä¸ºå¯èƒ½ï¼ˆå…è®¸é€šè¿‡PSQL_HISTFILEç¯å¢ƒå˜é‡æŒ‡å®šå†å²æ–‡ä»¶è·¯å¾„ï¼Œå¦åˆ™å°±ä¸ºé»˜è®¤çš„$HOME/. psql_historyï¼‰ï¼š \set HISTFILE `[[ -z $PSQL_HISTFILE ]] &amp;&amp; echo $HOME/. psql_history || echo $PSQL_HISTFILE`è®©æˆ‘ä»¬æ¥è°ˆä¸‹ç¯å¢ƒå˜é‡ï¼š environment: - NODE_ENV=${NODE_ENV:-development} - RAILS_ENV=${RAILS_ENV:-development} - REDIS_URL=redis://redis:6379/ - DATABASE_URL=postgres://postgres:postgres@postgres:5432 - WEBPACKER_DEV_SERVER_HOST=webpacker - BOOTSNAP_CACHE_DIR=/usr/local/bundle/_bootsnap - HISTFILE=/app/log/. bash_history - PSQL_HISTFILE=/app/log/. psql_history - EDITOR=vi - MALLOC_ARENA_MAX=2 - WEB_CONCURRENCY=${WEB_CONCURRENCY:-1}è¿™é‡Œæœ‰å¥½äº›ä¸œè¥¿ï¼Œæˆ‘é‡ç‚¹è°ˆä¸€ä¸ªã€‚ é¦–å…ˆæ˜¯X=${X:-smth}çš„è¯­æ³•ã€‚å…¶å¯ä»¥è¢«ç¿»è¯‘ä¸ºâ€œå¯¹äºå®¹å™¨å†…çš„ X å˜é‡ï¼Œä½¿ç”¨ host æœºå™¨çš„ X ç¯å¢ƒå˜é‡å€¼å¦‚æœå…¶å­˜åœ¨çš„è¯ï¼Œå¦åˆ™å°±ç”¨å¦ä¸€ä¸ªå€¼â€ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬è®© service è¿è¡Œåœ¨é€šè¿‡å‘½ä»¤æ‰€æä¾›çš„ä¸åŒç¯å¢ƒä¸­å°±æˆä¸ºå¯èƒ½ï¼Œä¾‹å¦‚ï¼ŒRAILS_ENV=test docker-compose up railsã€‚ å˜é‡DATABASE_URLã€REDIS_URLå’ŒWEBPACKER_DEV_SERVER_HOSTæŠŠæˆ‘ä»¬çš„ Ruby åº”ç”¨è¿æ¥åˆ°äº†å…¶ä»– serviceã€‚DATABASE_URLå’ŒWEBPACKER_DEV_SERVER_HOSTå˜é‡æ˜¯ Rails åŸç”Ÿæ‰€æ”¯æŒçš„ï¼ˆåˆ†åˆ«æ˜¯ ActiveRecord å’Œ Webpackerï¼‰ã€‚æŸäº›åº“ä¹Ÿæ”¯æŒREDIS_URLï¼ˆSidekiqï¼‰ï¼Œä½†å¹¶éæ‰€æœ‰ï¼ˆæ¯”å¦‚ï¼ŒAction Cable å¿…é¡»æ˜ç¡®é…ç½®æ‰è¡Œï¼‰ã€‚ æˆ‘ä»¬ä½¿ç”¨äº†bootsnapæ¥æå‡åº”ç”¨ç¨‹åºçš„åŠ è½½æ—¶é—´ï¼ŒæŠŠå…¶ç¼“å­˜å­˜å‚¨äºè·Ÿ Bundler æ•°æ®ç›¸åŒçš„ volume ä¸­ï¼Œå› ä¸ºè¿™ä¸ªç¼“å­˜ä¸»è¦æ˜¯åŒ…å« gems æ•°æ®ï¼›å› æ­¤ï¼Œæˆ‘ä»¬åœ¨åšå¦ä¸€æ¬¡ Ruby ç‰ˆæœ¬å‡çº§æ—¶ï¼Œå°±åº”è¯¥ä¸€èµ·åˆ é™¤æ‰€æœ‰å†…å®¹ã€‚ HISTFILE=/app/log/. bash_historyä»å¼€å‘è€…çš„ UX è§’åº¦çœ‹æ˜¯å¾ˆé‡è¦çš„è®¾ç½®ï¼šå‘Šè¯‰ Bash åœ¨æŒ‡å®šä½ç½®å­˜å‚¨å…¶å†å²å‘½ä»¤ä»¥ä½¿å…¶æŒä¹…åŒ–ã€‚ EDITOR=viè¢«ç”¨åœ¨ï¼Œä¾‹å¦‚ï¼Œrails credentials:editå‘½ä»¤ç®¡ç† credentials æ–‡ä»¶æ—¶ã€‚ æœ€åï¼Œæœ«å°¾ä¸¤ä¸ªè®¾ç½®ï¼ŒMALLOC_ARENA_MAXå’ŒWEB_CONCURRENCYï¼Œå¸®åŠ©ä½ æ£€æŸ¥ Rails å†…å­˜çš„å¤„ç†æƒ…å†µã€‚ è¯¥ service ä¸­å°šæœªæ¶µç›–çš„æ˜¯ï¼š stdin_open: truetty: trueå®ƒä»¬ä½¿å¾—è¯¥ service æ˜¯å¯äº¤äº’çš„ï¼Œä¾‹å¦‚ï¼Œæä¾› TTYã€‚æˆ‘ä»¬éœ€è¦è¿™ä¸ªï¼Œæ¯”å¦‚ï¼Œæ¥è¿è¡Œ Rails console æˆ–è€…åœ¨å®¹å™¨å†…çš„ Bashã€‚ è¿™è·Ÿä½¿ç”¨-ité€‰é¡¹æ¥è¿è¡Œ Docker å®¹å™¨æ˜¯ç›¸åŒçš„ã€‚ webpacker: è¿™é‡Œæˆ‘åªæƒ³å¼ºè°ƒä¸€ç‚¹å°±æ˜¯WEBPACKER_DEV_SERVER_HOST=0. 0. 0. 0çš„é…ç½®ï¼šå®ƒè®© Webpack dev server ä»å¤–éƒ¨æ˜¯å¯è®¿é—®çš„ï¼ˆé»˜è®¤è¿è¡Œåœ¨localhostä¸Šï¼‰. runner: è¦è§£é‡Šè¯¥ service çš„ç›®çš„ï¼Œè®©æˆ‘æ¥åˆ†äº«ä¸€ä¸‹è‡ªå·±åœ¨å¼€å‘æ—¶ä½¿ç”¨ Docker çš„æ–¹å¼ï¼š  å¯åŠ¨ä¸€ä¸ª Docker daemonï¼Œè¿è¡Œä¸€ä¸ªè‡ªå®šä¹‰çš„docker-startè„šæœ¬ï¼š#!/bin/shif ! $(docker info &gt; /dev/null 2&gt;&amp;1); then echo  Opening Docker for Mac. . .   open -a /Applications/Docker. app while ! docker system info &gt; /dev/null 2&gt;&amp;1; do sleep 1; done echo  Docker is ready to rock! else echo  Docker is up and running.  fi ç„¶åæˆ‘åœ¨é¡¹ç›®ç›®å½•ä¸‹è¿è¡Œdcr runnerï¼ˆdcræ˜¯docker-compose runçš„ aliasï¼‰ä»¥è¿›å…¥å®¹å™¨çš„ shell ä¸­ï¼›è¿™æ˜¯ä¸‹é¢å‘½ä»¤çš„ aliasï¼š$ docker-compose run --rm runner æˆ‘åœ¨è¿™ä¸ªå®¹å™¨å†…è¿è¡Œï¼ˆå‡ ä¹ï¼‰ä¸€åˆ‡ï¼štestsã€migrationsã€Rake tasksï¼Œç­‰ç­‰ã€‚å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä¸æ˜¯åœ¨éœ€è¦è¿è¡Œä¸€ä¸ªä»»åŠ¡æ—¶å»å¼€æ–°å®¹å™¨ï¼Œè€Œæ˜¯æ€»ä½¿ç”¨åŒä¸€ä¸ªã€‚ è¿™æ ·ï¼Œæˆ‘å°±å¦‚åŒå¤šå¹´å‰ä½¿ç”¨vagrant sshé‚£æ ·æ¥ä½¿ç”¨dcr runneräº†ã€‚ æˆ‘ä¹‹æ‰€ä»¥æŠŠå®ƒç§°ä¸ºrunnerè€Œä¸æ˜¯shellï¼Œæ˜¯å› ä¸ºå®ƒè¿˜å¯åœ¨å®¹å™¨å†…ç”¨æ¥è¿è¡Œä»»æ„å‘½ä»¤ã€‚ æ³¨æ„ï¼šrunnerè¿™ä¸ª service æ˜¯ä¸€ä¸ªå“å‘³é—®é¢˜ï¼Œè·Ÿweb service ç›¸æ¯”ï¼Œé™¤äº†é»˜è®¤ commandï¼ˆ/bin/bashï¼‰å¤–ï¼Œå®ƒå¹¶æ²¡æœ‰å¸¦æ¥ä»»ä½•æ–°ä¸œè¥¿ï¼›å› æ­¤ï¼Œdocker-compose run runnerè·Ÿdocker-compose run web /bin/bashæ˜¯ä¸€æ ·çš„ï¼ˆé™¤äº†çŸ­ä¸€äº›ğŸ˜‰ï¼‰ã€‚ Health checks: å½“è¿è¡Œè¯¸å¦‚db:migrateçš„å¸¸è§„ Rails å‘½ä»¤æ—¶ï¼Œæˆ‘ä»¬æœŸæœ›ç¡®è®¤æ•°æ®åº“å·²ç»å¯åŠ¨å¹¶å‡†å¤‡å¥½è¿æ¥äº†ã€‚å¦‚ä½•å‘ŠçŸ¥ Docker Compose ç­‰å¾…æ‰€ä¾èµ–çš„ service ç›´è‡³å°±ç»ªï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¥åº·æ£€æŸ¥ï¼ ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°æˆ‘ä»¬çš„depends_onå®šä¹‰å¹¶é services åˆ—è¡¨ï¼š backend: # . . .  depends_on:  postgres:   condition: service_healthy  redis:   condition: service_healthypostgres: # . . .  healthcheck:  test: pg_isready -U postgres -h 127. 0. 0. 1  interval: 5sredis: # . . .  healthcheck:  test: redis-cli ping  interval: 1s  timeout: 3s  retries: 30æ³¨æ„ï¼šå¥åº·æ£€æŸ¥ä»…è¢« Docker Compose æ–‡ä»¶æ ¼å¼åœ¨ v2. 1 åŠæ›´é«˜ç‰ˆæœ¬ä»¥ä¸Šæ”¯æŒï¼›è¿™å°±æ˜¯æˆ‘ä»¬ç”¨åœ¨å¼€å‘ä¸­çš„åŸå› äº†ã€‚ é¢˜å¤–è¯ï¼šdip. yml: å¦‚æœä½ ä»ç„¶è§‰å¾— Docker Compose çš„æ–¹å¼è¿‡äºå¤æ‚ï¼Œæœ‰ä¸€ä¸ªå«åš Dip çš„å·¥å…·ï¼Œæ˜¯æˆ‘åœ¨ Evil Martians çš„åŒäº‹å¼€å‘çš„ï¼Œç›®çš„æ˜¯è®©å¼€å‘ä½“éªŒæ›´åŠ é¡ºæ»‘ã€‚ å¦‚æœä½ æœ‰å¤šä¸ª compose æ–‡ä»¶æˆ–å¹³å°é…ç½®ï¼Œé‚£ä¹ˆå®ƒå°¤å…¶æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥æŠŠè¿™äº›é…ç½®ç²˜åˆåˆ°ä¸€èµ·ï¼Œå¹¶æä¾›ä¸€ä¸ªé€šç”¨ç•Œé¢æ¥ç®¡ç† Docker å¼€å‘ç¯å¢ƒã€‚ æˆ‘ä»¬å°†åœ¨æœªæ¥ä¸ºä½ ä»‹ç»æœ‰å…³å®ƒçš„æ›´å¤šå†…å®¹ï¼Œæ•¬è¯·å…³æ³¨ï¼ æ³¨ï¼šç‰¹åˆ«æ„Ÿè°¢ Sergey Ponomarev å’Œ Mikhail Merkushin åˆ†äº«äº†æœ‰å…³è¯¥ä¸»é¢˜çš„æŠ€å·§ğŸ¤˜ å°é¢å›¾ç‰‡ï¼šÂ© NASA/JPL-Caltech, 2009 Changelog: 1. 1. 0 (2019-12-10):  Change base Ruby image to slim.  Specify Debian release for Ruby version explicitly and upgrade to buster.  Use standard Bundler path (/usr/local/bundle) instead of /bundle.  Use Docker Compose file format v2. 4.  Add health checking to postgres and redis services. "
    }, {
    "id": 45,
    "url": "/2020/07/patch-sf-mono-to-nerd-font/",
    "title": "æŠŠ SF Mono å­—ä½“ Patch ä¸º Nerd Font",
    "body": "2020/07/08 - ä½œä¸ºä¸€åå¼€å‘è€…ï¼Œåœ¨ç¼–ç¨‹ä¸­ä½¿ç”¨ç­‰å®½å­—ä½“æ˜¯å¾ˆé‡è¦çš„ã€‚æˆ‘æœ€è¿‘å‡ å¹´ä¸€ç›´ä½¿ç”¨çš„æ˜¯ Adobe å…¬å¸çš„ Source Code Pro å­—ä½“ã€‚è¿™æ¬¾ç­‰å®½å­—ä½“çš„å­—å½¢è®¾è®¡ä¼˜ç¾ï¼Œé—´è·é€‚ä¸­ï¼Œé˜…è¯»æ—¶çœ¼ç›ä¸æ˜“ç–²åŠ³ï¼Œå®Œå…¨å¯ä»¥æ’åˆ°ç­‰å®½å­—ä½“çš„ Top 3ã€‚ä¸è¿‡å†å¥½çš„ä¸œè¥¿ï¼Œæ—¶é—´é•¿äº†ä¹Ÿæœ‰å®¡ç¾ç–²åŠ³ã€‚æ­£å¥½æœ€è¿‘çœ‹åˆ°äº†è¿™ä¸€ç¯‡æ–‡ç« ã€Šä» DejaVu Sans Mono æ¢æˆ Hack å­—ä½“äº†ã€‹ï¼Œä½œè€…çš„å®¡ç¾ç”šåˆæˆ‘å¿ƒï¼Œäºæ˜¯æ‰“æ¢ä¸€æ¬¾è¯•è¯•ã€‚ ä¸Šé¢å¼•ç”¨çš„æ–‡ç« ä¸­çš„å‡ æ¬¾å­—ä½“å½“ç„¶éƒ½å¾ˆä¸é”™ï¼Œæˆ‘ä¹Ÿä¸€ä¸€åœ¨æœ¬åœ°å°è¯•äº†ï¼Œä½†è¿˜æ˜¯å·®ä¸€ç‚¹é‚£ç§ä»¤è‡ªå·±å¿ƒåŠ¨çš„â€œæ„Ÿè§‰â€ã€‚æ­£åœ¨çŠ¹è±«ä¸å†³ä¹‹é™…ï¼Œæ— æ„ä¸­çœ‹åˆ°äº†è‹¹æœå…¬å¸ä»Šå¹´çš„ WWDC å¤§ä¼šï¼Œå…¶ä¸­æ­£å¥½è°ˆåˆ°äº†å­—ä½“è®¾è®¡çš„ä¸»é¢˜ã€‚äºæ˜¯çœ¼å‰ä¸€äº®ï¼Œå› ä¸ºæˆ‘å¯¹äº Apple åœ¨è®¾è®¡ä¸Šçš„å“å‘³ä¸€å‘æ˜¯éå¸¸ä¿¡æœçš„ï¼Œåœ¨ä½¿ç”¨ Source Code Pro ä¹‹å‰ï¼Œæ°æ°å°±æ˜¯ä»¥ macOS è‡ªå¸¦çš„ Menlo ç­‰å®½å­—ä½“ä½œä¸ºå¸¸ç”¨ç¼–ç¨‹å­—ä½“ã€‚è€Œç°åœ¨ï¼ŒApple çš„æ–°å­—ä½“å·²ç»æ¢æˆäº† SFï¼ˆæ—§é‡‘å±±ï¼‰ å­—ä½“å®¶æ—ï¼Œå…¶ä¸­è‡ªç„¶ä¹ŸåŒ…æ‹¬ç­‰å®½ç³»åˆ—ï¼ŒSF Monoã€‚ å› ä¸ºè‡ªå·±çš„ macOS å·²ç»å‡çº§åˆ°äº† Catalinaï¼Œæ‰€ä»¥å®é™…ä¸Šç³»ç»Ÿå·²ç»å®‰è£…äº† SF Mono å­—ä½“ã€‚åªæ˜¯ä½ç½®æ¯”è¾ƒéšç§˜ï¼Œåœ¨å­—ä½“å†Œä¸­æ˜¯çœ‹ä¸åˆ°çš„ã€‚å…¶å®é™…ä½ç½®åœ¨ /Applications/Utilities/Terminal. app/Contents/Resources/Fontsæ¥ä¸‹æ¥å°±æ˜¯éœ€è¦æŠŠ SF Mono å­—ä½“ Patch ä¸Š Nerd Font äº†ã€‚å…³äº Nerd Font çš„ä»‹ç»ï¼Œå¯ä»¥å‚è€ƒå…¶å®˜ç½‘ã€‚Nerd Font å…¶å®å·²ç»é¢„å…ˆ Patch å¥½äº†ä¸å°‘å¸¸ç”¨ç­‰å®½å­—ä½“ï¼Œåœ¨å…¶ Release é¡µé¢å¯ä»¥ç›´æ¥ä¸‹è½½ã€‚ä½† SF Mono ç”±äº Apple ç‰ˆæƒåŸå› ï¼ŒNerd Font è‚¯å®šä¸èƒ½å…¬ç„¶å‘å¸ƒçš„ï¼Œæ‰€ä»¥åªèƒ½è‡ªå·±ä½¿ç”¨ Nerd Font æä¾›çš„ Script æ¥æ‰‹åŠ¨ Patchã€‚ è¿‡ç¨‹å¹¶ä¸å¤æ‚ï¼Œåªæ˜¯éœ€è¦å…ˆ Homebrew å®‰è£…å¥½ fontforge brew install fontforgeç„¶åæŠŠ Nerd Font çš„ Repo ä½¿ç”¨ git clone åˆ°æœ¬åœ°ï¼ˆRepo éå¸¸å¤§ï¼Œæ‰€ä»¥ä½¿ç”¨ â€“depth=1 é€‰é¡¹ï¼‰ git clone --depth=1 https://github. com/ryanoasis/nerd-fonts. gitå†æŠŠä¸Šé¢ç›®å½•ä½ç½®ä¸‹çš„ SF Mono å­—ä½“å¤åˆ¶åˆ°æŸä¸ªä¸´æ—¶ç›®å½•ï¼Œæ¯”å¦‚å« tmpfontã€‚ æœ€åï¼Œåœ¨ä¸´æ—¶ç›®å½•ä¸‹è¿è¡Œå‘½ä»¤ fontforge -script nerd-font/font-patcher -s -c tmpfont/SFMono-Medium. otf -out . /tmpfont/patchedå³å¯çœ‹åˆ° Patch çš„è¿‡ç¨‹åœ¨é£å¿«è¿›è¡Œã€‚ç¨ç­‰ç‰‡åˆ»åï¼Œåœ¨ patched ç›®å½•ä¸‹å°±èƒ½çœ‹åˆ°ç”Ÿæˆå¥½çš„å­—ä½“äº†ã€‚ å®‰è£…å¥½å­—ä½“ï¼ŒæŠŠ Terminal å’Œ Vim çš„å­—ä½“éƒ½è®¾ç½®ä¸º SF Monoï¼Œéšä¾¿æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶çœ‹çœ‹æ•ˆæœå§ï¼š "
    }, {
    "id": 46,
    "url": "/2020/07/integrate-stimulus-and-tailwindcss-with-rails6/",
    "title": "åœ¨ Rails 6 ä¸­æ•´åˆ Stimulus å’Œ Tailwind CSS",
    "body": "2020/07/05 - ä¸Šä¸€ç¯‡åšå®¢æåˆ°äº† Stimulusã€‚Stimulus ä¹Ÿæ˜¯ Basecamp å¼€æºå‘å¸ƒçš„ä¸€ä¸ªå‰ç«¯ JS æ–¹æ¡ˆï¼ˆæˆ‘ä¸ªäººè®¤ä¸ºï¼Œè·Ÿ Reactã€Vuejsè¿™äº› JS æ¡†æ¶ç›¸æ¯”ï¼ŒStimulus åº”è¯¥è¿˜ç§°ä¸ä¸Šæ˜¯ä¸€ä¸ªæ¡†æ¶ï¼‰ã€‚Stimulus çš„æ–‡æ¡£å¾ˆç®€å•ï¼Œä¸»è¦å°± Handbook å’Œ Reference ä¸¤éƒ¨åˆ†ï¼ŒåŸºæœ¬ä¸¤ä¸ªå°æ—¶å°±èƒ½çœ‹å®Œã€‚ Tailwind CSS åˆ™æ˜¯ç›®å‰å¾ˆç«çš„ä¸€ä¸ª CSS åº“ï¼Œæˆ‘ä¸ªäººå¾ˆçœ‹å¥½ã€‚å®ƒæœ‰ç‚¹ç±»ä¼¼è‘—åçš„ Bootstrap æ¡†æ¶ï¼Œä½†åˆæœ‰æ˜¾è‘—ä¸åŒã€‚ç®€å•åœ°è¯´ï¼ŒTailwind CSS æ˜¯ä¸€ä¸ªè®©ä½ èƒ½ä¸å†™ CSS å°±èƒ½å®ç° CSS æ•ˆæœçš„ä¸€ä¸ª CSS å·¥å…·åº“ã€‚Tailwind CSS çš„å…·ä½“ä¼˜ç‚¹ï¼Œæˆ‘å‡†å¤‡ä»¥åç”¨ä¸“é—¨çš„æ–‡ç« è¿›è¡Œä»‹ç»ï¼Œæœ¬æ–‡ä¸åšè¿‡å¤šå±•å¼€ã€‚ æ‰€ä»¥ï¼Œæœ¬æ–‡å°±æ¥çœ‹ä¸‹åœ¨ Rails 6 ä¸­å¦‚ä½•é›†æˆ Stimulus å’Œ Tailwind CSS å¹¶è¿›è¡Œç®€å•åœ°ä½¿ç”¨ã€‚ é¦–å…ˆï¼Œå½“ç„¶æ˜¯ä½¿ç”¨ rails new stw_demo -d postgresqlæ¥åˆ›å»ºä¸€ä¸ªæ–° Rails é¡¹ç›®ï¼Œå¹¶è¿›è¡Œå¸¸è§„çš„database. ymlã€Gemfileç­‰é…ç½®ï¼Œè¿™é‡Œä¸åšèµ˜è¿°äº†ã€‚ é›†æˆ Stimulus å¹¶åˆ›å»ºä¸€ä¸ªå°çš„ Demo: ç„¶åï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤æ¥å®‰è£… Stimulus rails webpacker:install:stimulusä¿®æ”¹config/routes. rbä¸º root to: 'home#index'ä¿®æ”¹app/controllers/home_controller. rbä¸º class HomeController &lt; ApplicationController def index endendä¿®æ”¹app/views/home/index. html. erbä¸º &lt;div data-controller= hello &gt; &lt;h3&gt; Default text when connect stimulus: &lt;/h3&gt; &lt;span data-target= hello. output &gt;&lt;/span&gt; &lt;h3&gt; disply text when click button: &lt;/h3&gt; &lt;div&gt; &lt;button data-action= click-&gt;hello#sayHello &gt;Say Hello!&lt;/button&gt; &lt;span data-target= hello. sayResult &gt;123&lt;/span&gt; &lt;/div&gt;&lt;/div&gt;ä¿®æ”¹app/javascript/controllers/hello_controller. jsä¸º import { Controller } from  stimulus export default class extends Controller { static targets = [  output ,  sayResult  ] connect() {  this. outputTarget. textContent = 'Welcome, Stimulus!' } sayHello() {  this. sayResultTarget. textContent = 'Hello, Stimulus!' }}ä¿®æ”¹app/javascript/controllers/index. jsä¸º import { Application } from  stimulus import { definitionsFromContext } from  stimulus/webpack-helpers const application = Application. start()const context = require. context( controllers , true, /_controller\. js$/)application. load(definitionsFromContext(context))ç„¶åè¿è¡Œrails sï¼Œæµè§ˆå™¨æ‰“å¼€http://localhost:3000ï¼Œå³å¯ä½“éªŒ Stimulus çš„å®é™…æ•ˆæœäº†ã€‚ é›†æˆ Tailwind CSS: ä½¿ç”¨ yarn è¿›è¡Œå®‰è£… yarn add tailwindcssyarn add @tailwindcss/uiç”Ÿæˆ tailwind çš„é…ç½®æ–‡ä»¶ npx tailwindcss initè¿™ä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªtailwind. config. jsï¼ŒåŠ å…¥ä¸‹é¢å†…å®¹ module. exports = { purge: [], theme: {  extend: {}, }, variants: {}, plugins: [],}ç„¶åï¼Œå¯¹æ ¹ç›®å½•ä¸‹çš„postcss. config. jsè¿›è¡Œä¿®æ”¹ï¼ŒåŠ å…¥ require('tailwindcss'),require('autoprefixer'),postcss. config. jsæœ€ç»ˆæ˜¯è¿™æ · module. exports = { plugins: [  require('postcss-import'),  require('tailwindcss'),  require('autoprefixer'),  require('postcss-flexbugs-fixes'),  require('postcss-preset-env')({   autoprefixer: {    flexbox: 'no-2009'   },   stage: 3  }) ]}å†åœ¨app/javascriptä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºstylesheetsçš„ç›®å½•ï¼Œå¹¶åœ¨å…¶ä¸‹åˆ›å»ºä¸€ä¸ªapplication. scssæ–‡ä»¶ @import  tailwindcss/base ;@import  tailwindcss/components ;@import  tailwindcss/utilities ;ç„¶ååœ¨app/javascript/packs/application. jså†…æ·»åŠ å¦‚ä¸‹å‡ è¡Œ require('stylesheets/application. scss')app/javascript/packs/application. jsæœ€ç»ˆçœ‹èµ·æ¥æ˜¯è¿™æ · require( @rails/ujs ). start()require( turbolinks ). start()require( channels )import '. . /stylesheets/application. scss'è‡³æ­¤ï¼ŒTailwind CSS å°±å¯ä»¥åœ¨ Rails ä¸­ä½¿ç”¨äº†ã€‚æ¥è¯•è¯•æŠŠå‰é¢çš„ Home index é¡µé¢åº”ç”¨ä¸Šï¼ŒæŠŠå…¶ erb æ–‡ä»¶æ”¹ä¸ºå¦‚ä¸‹ &lt;div class= py-6 mx-auto max-w-7xl sm:px-6 lg:px-8  data-controller= hello &gt; &lt;!-- Replace with your content --&gt; &lt;div class= px-4 py-6 sm:px-0 &gt;  &lt;div class= border-4 border-gray-200 border-dashed rounded-lg h-96 &gt;   &lt;div&gt;    Default text when connect stimulus:    &lt;span data-target= hello. output &gt;&lt;/span&gt;   &lt;/div&gt;   &lt;div&gt;    disply text when click button:    &lt;button class= px-4 py-2 font-bold text-white bg-blue-500 rounded hover:bg-blue-700  data-action= click-&gt;hello#sayHello &gt;Say Hello!&lt;/button&gt;    &lt;span data-target= hello. sayResult &gt;123&lt;/span&gt;   &lt;/div&gt;  &lt;/div&gt; &lt;/div&gt; &lt;!-- /End replace --&gt;&lt;/div&gt;è¿è¡Œrails sï¼Œè®¿é—®http://localhost:3000ï¼Œåº”è¯¥å°±å¯ä»¥çœ‹åˆ°æ•ˆæœäº†ã€‚ åŠ å…¥ Alpine. js: Tailwind CSS åªæ˜¯ä¸€ä¸ªå·¥å…·åº“ï¼Œå¹¶æœªæä¾›ç°æˆçš„é¡µé¢æ¨¡å—å¯ä»¥å‚è€ƒã€‚ä¸è¿‡ä¸è¦ç´§ï¼Œä»–ä»¬å·²ç»æ¨å‡ºäº† Tailwind-UI çš„åº“ï¼Œå·²ç»åŒ…å«äº†è¿™äº›å†…å®¹ï¼Œæ¯”å¦‚å¸¸è§çš„é¡µé¢å¸ƒå±€ï¼ŒHeader è®¾è®¡ï¼Œä»¥åŠ Navigation èœå•ç­‰ã€‚å› ä¸ºè¿™äº›éœ€è¦ä¸€äº›ç®€å• JS çš„é…åˆï¼ŒTailwind å®˜æ–¹æ–‡æ¡£é‡Œæ¨èäº† Alpine. js çš„åº“ä½œä¸ºè¾…åŠ©ã€‚æˆ‘ä»¬æ¥æŠŠè¿™äº›åŠ å…¥åˆ°é¡¹ç›®ä¸­ï¼Œä»¥ä¾¿å¿«é€Ÿå®ç°ä¸€ä¸ªä¸é”™çš„é¡µé¢å¸ƒå±€ã€‚ å®‰è£… Alpine. js yarn add alpinejsåœ¨app/javascript/packs/application. jså†…åŠ å…¥è¿™è¡Œ require( alpinejs )ç„¶åï¼Œä¿®æ”¹app/views/layouts/application. html. erbä¸ºå¦‚ä¸‹ï¼š &lt;!DOCTYPE html&gt;&lt;html&gt; &lt;head&gt;  &lt;title&gt;STW Demo&lt;/title&gt;  &lt;%= csrf_meta_tags %&gt;  &lt;%= csp_meta_tag %&gt;  &lt;%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %&gt;  &lt;%= javascript_pack_tag 'application', 'data-turbolinks-track': 'reload' %&gt; &lt;/head&gt; &lt;body&gt;  &lt;div&gt;   &lt;nav x-data= { open: false }  @keydown. window. escape= open = false  class= bg-gray-800 &gt;    &lt;div class= px-4 mx-auto max-w-7xl sm:px-6 lg:px-8 &gt;     &lt;div class= flex items-center justify-between h-16 &gt;      &lt;div class= flex items-center &gt;       &lt;div class= flex-shrink-0 &gt;        &lt;h3 class= text-lg text-gray-300  &gt;MyApp&lt;/h3&gt;       &lt;/div&gt;       &lt;div class= hidden md:block &gt;        &lt;div class= flex items-baseline ml-10 &gt;         &lt;a href= #  class= px-3 py-2 text-sm font-medium text-white bg-gray-900 rounded-md focus:outline-none focus:text-white focus:bg-gray-700 &gt;Dashboard&lt;/a&gt;         &lt;a href= #  class= px-3 py-2 ml-4 text-sm font-medium text-gray-300 rounded-md hover:text-white hover:bg-gray-700 focus:outline-none focus:text-white focus:bg-gray-700 &gt;Team&lt;/a&gt;         &lt;a href= #  class= px-3 py-2 ml-4 text-sm font-medium text-gray-300 rounded-md hover:text-white hover:bg-gray-700 focus:outline-none focus:text-white focus:bg-gray-700 &gt;Projects&lt;/a&gt;         &lt;a href= #  class= px-3 py-2 ml-4 text-sm font-medium text-gray-300 rounded-md hover:text-white hover:bg-gray-700 focus:outline-none focus:text-white focus:bg-gray-700 &gt;Calendar&lt;/a&gt;         &lt;a href= #  class= px-3 py-2 ml-4 text-sm font-medium text-gray-300 rounded-md hover:text-white hover:bg-gray-700 focus:outline-none focus:text-white focus:bg-gray-700 &gt;Reports&lt;/a&gt;        &lt;/div&gt;       &lt;/div&gt;      &lt;/div&gt;      &lt;div class= hidden md:block &gt;       &lt;div class= flex items-center ml-4 md:ml-6 &gt;        &lt;button class= p-1 text-gray-400 border-2 border-transparent rounded-full hover:text-white focus:outline-none focus:text-white focus:bg-gray-700 &gt;         &lt;svg class= w-6 h-6  stroke= currentColor  fill= none  viewBox= 0 0 24 24 &gt;          &lt;path stroke-linecap= round  stroke-linejoin= round  stroke-width= 2  d= M15 17h5l-1. 405-1. 405A2. 032 2. 032 0 0118 14. 158V11a6. 002 6. 002 0 00-4-5. 659V5a2 2 0 10-4 0v. 341C7. 67 6. 165 6 8. 388 6 11v3. 159c0 . 538-. 214 1. 055-. 595 1. 436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9  /&gt;         &lt;/svg&gt;        &lt;/button&gt;        &lt;div @click. away= open = false  class= relative ml-3  x-data= { open: false } &gt;         &lt;div&gt;          &lt;button @click= open = !open  class= flex items-center max-w-xs text-sm text-white rounded-full focus:outline-none focus:shadow-solid &gt;           &lt;img class= w-8 h-8 rounded-full  src= https://images. unsplash. com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1. 2. 1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=facearea&amp;facepad=2&amp;w=256&amp;h=256&amp;q=80  alt=   /&gt;          &lt;/button&gt;         &lt;/div&gt;         &lt;div x-show= open  x-transition:enter= transition ease-out duration-100  x-transition:enter-start= transform opacity-0 scale-95  x-transition:enter-end= transform opacity-100 scale-100  x-transition:leave= transition ease-in duration-75  x-transition:leave-start= transform opacity-100 scale-100  x-transition:leave-end= transform opacity-0 scale-95  class= absolute right-0 w-48 mt-2 shadow-lg origin-top-right rounded-md &gt;          &lt;div class= py-1 bg-white rounded-md shadow-xs &gt;           &lt;a href= #  class= block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 &gt;Your Profile&lt;/a&gt;           &lt;a href= #  class= block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 &gt;Settings&lt;/a&gt;           &lt;a href= #  class= block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 &gt;Sign out&lt;/a&gt;          &lt;/div&gt;         &lt;/div&gt;        &lt;/div&gt;       &lt;/div&gt;      &lt;/div&gt;      &lt;div class= flex -mr-2 md:hidden &gt;       &lt;button @click= open = !open  class= inline-flex items-center justify-center p-2 text-gray-400 rounded-md hover:text-white hover:bg-gray-700 focus:outline-none focus:bg-gray-700 focus:text-white &gt;        &lt;svg class= w-6 h-6  stroke= currentColor  fill= none  viewBox= 0 0 24 24 &gt;         &lt;path :class= {'hidden': open, 'inline-flex': !open }  class= inline-flex  stroke-linecap= round  stroke-linejoin= round  stroke-width= 2  d= M4 6h16M4 12h16M4 18h16  /&gt;         &lt;path :class= {'hidden': !open, 'inline-flex': open }  class= hidden  stroke-linecap= round  stroke-linejoin= round  stroke-width= 2  d= M6 18L18 6M6 6l12 12  /&gt;        &lt;/svg&gt;       &lt;/button&gt;      &lt;/div&gt;     &lt;/div&gt;    &lt;/div&gt;    &lt;div :class= {'block': open, 'hidden': !open}  class= hidden md:hidden &gt;     &lt;div class= px-2 pt-2 pb-3 sm:px-3 &gt;      &lt;a href= #  class= block px-3 py-2 text-base font-medium text-white bg-gray-900 rounded-md focus:outline-none focus:text-white focus:bg-gray-700 &gt;Dashboard&lt;/a&gt;      &lt;a href= #  class= block px-3 py-2 mt-1 text-base font-medium text-gray-300 rounded-md hover:text-white hover:bg-gray-700 focus:outline-none focus:text-white focus:bg-gray-700 &gt;Team&lt;/a&gt;      &lt;a href= #  class= block px-3 py-2 mt-1 text-base font-medium text-gray-300 rounded-md hover:text-white hover:bg-gray-700 focus:outline-none focus:text-white focus:bg-gray-700 &gt;Projects&lt;/a&gt;      &lt;a href= #  class= block px-3 py-2 mt-1 text-base font-medium text-gray-300 rounded-md hover:text-white hover:bg-gray-700 focus:outline-none focus:text-white focus:bg-gray-700 &gt;Calendar&lt;/a&gt;      &lt;a href= #  class= block px-3 py-2 mt-1 text-base font-medium text-gray-300 rounded-md hover:text-white hover:bg-gray-700 focus:outline-none focus:text-white focus:bg-gray-700 &gt;Reports&lt;/a&gt;     &lt;/div&gt;     &lt;div class= pt-4 pb-3 border-t border-gray-700 &gt;      &lt;div class= flex items-center px-5 &gt;       &lt;div class= flex-shrink-0 &gt;        &lt;img class= w-10 h-10 rounded-full  src= https://images. unsplash. com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1. 2. 1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=facearea&amp;facepad=2&amp;w=256&amp;h=256&amp;q=80  alt=   /&gt;       &lt;/div&gt;       &lt;div class= ml-3 &gt;        &lt;div class= text-base font-medium leading-none text-white &gt;Tom Cook&lt;/div&gt;        &lt;div class= mt-1 text-sm font-medium leading-none text-gray-400 &gt;tom@example. com&lt;/div&gt;       &lt;/div&gt;      &lt;/div&gt;      &lt;div class= px-2 mt-3 &gt;       &lt;a href= #  class= block px-3 py-2 text-base font-medium text-gray-400 rounded-md hover:text-white hover:bg-gray-700 focus:outline-none focus:text-white focus:bg-gray-700 &gt;Your Profile&lt;/a&gt;       &lt;a href= #  class= block px-3 py-2 mt-1 text-base font-medium text-gray-400 rounded-md hover:text-white hover:bg-gray-700 focus:outline-none focus:text-white focus:bg-gray-700 &gt;Settings&lt;/a&gt;       &lt;a href= #  class= block px-3 py-2 mt-1 text-base font-medium text-gray-400 rounded-md hover:text-white hover:bg-gray-700 focus:outline-none focus:text-white focus:bg-gray-700 &gt;Sign out&lt;/a&gt;      &lt;/div&gt;     &lt;/div&gt;    &lt;/div&gt;   &lt;/nav&gt;   &lt;header class= bg-white shadow &gt;    &lt;div class= px-4 py-6 mx-auto max-w-7xl sm:px-6 lg:px-8 &gt;     &lt;h2 class= text-3xl font-bold leading-tight text-gray-900 &gt;      Dashboard     &lt;/h2&gt;    &lt;/div&gt;   &lt;/header&gt;   &lt;main&gt;   &lt;%= yield %&gt;   &lt;/main&gt;  &lt;/div&gt; &lt;/body&gt;&lt;/html&gt;å†æ¬¡è¿è¡Œrails sï¼Œè®¿é—®http://localhost:3000ï¼Œå¯ä»¥çœ‹åˆ°å‡ºç°çš„å¸¸è§„é¡µé¢å¸ƒå±€ï¼Œé¡¶éƒ¨å³ä¾§çš„å¤´åƒç‚¹å‡»å¯ä»¥å¼¹å‡ºèœå•ã€‚ æœ€åçš„ä¼˜åŒ–è®¾è®¡ï¼ˆåŠ å…¥è‡ªå®šä¹‰å­—ä½“ï¼‰: æˆ‘ä»¬æœ‰æ—¶å¸Œæœ›ä½¿ç”¨æ›´ç‹¬ç‰¹ä¼˜ç¾çš„å­—ä½“æ¥ä½œä¸ºé»˜è®¤å­—ä½“ï¼Œä»¥æ­¤å¢å¼ºé¡µé¢çš„æ˜¾ç¤ºæ•ˆæœã€‚ä¸‹é¢æˆ‘ä»¬æ¥åŠ å…¥ç›®å‰æœ‰ç‚¹æµè¡Œçš„ Inter å­—ä½“ã€‚ å®‰è£…å­—ä½“ yarn add 'typeface-inter'ç„¶åéœ€è¦å‘Šè¯‰ Tailwind CSS ä½¿ç”¨è¿™ä¸ªå­—ä½“ã€‚é¦–å…ˆï¼Œä¿®æ”¹app/javascript/packs/application. jsåŠ å…¥ä¸‹é¢è¿™è¡Œ require('typeface-inter')å†ä¿®æ”¹tailwind. config. jsä¸º module. exports = { theme: {  fontFamily: {   body: ['inter']  },  extend: {}, }, variants: {}, plugins: [],}æœ€åï¼Œéœ€è¦ä¿®æ”¹ä¸Šé¢çš„application. scssä¸ºå¦‚ä¸‹ä»¥åº”ç”¨æ–°å­—ä½“ @import  tailwindcss/base ;html { @apply font-body;}@import  tailwindcss/components ;@import  tailwindcss/utilities ;è¿™æ ·ï¼Œæˆ‘ä»¬å°±æ­å»ºå¥½äº†ä¸€ä¸ªé›†æˆ Stimulus + Tailwind CSS + Tailwind UI + Alpine. js çš„ Rails é¡¹ç›®åŸºç¡€ï¼Œè€Œä¸”åº”ç”¨äº†è‡ªå®šä¹‰çš„ Inter å­—ä½“ã€‚æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥åœ¨è¿™ä¸ªåŸºç¡€ä¸Šè¿›è¡Œå¼€å‘äº†ã€‚ "
    }, {
    "id": 47,
    "url": "/2020/07/dhh-talk-about-heystack/",
    "title": "å¯¹ Hey.com æŠ€æœ¯æ ˆçš„æœŸå¾…",
    "body": "2020/07/04 - è¿‘ä¸€å‘¨æ¥ï¼Œè‘—åçš„ Basecamp å…¬å¸å‘å¸ƒäº†æ–°å¼çš„ Hey. com çš„é‚®ä»¶æœåŠ¡ï¼Œå·ç§°æ˜¯é’ˆå¯¹å½“å‰è¯¸å¦‚ GMail ç­‰é‚®ä»¶æœåŠ¡çš„ä¸€æ¬¡â€œé©å‘½â€ï¼Œåœ¨ Twitter ä¸Šå¼•å‘äº†å·¨å¤§çš„è®®è®ºé£æš´ã€‚è€Œä½œä¸ºå…¬å¸åˆ›å§‹äººã€Rails åˆ›å»ºè€…çš„ DHH å¤§ç¥ï¼Œåœ¨ Twitter ä¸Šä¹Ÿå‘äº†å¤šä¸ªæ¨ï¼Œæ¥è¯´æ˜ Hey. com çš„å“è¶Šä¸å‡¡ã€‚å…¶ä¸­ä¸€ç¯‡æ›´æ˜¯åˆ—ä¸¾äº† Hey. com å½“å‰ä½¿ç”¨çš„æŠ€æœ¯æ ˆï¼Œä»–ç§°ä¹‹ä¸ºâ€œHeystackâ€ï¼ˆç”šè‡³åˆ†äº«äº†æ‰€ç”¨åˆ°çš„ Gemfileï¼‰ï¼Œå¦‚ä¸‹ï¼š - Vanilla Ruby on Rails on the backend, running on edge- Stimulus, Turbolinks, Trix + NEW MAGIC on the front end- MySQL for DB (Vitess for sharding)- Redis for short-lived data + caching- ElasticSearch for indexing- AWS/K8Sç”±äº Hey. com çš„ï¼ˆç½‘é¡µç«¯ï¼‰ä½¿ç”¨ä½“éªŒç›¸å½“æµç•…é¡ºæ»‘ï¼ˆæä¾› 7 å¤©å…è´¹è¯•ç”¨ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å»æ„Ÿå—ä¸‹ã€‚ä½†æ­£å¼ä½¿ç”¨çš„è¯åˆ™æ˜¯æŒ‰ $99/å¹´ æ”¶è´¹^_^ï¼‰ï¼Œè¿™ä¸ªåˆ—è¡¨ä¸­çš„ä¸€é¡¹å¼•å‘äº†è¯¸å¤šäººçš„å¼ºçƒˆå…´è¶£ï¼š Stimulus, Turbolinks, Trix + NEW MAGIC on the front endè¿™ä¸€é¡¹æ˜æ˜¾æ˜¯æŒ‡ Hey. com å½“å‰æ‰€ç”¨åˆ°çš„å‰ç«¯æŠ€æœ¯ï¼Œè€Œæ‰€è°“çš„â€œNEW MAGICâ€åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œåœ¨ DHH æœ¬æ¡æ¨ç‰¹ä¸‹æœ‰å¾ˆå¤šäººçŒœæµ‹ï¼Œç”šè‡³ç›´æ¥è¯¢é—®ä»–ã€‚DHH åˆ™çƒ­æƒ…æ´‹æº¢åœ°å›å¤è¯´ä¸ä¹…ä¹‹å Basecamp ä¼šå¼€æºå‘å¸ƒæœ‰å…³ä»£ç ã€‚æˆ‘ä¸ªäººçŒœæµ‹æœ‰å¯èƒ½æ˜¯ Stimulus 2. 0 + WebSocket ç­‰æŠ€æœ¯å®ç°ï¼Œç±»ä¼¼äº Elixir è¯­è¨€çš„ Phoenix æ¡†æ¶ä¸­çš„ LiveViewã€‚ä¸ç®¡æ€æ ·ï¼ŒDHH çš„æŠ€æœ¯å“å‘³å’Œ Basecamp çš„åå¤´ï¼Œéƒ½ç›¸å½“å€¼å¾—ç»™ä»¥æœŸç›¼ã€‚è®©æˆ‘ä»¬æ‹­ç›®ä»¥å¾…å§ã€‚ "
    }, {
    "id": 48,
    "url": "/2020/07/programming-elixir-1-6-chapter-4-part2/",
    "title": "ã€ŠProgramming Elixir >= 1.6ã€‹ç¬¬å››ç« ï¼šåŸºæœ¬è¯­æ³•ï¼ˆèŠ‚é€‰äºŒï¼‰",
    "body": "2020/07/03 - è¿™æ˜¯ã€ŠProgramming Elixir &gt;= 1. 6ã€‹ç¬¬å››ç« çš„ç¬¬äºŒéƒ¨åˆ†ã€‚ä¸å¤šè¯´äº†ï¼Œç›´æ¥ä¸Šæ­£æ–‡å§ã€‚ ã€ä¸‹é¢æ˜¯æ­£æ–‡ã€‘ ï¼ˆæ¥ç¬¬ä¸€éƒ¨åˆ†ï¼‰ Binaries: æœ‰æ—¶ä½ éœ€è¦ä»¥æ¯”ç‰¹ä½ï¼ˆbitï¼‰å’Œå­—èŠ‚ï¼ˆbyteï¼‰åºåˆ—çš„å½¢å¼è®¿é—®æ•°æ®ã€‚ä¾‹å¦‚ï¼ŒJPEG å’Œ MP3 æ–‡ä»¶çš„å¤´éƒ¨å°±æœ‰ä¸€äº›å­—æ®µï¼Œé‚£é‡Œå•ä¸ªå­—èŠ‚å¯ä»¥ç¼–ç æˆä¸¤ä¸‰ä¸ªå•ç‹¬å€¼ã€‚ Elixir é€šè¿‡äºŒè¿›åˆ¶æ•°æ®ç±»å‹æ¥åšåˆ°è¿™äº›ã€‚äºŒè¿›åˆ¶å­—é¢é‡è¢«åŒ…å«åœ¨&lt;&lt;å’Œ&gt;&gt;ä¹‹é—´ã€‚ åŸºæœ¬çš„è¯­æ³•æ˜¯å°†è¿ç»­çš„æ•´æ•°è½¬æˆå­—èŠ‚ï¼š iex&gt; bin = &lt;&lt; 1, 2 &gt;&gt;&lt;&lt;1, 2&gt;&gt;iex&gt; byte_size bin2ä½ å¯ä»¥æ·»åŠ ä¿®é¥°ç¬¦æ¥æ§åˆ¶æ¯ä¸ªå­—æ®µçš„ç±»å‹å’Œå¤§å°ã€‚ä¸‹é¢çš„ä¾‹å­æ˜¯ä¸€ä¸ªå•å­—èŠ‚åŒ…å«ä¸‰ä¸ªå­—æ®µï¼Œå¤§å°åˆ†åˆ«æ˜¯2ã€4ã€2æ¯”ç‰¹ä½ã€‚ï¼ˆç¤ºä¾‹ä¸­ä½¿ç”¨äº†ä¸€äº›å†…ç½®åº“å‡½æ•°æ¥æ˜¾ç¤ºäºŒè¿›åˆ¶æ•°æ®çš„ç»“æœï¼‰ iex&gt; bin = &lt;&lt;3 :: size(2), 5 :: size(4), 1 :: size(2)&gt;&gt;&lt;&lt;213&gt;&gt;iex&gt; :io. format( ~-8. 2b~n , :binary. bin_to_list(bin))11010101:okiex&gt; byte_size bin1äºŒè¿›åˆ¶æ•°æ®æ—¢é‡è¦å´åˆç¥ç§˜ã€‚é‡è¦åœ¨äº Elixir ç”¨å®ƒä»¬æ¥è¡¨ç¤º UTF å­—ç¬¦ä¸²ï¼Œç¥ç§˜æ˜¯å› ä¸ºè‡³å°‘åœ¨æœ€åˆé˜¶æ®µä½ éƒ½ä¸å¤ªå¯èƒ½ç›´æ¥ä½¿ç”¨å®ƒä»¬ã€‚ Dates and Times: Elixir 1. 3 æ·»åŠ äº†ä¸€ä¸ªæ—¥å†ï¼ˆcalendarï¼‰æ¨¡å—å’Œå››ä¸ªæ–°çš„æ—¥æœŸä¸æ—¶é—´ç›¸å…³çš„ç±»å‹ã€‚æœ€åˆï¼Œå®ƒä»¬åªä¸è¿‡ç”¨æ¥æ”¾ç½®æ•°æ®ï¼Œä½† Elixir 1. 5 å¼€å§‹ä¸ºå®ƒä»¬æ·»åŠ ä¸€äº›åŠŸèƒ½ã€‚ Calendaræ¨¡å—ä»£è¡¨äº†æ“ä½œæ—¥æœŸçš„è§„åˆ™ã€‚å½“å‰ä»…ä»…å®ç°äº†Calendar. ISOï¼Œå³å…¬å†çš„ ISO-8601 è¡¨ç¤ºã€‚ Dateç±»å‹å¤„ç†å¹´ã€æœˆã€æ—¥ï¼Œä»¥åŠå¯¹å„’ç•¥å†çš„å¼•ç”¨ã€‚ iex&gt; d1 = Date. new(2018, 12, 25){:ok, ~D[2018-12-25]}iex&gt; {:ok, d1} = Date. new(2018, 12, 25){:ok, ~D[2018-12-25]}iex&gt; d2 = ~D[2018-12-25]~D[2018-12-25]iex&gt; d1 == d2trueiex&gt; Date. day_of_week(d1)2iex&gt; Date. add(d1, 7)~D[2019-01-01]iex&gt; inspect d1, structs: false %{__struct__: Date, calendar: Calendar. ISO, day: 25, month: 12, year: 2018} ï¼ˆ~D[â€¦]å’Œ~T[â€¦]æ˜¯ Elixir ä¸­çš„é­”ç¬¦sigilç”¨æ³•ã€‚å®ƒä»¬æ˜¯ä¸€ç§æ„å»ºå€¼çš„å­—é¢é‡çš„æ–¹å¼ã€‚å½“æˆ‘ä»¬è¯»åˆ°å­—ç¬¦ä¸²å’ŒäºŒè¿›åˆ¶æ—¶ä¼šå†é‡è§å®ƒä»¬ã€‚ï¼‰ Elixir ä¹Ÿå¯ä»¥è¡¨ç¤ºä¸€ä¸ªæ—¥æœŸçš„èŒƒå›´ï¼š iex&gt; d1 = ~D[2018-01-01]~D[2018-01-01]iex&gt; d2 = ~D[2018-06-30]~D[2018-06-30]iex&gt; first_half = Date. range(d1, d2)#DateRange&lt;~D[2018-01-01], ~D[2018-06-30]&gt;iex&gt; Enum. count(first_half)181iex&gt; ~D[2018-03-15] in first_halftrueæ—¶é—´ç±»å‹å¤„ç†æ—¶ã€åˆ†ã€ç§’ï¼Œä»¥åŠå‡ åˆ†ä¹‹ä¸€ç§’ã€‚åè€…å­˜å‚¨ä¸ºä¸€ä¸ªåŒ…å«å¾®ç§’å’Œæœ‰æ•ˆä½æ•°çš„å…ƒç»„ï¼ˆtupleï¼‰ã€‚ï¼ˆæ—¶é—´å€¼ä¸ç§’ä¸­æœ‰æ•ˆä½æ•°ç›¸å…³çš„äº‹å®æ„å‘³ç€~T[12:34:56. 0]è·Ÿ~T[12:34:56. 00]æ˜¯ä¸ç›¸ç­‰çš„ã€‚ï¼‰ iex&gt; {:ok, t1} = Time. new(12, 34, 56){:ok, ~T[12:34:56]}iex&gt; t2 = ~T[12:34:56. 78]~T[12:34:56. 78]iex&gt; t1 == t2falseiex&gt; Time. add(t1, 3600)~T[13:34:56. 000000]iex&gt; Time. add(t1, 3600, :millisecond)~T[12:34:59. 600000]ä¸€å…±æœ‰ä¸¤ç§æ—¥æœŸæ—¶é—´çš„ç±»å‹ï¼šDateTimeå’ŒNaiveDateTimeã€‚Naive ç‰ˆæœ¬åªåŒ…å«æ—¥æœŸå’Œæ—¶é—´ï¼Œå‰è€…åˆ™è¿˜èƒ½å…³è”æ—¶åŒºã€‚~N[. . . ]çš„é­”ç¬¦æ–¹å¼å¯ä»¥åˆ›å»ºNaiveDateTimeçš„ç»“æ„ä½“ã€‚ å¦‚æœä½ åœ¨ä»£ç ä¸­ä½¿ç”¨æ—¥æœŸå’Œæ—¶é—´ï¼Œåˆ™å¯èƒ½éœ€è¦ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œä¾‹å¦‚ Lau Taarnskov çš„æ—¥å†åº“ï¼Œæ¥æ‰©å……è¿™äº›å†…ç½®ç±»å‹ã€‚ Names, Source Files, Conventions, Operators, and So On: Elixir çš„æ ‡è¯†ç¬¦å¿…é¡»ä»¥å­—æ¯å’Œä¸‹åˆ’çº¿å¼€å¤´ï¼Œåé¢å¯è·Ÿå­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ã€‚è¿™é‡Œçš„å­—æ¯æ˜¯æŒ‡ä»»ä½• UTF-8 å­—æ¯çš„å­—ç¬¦ï¼ˆå¯å¸¦ç»„åˆæ ‡è®°ï¼‰ï¼Œè€Œæ•°å­—æ˜¯æŒ‡ UTF-8 åè¿›åˆ¶æ•°çš„å­—ç¬¦ã€‚å¦‚æœä½ ä½¿ç”¨ ASCIIï¼Œé‚£ä¹ˆæ¯‹éœ€æ‹…å¿ƒã€‚æ ‡è¯†ç¬¦å¯ç”¨é—®å·æˆ–æ„Ÿå¹å·ç»“å°¾ã€‚ ä¸‹é¢æ˜¯ä¸€äº›åˆæ³•å‘½åçš„å˜é‡ä¾‹å­ï¼š name josÃ© _age ã¾ã¤ã‚‚ã¨ _42 Ğ°Ğ´Ñ€ĞµÑ!ä¸åˆæ³•å‘½åçš„å˜é‡ä¾‹å­å¦‚ä¸‹ï¼š nameâ€¢ aÂ±2 42æ¨¡å—ï¼ˆmoduleï¼‰ã€è®°å½•ï¼ˆrecordï¼‰ã€åè®®ï¼ˆprotocolï¼‰å’Œè¡Œä¸ºï¼ˆbehaviorï¼‰çš„åç§°éƒ½ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œä¸”æ˜¯é©¼å³°å¼çš„ï¼ˆå¦‚ BumpyCaseï¼‰ã€‚å…¶ä»–æ ‡è¯†ç¬¦ä»¥å°å†™å­—æ¯æˆ–ä¸‹åˆ’çº¿å¼€å¤´ï¼Œä¸”æƒ¯å¸¸ç”¨ä¸‹åˆ’çº¿åˆ†éš”å•è¯ã€‚å½“å˜é‡é¦–å­—ç¬¦æ˜¯ä¸‹åˆ’çº¿æ—¶ï¼Œåªè¦å®ƒåœ¨æ¨¡å¼åŒ¹é…æˆ–å‡½æ•°å‚æ•°åˆ—è¡¨ä¸­ä¸è¢«ä½¿ç”¨ï¼Œé‚£ä¹ˆ Elixir æ˜¯å…è®¸çš„ã€‚ æƒ¯ä¾‹ä¸Šæºç æ–‡ä»¶éƒ½ä½¿ç”¨ä¸¤ä¸ªå­—ç¬¦çš„ç¼©è¿›â€”â€”ä¸”ç”¨ space è€Œé tabã€‚ æ³¨é‡Šä»¥#å¼€å¤´ç›´è‡³ä¸€è¡Œçš„ç»“å°¾ã€‚ Elixir è‡ªå¸¦äº†ä¸€ä¸ªä»£ç æ ¼å¼åŒ–å™¨ï¼Œç”¨æ¥æŠŠä»£ç è½¬åŒ–æˆâ€ç»Ÿä¸€è§„èŒƒâ€çš„æ ¼å¼ã€‚åé¢ä¼šæåˆ°å®ƒã€‚æœ¬ä¹¦ä¸­çš„å¾ˆå¤šç¤ºä¾‹éƒ½ä¼šè·Ÿéšè¯¥è§„èŒƒï¼ˆé™¤å»ä¸ªåˆ«æˆ‘è®¤ä¸ºæœ‰ç‚¹ä¸‘é™‹å¤–ï¼‰ã€‚ Truth: Elixir æœ‰ä¸‰ç§ç‰¹åˆ«çš„å…³äºå¸ƒå°”æ“ä½œçš„å€¼ï¼štrueã€falseå’Œnilã€‚nilåœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­è¢«è§†ä½œ falseã€‚ ï¼ˆæä¸€ä¸‹ï¼šè¿™ä¸‰ç§å€¼éƒ½æ˜¯ç›¸åŒåç§°çš„åŸå­çš„åˆ«åï¼Œæ‰€ä»¥trueå°±æ˜¯åŸå­:trueã€‚ï¼‰ å¤§å¤šä¸Šä¸‹æ–‡ä¸­ï¼Œä»»ä½•ä¸æ˜¯falseæˆ–nilçš„å€¼éƒ½è¢«è®¤ä¸ºæ˜¯ trueã€‚æœ‰æ—¶æˆ‘ä»¬æŠŠè¿™ç§°ä¸º truthy è€Œä¸å« trueã€‚ Operators: Elixir æœ‰ä¸°å¯Œçš„æ“ä½œç¬¦ã€‚è¿™å„¿åªåˆ—å‡ºæœ¬ä¹¦ä¸­ç”¨åˆ°çš„ä¸€éƒ¨åˆ†ï¼š æ¯”è¾ƒè¿ç®—ç¬¦ a === b # strict equality (so 1 === 1. 0 is false)a !== b # strict inequality (so 1 !== 1. 0 is true)a == b # value equality (so 1 == 1. 0 is true)a != b # value inequality (so 1 != 1. 0 is false)a &gt; b # normal comparisona &gt;= b # :a &lt; b #:a &lt;= b #Elixirä¸­çš„æ’åºæ¯”è¾ƒä¸åƒè®¸å¤šè¯­è¨€é‚£æ ·ä¸¥æ ¼ï¼Œå› ä¸ºä½ å¯ä»¥æ¯”è¾ƒä¸åŒç±»å‹çš„å€¼ã€‚å¦‚æœç±»å‹ç›¸åŒæˆ–è€…å…¼å®¹ï¼ˆå¦‚3 &gt; 2æˆ–3. 0 &lt; 5ï¼‰ï¼Œæ¯”è¾ƒä¼šä½¿ç”¨è‡ªç„¶æ’åºã€‚å¦åˆ™ä¼šåŸºäºå¦‚ä¸‹è§„åˆ™æ¥æ¯”è¾ƒï¼š number &lt; atom &lt; reference &lt; function &lt; port &lt; pid &lt; tuple &lt; map &lt; list &lt; binaryå¸ƒå°”è¿ç®—ç¬¦ ï¼ˆæ“ä½œç¬¦æœŸæœ›å…¶ç¬¬ä¸€ä¸ªå‚æ•°ä¸º true æˆ–è€… falseï¼‰ a or b # true if a is true; otherwise ba and b # false if a is false; otherwise bnot a  # false if a is true; true otherwiseçŸ­è·¯å¸ƒå°”è¿ç®—ç¬¦ æ“ä½œç¬¦å¯ä½¿ç”¨ä»»ä½•ç±»å‹ä½œä¸ºå‚æ•°ã€‚ä»»ä½•ä¸æ˜¯falseæˆ–nilçš„å€¼éƒ½è¢«è®¤ä¸ºæ˜¯ trueã€‚ a || b # a if a is truthy; otherwise ba &amp;&amp; b # b if a is truthy; otherwise a!a # false if a is truthy; otherwise trueç®—æœ¯è¿ç®—ç¬¦ + - * / div remæ•´æ•°ç›¸é™¤ä¼šå¾—åˆ°ä¸€ä¸ªæµ®ç‚¹æ•°ç»“æœã€‚ä½¿ç”¨div(a, b)å¯å¾—åˆ°æ•´æ•°ã€‚ remæ˜¯ä½™æ•°æ“ä½œç¬¦ï¼Œä½œä¸ºå‡½æ•°æ¥è°ƒç”¨ï¼ˆrem(11, 3) =&gt; 2ï¼‰ã€‚å®ƒä¸æ™®é€šæ¨¡è¿ç®—çš„ä¸åŒä¹‹å¤„åœ¨äºç»“æœä¸å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å…·æœ‰ç›¸åŒçš„ç¬¦å·ã€‚ è¿æ¥è¿ç®—ç¬¦ binary1 &lt;&gt; binary2 # concatenates two binaries (Later we'll          # see that binaries include strings. )list1 ++ list2   # concatenates two listslist1 -- list2   # removes elements of list 2 from a copy of list 1inè¿ç®—ç¬¦ a in enum # tests if a is included in enum (for example,      # a list, a range, or a map). For maps, a should      # be a {key, value} tuple. Variable Scope: Elixir åŸºäºè¯æ³•åŸŸï¼ŒåŸŸçš„åŸºæœ¬å•å…ƒæ˜¯å‡½æ•°ä½“ã€‚å®šä¹‰åœ¨å‡½æ•°å†…éƒ¨çš„å˜é‡ï¼ˆåŒ…æ‹¬å‡½æ•°å‚æ•°ï¼‰éƒ½æ˜¯å‡½æ•°çš„å±€éƒ¨å˜é‡ã€‚æ­¤å¤–ï¼Œæ¨¡å—ä¹Ÿå®šä¹‰äº†ä¸€ä¸ªå±€éƒ¨å˜é‡åŸŸï¼Œä½†è¿™äº›å˜é‡åªèƒ½åœ¨æ¨¡å—é¡¶å±‚è®¿é—®ï¼Œè€Œä¸èƒ½åœ¨æ¨¡å—ä¸­å®šä¹‰çš„å‡½æ•°å†…è®¿é—®ã€‚ Do-block Scope: å¾ˆå¤šè¯­è¨€å…è®¸ä½ æŠŠå¤šä¸ªä»£ç è¯­å¥æ”¾åˆ°ä¸€èµ·ä½œä¸ºå•ä¸ªä»£ç å—ï¼Œé€šå¸¸éƒ½ä½¿ç”¨å¤§æ‹¬å·åŒ…èµ·æ¥ã€‚ä¸‹é¢æ˜¯ä¸ª C è¯­è¨€çš„ä¾‹å­ï¼š int line_no = 50;/* . . . . . */if (line_no == 50) { printf( new-page\f ); line_no = 0;}Elixir æ²¡æœ‰ç±»ä¼¼è¿™æ ·çš„ä»£ç å—ï¼Œä½†å®ƒç”¨ä¸€äº›å…¶ä»–çš„æ–¹å¼æ¥å®ç°ã€‚æœ€å¸¸è§çš„æ˜¯doä»£ç å—ï¼š line_no = 50# . . . if (line_no == 50) do IO. puts  new-page\f  line_no = 0endIO. puts line_noç„¶è€Œï¼ŒElixir ä¸­è¿™æ˜¯ä¸€ç§å±é™©çš„ä»£ç å†™æ³•ã€‚ç‰¹åˆ«æ˜¯ï¼Œå¾ˆå®¹æ˜“å¿˜è®°åœ¨ä»£ç å—å¤–é¢åˆå§‹åŒ–line_noï¼Œä¸”åœ¨ä»£ç å—ååˆä¾èµ–äºline_noå…¶å€¼ã€‚è¿™æ—¶ï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªè­¦å‘Šæç¤ºï¼š $ elixir back_block. exwarning: the variable  line_no  is unsafe as it has been set inside one of: case, cond, receive, if, and, or, &amp;&amp;, ||. Please explicitly return the variable value instead. Here's an example:  case integer do   1 -&gt; atom = :one   2 -&gt; atom = :two  endshould be written as  atom =   case integer do1 -&gt; :one2 -&gt; :two endUnsafe variable found at: t. ex:100The with Expression: withè¡¨è¾¾å¼æœ‰åŒé‡ç”¨é€”ã€‚é¦–å…ˆï¼Œä½ å¯ä»¥ç”¨å®ƒå®šä¹‰ä¸€ä¸ªå±€éƒ¨å˜é‡åŸŸã€‚å½“ä½ è®¡ç®—æŸä¸ªä¸œè¥¿éœ€è¦ä¸€äº›ä¸´æ—¶å˜é‡ï¼Œåˆä¸æƒ³è®©å®ƒä»¬æ³„æ¼åˆ°å¤–éƒ¨åŸŸçš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨withã€‚å…¶æ¬¡ï¼Œå®ƒèƒ½è®©ä½ æŒæ§ä¸€äº›æ¨¡å¼åŒ¹é…å¤±è´¥æƒ…å†µçš„å¤„ç†ã€‚ä¾‹å¦‚ï¼Œæ–‡ä»¶/etc/passwdåŒ…å«è¿™æ ·çš„æ–‡æœ¬ _installassistant:*:25:25:Install Assistant:/var/empty:/usr/bin/false_lp:*:26:26:Printing Services:/var/spool/cups:/usr/bin/false_postfix:*:27:27:Postfix Mail Server:/var/spool/postfix:/usr/bin/falseè¡Œä¸­çš„ä¸¤ä¸ªæ•°å­—æ˜¯å¯¹åº”ç”¨æˆ·çš„ç”¨æˆ· ID å’Œç»„ IDã€‚ ä¸‹é¢çš„ä»£ç æ˜¯æŸ¥æ‰¾_lpç”¨æˆ·çš„å¯¹åº”å€¼ã€‚ content =  Now is the time lp = with {:ok, file} = File. open( /etc/passwd ),   content = IO. read(file, :all), # note: same name as above   :ok = File. close(file),   [_, uid, gid] = Regex. run(~r/^lp:. *?:(\d+):(\d+)/m, content)  do    Group: #{gid}, User: #{uid}   endIO. puts lp #=&gt; Group: 26, User: 26IO. puts content #=&gt; Now is the timeæ ¼å¼åŒ–ä»£ç çš„æ¯”è¾ƒ withè¯­å¥æ­£å¥½æ˜¯ Elixir å…³äºä»£ç æ ¼å¼åŒ–ä¸Šè¿˜æœªå–å¾—ä¸€è‡´çš„ä¾‹å­ã€‚å¦‚æœä½¿ç”¨å…¶å†…ç½®ä»£ç æ ¼å¼åŒ–å™¨ï¼Œæ ¼å¼åŒ–çš„ç»“æœæ˜¯è¿™æ ·çš„ã€‚ content =  Now is the time lp = with {:ok, file} = File. open( /etc/passwd ),    content = IO. read(file, :all),    :ok = File. close(file),    [_, uid, gid] = Regex. run(~r/^_lp:. *?:(\d+):(\d+)/m, content) do   Group: #{gid}, User: #{uid}  end# =&gt; Group: 26, User: 26IO. puts(lp)# =&gt; Now is the timeIO. puts(content)å“ªç§æ›´å¥½æˆ‘ç•™ç»™ä½ æ¥åˆ¤æ–­äº†ã€‚ withè¡¨è¾¾å¼è®©æˆ‘ä»¬åœ¨æ‰“å¼€æ–‡ä»¶ã€è¯»å–å†…å®¹ã€å…³é—­æ–‡ä»¶å’ŒæŸ¥æ‰¾æŸè¡Œæ—¶èƒ½æ›´é«˜æ•ˆåœ°ä½¿ç”¨ä¸´æ—¶å˜é‡ã€‚withä¸­çš„å˜é‡è¢«ä¼ é€’ä¸ºåé¢doå—çš„å‚æ•°ä½¿ç”¨ã€‚ å˜é‡contentæ˜¯withçš„å±€éƒ¨å˜é‡ï¼Œä¸ä¼šè¢«åœ¨å¤–éƒ¨è®¿é—®åˆ°ã€‚ with and Pattern Matching: ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œwithè¡¨è¾¾å¼çš„å¤´éƒ¨ä½¿ç”¨=æ¥è¿›è¡ŒåŸºæœ¬çš„æ¨¡å¼åŒ¹é…ã€‚å…¶ä¸­ä»»ä½•ä¸€ä¸ªåŒ¹é…å¤±è´¥ï¼Œéƒ½ä¼šæŠ›å‡ºä¸€ä¸ªMatchErrorå¼‚å¸¸ã€‚ä½†ä¹Ÿè®¸æˆ‘ä»¬ä»¥ä¸€ç§æ›´ä¼˜é›…çš„æ–¹å¼æ¥å¤„ç†ã€‚è¿™é‡Œ&lt;-å°±èƒ½ä¸€å±•èº«æ‰‹äº†ã€‚å¦‚æœåœ¨withè¡¨è¾¾å¼ä¸­ä½¿ç”¨&lt;-ä»£æ›¿=ï¼Œå®ƒä¾ç„¶è¿›è¡ŒåŒ¹é…ï¼Œä½†åŒ¹é…å¤±è´¥æ—¶ä¼šè¿”å›æ— æ³•åŒ¹é…çš„å€¼ã€‚ iex&gt; with [a|_] &lt;- [1,2,3], do: a1iex&gt; with [a|_] &lt;- nil, do: anilæˆ‘ä»¬æ¥ä½¿ç”¨è¿™ç§æ–¹æ³•è®©ä¸Šé¢ç¤ºä¾‹çš„withè¯­å¥åœ¨æ— æ³•æ‰¾åˆ°ç”¨æˆ·æ—¶è¿”å›nilè€Œä¸æ˜¯æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚ result = with {:ok, file} = File. open( /etc/passwd ),     content = IO. read(file, :all),     :ok = File. close(file),     [_, uid, gid] &lt;- Regex. run(~r/^xxx:. *?:(\d+):(\d+)/, content)    do      Group: #{gid}, User: #{uid}     endIO. puts inspect(result) #=&gt; nilå½“æˆ‘ä»¬è¯•å›¾åŒ¹é…ç”¨æˆ· xxx æ—¶ï¼ŒRegex. runä¼šè¿”å›nilã€‚è¿™ä½¿å¾—åŒ¹é…å¤±è´¥ï¼Œnilæˆä¸ºwithçš„è¿”å›å€¼ã€‚ A Minor Gotcha: åœ¨è¡¨é¢ä¹‹ä¸‹ï¼Œwithè¢« Elixir è§†ä¸ºæ˜¯ä¸€ä¸ªå‡½æ•°æˆ–å®ï¼ˆmacroï¼‰çš„è°ƒç”¨ã€‚è¿™æ„å‘³ç€ä½ ä¸èƒ½è¿™æ ·å†™ï¼š mean = with             # WRONG!     count = Enum. count(values),     sum  = Enum. sum(values)    do    sum/count    endç›¸åï¼Œä½ å¯ä»¥æŠŠç¬¬ä¸€ä¸ªå‚æ•°å’Œwithå†™åœ¨åŒä¸€è¡Œï¼š mean = with count = Enum. count(values),      sum  = Enum. sum(values)    do    sum/count    endæˆ–è€…ä½¿ç”¨æ‹¬å·ï¼š mean = with (     count = Enum. count(values),     sum  = Enum. sum(values)    do    sum/count    end)å’Œå…¶ä»–doè¯­å¥ä¸€æ ·ï¼Œä¹Ÿæœ‰ç®€å†™æ–¹å¼å¯ç”¨ï¼š mean = with count = Enum. count(values),      sum  = Enum. sum(values)    do: sum/countEnd of the Basics: è‡³æ­¤æˆ‘ä»¬å·²ç»è®²å®Œäº† Elixir è¯­è¨€çš„åº•å±‚éƒ¨åˆ†ã€‚æ¥ä¸‹æ¥ä¸¤ç« é‡Œæˆ‘ä»¬å°†ä¼šè®¨è®ºå¦‚ä½•åˆ›å»ºåŒ¿åå‡½æ•°ã€æ¨¡å—å’Œå…·åå‡½æ•°ã€‚ "
    }, {
    "id": 49,
    "url": "/2020/07/programming-elixir-1-6-chapter-4-part1/",
    "title": "ã€ŠProgramming Elixir >= 1.6ã€‹ç¬¬å››ç« ï¼šåŸºæœ¬è¯­æ³•ï¼ˆèŠ‚é€‰ä¸€ï¼‰",
    "body": "2020/07/02 - å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­çš„å¸¸è§„è¯­æ³•ä»‹ç»åœ¨ã€ŠProgramming Elixir &gt;= 1. 6ã€‹é‡Œç›´åˆ°ç¬¬å››ç« æ‰ç»ˆäºå§—å§—æ¥è¿Ÿã€‚è¿™ä¸€ç« ä»‹ç»çš„æ˜¯ Elixir ä¸­å…¨éƒ¨çš„å„ç§å†…ç½®ç±»å‹ã€‚å‡½æ•°åœ¨ Elixir ä¸­ä¹Ÿæ˜¯ä¸€ç§ç±»å‹ï¼Œä½†ä¼šç”¨å•ç‹¬çš„ä¸€ç« æ¥ä¸“é—¨ä»‹ç»è€Œä¸åœ¨æœ¬ç« ä¹‹å†…ã€‚å‡ºäººæ„æ–™çš„æ˜¯ï¼Œå­—ç¬¦ä¸²å’Œç»“æ„ä½“ä¹Ÿä¸åœ¨æœ¬ç« é‡Œï¼Œå› ä¸ºå®ƒä»¬ä¸æ˜¯ Elixir çš„åŸºæœ¬ç±»å‹ï¼Œè€Œæ˜¯ç”±åŸºæœ¬ç±»å‹æ„æˆçš„é«˜çº§ç±»å‹ã€‚ ç”±äºæœ¬ç« æ¶µç›–å†…å®¹å¤ªå¤šï¼Œå› æ­¤è·Ÿå…¶ä»–è¯­è¨€ç±»ä¼¼çš„ä¸€äº›ç±»å‹å°±ä¸å‘å‡ºæ¥äº†ï¼Œæ¯”å¦‚æ•°å­—ã€æ­£åˆ™è¡¨è¾¾å¼ç­‰ï¼Œè€ŒåªèŠ‚é€‰äº†ä¸€äº› Elixir ç‰¹æœ‰çš„ç±»å‹ï¼Œæ¯”å¦‚å…ƒç»„ç­‰å‡ ç§é›†åˆç±»å‹ç­‰ã€‚æƒ³è¦äº†è§£ Elixir æ‰€æœ‰è¿™äº›åŸºæœ¬ç±»å‹çš„çŸ¥è¯†ï¼Œå¯ä»¥åœ¨å»æŸ¥é˜…å®˜æ–¹æ–‡æ¡£æˆ–è€…æœ¬ä¹¦è¯¥ç« èŠ‚çš„åŸæ–‡ã€‚ å³ä½¿ç»è¿‡ä¸Šè¿°èŠ‚é€‰ä¹‹åï¼Œæœ¬ç« çš„å†…å®¹è¿˜æ˜¯æ˜¾å¾—å¤ªé•¿äº†ï¼Œæ‰€ä»¥æˆ‘ä¸å¾—ä¸æŠŠå…¶åˆ†æˆä¸¤éƒ¨åˆ†å‘å‡ºã€‚è¿™æ˜¯èŠ‚é€‰çš„ç¬¬ä¸€éƒ¨åˆ†ã€‚ ã€ä¸‹é¢æ˜¯æ­£æ–‡ã€‘ 4. Elixir Basics: è¿™ä¸€ç« æˆ‘ä»¬å°†çœ‹çœ‹ Elixir ä¸­çš„ç±»å‹ï¼Œä»¥åŠå¼€å§‹æ—¶éœ€è¦äº†è§£çš„å…¶ä»–ä¸€äº›å†…å®¹ã€‚æœ¬ç« ç‰¹æ„å†™å¾—ä¸é•¿â€”â€”ä½œä¸ºä¸€åå¼€å‘è€…ä½ å½“ç„¶çŸ¥é“ä»€ä¹ˆæ˜¯æ•´æ•°ï¼Œæ‰€ä»¥æˆ‘ä¸ä¼šåœ¨è¿™äº›å°äº‹ä¸Šä¾®è¾±å¤§å®¶çš„æ™ºå•†ã€‚ç›¸åï¼Œæˆ‘ä¼šèŠä¸€äº› Elixir ä¸­ç‰¹åˆ«çš„ä¸œè¥¿ã€‚ Built-in Types: Elixir çš„å†…ç½®ç±»å‹æœ‰ï¼š  Value types:     Arbitrary-sized integersã€æ•´æ•°ã€‘   Floating-point numbersã€æµ®ç‚¹æ•°ã€‘   Atomsã€åŸå­ã€‘   Rangesã€èŒƒå›´ã€‘   Regular expressionsã€æ­£åˆ™è¡¨è¾¾å¼ã€‘    System types:     PIDs and ports   References    Collection types:     Tuplesã€å…ƒç»„ã€‘   Listsã€åˆ—è¡¨ã€‘   Mapsã€æ˜ å°„ã€‘   Binaries   å‡½æ•°ä¹Ÿæ˜¯ä¸€ç§ç±»å‹ã€‚ä¸‹ä¸€ç« ä¼šç”¨ä¸“é—¨çš„ç« èŠ‚æ¥è®²å®ƒã€‚ ä½ å¯èƒ½å¾ˆæƒŠè®¶ä¸Šé¢çš„åˆ—è¡¨ä¸­æ²¡æœ‰åŒ…å«è¯¸å¦‚å­—ç¬¦ä¸²å’Œç»“æ„ä½“è¿™æ ·çš„ä¸œè¥¿ã€‚Elixir æ˜¯æœ‰çš„ï¼Œä½†å®ƒä»¬æ˜¯ç”±ä¸Šè¿°åŸºæœ¬ç±»å‹æ¥æ„æˆã€‚å®ƒä»¬å…¨éƒ½å¾ˆé‡è¦ã€‚å­—ç¬¦ä¸²åŒæ ·æœ‰ä¸“é—¨çš„ç« èŠ‚è®²ï¼Œåˆ—è¡¨ï¼ˆlistï¼‰å’Œæ˜ å°„ï¼ˆmapï¼‰æœ‰å¥½å‡ ç« æ¥è®²ï¼ˆåŒ…æ‹¬å…¶ä»–ç±»ä¼¼å­—å…¸çš„ç±»å‹ï¼‰ã€‚æ˜ å°„é‚£ä¸€ç« ä¹Ÿä¼šè®²åˆ° Elixir çš„ç»“æ„ä½“ã€‚ æœ€åï¼Œå…³äºæ­£åˆ™è¡¨è¾¾å¼ï¼ˆRegular expressionï¼‰å’ŒèŒƒå›´ï¼ˆRangeï¼‰æ˜¯å¦æ˜¯å€¼ç±»å‹è¿˜æœ‰äº›äº‰è®®ã€‚ä»æŠ€æœ¯ä¸Šè®²ï¼Œå®ƒä»¬ä¸æ˜¯â€”â€”è¡¨è±¡ä¹‹ä¸‹å®ƒä»¬éƒ½åªæ˜¯ç»“æ„ä½“ã€‚ä½†å½“å‰æŠŠå®ƒä»¬çœ‹ä½œæ˜¯ä¸åŒçš„ç±»å‹ä¼šæ›´æ–¹ä¾¿ã€‚ Value Types: Elixir çš„å€¼ç±»å‹æŒ‡çš„æ˜¯æ•°å­—ï¼ˆnumberï¼‰ã€åŸå­ï¼ˆatomï¼‰ã€èŒƒå›´ï¼ˆrangeï¼‰å’Œæ­£åˆ™è¡¨è¾¾å¼ï¼ˆregular expressionï¼‰ã€‚ â€¦â€¦èŠ‚ç•¥â€¦â€¦ Atomsã€åŸå­ã€‘: åŸå­æ˜¯ä»£è¡¨æŸäº‹ç‰©åç§°çš„å¸¸é‡ã€‚å®ƒä»¥ä¸€ä¸ªå†’å·:å¼€å¤´ï¼Œåé¢è·Ÿä¸€ä¸ªåŸå­å•è¯æˆ– Elixir æ“ä½œç¬¦ã€‚åŸå­å•è¯ç”±ä¸€ç³»åˆ—UTF-8å­—æ¯ï¼ˆåŒ…æ‹¬ç»„åˆæ ‡è®°ï¼‰ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œç¬¦å·ï¼ˆ@ï¼‰æ„æˆã€‚å®ƒèƒ½ä»¥æ„Ÿå¹å·æˆ–é—®å·ç»“å°¾ã€‚ä½ è¿˜å¯ä»¥é€šè¿‡æŠŠå†’å·åçš„å­—ç¬¦ç”¨åŒå¼•å·æ‹¬èµ·æ¥ä»¥åˆ›å»ºåŒ…å«ä»»æ„å­—ç¬¦çš„åŸå­ã€‚ä¸‹é¢è¿™äº›éƒ½æ˜¯åˆæ³•çš„åŸå­ï¼š :fred :is_binary? :var@2 :&lt;&gt; :=== : func/3  : long john silver  :ÑĞ»Ğ¸ĞºÑĞ¸Ñ€ :mÃ¶tley_crÃ¼eåŸå­çš„åç§°å°±æ˜¯å®ƒçš„å€¼ã€‚ä¸¤ä¸ªç›¸åŒåç§°çš„åŸå­åœ¨æ¯”è¾ƒæ—¶å§‹ç»ˆä¼šè¢«çœ‹ä½œç›¸ç­‰çš„ï¼Œå³ä½¿å®ƒä¿©æ˜¯ç”±è¿œéš”é‡æ´‹çš„ä¸¤å°ç”µè„‘ä¸Šçš„ä¸åŒåº”ç”¨ç¨‹åºæ‰€åˆ›å»ºã€‚ æˆ‘ä»¬ä¼šæŠŠåŸå­ç”¨åœ¨éå¸¸å¤šçš„æ ‡è®°å€¼ï¼ˆtag valueï¼‰ä¸Šã€‚ â€¦â€¦èŠ‚ç•¥â€¦â€¦ Collection Types: åˆ°ä¸Šé¢ä¸ºæ­¢æˆ‘ä»¬çœ‹åˆ°çš„ç±»å‹åœ¨å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­å¾ˆå¸¸è§ã€‚ ç°åœ¨èµ·ä¼šå¼€å§‹çœ‹åˆ°æ›´å¤šç‹¬ç‰¹çš„ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥ä¸‹æ¥è¦è¯¦ç»†ä»‹ç»ã€‚ Elixir é›†åˆå¯ä»¥åŒ…å«ä»»ä½•ç±»å‹çš„å€¼ï¼ˆåŒ…æ‹¬ä½¿ç”¨å…¶ä»–é›†åˆï¼‰ã€‚ Tuplesã€å…ƒç»„ã€‘: å…ƒç»„æ˜¯æœ‰åºçš„å€¼çš„é›†åˆã€‚è·Ÿæ‰€æœ‰ Elixir çš„æ•°æ®ç»“æ„ä¸€æ ·ï¼Œå…ƒç»„ä¸€æ—¦åˆ›å»ºå³ä¸å¯æ”¹å˜ã€‚ å…ƒç»„å†™åœ¨å¤§æ‹¬å·ä¸­ï¼Œå…ƒç´ ç”¨é€—å·åˆ†éš”ã€‚ { 1, 2 } { :ok, 42,  next  } { :error, :enoent }ä¸€èˆ¬è€Œè¨€ Elixir çš„å…ƒç»„åŒ…å«äºŒè‡³å››ä¸ªå…ƒç´ â€”â€”æ›´å¤šçš„è¯ä½ å¯èƒ½åº”è¯¥å»çœ‹çœ‹mapæˆ–è€…structã€‚ å¯ä»¥æŠŠå…ƒç»„ç”¨åœ¨æ¨¡å¼åŒ¹é…ä¸­ï¼š iex&gt; {status, count, action} = {:ok, 42,  next }{:ok, 42,  next }iex&gt; status:okiex&gt; count42iex&gt; action next åœ¨å‡½æ•°ä¸­ï¼Œå½“æ²¡æœ‰é”™è¯¯æ—¶ï¼Œè¿”å›ä¸€ä¸ªé¦–å…ƒç´ ä¸ºåŸå­:okçš„å…ƒç»„æ˜¯å¾ˆå¸¸è§çš„äº‹ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼ˆå‡è®¾ä½ å½“å‰ç›®å½•ä¸­æœ‰ä¸€ä¸ªåä¸ºmix. exsçš„æ–‡ä»¶ï¼‰ï¼š iex&gt; {status, file} = File. open( mix. exs ){:ok, #PID&lt;0. 39. 0&gt;}å› ä¸ºæ–‡ä»¶æ‰“å¼€æˆåŠŸï¼Œæ‰€ä»¥å…ƒç»„åŒ…å«ä¸€ä¸ª:okçš„çŠ¶æ€å’Œä¸€ä¸ªå¯ç”¨äºè®¿é—®æ–‡ä»¶å†…å®¹çš„ PIDã€‚ ä¸€ä¸ªå¸¸è§çš„åšæ³•æ˜¯å†™ä¸€ä¸ªé¢„è®¾æˆåŠŸçš„åŒ¹é…ï¼š iex&gt; { :ok, file } = File. open( mix. exs ){:ok, #PID&lt;0. 39. 0&gt;}iex&gt; { :ok, file } = File. open( non-existent-file )** (MatchError) no match of right hand side value: {:error, :enoent}æ‰“å¼€ç¬¬äºŒä¸ªæ–‡ä»¶å¤±è´¥ï¼Œè¿”å›å…ƒç»„çš„é¦–å…ƒç´ æ˜¯:errorã€‚è¿™ä½¿å¾—åŒ¹é…å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯è¡¨æ˜ç¬¬äºŒä¸ªå…ƒç´ åŒ…å«äº†å¤±è´¥åŸå› â€”â€”enoentæ˜¯ Unix ä¸­â€æ–‡ä»¶ä¸å­˜åœ¨â€çš„æ„æ€ã€‚ Listsã€åˆ—è¡¨ã€‘: æˆ‘ä»¬å·²ç»è§è¿‡äº† Elixir çš„åˆ—è¡¨å­—é¢é‡è¯­æ³•[1, 2, 3]ã€‚ä½ å› æ­¤å¯èƒ½ä¼šè®¤ä¸ºåˆ—è¡¨å’Œå…¶ä»–è¯­è¨€ä¸­çš„æ•°ç»„å¾ˆåƒï¼Œä½†å¹¶ä¸æ˜¯ã€‚ï¼ˆå®é™…ä¸Šï¼Œå…ƒç»„æ‰æ˜¯ Elixir ä¸­è·Ÿæ•°ç»„æœ€æ¥è¿‘çš„ï¼‰ç›¸åï¼Œåˆ—è¡¨å®é™…ä¸Šæ˜¯é“¾è¡¨çš„æ•°æ®ç»“æ„ã€‚       åˆ—è¡¨çš„å®šä¹‰         åˆ—è¡¨å¯ä»¥æ˜¯ç©ºçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤´éƒ¨å’Œå°¾éƒ¨ã€‚ å¤´éƒ¨åŒ…å«ä¸€ä¸ªå€¼ï¼Œå°¾éƒ¨æœ¬èº«å°±æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚   ï¼ˆå¦‚æœä½ ç”¨è¿‡ Lisp è¯­è¨€ï¼Œä¼šçœ‹åˆ°äºŒè€…å¾ˆåƒã€‚ï¼‰ åé¢åœ¨ã€ŠLists and Recursionã€‹ç« ä¸­ä¼šè®²åˆ°ï¼Œåˆ—è¡¨çš„é€’å½’å®šä¹‰æ˜¯ Elixir ç¼–ç¨‹çš„æ ¸å¿ƒã€‚ å¤„äºå…¶å®ç°æ–¹å¼ï¼Œåˆ—è¡¨å¾ˆå®¹æ˜“çº¿æ€§éå†ï¼Œä½†æ˜¯ä»¥éšæœºé¡ºåºè®¿é—®å®ƒä»¬åˆ™ä»£ä»·æ˜‚è´µã€‚ï¼ˆè¦è·å–ç¬¬ n ä¸ªå…ƒç´ ï¼Œå¿…é¡»è¦æ‰«æ n - 1 ä¸ªå‰é¢çš„å…ƒç´ ã€‚ï¼‰è·å–åˆ—è¡¨çš„å¤´éƒ¨å¹¶æå–å°¾éƒ¨åˆ™æ€»æ˜¯å¼€é”€å¾ˆå°çš„ã€‚ åˆ—è¡¨è¿˜æœ‰ä¸€ä¸ªæ€§èƒ½ç‰¹å¾ã€‚è¿˜è®°å¾—æˆ‘ä»¬è¯´è¿‡æ‰€æœ‰çš„ Elixir æ•°æ®ç»“æ„éƒ½æ˜¯ä¸å¯å˜çš„å—ï¼Ÿè¿™æ„å‘³ä¸€ä¸ªåˆ—è¡¨ä¸€æ—¦è¢«åˆ›å»ºå°±æ°¸ä¸å¯å˜ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬è¦ç§»é™¤å…¶å¤´éƒ¨ï¼Œä¿ç•™å°¾éƒ¨ï¼Œä¸å¿…æ‹·è´è¿™ä¸ªåˆ—è¡¨ï¼Œç›¸åå¯ä»¥è¿”å›ä¸€ä¸ªæŒ‡å‘å°¾éƒ¨çš„æŒ‡é’ˆã€‚è¿™æ˜¯å°†åœ¨ç¬¬ 7 ç« ã€ŠLists and Recursionã€‹ä¸­ä»‹ç»çš„æ‰€æœ‰åˆ—è¡¨éå†æŠ€å·§çš„åŸºç¡€ã€‚ Elixir å¯¹äºåˆ—è¡¨æœ‰ä¸€äº›ç‰¹åˆ«çš„æ“ä½œç¬¦ï¼š iex&gt; [1,2,3] ++ [4,5,6][1, 2, 3, 4, 5, 6]iex&gt; [1, 2, 3, 4] -- [2, 4][1, 3]iex&gt; 1 in [1,2,3,4]trueiex&gt;  wombat  in [1, 2, 3, 4]falseKeyword Listsã€å…³é”®å­—åˆ—è¡¨ã€‘ç”±äºæˆ‘ä»¬ç»å¸¸éœ€è¦é”®å€¼å¯¹çš„ç®€å•åˆ—è¡¨ï¼ŒElixir æä¾›äº†ä¸€ç§å¿«æ·æ–¹å¼ã€‚å¦‚æœæˆ‘ä»¬è¿™æ ·å†™ï¼š [ name:  Dave , city:  Dallas , likes:  Programming  ]Elixir ä¼šæŠŠå®ƒè½¬æ¢æˆä»¥äºŒå…ƒå…ƒç»„ä½œä¸ºå…ƒç´ çš„åˆ—è¡¨ï¼š [ {:name,  Dave }, {:city,  Dallas }, {:likes,  Programming } ]è€Œä¸”ï¼Œå½“ä¸€ä¸ªå…³é”®å­—åˆ—è¡¨ä½œä¸ºå‡½æ•°æœ€åä¸€ä¸ªå‚æ•°æ—¶ï¼ŒElixir å…è®¸æˆ‘ä»¬ä¸å†™ä¸­æ‹¬å·ã€‚ DB. save record, [ {:use_transaction, true}, {:logging,  HIGH } ]ä¸Šé¢çš„ä»£ç å¯ä»¥ç®€å†™æˆï¼š DB. save record, use_transaction: true, logging:  HIGH åœ¨ä»»ä½•é¢„æœŸå¾—åˆ°ä¸€ä¸ªå€¼çš„åˆ—è¡¨çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå¦‚æœå…³é”®å­—åˆ—è¡¨æ˜¯å…¶æœ€åä¸€é¡¹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸è¦æ‹¬å·ã€‚ iex&gt; [1, fred: 1, dave: 2][1, {:fred, 1}, {:dave, 2}]iex&gt; {1, fred: 1, dave: 2}{1, [fred: 1, dave: 2]}Mapsã€æ˜ å°„ã€‘: æ˜ å°„æ˜¯é”®å€¼å¯¹çš„é›†åˆã€‚æ˜ å°„å­—é¢é‡åƒè¿™æ ·ï¼š %{ key =&gt; value, key =&gt; value }ä¸‹é¢æ˜¯ä¸€äº›ç¤ºä¾‹ï¼š iex&gt; states = %{  AL  =&gt;  Alabama ,  WI  =&gt;  Wisconsin  }%{ AL  =&gt;  Alabama ,  WI  =&gt;  Wisconsin }iex&gt; responses = %{ { :error, :enoent } =&gt; :fatal, { :error, :busy } =&gt; :retry }%{{:error, :busy} =&gt; :retry, {:error, :enoent} =&gt; :fatal}iex&gt; colors = %{ :red =&gt; 0xff0000, :green =&gt; 0x00ff00, :blue =&gt; 0x0000ff }%{blue: 255, green: 65280, red: 16711680}ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œé”®æ˜¯å­—ç¬¦ä¸²ã€‚ç¬¬äºŒä¸ªçš„æ˜¯å…ƒç»„ï¼Œç¬¬ä¸‰ä¸ªçš„æ˜¯åŸå­ã€‚å°½ç®¡ä¸€ä¸ªæ˜ å°„çš„æ‰€æœ‰é”®é€šå¸¸éƒ½ä¼šæ˜¯ç›¸åŒçš„ç±»å‹ï¼Œä½†è¿™å¹¶éå¿…é¡»ã€‚ iex&gt; %{  one  =&gt; 1, :two =&gt; 2, {1,1,1} =&gt; 3 }%{:two =&gt; 2, {1, 1, 1} =&gt; 3,  one  =&gt; 1}å¦‚æœé”®æ˜¯åŸå­ï¼Œä½ å¯ä»¥ä½¿ç”¨å’Œå…³é”®å­—åˆ—è¡¨ç›¸åŒçš„ç®€å†™æ–¹å¼ï¼š iex&gt; colors = %{ red: 0xff0000, green: 0x00ff00, blue: 0x0000ff }%{blue: 255, green: 65280, red: 16711680}ä½ ä¹Ÿèƒ½åœ¨æ˜ å°„çš„é”®ä¸­ä½¿ç”¨è¡¨è¾¾å¼ï¼š iex&gt; name =  JosÃ© Valim  JosÃ© Valim iex&gt; %{ String. downcase(name) =&gt; name }%{ josÃ© valim  =&gt;  JosÃ© Valim }ä¸ºä»€ä¹ˆæˆ‘ä»¬åŒæ—¶æ‹¥æœ‰æ˜ å°„å’Œå…³é”®å­—åˆ—è¡¨ï¼Ÿæ˜ å°„åªå…è®¸é”®æ˜¯å”¯ä¸€çš„ï¼Œè€Œå…³é”®å­—åˆ—è¡¨çš„é”®å¯ä»¥é‡å¤ã€‚æ˜ å°„æ˜¯é«˜æ•ˆçš„ï¼ˆç‰¹åˆ«æ˜¯å½“å…¶å†…å®¹å¢é•¿æ—¶ï¼‰ï¼Œè€Œä¸”è¿˜å¯ç”¨äº Elixir çš„æ¨¡å¼åŒ¹é…ä¸­ï¼Œè¿™ä¸ªåç»­ç« èŠ‚ä¸­ä¼šè®¨è®ºåˆ°ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨å…³é”®å­—åˆ—è¡¨æ¥æ‰§è¡Œå‘½ä»¤è¡Œå‚æ•°å’Œä¼ é€’é€‰é¡¹ç­‰æ“ä½œï¼Œåœ¨éœ€è¦å…³è”æ•°ç»„æ—¶ä½¿ç”¨æ˜ å°„ã€‚ Accessing a Map: ä½ é€šè¿‡æ˜ å°„çš„é”®æ¥è·å–å€¼ã€‚ä¸­æ‹¬å·çš„è¯­æ³•é€‚ç”¨äºæ‰€æœ‰æ˜ å°„ï¼š iex&gt; states = %{  AL  =&gt;  Alabama ,  WI  =&gt;  Wisconsin  }%{ AL  =&gt;  Alabama ,  WI  =&gt;  Wisconsin }iex&gt; states[ AL ] Alabama iex&gt; states[ TX ]niliex&gt; response_types = %{ { :error, :enoent } =&gt; :fatal,. . . &gt; { :error, :busy } =&gt; :retry }%{{:error, :busy} =&gt; :retry, {:error, :enoent} =&gt; :fatal}iex&gt; response_types[{:error,:busy}]:retryå¦‚æœé”®æ˜¯åŸå­ï¼Œå¯ä»¥ä½¿ç”¨ç‚¹å·è¡¨ç¤ºæ³•ï¼š iex&gt; colors = %{ red: 0xff0000, green: 0x00ff00, blue: 0x0000ff }%{blue: 255, green: 65280, red: 16711680}iex&gt; colors[:red]16711680iex&gt; colors. green65280å½“ä½¿ç”¨ç‚¹å·è¡¨ç¤ºæ³•æ—¶ï¼Œå¦‚æœæ²¡æœ‰å¯¹åº”çš„é”®å°±ä¼šå¾—åˆ°ä¸€ä¸ª KeyError çš„é”™è¯¯ã€‚ ã€å¾…ç»­ã€‘ "
    }, {
    "id": 50,
    "url": "/2020/07/programming-elixir-1-6-chapter-3/",
    "title": "ã€ŠProgramming Elixir >= 1.6ã€‹ç¬¬ä¸‰ç« ï¼šä¸å¯å˜æ€§",
    "body": "2020/07/01 - ã€ŠProgramming Elixir &gt;= 1. 6ã€‹ç¬¬ä¸‰ç« ä»‹ç»äº† Elixir çš„å¦ä¸€å—åŸºçŸ³ï¼Œä¸å¯å˜æ€§ï¼ˆImmutabilityï¼‰ã€‚æˆ‘é˜…è¯»æœ¬ä¹¦ä¹‹åçš„ä¸ªäººä½“ä¼šæ˜¯ï¼ŒElixir ä¸€å…±æœ‰ä¸‰å¤§åŸºçŸ³ï¼šæ¨¡å¼åŒ¹é…ã€ä¸å¯å˜æ€§å’Œ OTPï¼Œä»¥è¿™ä¸‰å—åŸºçŸ³ä¸ºåº•ï¼ŒJosÃ© Valimï¼ˆElixir çš„åˆ›å»ºè€…ã€‚ä»–çš„åå­—æ˜¯è‘¡è„ç‰™è¯­ï¼Œåº”è¯»ä½œï¼šä½•å¡Â·ç“¦é‡Œå§†ï¼‰æ„å»ºèµ·äº†æ•´ä¸ªè¯­è¨€çš„å®ä¼Ÿå¤§å¦ã€‚ Dave Thomas åŒæ ·è®¤è¯†åˆ°äº†è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥ç´§æ¥ç€å‰ä¸€ç« è¯´å®Œæ¨¡å¼åŒ¹é…ï¼Œè¿™ä¸€ç« å°±é©¬ä¸Šå¯¹ä¸å¯å˜æ€§è¿›è¡Œæè¿°ï¼Œè€Œä¸æ˜¯å¼€å§‹å †ç Œå¸¸è§„è¯­æ³•çš„è¯´æ˜ã€‚å› ä¸ºå‰ä¸¤è€…æ˜¯ Elixir åŸºç¡€ç¼–ç¨‹çš„åŸºçŸ³ï¼Œè€Œ OTP æ˜¯ Elixir å¹¶å‘ç¼–ç¨‹çš„åŸºçŸ³ã€‚ç†è§£äº†æ¨¡å¼åŒ¹é…å’Œä¸å¯å˜æ€§ï¼Œå†çœ‹åç»­çš„åŸºç¡€è¯­æ³•æ—¶å¾ˆå¤šåœ°æ–¹æ‰èƒ½èä¼šè´¯é€šï¼Œå¦åˆ™å°±ä¼šä¸€å¤´é›¾æ°´ï¼šOOé‡Œä¸æ˜¯è¿™æ ·çš„å•Šï¼Ÿ æ¥çœ‹ä¸€ä¸‹ Dave Thomas å¯¹ Elixir çš„ä¸å¯å˜æ€§æ˜¯å¦‚ä½•ä»‹ç»çš„å§ã€‚ ã€ä¸‹é¢æ˜¯æ­£æ–‡ã€‘ 3. Immutability: å¦‚æœä½ å¬è¯´è¿‡å‡½æ•°å¼ç¼–ç¨‹ç‹‚çƒ­çˆ±å¥½è€…ï¼Œé‚£ä½ åº”è¯¥çŸ¥é“äººä»¬é’ˆå¯¹ä¸å¯å˜æ€§åšäº†å¤§é‡å·¥ä½œâ€”â€”äº‹å®ä¸Šå¯¹äºä¸€é—¨å‡½æ•°å¼è¯­è¨€ï¼Œæ•°æ®ä¸€æ—¦åˆ›å»ºå°±ä¸å¯è¢«æ›´æ”¹ã€‚ ç¡®å®ï¼ŒElixir å¼ºåˆ¶å®è¡Œäº†ä¸å¯å˜æ•°æ®ã€‚ ä¸ºä»€ä¹ˆï¼Ÿ You Already Have (Some) Immutable Data: å…ˆå¿˜æ‰ Elixir ä¸€ä¼šå„¿ã€‚æƒ³ä¸€æƒ³ä½ ç°åœ¨é€‰ç”¨çš„ç¼–ç¨‹è¯­è¨€ï¼Œå‡è®¾ä½ å†™äº†è¿™æ ·çš„ä»£ç ï¼š count = 99do_something_with(count)print(count)ä½ æœŸæœ›è¾“å‡ºç»“æœ 99ã€‚å½“å®ƒæ²¡æœ‰è¿™æ ·è¾“å‡ºæ—¶ä½ ä¼šå¾ˆåƒæƒŠã€‚åœ¨ä½ å¿ƒä¸­ï¼Œ99 å°±åº”è¯¥ä¸€ç›´æ˜¯ 99ã€‚ ç°åœ¨ï¼Œä½ å½“ç„¶èƒ½ç»‘å®šä¸€ä¸ªæ–°çš„å€¼åˆ°ä½ çš„å˜é‡ï¼Œä½†è¿™ä¸èƒ½æ”¹å˜ 99 å°±æ˜¯ 99 çš„äº‹å®ã€‚ æƒ³è±¡ä¸€ä¸‹ï¼Œä½ åˆ°äº†ä¸€ä¸ªæ— æ³•å€¼å¾—ä¾èµ–çš„è¯­è¨€ä¸–ç•Œä¸­ç¼–ç¨‹â€”â€”åœ¨è¿™é‡Œï¼Œä½ çš„ä¸€äº›ä»£ç å¯èƒ½åœ¨å¤šå¤„åŒæ—¶è¿è¡Œï¼Œä¸”èƒ½æ”¹å˜ 99 çš„å€¼ã€‚å‡½æ•°do_something_withåœ¨åå°è¢«è°ƒç”¨ç€ï¼Œ99 ä½œä¸ºå‚æ•°è¢«ä¼ é€’è¿›å»ã€‚è€Œä¼ é€’è¿‡å»çš„å‚æ•°å†…å®¹èƒ½è¢«æ”¹å˜ã€‚çªç„¶é—´ï¼Œ99 å˜æˆäº† 100ã€‚ ä½ å½»åº•æ··ä¹±äº†ï¼ˆç†æ‰€å½“ç„¶ï¼‰ã€‚æ›´ç³Ÿçš„æ˜¯ï¼Œä½ æ— æ³•å†ä¿è¯è‡ªå·±çš„ä»£ç ä¸€å®šèƒ½å¾—åˆ°æ­£ç¡®çš„è¿è¡Œç»“æœäº†ã€‚ è¿˜æ˜¯ä½ ä¸Šé¢çš„è¯­è¨€ï¼Œçœ‹ä¸‹è¿™ä¸ªï¼š array = [ 1, 2, 3 ]do_something_with(array)print(array)å’Œå‰é¢ä¸€æ ·ï¼Œä½ è¿˜æ˜¯æœŸæœ›printæ–¹æ³•è¾“å‡º[1, 2, 3]ã€‚ä½†å¾ˆå¤šè¯­è¨€ä¸­ï¼Œdo_something_withä¼šæŠŠæ¥æ”¶çš„ array ä½œä¸ºæŒ‡é’ˆã€‚å½“å®ƒæ”¹å˜ç¬¬äºŒä¸ªå…ƒç´ æˆ–è€…å®Œå…¨åˆ é™¤å†…å®¹æ—¶ï¼Œè¾“å‡ºå°†ä¸å†ç¬¦åˆä½ çš„æœŸæœ›ã€‚è¿™æ ·çœ‹ä½ çš„ä»£ç ä»¥åŠå®ƒåšäº†ä»€ä¹ˆå°±æ›´å›°éš¾äº†ã€‚ å†è¿›ä¸€æ­¥â€”â€”åœ¨å¤šä¸ªçº¿ç¨‹ï¼Œä¸”æ¯ä¸ªéƒ½èƒ½è®¿é—®è¯¥ array çš„æƒ…å†µä¸‹ï¼Œè°èƒ½çŸ¥é“å…¨éƒ¨çº¿ç¨‹éƒ½å¼€å§‹ä¿®æ”¹æ“ä½œåè¿™ä¸ª array çš„çŠ¶æ€ä¼šæ€æ ·ï¼Ÿ å¯¼è‡´æ‰€æœ‰è¿™äº›é—®é¢˜çš„åŸå› å°±åœ¨äºå¾ˆå¤šè¯­è¨€ä¸­çš„å¤åˆæ•°æ®ç»“æ„éƒ½æ˜¯å¯å˜çš„â€”â€”ä½ å¯ä»¥ä¿®æ”¹å…¶å…¨éƒ¨æˆ–éƒ¨åˆ†çš„å†…å®¹ã€‚å½“ä½ çš„ä»£ç ä¼šåœ¨å¤šå¤„åŒæ—¶å»æ“ä½œæ•°æ®æ—¶ï¼Œæ‚²å‰§å°±äº§ç”Ÿäº†ã€‚ å·§åˆçš„æ˜¯ï¼Œåœ¨æˆ‘æ’°å†™æœ¬ç« çš„é‚£å¤©ï¼ŒJessica Kerr (@jessitron) æ°å¥½å‘æ¨è¯´ï¼š  GOTO was evil because we asked, â€œhow did I get to this point of execution?â€ Mutability leaves us with, â€œhow di I get to this state?â€ è¯´å¾—å¯¹æäº†ã€‚ Immutable Data Is Known Data: Elixir é¿å¼€äº†è¿™äº›é—®é¢˜ã€‚Elixir ä¸­ï¼Œæ‰€æœ‰çš„å€¼éƒ½æ˜¯ä¸å¯å˜çš„ã€‚å³ä½¿æ˜¯ç‰¹åˆ«å¤æ‚çš„åµŒå¥—åˆ—è¡¨ï¼ˆlistï¼‰ã€æ•°æ®åº“è®°å½•â€”â€”éƒ½è·Ÿæœ€ç®€å•çš„æ•´æ•°ä¸€æ ·ï¼Œå…¨éƒ½ä¸å¯å˜ã€‚ åœ¨ Elixir ä¸­ï¼Œä¸€æ—¦ä¸€ä¸ªå˜é‡æŒ‡å‘äº†ä¸€ä¸ªåˆ—è¡¨ï¼ˆlistï¼‰ï¼Œå¦‚[1, 2, 3]ï¼Œä½ å°±èƒ½ç¡®ä¿¡å®ƒæ€»æ˜¯æŒ‡åŒæ ·çš„å€¼ï¼Œé™¤éä½ é‡æ–°ç»‘å®šå®ƒåˆ°å…¶ä»–ã€‚è¿™å°±è®©å¹¶å‘çš„å¤„ç†ä¸ä¼šå†æ˜¯å›°æ‰°äº†ã€‚ é‚£ä¹ˆå¦‚ä½•æŠŠ 100 åŠ åˆ°[1, 2, 3]çš„æ¯ä¸ªå…ƒç´ ä¸Šå‘¢ï¼ŸElixir é€šè¿‡äº§ç”Ÿä¸€ä¸ªåˆå§‹å¯¹è±¡çš„æ‹·è´å¹¶åŒ…å«æ–°çš„å€¼æ¥å®ç°ã€‚åˆå§‹å¯¹è±¡ä¿æŒä¸å˜ï¼Œè¿™æ ·åˆšæ‰çš„æ“ä½œä¸ä¼šå½±å“åˆ°ä»»ä½•ä½¿ç”¨è¯¥åˆå§‹å¯¹è±¡çš„ä»£ç ã€‚ è¿™å®Œç¾å¥‘åˆäº†ç¼–ç¨‹å°±æ˜¯å…³äºæ•°æ®è½¬æ¢çš„æ€æƒ³ã€‚å½“æˆ‘ä»¬ä¿®æ”¹[1, 2, 3]æ—¶ï¼Œå¹¶ä¸ç›´æ¥ä¿®æ”¹ï¼Œè€Œæ˜¯æŠŠå®ƒè½¬æ¢ä¸ºæ–°çš„æ•°æ®ã€‚ Performance Implications of Immutability: å¾ˆå®¹æ˜“å°±ä¼šè®¤å®šè¿™ç§æ–¹å¼æ•ˆç‡ä½ä¸‹ã€‚æ¯•ç«Ÿï¼Œä»»ä½•æƒ…å†µä¸‹ä½ åªè¦ä¿®æ”¹æ•°æ®å°±å¿…é¡»åˆ›å»ºä¸€ä»½å®ƒçš„æ‹·è´ï¼Œè€Œä¸”ä¼šç•™ä¸‹å¤ªå¤šæ—§æ•°æ®ä½œä¸ºåƒåœ¾å›æ”¶ã€‚é‚£ä¹ˆæˆ‘ä»¬æ¥ä¾æ¬¡çœ‹ä¸€ä¸‹ã€‚ Copying Data: å°½ç®¡ä¸€èˆ¬éƒ½è®¤ä¸ºæ•°æ®æ‹·è´æ˜¯æ•ˆç‡ä½ä¸‹çš„ï¼Œä½†è¿™é‡Œæ°æ°ç›¸åã€‚å› ä¸º Elixir çŸ¥é“ç°æœ‰æ•°æ®ä¸å¯å˜ï¼Œæ‰€ä»¥åœ¨æ„å»ºæ–°ç»“æ„æ—¶ï¼Œå°±èƒ½éƒ¨åˆ†æˆ–æ•´ä½“çš„é‡ç”¨å®ƒã€‚ æ¥çœ‹ä¸‹é¢çš„ä»£ç ã€‚ï¼ˆå®ƒä½¿ç”¨äº†ä¸€ä¸ªæ–°æ“ä½œç¬¦ï¼Œ[head|tail]ï¼Œç”¨æ¥ç”Ÿæˆä¸€ä¸ªæ–°åˆ—è¡¨ã€‚headä½œä¸ºå…¶ç¬¬ä¸€å…ƒç´ ï¼Œtailä½œä¸ºä½™ä¸‹çš„å…ƒç´ ã€‚æˆ‘ä»¬åé¢ä¼šç”¨ä¸€æ•´ç« æ¥è®²åˆ—è¡¨å’Œé€’å½’ã€‚è¿™é‡Œå…ˆç›´æ¥ç”¨å¥½äº†ã€‚ï¼‰ iex&gt; list1 = [ 3, 2, 1 ][3, 2, 1]iex&gt; list2 = [ 4 | list1 ][4, 3, 2, 1]å¾ˆå¤šè¯­è¨€ä¸­ï¼Œlist2 ä¼šé€šè¿‡åˆ›å»ºä¸€ä¸ªåŒ…å« 4ï¼Œ3ï¼Œ2ï¼Œ1 çš„æ–°åˆ—è¡¨æ¥å¾—åˆ°ã€‚list1 ä¸­çš„ä¸‰ä¸ªå…ƒç´ ä¼šè¢«å¤åˆ¶åˆ° list2 çš„å°¾éƒ¨ã€‚å› ä¸º list1 å¯å˜ï¼Œæ‰€ä»¥è¿™æ˜¯å¿…é¡»çš„ã€‚ ä½†æ˜¯ Elixir çŸ¥é“ list1 æ°¸ä¸æ”¹å˜ï¼Œæ‰€ä»¥å®ƒåªéœ€è¦ç®€å•åœ°æ„å»ºä¸€ä¸ªå¤´éƒ¨ä¸º 4 å’Œå°¾éƒ¨ä¸º list1 çš„æ–°åˆ—è¡¨å°±è¡Œäº†ã€‚ Garbage Collection: å¦ä¸€ä¸ªå…³äºæ•°æ®è½¬æ¢å¼è¯­è¨€æ€§èƒ½çš„è¯Ÿç—…æ˜¯ï¼Œå½“ä½ ä»æ—§æ•°æ®åˆ›å»ºæ–°æ•°æ®æ—¶ï¼ˆæ‹·è´æ–¹å¼ï¼‰ï¼Œç»å¸¸ä¼šé—ç•™ä¸‹ä¸å†ä½¿ç”¨çš„æ—§æ•°æ®ã€‚è¿™ä¼šç•™ä¸‹å¤ªå¤šä¸œè¥¿åœ¨å†…å­˜å †æ ˆä¸­ï¼Œè€Œä¸å¾—ä¸è®©åƒåœ¾å›æ”¶å™¨å»å¤„ç†å®ƒä»¬ã€‚ å¾ˆå¤šç°ä»£è¯­è¨€éƒ½æœ‰åƒåœ¾å›æ”¶å™¨ï¼Œè€Œå¼€å‘è€…ä»¬è¶Šæ¥è¶Šæ€€ç–‘å…¶ä½œç”¨â€”â€”å®ƒä»¬ä¼šåœ¨èƒŒåæ‚„æ‚„åœ°å½±å“æ€§èƒ½ã€‚ ç„¶è€Œ Elixir å‰å®³çš„åœ°æ–¹åœ¨äºï¼Œä½ å¯ä»¥åœ¨ä»£ç ä¸­ç”¨å¾ˆå¤šå¾ˆå¤šçš„è¿›ç¨‹ï¼Œè€Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„å†…å­˜å †æ ˆã€‚ç¨‹åºçš„æ•°æ®åœ¨è¿™äº›è¿›ç¨‹ä¸­æ˜¯åˆ†å¼€çš„ï¼Œæ‰€ä»¥æ¯ä¸ªå †æ ˆéƒ½éå¸¸éå¸¸å°ï¼Œè¿œæ¯”æŠŠå…¨éƒ¨æ•°æ®æ”¾åœ¨ä¸€ä¸ªå¤§çš„å†…å­˜å †æ ˆä¸­è¦å°ã€‚ç»“æœå°±æ˜¯ï¼Œåƒåœ¾å›æ”¶å™¨è¿è¡Œæ›´å¿«ã€‚å¦‚æœä¸€ä¸ªè¿›ç¨‹åœ¨å®ƒçš„å †æ ˆæ»¡äº†ä¹‹å‰å°±ç»ˆæ­¢ï¼Œå…¶æ‰€æœ‰æ•°æ®è¢«ä¸¢å¼ƒâ€”â€”é‚£ç”šè‡³æ ¹æœ¬éƒ½ä¸éœ€è¦åƒåœ¾å›æ”¶å™¨äº†ã€‚ Coding with Immutable Data: ä¸€æ—¦ä½ æ¥å—äº†è¿™ä¸ªæ¦‚å¿µï¼Œé‚£ä¹ˆä»¥ä¸å¯å˜æ•°æ®æ¥ç¼–ç¨‹ä¼šç®€å•çš„å‡ºå¥‡ã€‚ä½ åªéœ€è¦è®°ä½ä»»ä½•è½¬æ¢æ•°æ®çš„å‡½æ•°éƒ½ä¼šè¿”å›ä¸€ä¸ªè¯¥æ•°æ®çš„æ–°æ‹·è´ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ°¸è¿œä¸ä¼šæŠŠä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™å­—æ¯ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªè¯¥å­—ç¬¦ä¸²è¢«å¤§å†™å­—æ¯åŒ–åçš„æ‹·è´ã€‚ iex&gt; name =  elixir  elixir iex&gt; cap_name = String. capitalize name Elixir iex&gt; name elixir å¦‚æœä½ ä¹‹å‰æ˜¯ç”¨é¢å‘å¯¹è±¡è¯­è¨€ï¼Œä¹Ÿè®¸ä½ ä¼šä¸å–œæ¬¢æˆ‘ä»¬ä½¿ç”¨String. capitalize nameè€Œä¸æ˜¯name. capitalize()çš„å†™æ³•ã€‚ä½†åœ¨é¢å‘å¯¹è±¡è¯­è¨€ä¸­ï¼Œå¯¹è±¡é€šå¸¸éƒ½æ‹¥æœ‰å¯å˜çš„çŠ¶æ€ã€‚å½“ä½ è¿›è¡Œè¯¸å¦‚name. capitalize()ä¹‹ç±»çš„è°ƒç”¨æ—¶ï¼Œæ— æ³•ç«‹å³æ¸…æ¥šè¿™æ˜¯è¦æ›´æ”¹åç§°çš„å†…éƒ¨è¡¨ç¤ºï¼Œæˆ–è¿”å›å¤§å†™å­—æ¯å‰¯æœ¬ï¼Œè¿˜æ˜¯ä¸¤è€…éƒ½æœ‰ã€‚æœ‰å¤ªå¤šäº§ç”Ÿæ­§ä¹‰çš„ç©ºé—´äº†ã€‚ å‡½æ•°å¼è¯­è¨€æ€»æ˜¯è½¬æ¢æ•°æ®ï¼Œä»ä¸ä¼šå»ä¿®æ”¹å®ƒã€‚å…¶è¯­æ³•éƒ½ä¼šæ—¶æ—¶åˆ»åˆ»æé†’æˆ‘ä»¬ã€‚ ç†è®ºçŸ¥è¯†è®²å¾—å¤Ÿå¤šäº†ã€‚è¯¥æ˜¯å¼€å§‹å­¦ä¹ å®ƒçš„æ—¶å€™äº†ã€‚ä¸‹ä¸€ç« æˆ‘ä»¬å°†å¿«é€Ÿæ¦‚è§ˆåŸºæœ¬çš„æ•°æ®ç±»å‹å’Œä¸€äº›è¯­æ³•ï¼Œä¹Ÿä¼šçœ‹åˆ°å‡½æ•°ï¼ˆfunctionï¼‰å’Œæ¨¡å—ï¼ˆmoduleï¼‰ã€‚ "
    }, {
    "id": 51,
    "url": "/2020/06/rspec-9-tips/",
    "title": "å†™å¥½RSpecçš„9ä¸ªæŠ€å·§",
    "body": "2020/06/30 - çœ‹åˆ°è¿™ç¯‡å…³äº Rspec çš„9ä¸ªæŠ€å·§ï¼Œè§‰å¾—ä¸é”™ï¼Œå°±ç®€ç•¥ç¿»è¯‘ä¸€ä¸‹ï¼Œä¾¿äºä»ŠåæŸ¥é˜…ã€‚ ã€ä»¥ä¸‹æ˜¯æ­£æ–‡ã€‘ ç¼–å†™å¥½çš„æµ‹è¯•ç”¨ä¾‹è·Ÿç¼–å†™å¥½çš„ä»£ç ä¸€æ ·é‡è¦ã€‚å¥½çš„ specs å°†å¦‚åŒå¥½çš„æ–‡æ¡£é‚£æ ·å¸®åŠ©è¯†åˆ« bugã€‚ è¿™å„¿æœ‰ 9 ä¸ªæå‡ RSpec çš„æŠ€å·§ã€‚ æœ‰ä¸¤æ¡åŸåˆ™è´¯ç©¿è¿™äº›æŠ€å·§ï¼š  DRY é’ˆå¯¹æ­£ç¡®çš„ç›®æ ‡åœ¨æ­£ç¡®çš„åœ°æ–¹ä½¿ç”¨æ­£ç¡®çš„å·¥å…·æˆ‘ä»¬å¼€å§‹å§ï¼ï¼ï¼ 1ã€æŠŠæ–‡ä»¶ç»„ç»‡æ”¾åœ¨æ­£ç¡®çš„ä½ç½®: å¯¹äºæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹æœ‰ä¸‰ä¸ªåŸºæœ¬çš„ blockï¼š  Setup â€”â€” before,let,let! Assert â€”â€” it Teardown â€”â€” afterå› æ­¤ï¼Œä»£ç åº”è¯¥æ”¾ç½®äºå¯¹åº”çš„åˆé€‚ä½ç½®ã€‚ # BAD#describe '#sync' do it 'updates the local account balance' do  local_account. open  transfer(1000)  expect { local_account. sync }. to change { local_account. balance }. by(1000)  widthdraw_all  local_account. close endend# GOOD#describe '#sync' do subject { local_account. sync } before do # Setup  local_account. open  transfer(1000) end after do # Teardown  widthdraw_all  local_account. close end it 'updates the local account balance' do # Assert  expect { subject }. to change { local_account. balance }. by(1000) endend2ã€é¿å… mock global classes/modules/objects: Global classes/modules/objects è¶‹å‘äºè¢«ç”¨åœ¨å½“å‰æµ‹è¯•ç©ºé—´ä¹‹å¤–çš„å¤šä¸ªåœ°æ–¹ã€‚å¯¹è¿™äº›ç»„ä»¶çš„ Mock å°†ä¼šè¿èƒŒå•å…ƒæµ‹è¯•çš„éš”ç¦»åŸåˆ™ï¼Œè¿™ä¼šå¯¼è‡´ç›¸å…³çš„è¾¹ç•Œæ•ˆåº”ã€‚ åœ¨ Mock class çš„newæ–¹æ³•æ—¶ï¼Œè¿™ä¸ªåŸåˆ™æ›´ä¸ºæœ‰æ•ˆã€‚ # BAD#class UserService attr_reader :user def verify_email  # . . .   email_service = EmailService. new(user)  email_service. send_confirmation_email  # . . .  endenddescribe UserService do describe '#verify_email' do  before do   email_service = double(:email_service)   # BAD: Mocking `new` method of EmailService   allow(EmailService). to receive(:new). and_return(email_service)   allow(email_service). to receive(:send_confirmation_email)  end endend# GOOD#class UserService attr_reader :user def verify_email  email_service = generate_email_service  email_service. send_confirmation_email end private # You can also use memoization if ONLY 1 instance of EmailService is needed def generate_email_service  EmailService. new(user) endenddescribe UserService do describe '#verify_email' do  before do   email_service = double(:email_service)   # GOOD: Mocking its own method `generate_email_service`   allow(described_class). to receive(:generate_email_service). and_return(email_service)   allow(email_service). to receive(:send_confirmation_email)  end endend3ã€ä½¿ç”¨ instance_double ä»£æ›¿ double: å½“ä½ è¦åˆ›å»ºä¸€ä¸ª class å®ä¾‹çš„ mock æ—¶ï¼Œinstance_doubleæ˜¯æ›´å®‰å…¨çš„é€‰æ‹©ã€‚è·Ÿdoubleä¸åŒï¼Œå¦‚æœè¢« mock çš„è¡Œä¸ºè¢«å®ç°ä¸ºæ‰€æä¾› class çš„å®ä¾‹æ–¹æ³•ï¼Œåˆ™ instance_doubleä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ä¸doubleç›¸æ¯”ï¼Œè¿™å…è®¸æˆ‘ä»¬æ•è·æ›´æ·±å±‚æ¬¡çš„é—®é¢˜ã€‚ class FootballPlayer def shoot  # . . . shoot. . .  endendmessi = instance_double(FootballPlayer)allow(messi). to receive(:shoot) # OKallow(messi). to receive(:shoot). with('power') # Wrong numbers of argumentsallow(messi). to receive(:score) # Player does not implement: scoreronaldo = double('FootballPlayer')allow(ronaldo). to receive(:shoot) # OKallow(ronaldo). to receive(:shoot). with('power') # OK - but silent failureallow(ronaldo). to receive(:score) # OK - but silent failure4ã€å¯¹äºæµ‹è¯•ç›®æ ‡ä½¿ç”¨ DESCRIBEï¼Œå¯¹äº scenario ä½¿ç”¨ CONTEXT: è¿™åªæ˜¯ä¸€ç§è®©ä½ çš„ä»£ç è¯»èµ·æ¥æ›´æµåˆ©çš„æ–¹å¼ã€‚ describe UserStore do describe '. create' do  context 'when user does not exists' do   it 'creates a new user' do    # . . .    end   describe 'the newly created user' do    it 'has the correct attributes' do     # . . .     end   end  end  context 'when user already exists' do   it 'raises error' do    # . . .    end  end endend5ã€DESCRIBE å’Œ CONTEXT çš„å®ç°å†…å®¹ç´§æŒ¨ç€å…¶è¯­å¥ä¸‹æ–¹å†™: è¿™å¯¹äºç¡®ä¿æµ‹è¯•åœ¨æ‰€ describe çš„ context ä¸‹è¿›è¡Œ set up å¾ˆé‡è¦ã€‚ä¹Ÿå¸®åŠ©äº†åœ¨ context å½¼æ­¤ä¹‹é—´è¿›è¡ŒåŒºåˆ†ã€‚ describe 'FootballPlayer' do let(:speed) { 50 } let(:shooting) { 50 } let(:player) do  create(:football_player,   speed: speed,   shooting: shooting,  ) end describe '#position' do  subject { player. position }  context 'when the player is fast' do   let(:speed) { 98 } # implements 'when the user is fast'   it { is_expected. to eq 'winger' }  end  context 'when the player shoots well' do   let(:shooting) { 90 } # implements 'when the player shoots well'   it { is_expected. to eq 'striker' }  end  context 'when the player is injured' do   before { player. injure } # implements `when the player is injured`   it { is_expected. to eq 'benched' }   context 'when the player uses doping' do # both injured and using doping    before { player. use_doping }    it { is_expected. to eq 'midfielder' }   end  end endend6ã€å¯èƒ½çš„è¯ï¼Œä½¿ç”¨ bulk æ–¹æ³•: è¿™æ˜¯ä¸ºäº†å‘Šè¯‰é˜…è¯»è€…ï¼Œæ‰€æœ‰çš„ assertion éƒ½æ˜¯é’ˆå¯¹åŒä¸€ä¸ª subjectã€‚ åŒæ—¶ï¼Œè¿™ä¹Ÿæ˜¯ DRY çš„ä½“ç°ã€‚ # BADit 'has correct attributes' do expect(user. name). to eq 'john' expect(user. age). to eq 20 expect(user. email). to eq 'john@ruby. com' expect(user. gender). to eq 'male' expect(user. country). to eq 'us'end# GOODit 'has correct attributes' do expect(user). to have_attributes(  name: 'john',  age: 20,  email: 'john@ruby. com',  gender: 'male',  country: 'us', )end7ã€ç†è§£åœ¨ RSpec ä¸­ transaction æ˜¯å¦‚ä½•å·¥ä½œçš„: é»˜è®¤æƒ…å†µä¸‹ï¼Œtransaction ç”±æ¯ä¸ª example è¿›è¡Œåˆ›å»ºå’Œå°è£…ã€‚è¿™å…è®¸ä¸€ä¸ª example å†…çš„æ‰€æœ‰æ•°æ®åº“æ“ä½œè¿›è¡Œå›æ»šä»¥ç¡®ä¿ä¸‹ä¸€ä¸ª example å¤„äºä¸€ä¸ªå¹²å‡€çš„çŠ¶æ€ã€‚ åœ¨è¯¸å¦‚before(:context)æˆ–before(:all)çš„æŸäº› hook å†…åˆ›å»ºæ•°æ®åº“è®°å½•åœ¨ä¸Šè¿°é»˜è®¤ transaction è¡Œä¸ºä¸‹å°†ä¸ä¼šè¢«å›æ»šã€‚è¿™å°†å¯¼è‡´è„æ•°æ®åŠç›¸åº”çš„ race conditionsã€‚ ontext 'context 1' do before(:context) do  create(:user) # WON'T BE ROLLED-BACK end before do  create(:user) # will be rolled-back end # . . . endcontext 'context 2' do before(:context) do  create(:user) # WON'T BE ROLLED-BACK end # . . . end# BY NOW, THERE ARE 2 USER RECORDS COMMITED TO DATABASE8ã€å¯¹äº mock é¿å…ä½¿ç”¨ expect: å°½ç®¡ expect å¯è¢«ç”¨äº mock ç›®æ ‡ï¼Œä½†ä¸¥æ ¼æ„ä¹‰ä¸Š expect æ˜¯ç”¨äº assertion çš„ã€‚ è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨ allow æ‰æ˜¯æ­£ç¡®çš„ã€‚ è€Œä¸”ï¼Œè¦æé†’æˆ‘ä»¬è‡ªå·±ä¸€ä¸‹ï¼Œmock æ˜¯æµ‹è¯•çš„ setup åœºæ™¯çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯ assertion åœºæ™¯çš„ã€‚ # BAD: expect. . . and_returnit 'returns the sync value' do expect(service). to receive(:sync). and_return(value) # mix between setup and assertion expect(subject). to eq valueend# GOODbefore do allow(service). to receive(:sync). and_return(value) # Set upenddescribe 'the service' do it 'syncs' do  expect(service). to receive(:sync) } # assert endendit { is_expected. to eq value } # assert9ã€å¯¹äºæœ‰ç±»ä¼¼æ¨¡å¼çš„æµ‹è¯•ç”¨ä¾‹ä½¿ç”¨ configs: è¿™æ˜¯ DRY çš„ä½“ç°ï¼Œä¹Ÿè®©é˜…è¯»è€…æ›´æ˜“äºç†è§£ã€‚ # BAD#describe '. extract_extension' do subject { described_class. extract_extension(filename) } context 'when the filename is empty' do  let(:filename) { '' }  it { is_expected. to eq '' } end context 'when the filename is video123. mp4' do  let(:filename) { 'video123. mp4' }  it { is_expected. to eq 'mp4' } end context 'when the filename is video. edited. mp4' do  let(:filename) { 'video. edited. mp4' }  it { is_expected. to eq 'mp4' } end context 'when the filename is video-edited' do  let(:filename) { 'video-edited' }  it { is_expected. to eq '' } end context 'when the filename is . mp4' do  let(:filename) { '. mp4' }  it { is_expected. to eq '' } endend# GOOD#describe '. extract_extension' do subject { described_class. extract_extension(filename) } test_cases = [  '' =&gt; '',  'video123. mp4' =&gt; 'mp4'  'video. edited. mp4' =&gt; 'mp4'  'video-edited' =&gt; ''  '. mp4' =&gt; '' ] test_cases. each do |test_filename, extension|  context  when filename = #{test_filename}  do   let(:filename) { test_filename }   it { is_expected. to eq extension }  end endend"
    }, {
    "id": 52,
    "url": "/2020/06/programming-elixir-1-6-chapter-2/",
    "title": "ã€ŠProgramming Elixir >= 1.6ã€‹ç¬¬äºŒç« ï¼šæ¨¡å¼åŒ¹é…",
    "body": "2020/06/29 - ã€ŠProgramming Elixir &gt;= 1. 6ã€‹çš„ç»“æ„å½¢å¼ä¸ä¸€èˆ¬çš„ç¼–ç¨‹è¯­è¨€å…¥é—¨ä¹¦å®Œå…¨ä¸åŒã€‚å¸¸è§„çš„ç¼–ç¨‹è¯­è¨€ä¹¦ä¸€èˆ¬éƒ½ä¼šä»åŸºæœ¬è¯­æ³•å¼€å§‹è®²èµ·ï¼Œæ— éæ•°å­—ã€å­—ç¬¦ä¸²ã€å‡½æ•°ã€å˜é‡ç­‰ç­‰ã€‚ä½†è¿™æœ¬ä¹¦ä¸æ˜¯ã€‚Dave Thomas æ„è¯†åˆ° Elixir æ‹¥æœ‰å¦‚æ­¤ä¸ä¼—ä¸åŒçš„è¯­æ³•ç‰¹æ€§ï¼Œä»–è®¤ä¸ºè®©è¯»è€…é¦–å…ˆæ¥è§¦å¹¶ç†è§£è¿™ç§ç‰¹æ®Šæ€§æ‰æ˜¯æ›´å¥½å­¦ä¹ è¯¥è¯­è¨€çš„æ–¹å¼ï¼Œæ‰€ä»¥åœ¨ç¬¬ä¸€æ­¥å°±é¦–å…ˆä»‹ç»äº† Elixir æœ€ä¸ºç‰¹æ®Šä¹Ÿæœ€ä¸ºé‡è¦çš„æ¨¡å¼åŒ¹é…ï¼ˆPattern Matchingï¼‰ã€‚ è€Œæˆ‘è®¤ä¸ºè¿™ä¹Ÿæ˜¯æœ¬ä¹¦æä¸ºå“è¶Šçš„ä¸€ç‚¹ã€‚å› ä¸ºæ¨¡å¼åŒ¹é…ï¼ˆPattern Matchingï¼‰å¯¹ç†Ÿæ‚‰äº†å…¶ä»–è¯­è¨€çš„å¼€å‘è€…è€Œè¨€ï¼Œææœ‰å¯èƒ½æ˜¯ä¸€ä¸ªå·¨å¤§çš„è§‚å¿µå†²å‡»ã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿæ˜¯ Elixir è¯­æ³•æœ€é‡è¦çš„ä¸€å—åŸºçŸ³ã€‚å¦‚æœä½ ä¸èƒ½æ¥å—å®ƒï¼Œåé¢çš„å†…å®¹å°±æ ¹æœ¬æ²¡æœ‰å†çœ‹ä¸‹å»çš„å¿…è¦äº†ã€‚æ‰€è°“æçº²æŒˆé¢†ï¼Œçº²ä¸¾ç›®å¼ ï¼Œæ¨¡å¼åŒ¹é…ï¼ˆPattern Matchingï¼‰å°±æ˜¯è¿™ä¸ªâ€œçº²â€ï¼Œç†è§£äº†å®ƒï¼Œå…¶ä»– Elixir çš„è¯­æ³•å°±èƒ½å¾ˆå®¹æ˜“ç†è§£äº†ã€‚è€Œ Dave Thomas æ•é”åœ°è®¤è¯†åˆ°äº†è¿™ä¸€ç‚¹ï¼Œä¸å†æŒ‰éƒ¨å°±ç­åœ°è¿›è¡Œå¸¸è§„è¯­æ³•ä»‹ç»ï¼Œè€Œæ˜¯æŠŠæ¨¡å¼åŒ¹é…ï¼ˆPattern Matchingï¼‰æåˆ°äº†æœ¬ä¹¦æ­£å¼å†…å®¹çš„æœ€å‰é¢ï¼Œæ­£æ˜¾ç¤ºäº†å…¶å“è¶Šçš„è¯­è¨€å—…è§‰ã€‚ ç”±äºæ¨¡å¼åŒ¹é…ï¼ˆPattern Matchingï¼‰æ˜¯å¦‚æ­¤é‡è¦ï¼Œæ‰€ä»¥æˆ‘æƒ³åœ¨è¿™é‡Œæ”¾å‡ºæœ¬ç« çš„å…¨æ–‡ç¿»è¯‘æ˜¯å€¼å¾—çš„ã€‚ è®©æˆ‘ä»¬æ¥çœ‹çœ‹ Dave Thomas åœ¨è¿™é‡Œæ˜¯æ€ä¹ˆä»‹ç»çš„å§ã€‚ ã€ä¸‹é¢æ˜¯æ­£æ–‡ã€‘ 2. Pattern Matchingï¼ˆæ¨¡å¼åŒ¹é…ï¼‰: æˆ‘ä»¬ä»å‰ä¸€ç« å¼€å§‹è¯´ Elixir äº§ç”Ÿäº†ä¸€ç§ä¸åŒçš„æ–¹å¼æ¥æ€è€ƒç¼–ç¨‹ã€‚ ä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œå¹¶ä¸”ä¸ºåç»­çš„ Elixir ç¼–ç¨‹å¥ å®šåŸºç¡€ï¼Œè®©æˆ‘ä»¬æ¥æ‰“é‡æ‰€æœ‰ç¼–ç¨‹è¯­è¨€çš„ä¸€ä¸ªåŸºçŸ³â€”â€”èµ‹å€¼ã€‚ Assignment: I Do Not Think It Means What You Think It Means. : ç”¨ Elixir å‘½ä»¤è¡Œï¼ŒIExï¼Œæ¥çœ‹ä¸€æ®µç®€å•çš„ä»£ç ï¼ˆè®°ä½ï¼Œåœ¨å‘½ä»¤è¡Œä½¿ç”¨iexå‘½ä»¤æ¥å¼€å§‹ IExï¼Œåœ¨iex&gt;åè¾“å…¥ Elixir ä»£ç æ¥è¿è¡Œæ˜¾ç¤ºç»“æœï¼‰ã€‚ iex&gt; a = 11iex&gt; a + 34å¤§éƒ¨åˆ†ç¨‹åºå‘˜çœ‹åˆ°ä¸Šé¢ä»£ç éƒ½ä¼šè¯´ï¼Œâ€å¥½å§ï¼Œæˆ‘ä»¬æŠŠ 1 èµ‹å€¼ç»™å˜é‡ aï¼Œä¸‹ä¸€è¡Œå†æŠŠ 3 åŠ åˆ° a ä¸Šï¼Œæœ€åå¾—åˆ° 4â€ã€‚ ä½†æ˜¯å½“æˆ‘ä»¬æ¥åˆ° Elixir çš„ä¸–ç•Œï¼Œè¿™æ˜¯é”™çš„ã€‚åœ¨ Elixir ä¸­ï¼Œç­‰å·ä¸è¡¨ç¤ºèµ‹å€¼ï¼Œè€Œæ›´åƒæ˜¯æ–­è¨€ï¼ˆassertionï¼‰ã€‚å½“ Elixir èƒ½æ‰¾åˆ°ä¸€ç§æ–¹å¼è®©ç­‰å·å·¦è¾¹ç­‰äºå³è¾¹æ—¶ï¼Œè¯¥è¡¨è¾¾å¼å³æˆç«‹ã€‚Elixir æŠŠç­‰å·=ç§°ä½œåŒ¹é…ï¼ˆmatchï¼‰æ“ä½œç¬¦ã€‚ ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå·¦è¾¹æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå³è¾¹æ˜¯ä¸€ä¸ªæ•´æ•°å­—é¢é‡ï¼Œæ‰€ä»¥ Elixir èƒ½é€šè¿‡æŠŠå˜é‡ a ç»‘å®šåˆ°å€¼ 1 æ¥ä½¿å¾—åŒ¹é…æˆåŠŸã€‚ä½ å¯èƒ½ä¼šäº‰è¾©è¿™ä¸è¿˜æ˜¯èµ‹å€¼ä¹ˆã€‚ä½†è®©æˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ï¼š iex&gt; a = 11iex&gt; 1 = a1iex&gt; 2 = a** (MatchError) no match of right hand side value: 1çœ‹ä¸‹ç¬¬ 2 è¡Œä»£ç ï¼Œ1 = aã€‚è¿™æ˜¯å¦ä¸€ä¸ªåŒ¹é…ï¼Œä¸”é€šè¿‡äº†ã€‚å˜é‡ a å·²ç»æœ‰äº†ä¸€ä¸ªå€¼ 1ï¼ˆç¬¬ 1 è¡Œä»£ç ä¸­è¢«è®¾å®šçš„ï¼‰ï¼Œæ‰€ä»¥ç­‰å·å·¦è¾¹å’Œå³è¾¹æ˜¯ç›¸åŒçš„ï¼ŒåŒ¹é…æˆåŠŸã€‚ ä½†æ˜¯åœ¨ç¬¬ 3 è¡Œä»£ç æ—¶ï¼Œ2 = aï¼ŒæŠ›å‡ºäº†é”™è¯¯ã€‚ä½ å¯èƒ½ä¼šæœŸæœ›æŠŠ 2 èµ‹å€¼ç»™ a æ¥è®©åŒ¹é…æˆåŠŸï¼Œç„¶è€Œ Elixir åªä¼šæ”¹å˜ç­‰å·å·¦è¾¹å˜é‡çš„å€¼â€”â€”å³è¾¹çš„å˜é‡ä¼šç›´æ¥ä½¿ç”¨å®ƒçš„å€¼ã€‚è¿™è¡Œä»£ç ç›¸å½“äº2 = 1ï¼Œå› æ­¤æŠ¥é”™äº†ã€‚ More Complex Matches: é¦–å…ˆï¼Œä»‹ç»ä¸€ä¸ªå°çš„è¯­æ³•ã€‚Elixir çš„åˆ—è¡¨ï¼ˆlistï¼‰å¯ä»¥é€šè¿‡ä½¿ç”¨æ–¹æ‹¬å·åŒ…å«ä»¥é€—å·åˆ†éš”çš„å€¼æ¥åˆ›å»ºã€‚ä¸€äº›ä¾‹å­å¦‚ä¸‹ï¼š [  Humperdinck ,  Buttercup ,  Fezzik  ][  milk ,  butter , [  iocane , 12 ] ]å›åˆ°åŒ¹é…æ“ä½œç¬¦ï¼š iex&gt; list = [ 1, 2, 3 ][1, 2, 3]ä¸ºä½¿åŒ¹é…æˆåŠŸï¼ŒElixir æŠŠå˜é‡ list ç»‘å®šä¸ºåˆ—è¡¨[1, 2, 3]ã€‚ å†çœ‹çœ‹åˆ«çš„ï¼š iex&gt; list = [1, 2, 3][1, 2, 3]iex&gt; [a, b, c ] = list[1, 2, 3]iex&gt; a1iex&gt; b2iex&gt; c3Elixir ä¼šå°½åŠ›å¯»æ‰¾ä¸€ç§æ–¹å¼æ¥ä½¿ç­‰å·å·¦å³ä¸¤è¾¹çš„å€¼ç›¸åŒã€‚å·¦è¾¹æ˜¯ä¸€ä¸ªåŒ…å«ä¸‰ä¸ªå˜é‡çš„åˆ—è¡¨ï¼Œå³è¾¹æ˜¯ä¸€ä¸ªæœ‰ä¸‰ä¸ªå€¼çš„åˆ—è¡¨ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ä¾æ¬¡è®¾ç½®ä¸‰ä¸ªå˜é‡ä¸ºå¯¹åº”ä½ç½®çš„å€¼æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚ Elixir æŠŠè¿™ä¸ªè¿‡ç¨‹ç§°ä½œæ¨¡å¼åŒ¹é…ï¼ˆpattern matchingï¼‰ã€‚å¯¹äºç­‰å·å·¦è¾¹ï¼ˆç§°ä½œâ€æ¨¡å¼â€ï¼ˆpatternï¼‰ï¼‰ï¼Œå¦‚æœç­‰å·å³è¾¹å’Œå…¶æœ‰ç›¸åŒçš„ç»“æ„ï¼Œä¸”å·¦è¾¹çš„æ¯ä¸ªå…ƒç´ éƒ½èƒ½å’Œå³è¾¹å¯¹åº”ä½ç½®çš„å…ƒç´ åŒ¹é…ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¨¡å¼å°±å’Œå³è¾¹æ˜¯åŒ¹é…çš„ã€‚å€¼å’Œå€¼åŒ¹é…ï¼Œå˜é‡é€šè¿‡è®¾ç½®ä¸ºå¯¹åº”ä½ç½®çš„å€¼æ¥åŒ¹é…ã€‚ ä¸‹é¢æ˜¯æ›´å¤šçš„èŒƒä¾‹ï¼š iex&gt; list = [1, 2, [ 3, 4, 5 ] ][1, 2, [3, 4, 5]]iex&gt; [a, b, c ] = list[1, 2, [3, 4, 5]]iex&gt; a1iex&gt; b2iex&gt; c[3, 4, 5]å³è¾¹ç›¸åº”ä½ç½®å’Œå·¦è¾¹å…ƒç´  c å¯¹åº”çš„æ˜¯å­åˆ—è¡¨[3, 4, 5]ï¼Œæ‰€ä»¥ c è¢«è®¾ç½®ä¸ºè¿™ä¸ªå€¼è€Œä½¿å¾—åŒ¹é…æˆåŠŸã€‚ å†çœ‹ä¸‹æ¨¡å¼åŒ…å«å€¼å’Œå˜é‡çš„æƒ…å†µï¼š iex&gt; list = [1, 2, 3][1, 2, 3]iex&gt; [a, 2, b ] = list[1, 2, 3]iex&gt; a1iex&gt; b3æ¨¡å¼ä¸­çš„å­—é¢é‡ 2 å’Œå³è¾¹å¯¹åº”ä½ç½®æ˜¯åŒ¹é…çš„ï¼Œæ‰€ä»¥å¯è®©å˜é‡ aï¼Œb åˆ†åˆ«è¢«è®¾ä¸º 1ï¼Œ3 æ¥ä½¿å¾—åŒ¹é…æˆåŠŸã€‚ä½†æ˜¯â€¦â€¦ iex&gt; list = [1, 2, 3][1, 2, 3]iex&gt; [a, 1, b ] = list** (MatchError) no match of right hand side value: [1, 2, 3]è¿™é‡Œçš„ 1ï¼ˆlist ç¬¬äºŒä¸ªå…ƒç´ ï¼‰æ— æ³•å’Œå³è¾¹ç›¸åº”ä½ç½®å…ƒç´ åŒ¹é…ï¼Œå› æ­¤æ²¡æœ‰ä»»ä½•å˜é‡è¢«è®¾ç½®ï¼ŒåŒ¹é…å¤±è´¥ã€‚å¯ä»¥çœ‹å‡ºè¿™é‡Œå®šä¹‰äº†åˆ—è¡¨çš„ä¸€ä¸ªåŒ¹é…æ ‡å‡†â€”â€”è¦åŒ…å« 3 ä¸ªå…ƒç´ ï¼Œä¸”ç¬¬äºŒä¸ªå…ƒç´ ä¸º 1ã€‚ Ignoring a Value with _ (Underscore): å¦‚æœåœ¨åŒ¹é…æ—¶ä¸éœ€è¦è·å–æŸä¸€ä¸ªå€¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç‰¹æ®Šå˜é‡ï¼Œ_ï¼ˆä¸‹åˆ’çº¿ï¼‰ã€‚å®ƒåœ¨è¿è¡Œæ—¶ä¼šè±¡ä¸€ä¸ªå˜é‡ä¸€æ ·ï¼Œä½†ä¼šä¸¢å¼ƒä»»ä½•åœ¨åŒ¹é…ä¸­è®¾ç½®ç»™å®ƒçš„å€¼ã€‚å®ƒè±¡ä¸€ä¸ªå®£ç§°â€æˆ‘èƒ½æ¥å—ä»»ä½•å€¼â€çš„é€šé…ç¬¦ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåŒ¹é…ä»»ä½•æœ‰ä¸‰ä¸ªå…ƒç´ çš„åˆ—è¡¨ï¼Œä¸”ç¬¬ä¸€ä¸ªå…ƒç´ ä¸º 1 çš„ä¾‹å­ã€‚ iex&gt; [1, _, _] = [1, 2, 3][1, 2, 3]iex&gt; [1, _, _] = [1,  cat ,  dog ][1,  cat ,  dog ]Variables Bind Once (per Match): ä¸€æ—¦ä¸€ä¸ªå˜é‡åœ¨åŒ¹é…è¿‡ç¨‹ä¸­è¢«ç»‘å®šåˆ°ä¸€ä¸ªå€¼äº†ï¼Œå®ƒå°±ä¼šåœ¨æ¥ä¸‹æ¥çš„åŒ¹é…è¿‡ç¨‹ä¸­ä¸€ç›´ä¿æŒè¿™ä¸ªå€¼ã€‚ iex&gt; [a, a] = [1, 1][1, 1]iex&gt; a1iex&gt; [b, b] = [1, 2]** (MatchError) no match of right hand side value: [1, 2]ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼æˆåŠŸæ˜¯å› ä¸º a é¦–å…ˆåŒ¹é…äº† 1ï¼Œè¿™ä¸ªå€¼ç„¶åä¿æŒç”¨åœ¨ç¬¬äºŒä¸ªåŒ¹é…ä¸­ï¼Œä¹Ÿæ˜¯ 1ï¼ŒæˆåŠŸã€‚ ä¸‹ä¸€ä¸ªè¡¨è¾¾å¼ä¸­ï¼Œé¦–å…ˆ b åŒ¹é…äº† 1ï¼Œä½†åˆ°ç¬¬äºŒä¸ªåŒ¹é…æ—¶ï¼Œb å’Œç›¸åº”ä½ç½®çš„ 2 å»åŒ¹é…ï¼Œb ä¸èƒ½æœ‰ä¸¤ä¸ªä¸åŒçš„å€¼ï¼Œæ‰€ä»¥å¤±è´¥äº†ã€‚ ç„¶è€Œï¼Œä¸€ä¸ªå˜é‡å¯ä»¥åœ¨åç»­çš„åŒ¹é…ä¸­ç»‘å®šåˆ°æ–°çš„å€¼ï¼Œå…¶å½“å‰çš„å€¼ä¸ä¼šç”¨åœ¨æ–°çš„åŒ¹é…ä¸­ã€‚ iex&gt; a = 11iex&gt; [1, a, 3] = [1, 2, 3][1, 2, 3]iex&gt; a2é‚£ä¹ˆå¦‚æœä½ æƒ³è¦ Elixir åœ¨åŒ¹é…ä¸­å¼ºåˆ¶ä½¿ç”¨å˜é‡çš„å½“å‰å€¼è¦æ€ä¹ˆåŠå‘¢ï¼Ÿç»™å®ƒåŠ ä¸Šå‰ç¼€^ï¼ˆè„±å­—ç¬¦ï¼‰ã€‚Elixir ä¸­æŠŠè¿™ä¸ªç§°ä½œpinæ“ä½œç¬¦ã€‚ iex&gt; a = 11iex&gt; a = 22iex&gt; ^a = 1** (MatchError) no match of right hand side value: 1This also works if the variable is a component of a pattern:iex&gt; a = 11iex&gt; [^a, 2, 3 ] = [ 1, 2, 3 ][1, 2, 3]iex&gt; a = 22iex&gt; [ ^a, 2 ] = [ 1, 2 ]** (MatchError) no match of right hand side value: [1, 2]å…³äºæ¨¡å¼åŒ¹é…ï¼Œå¦å¤–æœ‰ä¸€ä¸ªé‡è¦çš„éƒ¨åˆ†ã€‚æˆ‘ä»¬å°†åœ¨åé¢çš„ç« èŠ‚ Lists and Recursion ä¸­ä»‹ç»ã€‚ Another Way of Looking at the Equals Sign: Elixir çš„æ¨¡å¼åŒ¹é…å’Œ Erlang çš„å¾ˆç›¸è¿‘ï¼ˆä¸»è¦çš„åŒºåˆ«åœ¨äº Elixir å…è®¸åœ¨åŒ¹é…ä¸­æŠŠä¹‹å‰å·²æœ‰ç»‘å®šå€¼çš„å˜é‡é‡æ–°è®¾ç½®æ–°çš„å€¼ï¼ŒErlang åˆ™åªå…è®¸å¯¹å˜é‡è®¾ç½®ä¸€æ¬¡å€¼ï¼‰ã€‚ Joe Armstrongï¼ŒErlang çš„åˆ›å»ºè€…ï¼ŒæŠŠ Erlang ä¸­çš„ç­‰å·å’Œä»£æ•°ä¸­çš„è¿›è¡Œäº†ç±»æ¯”ã€‚å½“ä½ å†™ä¸‹æ–¹ç¨‹x = a + 1æ—¶ï¼Œå¹¶ä¸æ˜¯æŠŠa + 1çš„å€¼èµ‹ç»™xï¼Œè€Œæ˜¯åœ¨æ–­è¨€ï¼ˆassertingï¼‰è¡¨è¾¾å¼xå’Œa + 1æœ‰ç›¸åŒçš„å€¼è€Œå·²ã€‚å½“ä½ çŸ¥é“äº†xçš„å€¼ï¼Œå°±èƒ½è®¡ç®—å‡ºaçš„å€¼ï¼Œåä¹‹äº¦ç„¶ã€‚ ä»–çš„è§‚ç‚¹æ˜¯ï¼Œå½“ä½ ç¬¬ä¸€æ¬¡é‡åˆ°å‘½ä»¤å¼ç¼–ç¨‹è¯­è¨€æ—¶æ˜¯ä¸å¾—ä¸æŠ›å¼ƒç­‰å·=çš„ä»£æ•°å«ä¹‰ï¼Œç°åœ¨æ˜¯é‡æ–°æ¡å›å®ƒä»¬çš„æ—¶å€™äº†ã€‚ è¿™å°±æ˜¯æˆ‘ä¹‹æ‰€ä»¥æŠŠæ¨¡å¼åŒ¹é…ä½œä¸ºæœ¬ä¹¦ç¬¬ä¸€ç« çš„åŸå› ã€‚å®ƒæ˜¯ Elixir çš„æ ¸å¿ƒä¹‹ä¸€â€”â€”è¢«å¹¿æ³›ç”¨äºæ¡ä»¶è¯­å¥ã€å‡½æ•°è°ƒç”¨å’Œæ‰§è¡Œä¸­ã€‚ è¯´çœŸçš„ï¼Œæˆ‘æœŸæœ›è®©ä½ å¯¹ç¼–ç¨‹è¯­è¨€æœ‰äº›ä¸åŒçš„æƒ³æ³•ï¼Œå¹¶ä¸”ä¹Ÿå‘ä½ å±•ç¤ºäº†ä¸€äº›ç°æœ‰é¢„è®¾åœ¨ Elixir ä¸­å¹¶ä¸èµ·ä½œç”¨ã€‚ è¯´åˆ°ç°æœ‰çš„é¢„è®¾â€¦â€¦ä¸‹ä¸€ç« ä¼šæ‰“ç ´å¦ä¸€ä¸ªä¸å®¹ç½®ç–‘çš„ä¸œè¥¿ã€‚ä½ ç°æœ‰çš„ç¼–ç¨‹è¯­è¨€å¯èƒ½è¢«è®¾è®¡ä¸ºå¾ˆå®¹æ˜“ä¿®æ”¹æ•°æ®ã€‚æ¯•ç«Ÿï¼Œé‚£å°±æ˜¯ç¨‹åºè¦å¹²çš„äº‹ï¼Œå¯¹å§ï¼ŸElixir ä¸æ˜¯ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€é—¨æ‰€æœ‰æ•°æ®éƒ½ä¸å¯å˜çš„è¯­è¨€ã€‚ "
    }, {
    "id": 53,
    "url": "/2020/06/programming-elixir-1-6-chapter-1/",
    "title": "ã€ŠProgramming Elixir >= 1.6ã€‹ç¬¬ä¸€ç« (èŠ‚é€‰)",
    "body": "2020/06/28 - ã€ŠProgramming Elixir &gt;= 1. 6ã€‹çš„ç¬¬ä¸€ç« æ ‡é¢˜ä¸ºâ€œTake the Red Pillâ€ã€‚æ¯«æ— ç–‘é—®ï¼Œè¿™ä¸ªè¯´æ³•çš„å‡ºå¤„æºè‡ªã€Šé»‘å®¢å¸å›½1ã€‹ä¸­çš„çº¢è“å°è¯ç‰‡èƒŒæ™¯ã€‚ä¸è¨€è€Œå–»ï¼ŒDave Thomas è€çˆ·å­æ˜æ˜¾æ˜¯æƒ³è¡¨ç¤ºå¦‚æœä½ é€‰æ‹©äº† Elixirï¼Œå°±æ„å‘³ç€é€‰æ‹©äº†ç¼–ç¨‹çš„â€œçœŸç›¸â€ã€‚æ‡‚è¿™ä¸ªæ¢—çš„äººçœ‹åˆ°è¿™é‡Œè‡ªç„¶ä¼šä¼šå¿ƒä¸€ç¬‘ï¼Œæœ‰äº†æƒ³æ¢ç©¶ä¸€ä¸‹è¿™ä¸ªâ€œçœŸç›¸â€åˆ°åº•æ˜¯ä»€ä¹ˆçš„å…´è¶£ã€‚ è®©æˆ‘ä»¬æ¥çœ‹çœ‹ Dave Thomas åœ¨è¿™é‡Œæ˜¯æ€ä¹ˆè¯´çš„å§ã€‚ ã€ä¸‹é¢æ˜¯æ­£æ–‡ã€‘ 1. Take the Red Pill: Elixir ä»¥å°å·§è€Œç°ä»£çš„è¯­æ³•å°è£…äº†å‡½æ•°å¼ç¼–ç¨‹ï¼ŒåŒ…æ‹¬ä¸å¯å˜çŠ¶æ€å’ŒåŸºäº Actor æ¨¡å¼çš„å¹¶å‘ã€‚å¹¶ä¸”å®ƒè¿è¡Œåœ¨ä»¥å·¥ä¸šåŒ–å¼ºåº¦ã€é«˜æ€§èƒ½ä»¥åŠåˆ†å¸ƒå¼è‘—ç§°çš„ Erlang VM ä¸Šã€‚é‚£ä¹ˆè¿™ä¸€åˆ‡æ„å‘³ç€ä»€ä¹ˆï¼Ÿ è¿™æ„å‘³ç€ä½ å¯ä»¥ä¸ç”¨å†æ‹…å¿ƒç›®å‰å›°æ‰°ä½ çš„é‚£äº›éš¾é¢˜äº†ã€‚ä½ ä¸å†éœ€è¦è‹¦è‹¦æ€ç´¢å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ç¡®ä¿æ•°æ®ä¸€è‡´æ€§çš„äº‹å„¿ï¼Œä¹Ÿä¸ç”¨å†æƒ³å¤ªå¤šåº”ç”¨åˆ‡åˆ†çš„äº‹å„¿ï¼ŒåŒæ—¶æœ€é‡è¦çš„æ˜¯ï¼Œä½ å¯ä»¥äº«å—ä»¥ä¸€ç§ä¸åŒçš„æ–¹å¼æ¥ç¼–å†™ä»£ç ã€‚ Programming Should Be About Transforming Data: å¦‚æœä½ æ¥è‡ªé¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸–ç•Œï¼Œé‚£ä½ ä¼šä¹ æƒ¯äºç”¨ç±»å’Œå®ä¾‹æ¥æ€è€ƒé—®é¢˜ã€‚ç±»å®šä¹‰è¡Œä¸ºï¼Œå¯¹è±¡æ§åˆ¶çŠ¶æ€ã€‚å¼€å‘è€…èŠ±è´¹æ—¶é—´åœ¨å¤æ‚çš„ç±»ç»§æ‰¿å…³ç³»ä¸Šï¼Œå¹¶å°è¯•é’ˆå¯¹é—®é¢˜æ¥å»ºæ¨¡ï¼Œå°±å¥½æ¯”ç»´å¤šåˆ©äºšæ—¶æœŸçš„ç§‘å­¦å®¶åˆ›å»ºåºæ‚çš„è´è¶åˆ†ç±»å­¦ä¸€æ ·ã€‚ å½“æˆ‘ä»¬å›´ç»•å¯¹è±¡ç¼–å†™ä»£ç æ—¶ï¼Œæˆ‘ä»¬è¦è€ƒè™‘çš„æ˜¯çŠ¶æ€ã€‚å¤§éƒ¨åˆ†æ—¶é—´éƒ½èŠ±åœ¨è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•å’ŒæŠŠå®ƒä»¬ä¼ ç»™å…¶ä»–å¯¹è±¡ä¸Šã€‚åŸºäºæ­¤ï¼Œå¯¹è±¡æ›´æ–°å®ƒä»¬çš„çŠ¶æ€ï¼Œæˆ–å…¶ä»–å¯¹è±¡çš„çŠ¶æ€ã€‚è¿™ä¸ªä¸–ç•Œä¸­ï¼Œç±»å°±æ˜¯å›½ç‹èˆ¬çš„å­˜åœ¨â€”â€”å®ƒå®šä¹‰æ¯ä¸ªå®ä¾‹èƒ½åšä»€ä¹ˆï¼Œå®ƒæŒæ§ç€å®ä¾‹æ•°æ®çš„çŠ¶æ€ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æŠŠæ•°æ®éšè—èµ·æ¥ã€‚ ä½†è¿™å¹¶ä¸æ˜¯çœŸå®çš„ä¸–ç•Œã€‚åœ¨çœŸå®çš„ä¸–ç•Œé‡Œï¼Œæˆ‘ä»¬ä¸æƒ³å»ºæ¨¡æŠ½è±¡ç­‰çº§ï¼ˆå› ä¸ºç°å®ä¸­å¹¶æ²¡æœ‰è¿™ä¹ˆå¤šçœŸå®çš„çº§åˆ«ï¼‰ã€‚æˆ‘ä»¬åªæƒ³æŠŠäº‹æƒ…å®Œæˆï¼Œä¸æƒ³ç»´æŠ¤ä»€ä¹ˆçŠ¶æ€ã€‚ ç°åœ¨ï¼Œæ¯”å¦‚ï¼Œæˆ‘æœ‰ä¸€äº›ç©ºçš„æ–‡ä»¶ï¼ŒæŠŠå®ƒä»¬è½¬æ¢æˆä¸€äº›åŒ…å«æ–‡æœ¬çš„æ–‡ä»¶ã€‚ç„¶åæˆ‘æŠŠå®ƒä»¬è½¬æ¢æˆä½ å¯ä»¥é˜…è¯»çš„æ ¼å¼ã€‚è¿˜æœ‰ï¼ŒæŸä¸ªåœ°æ–¹çš„ web æœåŠ¡å™¨ä¼šæŠŠä½ çš„ä¸‹è½½è¯·æ±‚è½¬æ¢ä¸ºä¸€ä¸ªåŒ…å«è¯·æ±‚ä¸‹è½½å†…å®¹çš„ HTTP å“åº”ã€‚ æˆ‘ä¸æƒ³éšè—æ•°æ®ï¼Œæˆ‘åªæƒ³è½¬æ¢å®ƒã€‚ Combine Transformations with Pipelines: Unix ç”¨æˆ·éƒ½ä¹ æƒ¯äºå°è€Œç²¾çš„å‘½ä»¤è¡Œå·¥å…·å“²å­¦ï¼Œç”¨ä¸åŒçš„æ–¹å¼æ¥éšæ„ç»„åˆã€‚æ¯ä¸ªè¿™æ ·çš„å·¥å…·éƒ½æœ‰å†…å®¹è¾“å…¥ã€è½¬æ¢å¹¶ä»¥ä¸‹ä¸€ä¸ªå·¥å…·æ‰€éœ€è¦çš„æ ¼å¼æ¥è¾“å‡ºã€‚ è¿™ç§å“²å­¦æå…¶çµæ´»ï¼Œä½¿å¾—å·¥å…·å¤ç”¨åº¦æé«˜ã€‚è¿™äº›å·¥å…·ç”šè‡³èƒ½ä»¥å…¶ä½œè€…åšæ¢¦éƒ½æƒ³ä¸åˆ°çš„æ–¹å¼æ¥ç»„åˆä½¿ç”¨ã€‚å› æ­¤æå¤§åœ°å€å¢äº†å·¥å…·ç›¸äº’é—´ä½œç”¨çš„æ½œèƒ½ã€‚ è¿™ä¹Ÿæ˜¯æä¸ºå¯é çš„â€”â€”æ¯ä¸ªå°çš„å·¥å…·åªåšå¥½ä¸€ä»¶äº‹ï¼Œæ„å‘³ç€å…¶å¾ˆå®¹æ˜“æµ‹è¯•ã€‚ è¿˜æœ‰å¦å¤–çš„å¥½å¤„ã€‚å‘½ä»¤ç®¡é“èƒ½åŒæ—¶è¿è¡Œã€‚å¦‚æœæˆ‘å†™ï¼š $ grep Elixir *. pml | wc -lé‚£ä¹ˆå•è¯è®¡æ•°ç¨‹åºï¼Œwcï¼Œä¼šè·Ÿ grep å‘½ä»¤åŒæ—¶è¿è¡Œã€‚å› ä¸º wc ç¨‹åºä¼šæ¶ˆè´¹ grep çš„è¾“å‡ºï¼Œåªè¦ grep æœ‰è¾“å‡ºå†…å®¹äº§ç”Ÿå‡ºæ¥ã€‚ä¸€æ—¦ grep ç»“æŸï¼Œå‡ ä¹æ²¡æœ‰ä»»ä½•å»¶è¿Ÿå°±èƒ½å¾—åˆ°å•è¯è®¡æ•°çš„ç»“æœã€‚ ä¸ºç»™ä½ ä¸€ç‚¹æ„Ÿè§‰ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ª Elixir çš„å‡½æ•°ï¼Œåä¸º pmapã€‚å®ƒè¾“å…¥ä¸€ä¸ª collection å’Œ functionï¼Œè¿”å›ä¸€ä¸ªæŠŠ collection æ¯ä¸ªå…ƒç´ éƒ½è°ƒç”¨ function åçš„ç»“æœä½œä¸ºå…ƒç´ çš„åˆ—è¡¨ã€‚ä½†â€¦â€¦å®ƒæ˜¯æŠŠæ¯ä¸ªå…ƒç´ è½¬æ¢éƒ½æ”¾åˆ°å•ç‹¬çš„è¿›ç¨‹ä¸­ã€‚å…ˆä¸è¦å…³å¿ƒé‚£äº›ç»†èŠ‚ã€‚ defmodule Parallel do def pmap(collection, func) do  collection  |&gt; Enum. map(&amp;(Task. async(fn -&gt; func. (&amp;1) end)))  |&gt; Enum. map(&amp;Task. await/1) endendæˆ‘ä»¬å¯ä»¥è¿è¡Œè¿™ä¸ªå‡½æ•°æ¥å¾—åˆ°ä» 1 åˆ° 1000 çš„å¹³æ–¹æ•°ã€‚ result = Parallel. pmap 1. . 1000, &amp;(&amp;1 * &amp;1)å½“ç„¶ï¼Œæˆ‘åˆšåˆšå¯åŠ¨äº† 1000 ä¸ªåå°è¿›ç¨‹ï¼Œå®Œå…¨å……åˆ†åˆ©ç”¨äº†è‡ªå·±ç”µè„‘çš„å…¨éƒ¨å¤šæ ¸å¤„ç†å™¨ã€‚ è¿™æ®µä»£ç ä½ å¯èƒ½è¿˜å¾ˆä¸ä¹ æƒ¯ï¼Œæ²¡å…³ç³»ï¼Œç­‰ä½ è¯»åˆ°æœ¬ä¹¦çš„ä¸€åŠä¹‹åï¼Œå°±èƒ½è‡ªå·±å†™å‡ºè¿™æ ·é£æ ¼çš„ä»£ç äº†ã€‚ Functions Are Data Transformers: Elixir è®©æˆ‘ä»¬ç”¨å’Œä¸Šè¿° Unix åŒæ ·çš„æ–¹å¼æ¥è§£å†³é—®é¢˜ã€‚è€Œé™¤äº†å‘½ä»¤è¡Œå·¥å…·å¤–ï¼Œæˆ‘ä»¬æ›´æ‹¥æœ‰äº†å‡½æ•°ã€‚æˆ‘ä»¬èƒ½æŠŠå®ƒä»¬æŒ‰ç…§è‡ªå·±çš„æ„æ„¿å°½æƒ…ä½¿ç”¨ã€‚è¿™äº›å‡½æ•°è¶Šå°ï¼ˆæ›´ä¸“æ³¨ï¼‰ï¼Œæˆ‘ä»¬è¶Šèƒ½çµæ´»åœ°ç»„åˆä½¿ç”¨å®ƒä»¬ã€‚ åªè¦æƒ³ï¼Œæˆ‘ä»¬å¯ä»¥è®©è¿™äº›å‡½æ•°å¹¶è¡Œåœ°è¿è¡Œâ€”â€”Elixir æ‹¥æœ‰ç®€å•è€Œåˆå¼ºå¤§çš„æœºåˆ¶åœ¨å®ƒä»¬ä¹‹é—´é€šä¿¡ã€‚è¿™å¯ä¸æ˜¯ä»ä½ çˆ¸çˆ¸é‚£ä¸ªæ—¶å€™èµ·å°±ä»¤äººå¤´ç–¼çš„è¿›ç¨‹æˆ–çº¿ç¨‹â€”â€”æˆ‘ä»¬è¿™é‡Œè¦è°ˆè®ºçš„æ˜¯ä»…ä»…åœ¨ä¸€å°ç”µè„‘ä¸Šå°±è¿è¡Œä¸Šç™¾ä¸‡ä¸ªä»»åŠ¡çš„æ½œåŠ›ï¼Œä»¥åŠåœ¨ä¸Šç™¾å°ç”µè„‘ä¸Šçš„è¿è¡Œã€‚Bruce Tate å¯¹æ­¤çš„æƒ³æ³•æ˜¯è¿™æ ·çš„ï¼šâ€œå¤§å¤šæ•°å¼€å‘è€…æŠŠçº¿ç¨‹å’Œè¿›ç¨‹çœ‹ä½œåœ°ç‹±ä¸€èˆ¬ï¼›Elixir å¼€å‘è€…å´æŠŠå®ƒä»¬å½“ä½œä¸€ç§é‡è¦çš„ç®€æ´æ–¹æ¡ˆâ€ã€‚å½“æˆ‘ä»¬è·Ÿéšç€æ­¤ä¹¦çš„æ·±å…¥è®²è§£ï¼Œä½ ä¼šå¼€å§‹æ˜ç™½ä»–è¿™è¯çš„æ„æ€ã€‚ è¿™ç§è½¬æ¢ç†å¿µæ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„æ ¸å¿ƒï¼šå‡½æ•°å°†å…¶è¾“å…¥è½¬æ¢ä¸ºè¾“å‡ºã€‚ä¸‰è§’å‡½æ•° sin å°±æ˜¯ä¸€ä¸ªä¾‹å­â€”â€”ç»™å®ƒ Ï€â„4ï¼Œè¿”å› 0. 7071ã€‚ä¸€ä¸ª HTML æ¨¡ç‰ˆç³»ç»Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå½“å®ƒæ¥æ”¶ä¸€ä¸ªåŒ…å«å ä½ç¬¦å’Œç›¸åº”é”®å€¼å¯¹çš„æ¨¡ç‰ˆæ—¶ï¼Œå°±ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„ HTML æ–‡æ¡£ã€‚ ä½†è¿™ç§å¼ºå¤§æ˜¯æœ‰ä»£ä»·çš„ã€‚ä½ å°†ä¸å¾—ä¸æŠ›å¼ƒå¾ˆå¤šä¹‹å‰å·²æœ‰çš„ç¼–ç¨‹ç†å¿µã€‚å¾ˆå¤šåŸæœ‰çš„ç›´è§‰éƒ½å°†å˜æˆé”™çš„ã€‚è¿™ä¼šæˆä¸ºä¸€ç§é˜»åŠ›ï¼Œå› ä¸ºä½ ä¼šæ„Ÿåˆ°è‡ªå·±å®Œå…¨å˜æˆäº†ä¸€ä¸ªâ€œæ–°â€æ‰‹ã€‚ ä»æˆ‘ä¸ªäººè§’åº¦çœ‹ï¼Œè¿™æ°æ°æ˜¯ä¹è¶£æ‰€åœ¨ã€‚ä½ å¹¶éåœ¨ä¸€å¤œä¹‹é—´å°±å­¦ä¼šé¢å‘å¯¹è±¡çš„ç¼–ç¨‹ï¼Œå½“ç„¶ä¹Ÿä¸å¯èƒ½ä¸€é¡¿æ—©é¥­çš„æ—¶é—´å°±æˆä¸ºå‡½æ•°å¼ç¼–ç¨‹çš„ä¸“å®¶ã€‚ ä¸è¿‡æŸç§è§’åº¦çœ‹ï¼Œä½ å°†å¼€å§‹ä»¥ä¸åŒçš„æ–¹å¼æ¥æ€è€ƒé—®é¢˜ï¼Œå¹¶ä¸”ä¼šå‘ç°è‡ªå·±ç”¨å¾ˆå°‘çš„ä»£ç å°±èƒ½å®Œæˆä»¤äººæƒŠè®¶çš„äº‹æƒ…ã€‚ä½ ä¼šå‘ç°è‡ªå·±ç¼–å†™çš„å°æ®µä»£ç èƒ½å¤Ÿè¢«åå¤ä½¿ç”¨ï¼Œè€Œä¸”é€šå¸¸ä»¥æ„æƒ³ä¸åˆ°çš„æ–¹å¼ï¼ˆå°±è±¡ä¸Šé¢çš„ wc å’Œ grepï¼‰ã€‚ ä½ çœ‹å¾…ä¸–ç•Œçš„è§†è§’ç”šè‡³ä¹Ÿå¼€å§‹æ”¹å˜ï¼Œå› ä¸ºä½ ä¸å†è€ƒè™‘è´£ä»»è€Œå¼€å§‹è€ƒè™‘å®Œæˆä»»åŠ¡ã€‚æ¯ä¸ªäººéƒ½ä¼šåŒæ„è¿™æ˜¯æœ‰è¶£çš„ã€‚ â€¦â€¦ï¼ˆå…³äºå¦‚ä½•é…ç½® Elixir ç¯å¢ƒçš„ä¸€äº›æ­¥éª¤è¯´æ˜ï¼Œç•¥è¿‡ï¼‰â€¦â€¦ Think Different(ly): è¿™æ˜¯ä¸€æœ¬ä¸åŒå‡¡â€æƒ³â€çš„ä¹¦â€”â€”æ¥å—ä¸€äº›å¯¹äºç¼–ç¨‹çš„çœ‹æ³•å¹¶éå…¶å…¨éƒ¨ï¼š  é¢å‘å¯¹è±¡å¹¶ä¸æ˜¯ä»£ç è®¾è®¡çš„å”¯ä¸€æ–¹æ³• å‡½æ•°å¼ç¼–ç¨‹å¹¶ä¸éœ€è¦éå¸¸å¤æ‚æˆ–ç²¾ç¡® ç¼–ç¨‹çš„åŸºç¡€å¹¶ä¸æ˜¯èµ‹å€¼ã€if è¯­å¥å’Œå¾ªç¯ å¹¶å‘ä¸éœ€è¦é”ï¼Œä¿¡å·é‡ï¼Œç›‘è§†å™¨ï¼Œä»¥åŠç±»ä¼¼çš„ä¸œè¥¿ è¿›ç¨‹å¹¶ä¸æ˜¯ä»£ä»·æ˜‚è´µçš„èµ„æº å…ƒç¼–ç¨‹å¹¶ä¸æ˜¯éšä¾¿æ·»åŠ åˆ°è¯­è¨€ä¸Šçš„ä¸œè¥¿ å³ä½¿å®ƒæ˜¯å·¥ä½œï¼Œç¼–ç¨‹ä¹Ÿèƒ½å¾ˆæœ‰è¶£å½“ç„¶ï¼Œæˆ‘å¹¶éè¦è¯´ Elixir å°±æ˜¯é‚£ç§çµä¸¹å¦™è¯ï¼ˆå¥½å§ï¼ŒæŠ€æœ¯ç¡®å®æ˜¯ï¼Œä½ æ‡‚æˆ‘çš„æ„æ€ï¼‰ã€‚å®ƒä¸æ˜¯ç¼–å†™ä»£ç çš„å”¯ä¸€æ–¹å¼ã€‚ä½†å®ƒè·Ÿä¸»æµæ˜¯å¦‚æ­¤ä¸åŒï¼Œå­¦ä¹ å®ƒä¼šä¸ºä½ æä¾›æ›´å¤šçš„è§†è§’ï¼Œèƒ½è®©ä½ æ‹“å±•æ€ç»´è€Œçœ‹åˆ°æ–°çš„æ€è€ƒç¼–ç¨‹çš„æ–¹å¼ã€‚ é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ã€‚ "
    }, {
    "id": 54,
    "url": "/2020/06/vim-increase-numbers/",
    "title": "Vim æ‰¹é‡é€’å¢æ•°å­—çš„æŠ€å·§",
    "body": "2020/06/24 - ä¼—æ‰€å‘¨çŸ¥ï¼ŒVim è‡ªå¸¦çš„é»˜è®¤å¿«æ·é”®âŒƒ-Aã€âŒƒ-Xå¯ä»¥å¯¹å•ä¸ªæ•°å­—è¿›è¡Œå¢å‡æ“ä½œï¼Œè¿™åœ¨ç¢°åˆ°é€‚ç”¨çš„åœºæ™¯æ—¶å½“ç„¶éå¸¸æ–¹ä¾¿ã€‚ä½†æ˜¯ï¼Œç¼–ç¨‹ä¸­å¦ä¸€ç§åœºæ™¯ä¹Ÿæ˜¯ç»å¸¸é‡åˆ°çš„ï¼š ä½ å¯èƒ½è¦åŒæ—¶å¯¹å¤šè¡Œä¸Šçš„å¤šä¸ªå˜é‡å‘½åï¼Œåç§°ä¸­å¸¦æœ‰æ•°å­—ï¼Œä¸”éœ€è¦ä¾æ¬¡é€’å¢ã€‚ æ¯”å¦‚ Vim ä¸­å¯ä»¥é€šè¿‡yy4på¿«é€Ÿå¤åˆ¶ç”Ÿæˆè¿™æ ·çš„å¤šè¡Œå˜é‡ car01car01car01car01car01é‚£ä¹ˆå¦‚ä½•æŠŠå…¶å¿«é€Ÿæ”¹å†™ä¸º car01car02car03car04car05è¿™æ ·çš„ç»“æœå‘¢ï¼ŸVim æ˜¯å¦æœ‰å¿«æ·é”®æˆ–ä»€ä¹ˆæŠ€å·§æ¥é«˜æ•ˆå¤„ç†è¿™ä¸ªåœºæ™¯ï¼Ÿè¿˜æ˜¯è¯´åªèƒ½é’ˆå¯¹æ¯ä¸ªå˜é‡åä¸€ä¸ªä¸€ä¸ªæ‰‹å·¥å»æ”¹ï¼Ÿ Vim æ˜¯å¦‚æ­¤å¼ºå¤§ï¼Œç­”æ¡ˆå½“ç„¶æ˜¯è‚¯å®šçš„ã€‚ çœ‹æœ¬æ–‡å¤´éƒ¨çš„ Gif æ“ä½œåŠ¨å›¾å°±ä¸€ç›®äº†ç„¶äº†ã€‚ "
    }, {
    "id": 55,
    "url": "/2020/06/programming-elixir-1-6-preface/",
    "title": "ã€ŠProgramming Elixir >= 1.6ã€‹åºè¨€",
    "body": "2020/06/23 - Elixir æ˜¯ä¸€é—¨å¥‡å¦™çš„è¯­è¨€ã€‚æˆ‘æœ¬èº«æ˜¯ä¸€å Ruby å¼€å‘è€…ï¼Œè‡ªä»ç¬¬ä¸€æ¬¡æ¥è§¦åˆ° Elixirï¼Œå°±è¢«å®ƒç±»ä¼¼ Ruby çš„è¯­æ³•è€ŒåŒæ—¶åˆæ‹¥æœ‰çš„ä¸€ç³»åˆ—ç‹¬ç‰¹ç‰¹æ€§æ‰€å¸å¼•ã€‚è¦å­¦ä¹ ä¸€é—¨æ–°è¯­è¨€ï¼Œå½“ç„¶æ˜¯ä»æœ€ç»å…¸çš„ä¹¦ç±å¼€å§‹ã€‚è€Œè‘—åçš„è€çˆ·å­ Dave Thomas æœ¬èº«å°±å…·æœ‰ä¸šå†…å“è¶Šçš„å·å¬åŠ›ï¼Œä»–äº²è‡ªæ’°å†™çš„ã€ŠProgramming Elixir &gt;= 1. 6ã€‹è‡ªç„¶æ˜¯æˆ‘çš„é¦–é€‰ã€‚äºæ˜¯å°±ä»è¿™æœ¬ä¹¦å¼€å§‹æˆ‘çš„ Elixir ä¹‹æ—…äº†ã€‚ çœ‹è¿™æœ¬ä¹¦çš„åŒæ—¶ï¼Œæˆ‘èŒå‘äº†ç¿»è¯‘çš„å¿µå¤´ã€‚å‰äº›å¹´è‡ªå·±çš„ä¸å°‘åŒäº‹éƒ½æ›¾åšè¿‡è¿™æ ·çš„äº‹ï¼Œç°åœ¨æœ‰äº†è¿™ä¸ªå¥‘æœºï¼Œäºæ˜¯æ‰“ç®—äº²è‡ªå°è¯•ä¸€å›ï¼Œä¹Ÿç®—æ˜¯ä¸€ç§ä¸é”™çš„ç»å†ã€‚äºæ˜¯ä¸€è¾¹çœ‹ä¸€è¾¹ç¿»è¯‘ï¼Œå†æ—¶å·®ä¸å¤šä¸‰ä¸ªæœˆå°±åŸºæœ¬å®Œæˆäº†ã€‚ å½“ç„¶ç”±äºç‰ˆæƒåŸå› ï¼Œä¸å¯èƒ½åœ¨æˆ‘çš„åšå®¢ä¸Šæ”¾å‡ºæ‰€æœ‰çš„å†…å®¹ã€‚æ‰€ä»¥æŒ‘é€‰äº†ä¸€äº› Elixir ä¸­æœ€æœ‰ç‹¬ç‰¹æ€§ã€æŠ€æœ¯å±‚é¢æœ€ä¼˜ç¾çš„ç›¸å…³ç« èŠ‚ï¼Œå‡†å¤‡åšæˆä¸€ä¸ªç³»åˆ—ï¼Œé™†ç»­ç™»åˆ°è‡ªå·±çš„åšå®¢ä¸Šã€‚ æˆ‘æƒ³ç¬¬ä¸€ç«™ä»è¿™æœ¬ä¹¦çš„åºè¨€å¼€å§‹æ˜¯æœ€æ°å½“çš„ã€‚è¿™æ˜¯ Dave Thomas è€çˆ·å­å‡ºäºè‡ªèº«å¯¹ Elixir è¯­è¨€äº²èº«æ„Ÿå—çš„ä¸€ä¸ªå¿ƒç†å†ç¨‹çš„æè¿°ï¼Œå¾ˆå€¼å¾—ä¸€çœ‹ã€‚ ã€ä¸‹é¢æ˜¯æ­£æ–‡ã€‘  A Vain Attempt at a Justification, Take Two:  æˆ‘æ˜¯ä¸ªç¼–ç¨‹è¯­è¨€çˆ±å¥½è€…ã€‚æˆ‘ä¹äºå°è¯•å„ç§è¯­è¨€ï¼Œå–œæ¬¢æ€è€ƒå®ƒä»¬çš„è®¾è®¡å’Œå®ç°ã€‚  1998å¹´ï¼Œä½œä¸ºç‹‚çƒ­çš„ comp. lang. misc é‚®ä»¶ç»„è¯»è€…ï¼Œæˆ‘å¶é‡äº† Ruby è¿™é—¨è¯­è¨€ã€‚æˆ‘ä¸‹è½½ã€ç¼–è¯‘ï¼Œå¹¶ä»æ­¤çˆ±ä¸Šäº†å®ƒã€‚ä»»ä½•æ—¶å€™ä½ çˆ±ä¸Šä¸€ä¸ªä¸œè¥¿å¾€å¾€å¾ˆéš¾è§£é‡Šä¸ºä»€ä¹ˆã€‚å®ƒè·Ÿæˆ‘æ˜¯å¦‚æ­¤é»˜å¥‘ï¼Œä¹Ÿæœ‰è¶³å¤Ÿçš„æ·±åº¦è®©æˆ‘ä¿æŒå¯¹å®ƒçš„å…´è¶£ã€‚  15å¹´è¿‡å»äº†ï¼Œè¿™æœŸé—´æˆ‘ä¸€ç›´åœ¨å¯»æ‰¾æ–°çš„èƒ½å¸¦ç»™æˆ‘åŒæ ·æ„Ÿå—çš„ä¸œè¥¿ã€‚  æˆ‘æ›¾ç»é‡åˆ°è¿‡ Elixirï¼Œä½†å› ä¸ºæŸç§åŸå› å¹¶æ²¡æœ‰è¢«å®ƒå¸å¼•ã€‚ä½†åœ¨æˆ‘å¼€å§‹å†™è¿™æœ¬ä¹¦ç¬¬ä¸€ç‰ˆçš„å‡ ä¸ªæœˆå‰ï¼Œæˆ‘å’Œ Corey Haines èŠäº†ã€‚æˆ‘å‘ä»–å“€åšè‡ªå·±æƒ³é€šè¿‡æœ‰å¸å¼•åŠ›çš„æ–¹å¼å‘äººä»¬å±•ç¤ºå‡½æ•°å¼ç¼–ç¨‹çš„æ¦‚å¿µï¼Œå´ä¸æƒ³å¦‚é‚£äº›å‘†æ¿çš„å­¦é™¢æ´¾ä¹¦ç±ä¸€æ ·ã€‚ä»–å‘Šè¯‰æˆ‘å†å»è¯•è¯• Elixirã€‚æˆ‘è¯•äº†ï¼Œç„¶åæ‰¾åˆ°äº†å½“åˆé‡è§ Ruby æ—¶çš„é‚£ç§æ„Ÿè§‰ã€‚  æ‰€ä»¥ç°åœ¨çš„æˆ‘è¿›å…¥äº†â€œå±é™©çŠ¶æ€â€â€”â€”æˆ‘æƒ³è¦è®©å…¶ä»–çš„äººä»¬çŸ¥é“ Elixir æœ‰å¤šç‰›ï¼Œæˆ‘æƒ³ä¼ é“ã€‚æ‰€ä»¥æˆ‘å†™äº†æœ¬ä¹¦ã€‚ä½†æˆ‘ä¸æƒ³å†å†™ä¸€æœ¬900é¡µçš„é•å¤´ä¹¦ï¼Œæˆ‘æƒ³è¦è®©æœ¬ä¹¦ç®€æ˜æ‰¼è¦åˆæ¿€åŠ¨äººå¿ƒã€‚å› æ­¤æˆ‘ä¸æ‰“ç®—è€ƒç©¶æ‰€æœ‰çš„ç»†èŠ‚ï¼Œåˆ—å‡ºå…¨éƒ¨çš„è¯­æ³•ï¼Œä»¥åŠå®Œæ•´çš„åº“å‡½æ•°åˆ—è¡¨ï¼Œé½å¤‡çš„ OTP é€‰é¡¹ï¼Œç­‰ç­‰â€¦â€¦  ç›¸åï¼Œæˆ‘æ‰“ç®—å¸¦ç»™ä½ ä»¬ Elixir ä½œä¸ºç¼–ç¨‹æ¨¡å‹çš„å¼ºå¤§å’Œç¾ã€‚æˆ‘æƒ³æ¿€åŠ±æ‚¨å‚ä¸å…¶ä¸­ï¼Œç„¶åç»™å‡ºèƒ½å¡«è¡¥ç©ºç™½çš„åœ¨çº¿èµ„æºã€‚  ä½†æœ€ä¸»è¦çš„æ˜¯ï¼Œæˆ‘å¸Œæœ›ä½ ä»ä¸­è·å¾—ä¹è¶£ã€‚  3å¹´è¿‡å»äº†ï¼ŒElixir ä¹Ÿåœ¨è¿›æ­¥ã€‚Phoenixï¼Œå®ƒç›¸åº”çš„å¼€å‘æ¡†æ¶ï¼Œä»¥å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€æ•´å¥—æ–¹æ¡ˆæŠŠå¿«ä¹å¸¦ç»™äº†å¼€å‘è€…ä»¬ã€‚è¿™ä¸ªç²¾å½©çš„é¡¹ç›®ä½¿å¾—åœ¨ Linux ä¸ºåŸºç¡€çš„å¾®æ§åˆ¶å™¨ä¸­ç¼–å†™ Elixir ä»£ç å˜å¾—å¦‚æ­¤å®¹æ˜“ã€‚Elixir æœ¬èº«ä¹Ÿåœ¨æˆé•¿ï¼Œä¸¾åŠäº†è®¸å¤šå…¨çƒæ€§ã€å›½å®¶æˆ–åŒºåŸŸæ€§çš„å¼€å‘è€…å¤§ä¼šã€‚å‡ºç°äº†æ›´å¤šçš„æ‹›è˜ Elixir å¼€å‘è€…çš„å²—ä½ã€‚  æˆ‘è‡ªå·±ä¹ŸåŒæ ·åœ¨è¿›æ­¥ã€‚ä½†æˆ‘ä»ç„¶æ¯å¤©éƒ½ä¼šä½¿ç”¨ Elixirã€‚æˆ‘åˆšåˆšç»“æŸäº†åœ¨å—å«ç†å…¬ä¼šå¤§å­¦çš„ç¬¬äºŒå¹´åŠ©æ•™å·¥ä½œâ€”â€”ç”¨ Elixir çš„é­…åŠ›è¯±æƒ‘æœªæ¥çš„ç¨‹åºå‘˜ã€‚æˆ‘å†™äº†ä¸€ä¸ª Elixir çš„åœ¨çº¿æ•™ç¨‹ã€‚  ç°åœ¨æˆ‘æ¥åˆ°äº†æ’°å†™æœ¬ä¹¦çš„è¦æ±‚ã€‚è¯´å®è¯ï¼Œè¿™å¹¶éå¿…é¡»ï¼Œå› ä¸º Elixir 1. 6 è·Ÿ 1. 3 ç›¸æ¯”å¹¶æ²¡æœ‰é‚£ä¹ˆå¤§çš„å·®åˆ«ä½¿å¾—ä¸Šä¸€ç‰ˆä¹¦å°±ä¸èƒ½çœ‹äº†ã€‚ä½†æˆ‘ä¸ªäººè§‰å¾— Elixir å·²ç»æˆç†Ÿï¼Œæ‰€ä»¥ç°åœ¨æˆ‘è¦åšç‚¹ä¸åŒçš„äº‹ï¼Œä¹Ÿä¹æ„æŠŠè¿™äº›åˆ†äº«ç»™ä½ ä»¬ã€‚ "
    }, {
    "id": 56,
    "url": "/2020/06/dhh-citadel-pattern-for-majestic-monolith/",
    "title": "â€œé›„ä¼Ÿå·¨çŸ³â€ å¯ä»¥æˆä¸º â€œåŸå ¡â€",
    "body": "2020/06/22 - ã€æœ¬æ–‡é¦–å‘äº RubyChina ç¤¾åŒºã€‘DHH åœ¨ 2020. 04. 08 å‘è¡¨äº†ä¸€ç¯‡æœ€æ–°åšå®¢ â€œThe Majestic Monolith can become The Citadelâ€ï¼Œç»§ç»­è®¨è®ºå¯¹å¾®æœåŠ¡çš„ä¸€ç‚¹çœ‹æ³•ï¼Œæå‡ºäº†ä¸€ç§ä¸å¾®æœåŠ¡ç›¸å¯¹çš„â€œåŸå ¡â€æ¨¡å¼ã€‚åœ¨ Twitter ä¸Šä¹Ÿå¼•å‘äº†ä¸å°‘å…³æ³¨ï¼Œæœå…³é”®å­—â€œThe Majestic Monolithâ€å°±èƒ½çœ‹åˆ°å¾ˆå¤šã€‚è¿™æ˜¯åŸæ–‡é“¾æ¥ï¼šhttps://m. signalvnoise. com/the-majestic-monolith-can-become-the-citadel/ æˆ‘æŒ‰ç…§ä¸ªäººç†è§£ï¼Œç²—ç•¥ç¿»è¯‘äº†ä¸€ä¸‹ã€‚çœ‹åˆ°çš„æœ‹å‹å¯ä»¥å¯¹ç…§åŸæ–‡æ¥çœ‹ï¼Œä»¥é˜²é—æ¼ä½œè€…çš„æœ¬æ„ã€‚ ã€ä¸‹é¢æ˜¯æ­£æ–‡ã€‘ â€œé›„ä¼Ÿå·¨çŸ³â€å¯ä»¥æˆä¸ºâ€œåŸå ¡â€: å¤§å¤šæ•°çš„ Web åº”ç”¨åº”è¯¥éƒ½æ˜¯ä»ä¸€å—â€œé›„ä¼Ÿå·¨çŸ³â€å¼€å§‹å…¶ç”Ÿæ¶¯çš„ï¼šä¸€ä¸ªå•ä¸€ä»£ç åº“åšå…¶æ‰€éœ€çš„æ‰€æœ‰äº‹å„¿ã€‚ä¸ä¹‹ç›¸å¯¹çš„æ˜¯ä¸€ç¾¤ Serviceï¼Œä¸ç®¡è¿™äº› Service æ˜¯â€œå¾®â€è¿˜æ˜¯â€œå¤§ä¸€ç‚¹â€çš„ï¼Œéƒ½è¯•å›¾æŠŠåº”ç”¨åˆ‡æˆå­¤å²›ï¼Œæ¯ä¸ªä»…åšæ•´ä½“å·¥ä½œçš„ä¸€å°ç‰‡è€Œå·²ã€‚ å¤§å¤šæ•°çš„ Web åº”ç”¨éƒ½å°†ä»¥â€œé›„ä¼Ÿå·¨çŸ³â€å½¢æ€åœ¨å…¶ä¸€ç”Ÿä¸­éƒ½èƒ½æŒç»­æä¾›å¾ˆå¥½çš„æœåŠ¡ã€‚è¿™ç§æ¨¡å¼çš„ä¸Šé™å¾ˆé«˜ï¼Œæ¯”å¤§éƒ¨åˆ†äººå¹»æƒ³æˆä¸ºæ¶æ„å¸ˆæ—¶æ‰€èƒ½æƒ³è±¡çš„è¦é«˜å¾—å¤šã€‚ ä½†æ˜¯ï¼Œå°½ç®¡å¦‚æ­¤ï¼Œâ€œé›„ä¼Ÿå·¨çŸ³â€ä»ç„¶ä¼šæœ‰éœ€è¦ä¸€äº›å¸®åŠ©çš„é‚£ä¸€å¤©ã€‚ä¹Ÿè®¸ä½ æ­£åœ¨ä¸åºå¤§çš„å›¢é˜Ÿæ‰“äº¤é“ï¼Œå…¶ä¸­çš„äººä»¬ç›¸äº’ç£•ç£•ç»Šç»Šï¼ˆå³ä½¿è¿™æ ·ï¼Œåˆ«å¿˜äº†æœ‰å¾ˆå¤šéå¸¸å¤§çš„ç»„ç»‡ä¾ç„¶åœ¨ä½¿ç”¨ monorepo æ¨¡å¼ï¼ï¼‰ã€‚æˆ–è€…ä½ ç»ˆç©¶ä¼šé‡åˆ°æç«¯è´Ÿè½½ä¸‹çš„æ€§èƒ½æˆ–å¯ç”¨æ€§é—®é¢˜ï¼Œè¿™åœ¨â€œé›„ä¼Ÿå·¨çŸ³â€çš„æŠ€æœ¯é€‰æ‹©èŒƒå›´å†…æ— æ³•è½»æ¾è§£å†³ã€‚ä½ çš„ç¬¬ä¸€ç›´è§‰å°†æ˜¯æ”¹è¿›â€œé›„ä¼Ÿå·¨çŸ³â€ç›´åˆ°å…¶èƒ½å¤Ÿåº”å¯¹é—®é¢˜ï¼Œåšäº†è¿™ä¸€åˆ‡è€Œæ²¡æˆåŠŸæ—¶ï¼Œä½ æ‰ä¼šè€ƒè™‘ä¸‹ä¸€æ­¥ã€‚ ä¸‹ä¸€æ­¥å°±æ˜¯â€œåŸå ¡â€ï¼Œä¿æŒâ€œé›„ä¼Ÿå·¨çŸ³â€åœ¨ä¸­å¿ƒä½ç½®ï¼Œä½†ç”¨ä¸€ç³»åˆ—çš„â€œåŸºåœ°â€å¯¹å…¶æ”¯æ´ï¼Œæ¯ä¸ªåˆ†ç¦»å‡ºåº”ç”¨ç¨‹åºèŒèƒ½ä¸€ä¸ªå°çš„å­é›†ã€‚â€œåŸºåœ°â€ä½¿å¾—â€œé›„ä¼Ÿå·¨çŸ³â€å¾—ä»¥å¸ä¸‹å…¶ä¸åŒè¡Œä¸ºçš„ä¸€ä¸ªåˆ‡ç‰‡ï¼Œï¼ˆè¿™äº›ä¸åŒè¡Œä¸ºï¼‰è¦ä¹ˆæ˜¯å‡ºäºç»„ç»‡åŸå› ï¼Œè¦ä¹ˆæ˜¯å‡ºäºæ€§èƒ½æˆ–å®ç°çš„åŸå› ã€‚ ä¸€ä¸ªåœ¨ Basecamp çš„è¿™ç§ä¾‹å­æ˜¯æˆ‘ä»¬çš„æ—§ chat åº”ç”¨ Campfireã€‚å®ƒæ˜¯åœ¨ 2005 å¹´æ„å»ºçš„ï¼Œé‚£æ—¶ Ajax å’Œå…¶ä»– JavaScript æŠ€æœ¯éƒ½è¿˜å¾ˆæ–°é¢–ï¼Œæ‰€ä»¥å®ƒåŸºäº polling è€Œä¸æ˜¯ç°ä»£ chat app ç›®å‰ä½¿ç”¨çš„é•¿è¿æ¥ã€‚è¿™æ„å‘³ç€æ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥åˆ°ç³»ç»Ÿéƒ½ä¼šæ¯ä¸‰ç§’è§¦å‘ä¸€ä¸ªè¯·æ±‚æ¥è¯¢é—®â€œæ˜¯å¦æœ‰æˆ‘çš„æ–°æ¶ˆæ¯ï¼Ÿâ€ã€‚å¤§å¤šæ•°è¿™äº›è¯·æ±‚éƒ½ä¼šå›ç­”â€œä¸ï¼Œæ²¡æœ‰â€ï¼Œä½†ä¸ºäº†è·å–è¿™ä¸ªç­”æ¡ˆï¼Œä½ ä»ç„¶ä¸å¾—ä¸å¯¹è¯·æ±‚è¿›è¡Œèº«ä»½éªŒè¯ï¼ŒæŸ¥è¯¢æ•°æ®åº“ï¼Œç­‰ç­‰ã€‚ ä¸åº”ç”¨ç¨‹åºçš„å…¶ä»–ç›¸æ¯”ï¼Œè¿™ä¸ªæœåŠ¡çš„æ€§èƒ½ç‰¹å¾å¤§ä¸ç›¸åŒã€‚åœ¨ä»»ä½•ç»™å®šæ—¶é—´ï¼Œå®ƒéƒ½å°†å æ‰€æœ‰è¯·æ±‚çš„99%ã€‚å®ƒä¹Ÿæ˜¯ä¸€ä¸ªç¡®å®å¾ˆç®€å•çš„ç³»ç»Ÿã€‚åœ¨ Ruby ä¸­ï¼Œå®ƒä»…ä»… 20 è¡Œä»£ç é•¿åº¦è€Œå·²ï¼Œå¦‚æœæˆ‘æ²¡è®°é”™çš„è¯ã€‚æ¢å¥è¯è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªæå¥½çš„â€œåŸºåœ°â€å€™é€‰äººï¼ æ‰€ä»¥æˆ‘ä»¬å°±ï¼ˆä¸ºå®ƒï¼‰æ„ç­‘äº†ä¸€ä¸ªâ€œåŸºåœ°â€ã€‚è¿™ä¹ˆäº›å¹´æ¥ï¼Œåœ¨æ—¥å…‰ä¸‹ä½¿ç”¨æ¯ç§é«˜æ€§èƒ½ç¼–ç¨‹è¯­è¨€æ¥é‡å†™è¿™ç§â€œåŸºåœ°â€æˆä¸ºäº†æˆ‘ä»¬çš„ä¹è¶£ï¼Œå› ä¸ºé€šå¸¸åªç”¨çŸ­çŸ­å‡ ç™¾è¡Œä»£ç å°±èƒ½æå®šï¼Œä¸ç®¡ä»€ä¹ˆè¯­è¨€ã€‚æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨äº† Cï¼ŒC++ï¼ŒGoï¼ŒErlangï¼Œè¿˜æœ‰äº›æˆ‘éƒ½å¿˜è®°äº†ã€‚ ä½†è¿™æ˜¾ç„¶æ˜¯ä¸€ç§â€œåŸºåœ°â€ï¼åº”ç”¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ç»§ç»­ä½œä¸º Ruby on Rails æ„å»ºçš„â€œé›„ä¼Ÿå·¨çŸ³â€ã€‚æˆ‘ä»¬æ²¡æœ‰è¯•å›¾æŠŠæ•´ä¸ª app åˆ‡æˆå°çš„ Serviceï¼Œæ¯ä¸ªä»¥ä¸åŒè¯­è¨€æ¥ç¼–å†™ã€‚ä¸ï¼Œæˆ‘ä»¬åªæ˜¯åˆ†ç¦»å‡ºä¸€ä¸ªå•ç‹¬çš„â€œåŸºåœ°â€ã€‚è¿™æ˜¯ä¸€ä¸ªâ€œåŸå ¡â€çš„å»ºè®¾ã€‚ éšç€è¶Šæ¥è¶Šå¤šçš„äººä»¬æ„è¯†åˆ°å¯¹äºå¾®æœåŠ¡çš„è¿½é€ä¼šèµ°ä¸Šä¸€æ¡æ­»èƒ¡åŒï¼Œâ€œé’Ÿæ‘†å°†ä¼šå†æ‘†åŠ¨å›æ¥â€œã€‚â€œé›„ä¼Ÿå·¨çŸ³â€åœ¨è¿™å„¿ç­‰å¾…ç€å¾®æœåŠ¡çš„â€œéš¾æ°‘â€ã€‚å¦‚æœä»–ä»¬ç¡®å®åšåˆ°äº†å¤§å‹åº”ç”¨ç¨‹åºçš„è§„æ¨¡ï¼Œé‚£ä¹ˆâ€œåŸå ¡â€è¿™ç§å¯ä»¥æ‰©å±•çš„æ¨¡å¼è¶³ä»¥è®©ä½ å®‰å¿ƒã€‚ "
    }, {
    "id": 57,
    "url": "/2020/06/update-blog-to-jekyll-4-1-with-github-actions/",
    "title": "åœ¨ Github Actions æ”¯æŒä¸‹å‡çº§åšå®¢åˆ° Jekyll 4.1",
    "body": "2020/06/18 - æˆ‘ä¸€ç›´ä½¿ç”¨ Github Page ä½œä¸ºè‡ªå·±çš„åšå®¢ï¼Œç®€å•ï¼Œå¤Ÿç”¨ã€‚è€Œåšå®¢æ˜¯ä½¿ç”¨ Jekyll æ¥æ­å»ºçš„ï¼Œè¿™ä¹Ÿæ˜¯ Github å®˜æ–¹çš„æ¨èæ–¹å¼ä¹‹ä¸€ã€‚æœ€è¿‘å‘ç° Jekyll å·²ç»åˆ°äº† 4. 1. 0ï¼Œäºæ˜¯æ‰“ç®—æŠŠåšå®¢ä¹Ÿå‡çº§åˆ°æœ€æ–°ç‰ˆã€‚è¯´å¹²å°±æ’¸èµ·è¢–å­å¼€å§‹ã€‚ åšå®¢ç°çŠ¶: ä¸è¿‡ç¨å¾®å¿«é€Ÿè°ƒç ”äº†ä¸€ä¸‹ï¼Œå‘ç°ä¸€ä¸ªæ‚²å‚¬çš„äº‹æƒ…ï¼šGithub å®˜æ–¹ç›®å‰è¿˜æ˜¯åªæ”¯æŒåˆ° Jekyll 3. 8. 7 è€Œå·²ã€‚è™½ç„¶è¿™ä¸ªç‰ˆæœ¬ä¹Ÿä¸ç®—å¤ªæ—§ï¼Œä½†æœ€è¿‘ä¸€æ¬¡æ›´æ–°ä¹Ÿæ˜¯ä¸¤å¹´å‰äº†ã€‚ å¦å¤–ï¼ŒJekyll 4 æ‰€æ”¯æŒçš„ Pluginï¼Œç›®å‰çš„ Github Page ä¹Ÿæš‚æ—¶è¿˜ä¸æ”¯æŒã€‚ æ€ä¹ˆåŠå‘¢ï¼Ÿ å½“ç„¶æ˜¯ç»§ç»­å¯»æ‰¾æŠ€æœ¯å±‚é¢çš„è§£å†³æ–¹æ¡ˆå…ˆï¼Œè€Œä¸”ä¹Ÿå¾ˆå¿«å°±æ‰¾åˆ°äº†â€”â€”Github å®˜æ–¹å»å¹´å‘å¸ƒçš„ Github Actions å°±æ˜¯è§£å†³æ–¹æ¡ˆï¼ Github Actions: Github Actions ç®€å•æ¥è¯´å°±æ˜¯ Github å®˜æ–¹æ¨å‡ºçš„ä¸€å¥— CI/CD å·¥å…·ï¼ŒæŠŠ buildã€testã€deploy ç›´æ¥å’Œä½ çš„ Github ä»£ç åº“æ•´åˆèµ·æ¥ï¼Œå†ä¹Ÿä¸ç”¨å»å¯»æ‰¾ç¬¬ä¸‰æ–¹çš„å·¥å…·ã€‚æ¯•ç«Ÿè‡ªå®¶çš„ä¸œè¥¿ç”¨èµ·æ¥æœ€ç§°å¿ƒä¸æ˜¯ã€‚ Github Actions çš„åŸºæœ¬æµç¨‹å°±æ˜¯ï¼Œå½“ä½ æœ‰ä»£ç  push åˆ° Github ä»£ç åº“æ—¶ï¼Œå°±ä¼šè§¦å‘ Actions ä¸­äº‹å…ˆå®šä¹‰å¥½çš„ Workflowï¼Œå¯¹ä½ çš„ä»£ç è¿›è¡Œ buildã€testã€deployç­‰æ“ä½œã€‚è¿™æ­£å¥½æ»¡è¶³äº†æ–° Jekyll ç‰ˆæœ¬çš„è¦æ±‚ã€‚ å‡çº§åˆ° Jekyll 4. 1: å…ˆ Google æ‰¾åˆ°ä¸€å¥— Free çš„ Jekyll 4 çš„ Themeï¼ˆæˆ‘æœ€ç»ˆé€‰æ‹©çš„æ˜¯Memoirs Jekyll Themeï¼‰ã€‚ç„¶ååœ¨æœ¬åœ°æŒ‰å…¶è¦æ±‚å¯¹åŸæœ‰ä»£ç å’Œæ–‡ä»¶è¿›è¡Œæ›¿æ¢ã€ä¿®æ”¹ç­‰å¸¸è§„æ“ä½œä¸æã€‚Push ä¹‹å‰å½“ç„¶éœ€è¦å…ˆåœ¨æœ¬åœ°é¢„è§ˆä¸‹æ•ˆæœï¼Œé‚£ä¹ˆåœ¨ä»£ç åº“ä¸‹å…ˆè¿è¡Œ bundle installå®‰è£… Jekyll 4. 1 ç­‰ Gem åŒ…åï¼Œå†è¿è¡Œ bundle exec jekyll serve --watchè¿™æ ·å°±å¯ä»¥è®© Jekyll è¿è¡Œåœ¨æœ¬åœ°çš„ 4000 ç«¯å£ã€‚æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥ http://localhost:4000å°±èƒ½çœ‹åˆ°æ–° Theme çš„æ¨¡æ ·äº†ã€‚ Jekyll 4 çš„ Github Actions æ”¯æŒ: è¿›è¡Œå¿…è¦çš„ä¿®æ”¹å®Œæˆï¼Œç¡®å®šæ— è¯¯åï¼Œæ¥ä¸‹æ¥å°±è¿›è¡Œé…ç½® Github Actions çš„ç¯èŠ‚äº†ã€‚è¿™ä¹Ÿæ˜¯æœ€å…³é”®çš„éƒ¨åˆ†ï¼Œå†³å®šäº†æ–°åšå®¢èƒ½å¦è¢« Github æ­£ç¡®åœ°è§£ææ˜¾ç¤ºã€‚å¦‚æœä¸å¯¹ï¼Œåšå®¢å°±æ— æ³•è¢«äººè®¿é—®äº†ã€‚ å¹¸è¿çš„æ˜¯ï¼Œè¿™ä¸ªéœ€æ±‚æ˜¯å¦‚æ­¤å¹¿æ³›ï¼ŒJekyll å®˜æ–¹å·²ç»ç»™å‡ºäº†ä¸€ä¸ª Github Actions çš„é…ç½®èŒƒä¾‹ï¼šGithub Actions for Jekyll 4ã€‚ä»æˆ‘è‡ªå·±é…ç½®å¥½çš„æœ€ç»ˆç»“æœæ¥çœ‹ï¼ŒåŸºæœ¬ä¸Šåªè¦å®‰è£…è¿™ä¸ªå®˜æ–¹æ–‡æ¡£æ¥å°±ä¸‡äº‹å¤§å‰ã€‚è¿™é‡Œåªç®€å•åˆ—å‡ºå‡ ä¸ªæ¯”è¾ƒå…³é”®çš„ç‚¹ï¼Œç®€å•è¯´ä¸€ä¸‹ã€‚ åˆ›å»º Github Actions çš„ Workflow: åœ¨ä»£ç åº“æ ¹è·¯å¾„ä¸‹åˆ›å»º. github/workflowsï¼Œç„¶ååœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªyamlæ–‡ä»¶ï¼Œæ–‡ä»¶åæ¯”å¦‚å«gh-pages. ymlã€‚ è¿™ä¸ªyamlæ–‡ä»¶çš„å†…å®¹å¯ä»¥ç›´æ¥æ‹·è´æ–‡æ¡£ä¸Šçš„èŒƒä¾‹ï¼Œå› ä¸ºéƒ½æ˜¯é€šç”¨çš„ï¼š name: Build and deploy Jekyll site to GitHub Pageson: push:  branches:   - masterjobs: github-pages:  runs-on: ubuntu-16. 04  steps:   - uses: actions/checkout@v2   - uses: helaili/jekyll-action@2. 0. 1. . . è¿™ä¸ªyamlå®é™…ä¸Šå°±æ˜¯å®šä¹‰äº† Github Actions çš„ä¸€ä¸ª workflowã€‚å½“ç„¶å…¶å…·ä½“è§„èŒƒå’Œå«ä¹‰ï¼Œå¯ä»¥å‚è€ƒ Github çš„å®˜æ–¹æ–‡æ¡£è¯´æ˜ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚ å…³äº JEKYLL_PAT: å”¯ä¸€ä¸€ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œå°±æ˜¯JEKYLL_PATè¿™é‡Œã€‚è¿™æ˜¯è®¾å®šäº†ä¸€ä¸ª secret çš„ç¯å¢ƒå˜é‡ï¼ŒJEKYLL_PATæ˜¯éœ€è¦è®¾ç½®çš„ä¸€ä¸ª Github çš„Personal Access Tokenï¼Œå…·ä½“è®¾ç½®æ–¹æ³•å‚è€ƒä¸Šé¢ Jekyll æ–‡æ¡£ä¸­Providing permissionsè¿™ä¸€èŠ‚çš„æ­¥éª¤æ¥åšå³å¯ã€‚ å¤§åŠŸå‘Šæˆ: å…¨éƒ¨å®Œæˆä¹‹åï¼ŒæŠŠæ‰€æœ‰æ–°ä»£ç  Push ä¸Š Githubï¼Œç„¶åæ‰“å¼€å¯¹åº”ä»£ç åº“çš„ Actions æ ‡ç­¾ã€‚å¦‚æœä¸Šè¿°é…ç½®éƒ½æ­£ç¡®æ— è¯¯çš„è¯ï¼Œå°±ä¼šçœ‹åˆ°è¿™é‡Œä¼šå‡ºç°ä¸€ä¸ªæ­£åœ¨è¿è¡Œä¸­çš„ Github Actions çš„ Workflowã€‚æ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯é™é™åœ°ç­‰å¾…â€¦â€¦ 5åˆ†é’Ÿåï¼ˆåŒ…æ‹¬ä¸Šé¢ Workflow è¿è¡Œæ—¶é—´å’Œ Github æ›´æ–°åšå®¢å†…å®¹çš„æ—¶é—´ä¸€èµ·ï¼‰ï¼Œé‡æ–°æ‰“å¼€æˆ‘çš„åšå®¢ï¼Œå…¨æ–°çš„ç•Œé¢å‡ºç°åœ¨é¢å‰ï¼è¯•è¯•ç‚¹å‡»ä¸€äº›é“¾æ¥ï¼Œç¡®è®¤éƒ½æ²¡æœ‰é—®é¢˜ï¼Œæ‰€æœ‰é¡µé¢å®Œå…¨æ˜¾ç¤ºæ­£ç¡®ï¼Œç«™å†…æœç´¢å’Œ Disqus è¯„è®ºç­‰åŠŸèƒ½ä¸€åˆ‡æ­£å¸¸ã€‚ è‡³æ­¤åšå®¢å‡çº§é¡ºåˆ©å®Œæˆï¼ "
    }, {
    "id": 58,
    "url": "/2017/03/prefer-ember-js-over-angular-and-react-js/",
    "title": "ä¸ºä»€ä¹ˆæˆ‘åçˆ± Ember.js èƒœè¿‡ Angular å’Œ React.js",
    "body": "2017/03/26 - å‰å‡ å¤©çœ‹åˆ°äº†è¿™ç¯‡æ–‡ç« ï¼šWhy I prefer Ember. js over Angular &amp; React. jsï¼Œè§‰å¾—å¯¹äºå›½å†…æœŸæœ›äº†è§£ Ember. js çš„å¼€å‘è€…æ¥è¯´æ˜¯ä¸€ä¸ªä¸é”™çš„ä»‹ç»ã€‚äºæ˜¯å’Œè¯¥æ–‡çš„ä½œè€… Paul Shan è”ç³»å–å¾—ç¿»è¯‘çš„æˆæƒï¼Œç¿»è¯‘äº†è¿‡æ¥ã€‚è¯‘æ–‡å¦‚ä¸‹ï¼š ä»æˆ‘å¼€å§‹å†™ JavaScript å·²ç»æœ‰5å¹´äº†ã€‚æ— è®ºæ˜¯å¼€å‘é¡¹ç›®ï¼ŒæŒ‡å¯¼åˆ«äººï¼Œè¿˜æ˜¯å‘å¸ƒæ–‡ç« ï¼ŒJavaScript éƒ½ç»™äº†æˆ‘æå¤§çš„æ»¡è¶³æ„Ÿã€‚æ„Ÿè°¢ JavaScriptï¼ åœ¨è¿‡å»5å¹´é‡Œæˆ‘ä½¿ç”¨è¿‡å¾ˆå¤š JavaScript æ¡†æ¶ï¼Œä¸ç®¡åšåç«¯è¿˜æ˜¯å‰ç«¯ã€‚ä½† Ember ä»2015å¹´ä¸­æœŸå°±ä»æˆ‘çš„å¼€å‘ä¸–ç•Œä¸­æ¶ˆå¤±äº†ã€‚å¹¸è¿çš„æ˜¯1ä¸ªæœˆå‰æœºç¼˜å‡‘å·§æˆ‘åˆå‚åŠ äº†ä¸€ä¸ªç”¨ Ember åšçš„å‰ç«¯é¡¹ç›®ã€‚èµ·åˆæˆ‘å¹¶ä¸å¤ªåœ¨æ„è¿™ç‚¹ï¼ŒåªæŠŠå®ƒå½“ä½œä¸è¿‡åˆä¸€ä¸ªæ—¥å¸¸å¼€å‘è€Œå·²ã€‚ä½†éšç€é¡¹ç›®çš„æ·±å…¥æˆ‘å¼€å§‹æ€è€ƒè‡ªå·±å…³äºè¿™ä¸‰ä¸ªå‰ç«¯æ¡†æ¶çš„ä½“éªŒï¼Œå¹¶åœ¨ä»Šå¤©æŠŠå®ƒè®°å½•ä¸‹æ¥ã€‚ å£°æ˜:  è¯¥æ–‡å¹¶éæ˜¯è¦æŠ¨å‡» Angular æˆ– Reactã€‚ è¯¥æ–‡å¹¶éè¦å¾ˆæ·±å…¥æ¢è®¨æŠ€æœ¯å±‚é¢çš„éƒ¨åˆ†ï¼Œè€Œæ˜¯ä½œä¸ºä¸€ä¸ªå¼€å‘äººå‘˜å¯¹å…¶çœŸå®ä½¿ç”¨ä½“éªŒçš„åéœ²ã€‚ æ ‡é¢˜ä¸­æˆ‘ä½¿ç”¨äº†â€œåçˆ±â€è€Œéâ€œæ¨èâ€çš„å­—çœ¼ï¼Œå› ä¸ºâ€œæ¨èâ€å¾€å¾€è¦å’Œå…·ä½“é¡¹ç›®å…·ä½“åœºæ™¯ç›¸å…³ï¼Œè€Œâ€œåçˆ±â€åˆ™æ˜¯ä¸€ç§æ›´æ™®é€‚æ€§çš„æè¿°ã€‚Ember ä»¤äººæ»¡æ„ä¹‹æ‰€åœ¨: åŸç”Ÿæ„Ÿå—: è¯´å®è¯ï¼Œæœ€è¿‘å‡ å¹´æ¥æˆ‘å¯¹ JavaScript è¶Šæ¥è¶Šä¸æ»¡ã€‚æˆ‘ä¸å–œæ¬¢æœ‰äººè¯•å›¾ç”¨å·¥ç¨‹çš„æ¨¡å¼æ¥å¯¹å¾… JavaScriptã€‚æˆ‘å–œçˆ± JavaScript å°±ä»…ä»…æ˜¯ JavaScript è€Œå·²ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä¸ºä»€ä¹ˆä¸å–œæ¬¢ TypeScriptï¼Œä»¥åŠ Angular 2ã€‚æˆ‘çœ‹ä¸åˆ°ä»»ä½•ç”¨å¤„æ¥å¤šå­¦ä¹ å¦ä¸€é—¨è¯­è¨€ï¼Œåªä¸ºäº†è¯•å›¾å¼•å…¥ä¸€äº›ä¸‘é™‹çš„ç±»ï¼ˆæˆ‘çŸ¥é“æ˜¯å¯é€‰çš„ï¼‰å’Œè¯­æ³•ã€‚React è‡³å°‘åœ¨è¿™ä¸€ç‚¹ä¸Šåšçš„æ¯” Angular 2 å¥½ä¸€äº›ï¼Œä½†ä½ ä¾æ—§è¦é¢å¯¹ jsx çš„é—®é¢˜ã€‚ ç›¸åï¼ŒEmber ä½¿ç”¨äº†çº¯ JavaScriptã€‚ä½ åªç”¨å†™ JavaScriptã€‚Ember æä¾›äº†å¾ˆå¤š apiï¼Œå´æ²¡æœ‰é¢å¤–çš„è¯­æ³•ã€‚è¿™è®©æˆ‘ä½œä¸º JavaScript å¼€å‘è€…è€Œè¨€æ„Ÿè§‰å¾ˆæ£’ã€‚ çº¦å®šå¤§äºé…ç½®: ç›¸ä¿¡æˆ‘ï¼Œå°½å¯èƒ½åœ°å‡å°‘é…ç½®ç›¸å…³ä»£ç å¯¹ä½ çš„é¡¹ç›®å°†æœ‰å·¨å¤§çš„å¥½å¤„ã€‚é¦–å…ˆï¼Œä»£ç ä¼šå˜å¾—å°‘è€Œæ¸…çˆ½ã€‚å…¶æ¬¡ï¼Œçº¦å®šå°†æ˜¯é€šç”¨çš„ï¼Œä»»ä½•æ–°åŠ å…¥çš„å¼€å‘è€…éƒ½èƒ½äº†è§£å‘ç”Ÿäº†ä»€ä¹ˆã€‚å¯¹äºé‚£äº›ä¹‹å‰ä»æ²¡æœ‰ä½¿ç”¨è¿‡ Ember çš„äººæ¥è¯´ï¼Œåªè¦ä½ éµå¾ªäº†çº¦å®šæ¥å‘½åæ–‡ä»¶å’Œå˜é‡ï¼ŒEmber å°±èƒ½è‡ªå·±å¤„ç†å¥½å‰©ä¸‹çš„äº‹æƒ…ã€‚ æ‰€è§è¿‡çš„æœ€å¥½æ–‡æ¡£: Ember guides å’Œ Ember API çš„æ–‡æ¡£å¯èƒ½æ˜¯æˆ‘å¼€å‘ç”Ÿæ¶¯ä¸­è§è¿‡çš„æœ€å¥½æŠ€æœ¯æ–‡æ¡£ã€‚å³ä½¿æ˜¯ä¸€ä¸ªåˆå­¦è€…éƒ½èƒ½å¾ˆå®¹æ˜“ç†è§£å¹¶ä¸Šæ‰‹ã€‚Ember çš„å®˜æ–¹è®ºå›å¯¹äºè§£å†³ç–‘é—®ä¹Ÿå¾ˆæœ‰å¸®åŠ©ã€‚ æœ€å¥½çš„æ„å»ºä½“éªŒ: Ember-CLI æ˜¯ Ember çš„ä¸€å¤§æ€å™¨ã€‚å³ä½¿ Angular éƒ½è¯•å›¾å€Ÿé‰´ Ember çš„è¿™ä¸€å·¥å…·æ¥å¼€å‘è‡ªå·±çš„ CLIã€‚ä½¿ç”¨ ember-cli ä½ å¯ä»¥å¿«é€Ÿæ„å»ºä¸€ä¸ªé¢„å®šä¹‰å¥½ç›®å½•æ–‡ä»¶æ¶æ„çš„é¡¹ç›®ï¼Œè€Œè¿™æ ·çš„æ¶æ„æ˜¯ç»è¿‡ç¤¾åŒºçš„è®¨è®ºå’Œå®è·µæ‰€éªŒè¯è¿‡çš„ã€‚å½“é¡¹ç›®å¼€å§‹æ„å»ºæ—¶ï¼Œæ— è®ºå›¢é˜Ÿæ˜¯å¦å¯¹æ­¤æœ‰ç»éªŒï¼Œéƒ½å®Œå…¨ä¸ç”¨æ‹…å¿ƒæœ‰æ²¡æœ‰éµå¾ªæœ€ä½³å®è·µçš„é—®é¢˜ã€‚å¯¹äº React è€Œè¨€è¿™é‡Œå°±å¯èƒ½å­˜åœ¨é£é™©ï¼Œå› ä¸ºå®ƒåªæ˜¯ä¸€ä¸ªåº“å¹¶éæ˜¯ä¸€ä¸ªæ¡†æ¶ã€‚ å¼ºåˆ¶æ€§çš„æœ€ä½³å®è·µ: å³ä½¿ä½ çš„å›¢é˜Ÿä¸­æœ‰å¾ˆæ£’çš„å¼€å‘è€…ï¼Œæœ‰æ—¶å€™è¿«äºä¸Šçº¿çš„å‹åŠ›ä»–ä»¬ä¹Ÿä¼šå†™å‡ºåçš„ä»£ç ã€‚è€Œ Ember ä¼šè‡³å°‘åœ¨æŸäº›å±‚é¢ä¸Šå¼ºåˆ¶æ€§åœ°è®©ä½ é‡‡å–æœ€ä½³å®è·µçš„æ–¹å¼ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½ ä¸åº”è¯¥æŠŠä¸šåŠ¡é€»è¾‘å†™åˆ°æ¨¡ç‰ˆä¸­ã€‚Ember çš„æ¨¡ç‰ˆé‡Œåªå¯ä»¥ä½¿ç”¨è¿­ä»£ iteration å’Œå¸¦å¸ƒå°”å‚æ•°çš„ helper å¸®åŠ©æ–¹æ³•ï¼Œè¿™æ ·ä½ å°±æ ¹æœ¬åˆ«è€ƒè™‘åœ¨æ¨¡ç‰ˆé‡Œå†™ä¸šåŠ¡é€»è¾‘çš„äº‹å„¿äº†ã€‚ å¼€å‘æ•ˆç‡çš„æå‡: æˆ‘çŸ¥é“ï¼Œåœ¨ä¸‰ä¸ªæ¡†æ¶é‡Œ Ember å¯èƒ½æ˜¯å­¦ä¹ æ›²çº¿æœ€é™¡ä¹Ÿæœ€éš¾å­¦çš„é‚£ä¸€ä¸ªã€‚ä½†æ˜¯ä¸€æ—¦ä½ æŒæ¡äº†å®ƒï¼Œä½ å°±èƒ½å¼€å‘ä¸€ä¸ªé¡¹ç›®è¶…å¿«ï¼Œè¿œèƒœè¿‡ Angular æˆ– Reactã€‚â€œçº¦å®šå¤§äºé…ç½®â€å’Œ ember-cli å°±æ˜¯æœ€ä¸»è¦çš„ä¸¤ä¸ªåŸå› ã€‚ å›¢é˜Ÿå·¥ä½œ: å¦‚æœä½ å…¬å¸çš„æ‰€æœ‰å›¢é˜Ÿï¼ˆç”šè‡³å³ä½¿æœ‰äººä¸åœ¨å…¬å¸åŠå…¬ï¼‰æ˜¯åœ¨å¼€å‘å¤šä¸ª Ember é¡¹ç›®ï¼Œä½¿ç”¨ ember-cli æ„å»ºå·¥å…·ï¼Œé‚£ä¹ˆä»–ä»¬æ¯ä¸ªäººçš„é¡¹ç›®ç›®å½•æ–‡ä»¶æ¶æ„ä¼šéå¸¸ç›¸ä¼¼ï¼Œè€Œä¸”å¯ä»¥å‡ ä¹ä¸èŠ±è´¹ä»€ä¹ˆæ—¶é—´æˆæœ¬å°±è¿›è¡Œé¡¹ç›®çš„åˆ‡æ¢ï¼Œå¹¶ç«‹åˆ»æŠ•å…¥å¼€å‘å’Œæäº¤ä»£ç ã€‚è¿™å®é™…å˜ç›¸æé«˜äº†å…¬å¸å®é™…ä¸Šçš„å¼€å‘æ•ˆç‡ã€‚ ä¸å±äºå…¬å¸åªå±äºç¤¾åŒº: Angular å±äº Googleï¼ŒReact å±äº Facebookã€‚è€Œ Ember æ¥è‡ªäºç¤¾åŒºï¼Œä¹Ÿåªä¸ºäº†ç¤¾åŒºã€‚Ember æ ¸å¿ƒå¼€å‘å›¢é˜Ÿçš„å¼€å‘è€…ä»¬éƒ½æ¥è‡ªäºå„è‡ªå…¬å¸å®é™… Ember é¡¹ç›®çš„æˆå‘˜ï¼Œè¿™æ°å¥½æ˜¯ Ember çš„æœ€å¤§ä¸åŒä¹‹å¤„ï¼šä»–ä»¬ä¸ä»…æ˜¯æ¡†æ¶çš„å¼€å‘è€…ï¼Œæ›´æ˜¯æ¡†æ¶çš„ä½¿ç”¨è€…ã€‚è¿™è®©ä»–ä»¬èƒ½å§‹ç»ˆè´´è¿‘ç°å®ï¼Œç´§æ¥åœ°æ°”ã€‚ å‹å¥½çš„ç‰ˆæœ¬å‘å¸ƒ: æˆ‘å¹¸è¿åœ°åœ¨ Angular 2 å‘å¸ƒæ—¶å·²ç»ç¦»å¼€äº†ä¹‹å‰çš„ Angular é¡¹ç›®ï¼Œä½†æˆ‘çš„æœ‹å‹è¦ä¸ºé¡¹ç›®å‡çº§åˆ° Angular 2 å¤´ç–¼å’ŒæŠ“ç‹‚äº†ã€‚ä¸æ­¤ç›¸åï¼ŒEmber 2 å‘å¸ƒæ—¶æ²¡æœ‰ä»»ä½•å˜åŒ–ã€‚æ˜¯çš„ï¼Œä½ æ²¡å¬é”™ã€‚å®ƒæ²¡æœ‰ä»»ä½•å˜åŒ–ã€‚Ember 1. 13. 0 å’Œ 2. 0 åœ¨ä½¿ç”¨ä¸Šå®Œå…¨ç›¸åŒï¼Œå› ä¸º Ember æ˜¯é‡‡å–æ¸è¿›å¼çš„ç­–ç•¥æ¥å¯¹ 1. x å¼€æ”¾æ–°åŠŸèƒ½ï¼Œä»¥ä¾¿è®©ä½¿ç”¨ Ember çš„å®é™…é¡¹ç›®èƒ½è¿›è¡Œå®Œå…¨æ— ç—›åœ°å‡çº§ã€‚è¿™æ­£æ˜¯ Ember æ ¸å¿ƒå›¢é˜Ÿæˆå‘˜â€œä¸ä»…æ˜¯æ¡†æ¶çš„å¼€å‘è€…ï¼Œæ›´æ˜¯æ¡†æ¶çš„ä½¿ç”¨è€…â€çš„æœ€å¥½ä½“ç°ã€‚ Ember æ²¡æœ‰ç¼ºç‚¹äº†å—ï¼Ÿ: ä»»ä½•äº‹ç‰©éƒ½æœ‰ä¸¤é¢æ€§ï¼ŒEmber ä¹Ÿä¸ä¾‹å¤–ã€‚Ember ä¹Ÿæœ‰è‡ªå·±çš„ç¼ºç‚¹ï¼Œè¯¸å¦‚é™¡å³­çš„å­¦ä¹ æ›²çº¿ï¼Œç¨æ…¢çš„é¡µé¢æ¸²æŸ“ï¼Œæ¡†æ¶ä½“ç§¯è¾ƒå¤§ç­‰ã€‚å·²ç»æœ‰å¾ˆå¤šçš„æŠ€æœ¯æ–‡ç« å¯¹è¿™äº›æ¡†æ¶è¿›è¡Œè¿‡æ¯”è¾ƒäº†ã€‚ä½†æœ¬æ–‡æ›´å¤šçš„æ˜¯åœ¨å¼€å‘å®è·µä½“éªŒä¸Šæˆ‘ä¸ªäººçš„ä¸€äº›æ„Ÿå—ã€‚æˆ‘ç›¸ä¿¡è¿™äº›æ¡†æ¶ä¸­ä¸ç®¡é€‰ç”¨å“ªä¸€ä¸ªï¼Œå°±æŠ€æœ¯è€Œè¨€éƒ½èƒ½å¸®ä½ å®Œæˆé¡¹ç›®ã€‚ä½†è¿˜æœ‰ä¸€äº›é™¤æ­¤ä¹‹å¤–çš„å› ç´ å½±å“åˆ°ä½ é¡¹ç›®çš„å®æ–½å’Œè¿›å±•ã€‚åœ¨è€ƒè™‘äº†å„ç§å®é™…æƒ…å†µã€ä¸šåŠ¡ã€åœºæ™¯ä¹‹åï¼Œä½ å°±å¯ä»¥åšå‡ºæœ€ä½³çš„å†³ç­–æ¥å¯åŠ¨é¡¹ç›®äº†ã€‚ ç›¸å…³æ–‡ç« :  Is React. js tougher and confusing than Ember or Angular? A complete guide to Ember â€“ Ember. js Tutorial Whatâ€™s new in Angular 2. 0? Why itâ€™s rewritten â€“ addressing few confusions Plus minus kind of calculation and comparison in Ember. js template, handlebars? MVC vs Flux â€“ which one is better? Scaffolding and understanding an ember application â€“ Ember. js Tutorial part 2"
    }, {
    "id": 59,
    "url": "/2017/03/use-alfred-to-auto-upload-screenshot-to-qiniu-and-generate-the-markdown-image-url/",
    "title": "ä½¿ç”¨ Alfred workflow ä¸Šä¼ æˆªå›¾åˆ°ä¸ƒç‰›å¹¶è‡ªåŠ¨ç”Ÿæˆå¤–é“¾URL",
    "body": "2017/03/17 - ä»Šå¹´å‡†å¤‡å¤šå†™ç‚¹Blogæ–‡ç« äº†ã€‚ å‰ä¸¤å‘¨æŠ½äº†äº›æ—¶é—´æŠŠ Github page é‡æ–°å¼„äº†ä¸‹ï¼šJekyll å‡äº†ä¸ªçº§ï¼ŒTheme æ¢äº†ä¸ªé¡ºçœ¼çš„ï¼Œè‡ªæˆ‘ä»‹ç»å†™äº†ç‚¹æ–°çš„ã€‚ã€‚æ­£ä¸‡äº‹ä¿±å¤‡ï¼Œå°±è¦åŠ¨ç¬”çš„æ—¶å€™ï¼Œå‘ç°äº†ä¸ªæœ‰ç‚¹ä¸çˆ½çš„é—®é¢˜â€”â€”å›¾ç‰‡ã€‚ Jekyll æ˜¯ç”¨ markdown æ ¼å¼æ¥å†™æ–‡ç« ï¼Œè€Œå†™ markdown çš„æ—¶å€™è¦æ”¾å…¥ä¸€å¼ å›¾ç‰‡åˆ°æ–‡ç« é‡Œï¼Œå¯å°±æ²¡é‚£ä¹ˆå‹å¥½äº†ã€‚ä¸åƒ Office Word ä¹‹ç±»è½¯ä»¶ï¼Œå¯ä»¥ç›´æ¥æ‹–å…¥å›¾ç‰‡åˆ°æ–‡ç« ä¸­ï¼Œmarkdown æ˜¯é€šè¿‡æ’å…¥ ![xxx](http://xxx. com/xxx. png) è¿™æ ·çš„ä»£ç æ¥æ˜¾ç¤ºå›¾ç‰‡çš„ï¼Œé‚£ä¹ˆè‡³å°‘å¾—ç»è¿‡è¿™æ ·å‡ æ­¥ï¼š  ä¸Šä¼ å›¾ç‰‡åˆ°ç½‘ç»œä¸Šçš„ä¸€ä¸ªå›¾ç‰‡ç©ºé—´ï¼ˆå›¾åºŠï¼‰ æ‹·è´è¯¥å›¾åºŠä¸Šè¿™å¼ å›¾ç‰‡çš„å¯¹åº”URLä»£ç  ç²˜è´´åˆ° markdown æ–‡ç« ä¸­ï¼Œæ”¹å†™ä¸ºä¸Šè¿°é‚£æ ·åˆé€‚çš„å½¢å¼æ›´ä¸ç”¨è¯´ä¸€ç¯‡æ–‡ç« å¦‚æœéœ€è¦çš„å›¾ç‰‡ç¨å¾®å¤šä¸€ç‚¹ï¼Œæ¯å¼ å›¾ç‰‡éƒ½è¿™æ ·æ¥ä¸€éæ“ä½œï¼Œé‚£å¾—æŠŠäººçƒ¦æ­»ï¼Œé‚£ç‚¹å­å†™ä½œçš„æ¬²æœ›æ—©å°±ä¼šè¢«æ‰”åˆ°çˆªæ´¼å›½äº†ã€‚ èº«ä¸ºä¸€å Devï¼Œç¢°åˆ°è¿™ä¸ªæƒ…å†µï¼Œå½“ç„¶è¦ç”¨ç¨‹åºå‘˜çš„æ–¹å¼æ¥è§£å†³é—®é¢˜ï¼ æˆ‘é€‰ç”¨çš„å›½å†…å›¾åºŠæ˜¯ä¸ƒç‰›ã€‚ä¸ƒç‰›å¯¹å…è´¹ç”¨æˆ·è¿˜ä¸é”™ï¼Œåªè¦é€šè¿‡äº†å®ƒçš„å®åè®¤è¯ï¼Œå°±å¯ä»¥æœ‰10Gçš„ç©ºé—´ï¼Œ10Gçš„è®¿é—®æµé‡ï¼æœˆç­‰ï¼ˆè¯¦ç»†æœåŠ¡å¯å»å‚çœ‹ä¸ƒç‰›å®˜ç½‘ï¼‰ã€‚ å‡†å¤‡ä¸ƒç‰›ç©ºé—´: è¦ä½¿ç”¨ä¸ƒç‰›çš„æœåŠ¡ï¼Œå¤§æ¦‚éœ€è¦è¿™æ ·å‡ æ­¥ï¼š  æ³¨å†Œä¸ƒç‰›å¼€å‘è€…è´¦å· https://portal. qiniu. com/signup?code=3looau4kfei4y ç™»å½•ä¸ƒç‰›å¼€å‘è€…å¹³å°ï¼Œæ·»åŠ ä¸€ä¸ªå­˜å‚¨ç©ºé—´ã€‚è¦ç»™è¿™ä¸ªå­˜å‚¨ç©ºé—´å–ä¸ªåå­—ï¼Œä¸ƒç‰›ç»™è¿™ä¸ªåå­—å–äº†ä¸ªæœ¯è¯­å« Bucket åœ¨â€œä¸ªäººä¸­å¿ƒ &gt; å¯†é’¥ç®¡ç†â€ä¸­æŸ¥çœ‹AccessKey å’Œ SecretKeyï¼ˆä¸‹é¢çš„ä¸Šä¼ å·¥å…·ä¼šç”¨åˆ°ï¼‰ ä½¿ç”¨ä¸ƒç‰›å®˜æ–¹æä¾›çš„ command line toolï¼šqshell å¯åœ¨æœ¬åœ°ç”µè„‘è¿›è¡Œç®¡ç†å’Œä¸Šä¼ ï¼ˆä¹‹å‰çš„ qsync å·²ç»è¢«åºŸå¼ƒäº†ï¼‰qshell çš„ä¸‹è½½å’Œç”¨æ³•å¯åœ¨å…¶å®˜ç½‘ http://developer. qiniu. com/code/v6/tool/qshell. html æ‰¾åˆ°ã€‚æœ¬æ–‡ä¸å¤šèµ˜è¿°ã€‚ è¦ä¸Šä¼ å•ä¸ªå›¾ç‰‡ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ qshell çš„ fput å‘½ä»¤: qshell fput &lt;Bucket&gt; &lt;Key&gt; &lt;LocalFile&gt;Bucket å°±æ˜¯ä¸Šé¢æåˆ°çš„å­˜å‚¨ç©ºé—´åå­—ã€‚ ä¾‹å¦‚ï¼šqshell fput your-bucket xyz. png /path/to/image/xyz. png å¯¹ä¸»è¦æµç¨‹çš„æ€è€ƒ: ç°åœ¨ï¼Œå›¾åºŠæœ‰äº†ï¼Œæ€æ ·ä¸Šä¼ å›¾ç‰‡ä¹ŸçŸ¥é“äº†ï¼Œè¯¥æ˜¯è€ƒè™‘æ•´ä¸ªç›®æ ‡å®ç°æµç¨‹çš„æ—¶å€™äº†ã€‚ é‡ç”³ä¸€ä¸‹ç›®æ ‡ï¼šè‡ªåŠ¨åŒ–å®Œæˆ â€œä¸Šä¼ å›¾ç‰‡ â€“&gt; è·å–å¯¹åº” markdown å›¾ç‰‡URLâ€ æ•´ä¸ªè¿‡ç¨‹ã€‚ åˆ†æä¸€ä¸‹ï¼Œæ¯æ¬¡æ·»åŠ ä¸€ä¸ªæˆªå›¾åˆ°æ–‡ç« é‡Œï¼Œå¤§æ¦‚å¯åˆ†ä¸ºä¸ƒæ­¥ï¼Œå…¶ä¸­ä¼šç”¨åˆ°ä¸€äº›å·¥å…·ï¼š  ä½¿ç”¨ OSX ç³»ç»Ÿçš„å¿«æ·é”®ï¼šâŒ˜+â‡§+âŒƒ+4 æˆªå›¾ï¼Œå¹¶å­˜å…¥å‰ªè´´æ¿ä¸­ ä½¿ç”¨ pngpaste æŠŠå‰ªè´´æ¿çš„å›¾ç‰‡å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ OSX è‡ªå¸¦æˆªå›¾å·¥å…·é»˜è®¤ PNG æ ¼å¼ï¼Œå›¾åƒæ–‡ä»¶ä½“ç§¯åå¤§ã€‚ä¸ƒç‰›è™½ç„¶æä¾› 10G çš„å…è´¹ç©ºé—´ï¼Œä½†ç§¯å°‘æˆå¤šï¼Œèƒ½çœä¸€ç‚¹æ˜¯ä¸€ç‚¹ï¼Œæ‰€ä»¥å°½é‡ç¼©å‡å›¾ç‰‡ä½“ç§¯æ˜¯å¿…è¦çš„ã€‚æˆ‘ç”¨äº† pngquant æ¥ä¼˜åŒ–ä¸´æ—¶æ–‡ä»¶çš„å›¾åƒå¤§å°ã€‚ æŠŠä¼˜åŒ–åçš„ä¸´æ—¶æ–‡ä»¶ç”¨ qshell ä¸Šä¼ åˆ°ä¸ƒç‰› ä¸Šä¼ æˆåŠŸåè‡ªåŠ¨åˆ é™¤ä¸´æ—¶æ–‡ä»¶ è‡ªåŠ¨ç”Ÿæˆä¸ƒç‰›ç©ºé—´å¯¹åº”ä¸Šä¼ å›¾ç‰‡çš„ markdown å›¾ç‰‡URLä»£ç  æœ€åï¼ŒæŠŠ markdown å›¾ç‰‡URLä»£ç å­˜å…¥ç³»ç»Ÿå‰ªè´´æ¿è¿™ä¸€ç³»åˆ—æ­¥éª¤è‡ªåŠ¨åŒ–å®Œæˆåï¼Œæˆ‘å°±åªéœ€æŒ‰ âŒ˜+V å³å¯æŠŠ markdown å›¾ç‰‡URLä»£ç ç²˜è´´åˆ°æ–‡ç« é‡Œäº†ã€‚ ä¸Šé¢ç”¨åˆ°çš„ä¸‰ä¸ªå·¥å…·ï¼špngpasteï¼Œpngquantï¼Œqshellï¼Œå…¶ä¸­å‰ä¸¤è€…éƒ½å¯ä»¥é€šè¿‡ OSX çš„ Homebrew æ¥å®‰è£…ã€‚ åˆ›å»º Alfred workflow: æ€è·¯æœ‰äº†ï¼Œå°±å¼€å§‹å¹²å§ï¼ å¯¹äºè¿™æ ·éœ€è¦æŠŠä¸€ç³»åˆ—æµç¨‹æ­¥éª¤è¿›è¡Œè‡ªåŠ¨åŒ–å¤„ç†çš„äº‹æƒ…ï¼Œæ¯«æ— ç–‘é—®é¦–é€‰ OSX ä¸Šçš„â€œç¥å…µåˆ©å™¨â€ â€”â€” Alfredã€‚Alfred çš„ Workflow æ­£é€‚åˆç”¨æ¥å¹²è¿™äº‹ã€‚ è¦ä½¿ç”¨ Alfred çš„ workflowï¼Œå¾—è´­ä¹°å®ƒçš„ PowerPack ç‰ˆæœ¬ã€‚Free ç‰ˆæœ¬æœªå¼€æ”¾ workflow åŠŸèƒ½ã€‚ç›¸ä¿¡æˆ‘ï¼Œæè¿™ç¬”é“¶å­æ˜¯ç»å¯¹å€¼å¾—çš„ï¼ åœ¨ Alfred çš„ â€œWorkflowsâ€ çª—å£ï¼Œç‚¹ + å·åˆ›å»ºä¸€ä¸ª â€œEmpty Workflowâ€ï¼Œåå­—å–ä½ å–œæ¬¢çš„ã€‚ åœ¨è¿™ä¸ªç©ºç™½ workflow ä¸­ï¼Œéœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªè§¦å‘å™¨ï¼Œæ¥å¼€å§‹æ•´ä¸ªå·¥ä½œæµã€‚ åœ¨å³ä¾§çª—å£ä¸­å³é”®èœå•ä¸­é€‰ â€œInputs â€“&gt; Keywordâ€ æ·»åŠ ä¸€ä¸ª Keyword è§¦å‘å™¨ã€‚æˆ‘è®¾å®šçš„ keyword æ˜¯ qiniuï¼Œtitle æè¿°ä¸ºâ€œä¸Šä¼ å‰ªåˆ‡æ¿å›¾ç‰‡åˆ°ä¸ƒç‰›å¹¶è·å–å¤–é“¾URLâ€ã€‚è¿™ä¸ªtitle æ˜¯è®©åœ¨ Alfred çš„å‘½ä»¤çª—å£è¾“å…¥ qiniu æ—¶æ˜¾ç¤ºè¯¥å‘½ä»¤ç”¨æ¥å¹²å˜›çš„ã€‚ ç„¶åå†æ·»åŠ ä¸€ä¸ª actionã€‚ åœ¨å³ä¾§çª—å£ä¸­å³é”®èœå•ä¸­é€‰ â€œActions â€“&gt; Run Scriptâ€ æ·»åŠ ä¸€ä¸ªè„šæœ¬æ‰§è¡Œå™¨ã€‚åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥å¦‚å›¾ä»£ç ã€‚qiniu. rb æ–‡ä»¶ä¼šåœ¨ç¨åæ·»åŠ ï¼Œå®ƒæ˜¯æ•´ä¸ªå·¥ä½œæµçš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œä¸Šè¿°ä¸ƒä¸ªæ­¥éª¤çš„2ï½6æ­¥ï¼ˆå³é™¤å»é¦–å°¾ä¹‹å¤–çš„å…¨éƒ¨ï¼‰å·¥ä½œéƒ½å°†ç”±å®ƒæ¥å®Œæˆã€‚ è‡³äºä¸ºä»€ä¹ˆé€‰ç”¨ Ruby è„šæœ¬ï¼ŒåŸå› å¾ˆç®€å• â€”â€” æˆ‘æ˜¯ä¸€å Ruby developerã€‚ è¿™ç¬¬äºŒæ­¥çš„ action æ‰§è¡Œåï¼Œä¼šè¾“å‡º markdown å›¾ç‰‡URLä»£ç ï¼Œæ‰€ä»¥éœ€è¦å†æ·»åŠ æœ€åä¸€æ­¥ï¼šæŠŠä»£ç å­˜å…¥ç³»ç»Ÿå‰ªè´´æ¿ã€‚Alfred å·²ç»å¸®ä½ å‡†å¤‡å¥½äº†è¿™ä¸ªå¸¸è§çš„æ“ä½œï¼Œç›´æ¥ä½¿ç”¨å®ƒå°±å¥½ï¼š åœ¨å³ä¾§çª—å£ä¸­å³é”®èœå•ä¸­é€‰ â€œOutputs â€“&gt; Copy to Clipboardâ€ æ·»åŠ  â€œCopy to Clipboardâ€ æ‰§è¡Œå™¨ã€‚ä¸€åˆ‡é»˜è®¤å³å¯ã€‚ æœ€åï¼Œæˆ‘ä»¬è¿˜åº”è¯¥æ·»åŠ ä¸€ä¸ª OSX ç³»ç»Ÿæé†’ï¼Œè®©è¿™ä¸ª workflow çš„ä½¿ç”¨ä½“éªŒæ›´å‹å¥½ã€‚ åœ¨å³ä¾§çª—å£ä¸­å³é”®èœå•ä¸­é€‰ â€œOutputs â€“&gt; Post Notificationâ€ æ·»åŠ  â€œPost Notificationâ€ æ‰§è¡Œå™¨ã€‚title å†™ä¸ºâ€œæˆªå›¾ä¸Šä¼ æˆåŠŸï¼Markdown URLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿â€ï¼Œå…¶ä»–ä½¿ç”¨é»˜è®¤ã€‚ è¿™æ ·æ•´ä¸ª workflow æ‰€æœ‰ç¯èŠ‚éƒ½å·²ç»æ„å»ºå¥½äº†ï¼Œæˆ‘ä»¬åªéœ€ç”¨çº¿å°†ä¸Šé¢å››ä¸ªéƒ¨åˆ†è¿èµ·æ¥ï¼Œä»¥ç»„æˆä¸€ä¸ªå·¥ä½œæµï¼Œå³å¯å¤§åŠŸå‘Šæˆï¼ 2 - 6 æ­¥çš„ä»£ç å®ç°: ç°åœ¨æ¥çœ‹çœ‹è¦æ€æ ·å®ç° 2 - 6 ä¸ªæ­¥éª¤ã€‚ä¸€æ­¥ä¸€æ­¥æ¥ã€‚ ç¬¬2æ­¥: * ä½¿ç”¨ pngpaste æŠŠå‰ªè´´æ¿çš„å›¾ç‰‡å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶pngpaste çš„ä½¿ç”¨å¾ˆç®€å•ï¼š pngpaste /path/to/temp. pngç¬¬3æ­¥: * ç”¨ pngquant æ¥ä¼˜åŒ–ä¸´æ—¶æ–‡ä»¶çš„å›¾åƒå¤§å°pngquant ç”¨æ³•ï¼š pngquant -f -o /path/to/temp. png /path/to/temp. png-f å‚æ•°ç¡®ä¿è¦†ç›–æºæ–‡ä»¶ ç¬¬4æ­¥: * æŠŠä¼˜åŒ–åçš„ä¸´æ—¶æ–‡ä»¶ç”¨ qshell ä¸Šä¼ åˆ°ä¸ƒç‰›qshell ä½¿ç”¨å…¶ fput å‘½ä»¤æ¥ä¸Šä¼ ï¼š qshell fput xfyuan markdown/xyz. png /path/to/temp. pngxfyuan æ˜¯æˆ‘ä¸ƒç‰›ç©ºé—´çš„Bucketåç§°ã€‚ markdown/ æ˜¯ä½¿ç”¨äº†ä¸ƒç‰›çš„å‘½åç©ºé—´å½¢å¼ä½œä¸ºåŒºåˆ†ï¼Œæˆ‘ç”¨ markdown æ¥è¡¨ç¤ºè·Ÿ Blog æ–‡ç« ç›¸å…³çš„å›¾ç‰‡ã€‚ ç¬¬5æ­¥: * ä¸Šä¼ æˆåŠŸåè‡ªåŠ¨åˆ é™¤ä¸´æ—¶æ–‡ä»¶è¿™ä¸ªä¸ç”¨å¤šè¯´ï¼š rm -f /path/to/temp. pngç¬¬6æ­¥: * è‡ªåŠ¨ç”Ÿæˆä¸ƒç‰›ç©ºé—´å¯¹åº”ä¸Šä¼ å›¾ç‰‡çš„ markdown å›¾ç‰‡URLä»£ç ä¸ƒç‰›çš„å…è´¹å¼€å‘è€…è´¦æˆ·ä¼šå¾—åˆ°ä¸€ä¸ªä¸Šä¼ æ–‡ä»¶å¤–é“¾çš„é»˜è®¤åŸŸåï¼ˆåœ¨å­˜å‚¨ç©ºé—´ç®¡ç†é¡µé¢å¯çœ‹åˆ°ï¼‰ï¼Œæˆ‘çš„æ˜¯ï¼š è€Œä¸Šä¼ å›¾ç‰‡çš„åç§°å°±æ˜¯ä¸Šé¢çš„ markdown/xyz. pngï¼ŒäºŒè€…æ‹¼èµ·æ¥å³å¯å¾—åˆ°å¯¹åº”çš„å¤–é“¾è®¿é—®URLï¼š http://omwi90lh4. bkt. clouddn. com/markdown/xyz. pngmarkdown çš„å›¾ç‰‡æ ¼å¼å³ä¸ºï¼š ![markdown/xyz. png](http://omwi90lh4. bkt. clouddn. com/markdown/xyz. png)qiniu. rb ä»£ç : qiniu. rb å°±æ˜¯æŠŠä¸Šè¿°å„æ­¥ä»£ç æ”¾åˆ°ä¸€èµ·ï¼ŒåŠ ä¸Šå¿…è¦çš„ä¸€äº›å¤„ç†ï¼Œç¡®ä¿å…¶æ­£å¸¸è¿è¡Œå’ŒåŸºæœ¬çš„å¼‚å¸¸å¤„ç†å³å¯ã€‚ å…¨éƒ¨ä»£ç å¦‚ä¸‹ï¼š #!/usr/bin/env rubyrequire 'date'qiniu_domain =  http://omwi90lh4. bkt. clouddn. com qiniu_bucket = 'xfyuan'qiniu_scope = 'markdown'folder    = '~/works/_tmp/'filename =  #{DateTime. now. strftime('%Y%m%d%H%M%S')}. png upload_file =  #{folder}#{filename} # paste screenshot to a temp filesystem  . /pngpaste #{upload_file} if File. file? File. expand_path(upload_file) # optimize png system  . /pngquant -f -o #{upload_file} #{upload_file}  # use qiniu qshell tool to upload screenshot image qiniu_filename =  #{qiniu_scope}/#{filename}  system  . /qshell fput #{qiniu_bucket} #{qiniu_filename} #{upload_file} &gt; /dev/null  # remove temp file system  rm -f #{upload_file}  # generate markdown image url qiniu_image_url =  #{qiniu_domain}/#{qiniu_filename}  markdown_image_url =  ![#{qiniu_filename}](#{qiniu_image_url})  print markdown_image_urlelse print  å‰ªåˆ‡æ¿æ²¡æœ‰å›¾ç‰‡ï¼ endæœ‰å‡ ä¸ªå€¼å¾—æ³¨æ„çš„åœ°æ–¹ï¼š  ä¸´æ—¶æ–‡ä»¶ä½¿ç”¨å½“å‰çš„æ—¶é—´æˆ³ä½œä¸ºæ–‡ä»¶å qshell ä¸Šä¼ æ–‡ä»¶ç”¨åˆ°äº† &gt; /dev/null é¿å…å…¶ä¸Šä¼ æˆåŠŸåè¾“å‡ºçš„ä¸€å¤§å †ä¿¡æ¯å¹²æ‰°åˆ°æœ€åçš„å‰ªè´´æ¿å†…å®¹ åº”è¯¥åˆ¤æ–­å½“å‰å‰ªè´´æ¿ä¸Šæ˜¯å¦æœ‰å›¾åƒï¼Œå¦‚æœæ²¡æœ‰å°±ä¸­æ–­é€€å‡ºï¼Œç»™äºˆè­¦å‘Šæç¤ºæœ€åçš„é‡è¦ä¸€æ­¥: è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼šqiniu. rb æ–‡ä»¶æ”¾åˆ°å“ªé‡Œæ‰èƒ½è®© Alfred workflow æ‰§è¡Œæ—¶èƒ½æ‰¾åˆ°å¹¶æ­£ç¡®è¿è¡Œï¼Ÿ å¾ˆç®€å•ã€‚ æ‰“å¼€ Keyword è§¦å‘å™¨è®¾ç½®çª—å£ï¼š çœ‹åˆ° â€œCancelâ€ æŒ‰é’®å·¦è¾¹é‚£ä¸ªå›¾æ ‡äº†ï¼Ÿç‚¹å‡»å®ƒï¼Œä¼šåœ¨ Finder ä¸­è‡ªåŠ¨æ‰“å¼€è¯¥ Workflow çš„å¯¹åº”ç›®å½•ã€‚æŠŠ qiniu. rb æ–‡ä»¶æ”¾åˆ°è¿™é‡Œï¼ŒWorkflow è¿è¡Œæ—¶å°±èƒ½æ‰¾åˆ°ã€‚ åŒç†ï¼Œä¸Šè¿°æ­¥éª¤ä¸­ç”¨åˆ°çš„ä¸‰ä¸ªå·¥å…·ï¼špngpasteï¼Œpngquantï¼Œqshellï¼Œä¸ºäº†è®© Workflow è¿è¡Œæ—¶èƒ½æ‰¾åˆ°å®ƒä»¬ï¼Œæˆ‘ä»¬ä¹Ÿåº”è¯¥æŠŠå®ƒä»¬çš„æ‰§è¡Œæ–‡ä»¶å„è‡ªæ‹·è´æ”¾åˆ°è¿™ä¸ªç›®å½•ï¼Œå¦åˆ™ä»£ç æ˜¯æ— æ³•æ­£å¸¸å·¥ä½œçš„ã€‚ å¦å¤–ï¼Œè¿˜å¯ä»¥ç¨å¾®ç¾åŒ–ä¸€ä¸‹ Workflowï¼Œä¾‹å¦‚ç»™å®ƒåŠ ä¸ªå›¾æ ‡ã€‚ æœ€åï¼ŒWorkflow çš„å¯¹åº”ç›®å½•ä¼šæ˜¯è¿™æ ·ï¼š æœ€ç»ˆçš„ä½¿ç”¨ä½“éªŒ: æœ¬æ–‡çš„å…¨éƒ¨å›¾ç‰‡æ’å…¥éƒ½é€šè¿‡ä½¿ç”¨è¯¥ Alfred Workflow æ¥å®Œæˆã€‚ Alfred å‘½ä»¤çª—å£ï¼š ä¸Šä¼ æˆåŠŸï¼Œç³»ç»Ÿå¼¹çª—æé†’ï¼š è½»æ¾å¿«é€Ÿç²˜è´´åˆ°æ–‡ç« é‡Œï¼š å¹²å¾—æ¼‚äº®ï¼ "
    }, {
    "id": 60,
    "url": "/2017/03/the-inheritance-of-rails-render-path/",
    "title": "Rails render path ç»§æ‰¿å…³ç³»ä¸€ä¾‹",
    "body": "2017/03/13 - è¿‘ä¸¤å¤©åœ¨ Rails çš„å¼€å‘ä¸­ï¼Œçªç„¶å‘ç°äº†å…³äº render path çš„ä¸€ä¸ªä¹‹å‰æœªæ›¾æ³¨æ„åˆ°çš„æœ‰è¶£åœ°æ–¹ã€‚ ä»£ç ä¸­æœ‰ä¸€ä¸ªçˆ¶ç±» Controllerï¼Œå‡è®¾ä¸º FruitsControllerï¼›ä¸¤ä¸ªå­ç±» Controllerï¼Œå‡è®¾ä¸º ApplesControllerï¼ŒOrangesControllerã€‚ ApplesController#showï¼ŒOrangesController#show çš„ View ä¸­ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå·²ç»æŠ½å‡ºæ¥äº†ä¸€ä¸ª partial æ¨¡ç‰ˆï¼Œå‡è®¾ä¸º _fruit_content. erbã€‚è¿™æ ·ä¸¤ä¸ª Controller#show çš„æ¨¡ç‰ˆå†…ï¼Œéƒ½ä¼šæœ‰è¿™ä¹ˆä¸€è¡Œï¼š render 'path/to/fruit_content'é‚£ä¹ˆ _fruit_content. erb æ”¾åˆ°å“ªä¸ª path æ¯”è¾ƒåˆé€‚å‘¢ï¼Ÿå½“ç„¶ shared ç›®å½•æ˜¯ä¸€ä¸ªé€‰æ‹©ï¼Œä½†ç”±äºä¸€äº›å…¶ä»–åŸå› å·²ç»æ’é™¤äº†ï¼Œæ‰€ä»¥ä¸åšè€ƒè™‘ã€‚ å¦‚æœæ”¾åœ¨ views/applesä¸‹ï¼Œé‚£ä¹ˆ OrangesController#show çš„æ¨¡ç‰ˆå†…é‚£ä¸€è¡Œ render å°±å¿…é¡»æŒ‡æ˜ _fruit_content. erb å®Œæ•´pathï¼š render 'apples/fruit_content'åä¹‹äº¦ç„¶ã€‚æ— è®ºå“ªç§éƒ½æ„Ÿè§‰ä¸å¤ªç¬¦åˆ Rails â€œConvension over Configrationâ€ çš„åŸåˆ™ã€‚ æœ€åæ— æ„ä¸­å´å‘ç° Rails ç«Ÿç„¶â€œåŸæ¥å¯¹æ­¤æ—©æœ‰å‡†å¤‡çš„â€ï½ ç­”æ¡ˆå¾ˆç®€å•ã€‚ ç”±äº ApplesControllerï¼ŒOrangesController éƒ½ç»§æ‰¿äº FruitsControllerï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€æŠŠ _fruit_content. erb æ”¾åœ¨ views/fruitsç„¶åæ— è®ºæ˜¯ ApplesController#show è¿˜æ˜¯ OrangesController#show çš„æ¨¡ç‰ˆå†…é‚£ä¸€è¡Œ render éƒ½åªéœ€å†™ä¸ºï¼š render 'fruit_content'å³å¯ã€‚ æå®šæ”¶å·¥ã€‚ "
    }, {
    "id": 61,
    "url": "/2014/04/set-up-development-environment-and-workflow-using-cygwin-in-windows7/",
    "title": "Set up development environment & workflow using cygwin in windows7",
    "body": "2014/04/25 - ä½¿ç”¨Cygwinåœ¨Windows7ä¸‹æ„å»ºå¼€å‘ç¯å¢ƒå’Œå·¥ä½œæµï¼ˆä¸Šï¼‰2014å¹´4æœˆ24æ—¥ä¸‹åˆ8:09 ç¼˜èµ·: ç°åœ¨çš„å·¥ä½œç”±äºæ¡ä»¶é™åˆ¶ï¼Œæœ€ç»ˆåªèƒ½åœ¨Windows7ä¸‹è¿›è¡Œå¼€å‘ã€‚è¿™ç»™ä¹ æƒ¯äº†OSX/Linuxå¼€å‘ç¯å¢ƒçš„æˆ‘å¸¦æ¥äº†å¾ˆå¤§é—®é¢˜ã€‚æ„Ÿè§‰å¥½åƒä»ç°ä»£ç¤¾ä¼šå›åˆ°åŸå§‹ç¤¾ä¼šä¼¼çš„ï¼Œå¼€å‘æ•ˆç‡ä¸€ä¸‹å­é™ä½äº†50%ä»¥ä¸Šã€‚ç»ˆäºå¿æ— å¯å¿ä¹‹ä¸‹ï¼Œå°è¯•çœ‹çœ‹èƒ½å¦å®‰è£…ä¸ŠCygwinè¿™ä¸ªä¼ è¯´ä¸­windowsä¸‹æ¨¡æ‹Ÿlinuxç¯å¢ƒçš„å·¥å…·ã€‚æœ€åç»è¿‡ä¸€ç•ªæ‘¸ç´¢ä¸‹ï¼Œåˆ°åº•æˆåŠŸæå®šã€‚ä»¥æ­¤ä¸ºè®°ã€‚ ç›®æ ‡: é¦–å…ˆæ˜¯å¼€å‘ç¯å¢ƒï¼Œæˆ‘åœ¨OSX/Linuxä¸‹åšå¼€å‘å¸¸ç”¨çš„å·¥å…·æœ‰è¿™ä¹ˆäº›ï¼š  Terminal Vim Tmux Zshell Git Ctagså¯¹äºå·¥ä½œæµï¼ˆWorkflowï¼‰ï¼Œè¿™é‡Œæ˜¯æŒ‡é’ˆå¯¹webå¼€å‘ï¼Œæ€»æœ‰å¸¸è§çš„ä¸€äº›å¿…è¦å·¥ä½œæ­¥éª¤ï¼Œè¯¸å¦‚sass/lessç¼–è¯‘ã€css/js minifyã€unit/integration testã€ç”šè‡³åŒ…å«sftpä¸Šä¼ ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸“é—¨çš„workflow toolæ¥æŠŠè¿™äº›æ­¥éª¤ä¸²èµ·æ¥ï¼Œå¹¶ä¸”è®©å…¶è‡ªåŠ¨åŒ–å®Œæˆï¼Œæ— éœ€äººå·¥å»åšã€‚ è€Œä¹‹å‰è‡ªå·±ä½¿ç”¨çš„å·¥ä½œæµå·¥å…·ï¼Œä¸»è¦æ˜¯Rubyçš„guardåŠç›¸å…³çš„ä¸€ç³»åˆ—gemã€‚ç°åœ¨nodejså¾ˆç«ï¼Œå…¶ä¸­çš„å·¥ä½œæµå·¥å…·Grunt/Gulpçœ‹èµ·æ¥ä¹Ÿå¾ˆå‰å®³çš„æ ·å­ï¼Œæ‰€ä»¥è¿™æ¬¡å‡†å¤‡å°è¯•çœ‹çœ‹ã€‚ æœ¬æ–‡å‡†å¤‡åˆ†æˆï¼ˆä¸Šï¼‰ï¼ˆä¸‹ï¼‰ä¸¤éƒ¨åˆ†ï¼Œæœ¬ç¯‡æ˜¯ç¬¬ä¸€éƒ¨åˆ†ï¼Œä¸»è¦çœ‹çœ‹åœ¨Cygwinä¸‹çš„å¼€å‘ç¯å¢ƒæ­å»ºã€‚ä¸‹ä¸€ç¯‡å†è®²å·¥ä½œæµæ­å»ºå’Œä½¿ç”¨ã€‚ é—²è¯ä¸å¤šè¯´ï¼Œå¼€å§‹å§ã€‚ å¼€å‘ç¯å¢ƒ: Install Nodejs: å› ä¸ºæœ€æ–°çš„Nodejså·²ç»ä¸æ”¯æŒCygwinäº†ï¼Œæ‰€ä»¥å¿…é¡»æ‰‹åŠ¨å®‰è£…ã€‚ å»Nodejså®˜ç½‘ä¸‹è½½windowsçš„å®‰è£…åŒ…http://nodejs. org/dist/v0. 10. 26/x64/node-v0. 10. 26-x64. msiã€‚è¿è¡Œï¼Œç›´æ¥é»˜è®¤å®‰è£…å¥½å³å¯ã€‚ Install Cygwin: æ¥ä¸‹æ¥å½“ç„¶æ˜¯å®‰è£…Cygwinã€‚å»Cygwinå®˜ç½‘ä¸‹è½½å®‰è£…æ–‡ä»¶åŒ…http://Cygwin. com/setup-x86_64. exeï¼Œè¿è¡Œã€‚ ä¸€è·¯nextï¼Œå®‰è£…è·¯å¾„é»˜è®¤ä¸ºC:\Cygwin64ã€‚â€œLocal Package Directoryâ€ä¸ºä¸´æ—¶æ–‡ä»¶è·¯å¾„ï¼Œä»»æ„å³å¯ã€‚ åœ¨â€œInternet Connectâ€ç•Œé¢ï¼Œå¦‚æœè¦é€šè¿‡Proxyå°±é€‰ç¬¬ä¸‰é¡¹ï¼Œå¡«å…¥Proxy Hostå’ŒPortã€‚ åœ¨â€œSelect Packageâ€ç•Œé¢ï¼Œé€‰æ‹©ä½ å‡†å¤‡å®‰è£…çš„è½¯ä»¶åŒ…ã€‚å¤§è‡´é€‰æ‹©è¿™äº›ï¼š  vim git curl wget tmux ssh ncurse(å®‰è£…æ‰å¯ä½¿ç”¨clearå‘½ä»¤) zshell ctags zip unzip ping procps tree ruby imagemagick pngquantCygwinè¿™é‡Œçš„é€‰æ‹©æ–¹å¼å’Œæ™®é€šè½¯ä»¶ç›¸æ¯”æœ‰äº›ä¸åŒã€‚ä½ è¦åœ¨é‚£ä¸ªåŒç®­å¤´çš„å›¾æ ‡ä¸Šç‚¹å‡»ï¼Œå°±èƒ½çœ‹åˆ°æ—è¾¹çš„æ–‡å­—ä¼šåœ¨install, skip, reinstall, uninstallç­‰çŠ¶æ€åˆ‡æ¢ã€‚ä½ è¦ç¡®ä¿æƒ³å®‰è£…çš„è½¯ä»¶åŒ…çŠ¶æ€åœ¨â€œinstallâ€å°±å¯¹äº†ã€‚ Nextç¡®è®¤æ— è¯¯åï¼ŒCygwinå°±ä¼šè”ç½‘ä¸‹è½½è½¯ä»¶åŒ…è¿›è¡Œå®‰è£…äº†ã€‚ æœ€åçš„finishç•Œé¢å»ºè®®å‹¾é€‰åœ¨æ¡Œé¢åˆ›å»ºå¿«æ·æ–¹å¼ã€‚ å…¨éƒ¨å®‰è£…å®Œæˆåï¼ŒåŒå‡»æ¡Œé¢å›¾æ ‡ï¼Œå¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä¼šçœ‹åˆ°Cygwinçš„çª—å£å‡ºç°ã€‚å†åº¦çœ‹åˆ°ç†Ÿæ‚‰çš„Linux Terminalé»‘è‰²çª—å£ï¼Œè¿˜çœŸæœ‰äº›å°æ¿€åŠ¨çš„æ„Ÿè§‰ã€‚ è‰¯å¥½çš„å¼€ç«¯ï¼ Settings: è¦æƒ³ä»…ä»…å‡­å€ŸCygwiné»˜è®¤çš„è®¾ç½®å°±è¿›è¡Œé«˜æ•ˆçš„å¼€å‘ï¼Œé‚£æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬å¿…é¡»è¦è¿›è¡Œä¸€äº›è®¾ç½®æ‰è¡Œã€‚ä¸€èµ·æ¥çœ‹çœ‹å§ã€‚ Cygwin: é¦–å…ˆæ˜¯Cygwinè‡ªèº«ã€‚ç‚¹å‡»Cygwinçª—å£å·¦ä¸Šè§’ï¼Œå¼¹å‡ºèœå•ä¸­é€‰æ‹©â€œoptionsâ€ï¼Œæ˜¾ç¤ºè®¾ç½®çª—å£ã€‚æœ‰è¿™ä¹ˆä¸€äº›è¾ƒé‡è¦çš„åœ°æ–¹éœ€è¦è°ƒæ•´ï¼š  Terminal â€“&gt; Type change to â€œxterm-256colorâ€ï¼› Looks â€“&gt; Cursor change to â€œBlockâ€ Text â€“&gt; Local change to â€œen_USâ€, Character set change to â€œUTF-8â€;ç‚¹å‡»â€œOKâ€ä¿å­˜ã€‚ Bash: ä½¿ç”¨å‘½ä»¤ï¼švim . bashrcï¼ŒæŒ‰ç…§è‡ªå·±ä¹ æƒ¯ä¿®æ”¹bashè®¾ç½®ã€‚æˆ‘è‡ªå·±å¸¸ç”¨çš„é…ç½®å¯å‚è§æˆ‘çš„githubï¼šbashrc å¾ˆé‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœéœ€è¦proxyè”ç½‘ï¼Œå¿…é¡»å¢åŠ å¦‚ä¸‹3è¡Œåœ¨bashrcï¼š export http_proxy=http://yourname:yourpasswd@proxyaddress:portexport https_proxy=https://yourname:yourpasswd@proxyaddress:portuse_proxy=onå¦å¤–ä¸€ä¸ªå¿…é¡»è®¾ç½®çš„ï¼Œä¸ºäº†æˆ‘ä»¬èƒ½åœ¨Cygwinä¸­æ­£å¸¸è¿è¡Œnode, npmå‘½ä»¤ï¼Œéœ€è¦æ·»åŠ ä¸€è¡Œï¼ˆå¦‚æœä¹‹å‰çš„nodeå®‰è£…åœ¨é»˜è®¤è·¯å¾„çš„è¯ï¼‰ï¼š export PATH=$PATH: /cygdrive/c/Program Files/nodejs/ /cygdrive/c/å°±æ˜¯c:\ç›˜ã€‚Cygwinä¸‹å¯ä»¥ç®€å•ä½¿ç”¨å‘½ä»¤cd c:æ¥è¿›å…¥c:ç›˜ã€‚ Tmux: Tmuxé»˜è®¤è®¾ç½®å’Œé”®ç›˜å¿«æ·é”®å¹¶ä¸å¥½ç”¨ã€‚æˆ‘è‡ªå·±ä¿®æ”¹äº†ä¸€äº›å¸¸ç”¨çš„é…ç½®å’Œå¿«æ·é”®æ˜ å°„ï¼Œå‚è§æˆ‘çš„githubï¼štmux. conf Vim: æœ€é‡è¦çš„Vimç¼–è¾‘å™¨ï¼Œå…¶é…ç½®è‡ªç„¶ä¹Ÿæ˜¯éœ€è¦è‡ªå®šä¹‰æ‰èƒ½ç”¨èµ·æ¥å¾—å¿ƒåº”æ‰‹ã€‚æˆ‘ä½¿ç”¨äº†Vundleæ¥ç®¡ç†vimçš„pluginã€‚å…·ä½“çš„é…ç½®å¯å‚è§æˆ‘çš„githubï¼švimrcï¼Œæˆ‘çš„githubï¼švimrc. bundle Git: æˆ‘è‡ªå·±å¸¸ç”¨çš„é…ç½®å¯å‚è§æˆ‘çš„githubï¼šgitconfig Zshellï¼ˆå¯é€‰ï¼‰: zshellæ˜¯æ¯”bashæ›´å¥½ç”¨çš„ä¸€ä¸ªshellï¼Œæˆ‘ç°åœ¨å·²ç»ç¦»ä¸å¼€å®ƒäº†ã€‚è¦ç”¨zshellï¼Œä¸€å®šå°‘ä¸äº†oh-my-zshï¼ oh-my-zsh: å»https://github. com/robbyrussell/oh-my-zshï¼Œå‚ç…§å…¶è¯´æ˜ï¼Œæˆ‘ä»¬åœ¨Cygwinä¸­è¿è¡Œï¼š curl -L http://install. ohmyz. sh | shè¿™ä¼šè‡ªåŠ¨å¸®ä½ æŠŠoh-my-zshå®‰è£…å¥½ã€‚è¿™é‡Œæœ‰ç‚¹ç‰¹æ®Šçš„æ˜¯ï¼Œå› ä¸ºæ˜¯Cygwinï¼Œæ‰€ä»¥æœ€åæ— æ³•è‡ªåŠ¨åˆ‡æ¢åˆ°zshellï¼Œéœ€è¦æˆ‘ä»¬æ‰‹å·¥å¤„ç†ä¸€ä¸‹ã€‚vimæ‰“å¼€ï¼š vim /etc/passwdæ‰¾åˆ°å¯¹åº”ä½ windows7ç™»å½•è´¦å·çš„é‚£ä¸€è¡Œï¼ŒæŠŠæœ€åçš„â€œ/bin/bashâ€æ”¹ä¸ºâ€œ/bin/zshâ€ã€‚é‡å¯Cygwinï¼Œå¤§åŠŸå‘Šæˆï¼ Zshell Setting: ä½¿ç”¨vim . zshrcç¼–è¾‘zshellçš„è®¾ç½®ï¼Œå¤§éƒ¨åˆ†åº”è¯¥éƒ½å¯ä»¥å‚è€ƒä¸Šé¢å¯¹bashrcçš„é…ç½®å³å¯ã€‚æˆ‘è‡ªå·±å¸¸ç”¨çš„é…ç½®å¯å‚è§æˆ‘çš„githubï¼šzshrc å€¼å¾—æ³¨æ„çš„ä¸€ä¸ªåœ°æ–¹æ˜¯ï¼Œoh-my-zshè‡ªå¸¦äº†å¾ˆå¤špluginï¼Œåœ¨~/. oh-my-zsh/pluginsä¸‹å³å¯çœ‹åˆ°ï¼Œå·²ç»å¸®ä½ åšå¥½äº†å¾ˆå¤šäº‹æƒ…ï¼Œç›´æ¥æ‹¿æ¥ç”¨å°±å¥½äº†ã€‚æ‰¾åˆ°. zshrcè¿™ä¸€è¡Œï¼š plugins=(git)åŠ å…¥ä½ éœ€è¦çš„å³å¯ï¼Œä¾‹å¦‚ï¼š plugins=(git tmux history ruby)ä½¿ç”¨zshellæœ‰æ—¶ä¼šæŠ¥ç±»ä¼¼è¿™æ ·çš„errorï¼š compdef: xxxxxxxè¿™æ—¶éœ€è¦è¿è¡Œè¿™ä¸ªå‘½ä»¤ï¼š compinitå›è½¦åï¼Œå¯¹è¯¢é—®çš„é—®é¢˜ï¼Œè¾“å…¥â€œyâ€ï¼Œå†å›è½¦ã€‚ç„¶åä¼šå‘ç°home folderä¸‹ä¼šç”Ÿæˆ. zcompdumpè¿™ä¸ªæ–‡ä»¶ï¼ŒåŒæ—¶è¿˜ä¼šå­˜åœ¨ä¸€ä¸ª. zcompdump-XXXXXXXã€‚è¿™æ—¶ä½ éœ€è¦è®°ä¸‹åè€…çš„åå­—ï¼Œç„¶ååˆ æ‰åè€…ï¼Œå†æŠŠå‰è€…åå­—æ”¹åä¸ºåè€…çš„ã€‚é‡å¯cygwinå°±çœ‹åˆ°æ¢å¤æ­£å¸¸äº†ã€‚ Ruby: å› ä¸ºå·¥ä½œç”¨åˆ°sassï¼Œæ‰€ä»¥å¿…é¡»è¦é…ç½®å¥½ç›¸å…³Rubyç¯å¢ƒã€‚æˆ‘ä»¬æ¥çœ‹çœ‹å…·ä½“è¿‡ç¨‹ã€‚ æˆ‘ä»¬åœ¨å®‰è£…Cygwinæ—¶å·²ç»è£…å¥½äº†rubyï¼Œç‰ˆæœ¬æ˜¯1. 9. 3p448ã€‚è™½ç„¶ä¸æ˜¯ç›®å‰æœ€æ–°çš„2. xç‰ˆæœ¬ï¼Œä½†å¯¹äºå·¥ä½œè€Œè¨€ä¹Ÿè¶³å¤Ÿäº†ã€‚ æ¥ä¸‹æ¥æ˜¯å®‰è£…sassç›¸å…³çš„gemã€‚ å¦‚æœèƒ½ç›´æ¥è”ç½‘ï¼Œå°±å†ç®€å•ä¸è¿‡äº†ã€‚å› ä¸ºæˆ‘ä»¬æ˜¯ç”¨åˆ°compassæ¥ç¼–è¯‘sassï¼Œæ‰€ä»¥ç›´æ¥è¿è¡Œï¼š gem install compasså®Œæˆã€‚ å¦‚æœä¸èƒ½ç›´æ¥è”ç½‘ï¼ˆä¾‹å¦‚å†…éƒ¨é™åˆ¶ç­‰åŸå› ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡æœ¬åœ°å®‰è£…çš„æ–¹å¼æ¥åšã€‚æˆ‘ä»¬éœ€è¦å…ˆæŠŠcompassçš„gemåŒ…ä¸‹è½½åˆ°æœ¬åœ°ã€‚ä¾‹å¦‚å¯¹äºcompassï¼Œæˆ‘ä»¬æ‰“å¼€å…¶gemé¡µé¢http://rubygems. org/gems/compassï¼Œç‚¹å‡»é¡µé¢ä¸­çš„â€œDownloadâ€ï¼Œå³å¯ä¸‹è½½gemåŒ…ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯é¡µé¢ä¸‹éƒ¨â€œRuntime Dependenciesâ€é‚£é‡Œï¼Œå¦‚æœæœ‰åˆ—å‡ºå…¶ä»–gemï¼Œé‚£ä¹ˆæ¯ä¸ªéƒ½éœ€è¦ä¸‹è½½ä¸‹æ¥ã€‚ä¾‹å¦‚compasså°±åˆ—å‡ºäº†ä¸‰ä¸ªï¼šchunky_png, fssm, sassã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿åŒcompassä¸€å…±ä¸‹è½½4ä¸ªgemã€‚ å…¨éƒ¨ä¸‹è½½åï¼Œåœ¨Cygwinä¸‹è¿›å…¥å¯¹åº”çš„ç›®å½•ï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š gem install --local chunky_png-x. x. x. gemgem install --local fssm-x. x. x. gemgem install --local sass-x. x. x. gemgem install --local compass-x. x. x. gemx. x. xæ˜¯å„è‡ªç‰ˆæœ¬å·ã€‚æ³¨æ„åŠ¡å¿…å…ˆå®‰è£…dependenciesçš„gemï¼Œæœ€åå®‰è£…compassã€‚ è¿™æ ·compasså°±å·²å¯ä»¥ä½¿ç”¨äº†ã€‚ å¦å¤–ï¼Œè¿™é‡Œå¼ºçƒˆæ¨èå®‰è£…ä¸€ä¸ªgemï¼štmuxinatorï¼Œå®ƒå°†ä½¿æˆ‘ä»¬çš„tmuxå¦‚è™æ·»ç¿¼ã€‚å…·ä½“ä½¿ç”¨æ–¹æ³•ä¼šåœ¨ä¸‹ç¯‡å·¥ä½œæµä¸­è®²åˆ°ã€‚ å°ç»“: è‡³æ­¤ï¼ŒCygwinçš„å¼€å‘ç¯å¢ƒåŸºæœ¬å°±ç®—å°±ç»ªäº†ã€‚ ç°åœ¨æˆ‘åœ¨Cygwinä¸­ï¼Œå¯ä»¥è¿›è¡Œå‡ ä¹å…¨éƒ¨æ—¥å¸¸å¼€å‘å·¥ä½œï¼š  ä½¿ç”¨ vim/ctags è¿›è¡Œä»£ç ç¼–è¾‘ï¼› ä½¿ç”¨ git è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼› éšæ—¶å¯ ssh è¿œç¨‹è¿å…¥ server è¿›è¡Œæ“ä½œï¼› ä½¿ç”¨å‘½ä»¤compass watchç›‘æ§å¹¶è‡ªåŠ¨ç¼–è¯‘sassï¼› zshell/tmux/tmuxinator ä½¿å·¥ä½œæ•ˆç‡æ›´é«˜æ•ˆï¼›å·¥ä½œæµ: ï¼ˆå¾…ç»­ï¼Œè§ä¸‹ç¯‡ï¼‰ "
    }, {
    "id": 62,
    "url": "/2013/08/use-vagrant-and-chef-to-create-virtual-environment-quickly/",
    "title": "Use vagrant and chef to create virtual environment quickly",
    "body": "2013/08/15 - Vagrantï¼‹Chef å¿«é€Ÿéƒ¨ç½²è™šæ‹Ÿæœºç¯å¢ƒ2013å¹´8æœˆ15æ—¥ä¸Šåˆ10:50 å‰è¨€: åœ¨ä¸Šä¸€ç¯‡ã€Šç¨‹åºå‘˜çš„ç¥å…µåˆ©å™¨ï¼Vagrantã€‹è®²åˆ°äº†Vagrantå®åœ¨æ˜¯æˆ‘ä»¬ç¨‹åºå‘˜â€œå±…å®¶æ—…è¡Œã€æ€äººç­å£â€çš„å¿…å¤‡å·¥å…·ã€‚ å½“æ—¶è¯´åˆ°ä½¿ç”¨Boxæºåšå¥½ä¸€ä¸ªè™šæ‹Ÿæœºåï¼Œä¸€èˆ¬éƒ½éœ€è¦å®‰è£…å„ç§è½¯ä»¶åŒ…å’ŒPHPã€Rubyç­‰ç›¸å…³çš„ä¸œè¥¿ç›´åˆ°æœ€ååšå¥½ä¸€ä¸ªå®Œæ•´çš„æœåŠ¡å™¨ç¯å¢ƒã€‚ ç¨å¾®æœ‰è¿‡ä¸€äº›SAç®¡ç†å‘˜ç±»ä¼¼ç»éªŒçš„äººéƒ½ä¼šæ˜ç™½ï¼Œè¿™ä¸ªè¿‡ç¨‹å®åœ¨ä¸èƒ½ç®—æ˜¯æ„‰å¿«ï¼Œå®Œå…¨æ˜¯ä¸€ä¸ªæ¯ç‡¥åˆä¹å‘³ã€ä¸æ–­é‡å¤å†é‡å¤çš„ç´¯èµ˜äº‹ã€‚åšå¥½ä¸€å°æœåŠ¡å™¨ç¯å¢ƒèŠ±ä¸Šå¥½å‡ ä¸ªå°æ—¶é‚£æ˜¯å¸¸æœ‰çš„äº‹å„¿ã€‚ä¸‡ä¸€ä¸­é€”å‘ç°é—æ¼äº†ä»€ä¹ˆä¸œè¥¿å¿˜è®°å®‰è£…ï¼Œåæœ‰å…«ä¹åªèƒ½ä»å¤´å†æ¥ã€‚ç­‰ä½ å¥½ä¸å®¹æ˜“åšå®Œï¼ŒæŠ¬å¤´ä¸€çœ‹ï¼Œè¾¹ä¸Šè¿˜æœ‰å¥½å‡ å°æœºå™¨ç­‰ç€ä½ ç»§ç»­å‘¢ï¼Œå°±çœ¼å‰ä¸€é»‘â€¦â€¦ å¥½äº†ï¼Œè¿˜æ˜¯æ‰“ä½ï¼Œä¸è¦å†å›é¡¾è¿™æ ·è¾›é…¸çš„è¡€æ³ªå²äº†â€”â€”ä»ç°åœ¨å¼€å§‹å¯ä»¥è®©å®ƒä¸€å»ä¸å¤è¿”ï¼Œåªè¦ä½ ç”¨ä¸ŠVagrantã€‚ æ¦‚è¿°: Vagrantä½¿ç”¨äº†Chefæ¥å¸®åŠ©æˆ‘ä»¬å®ç°å¿«é€Ÿã€è‡ªåŠ¨åŒ–éƒ¨ç½²çš„ç›®æ ‡ã€‚SAç®¡ç†å‘˜è¦æ„Ÿè°¢OPSCODEç¤¾åŒºä¸ºå¤§å®¶åšå‡ºäº†å¦‚æ­¤å‡ºè‰²çš„Chefæ¥æå¤§å‡è½»ä»–ä»¬çš„å·¥ä½œé‡ã€‚ï¼ˆé¢˜å¤–è¯´ä¸€å¥ï¼Œå¦ä¸€ä¸ªç›®å‰å¾ˆç«çš„éƒ¨ç½²å·¥å…·Puppetä¹Ÿå¾ˆå‡ºè‰²ï¼Œæ›´æ£’çš„æ˜¯VagrantåŒæ ·å†…ç½®äº†å¯¹Puppetçš„æ”¯æŒã€‚ä¸è¿‡Puppetä¸æ˜¯æœ¬æ–‡è®²è¿°çš„å¯¹è±¡ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥è‡ªå·±å»ç ”ç©¶ã€‚ï¼‰ Vagrantå’ŒCheféƒ½æ˜¯ç”¨Rubyè¯­è¨€å†™æˆçš„ï¼Œå†è”æƒ³åˆ°å½“ä»Šå¦‚Railsè¿™æ ·ä¸å‡¡çš„ä¸œè¥¿ï¼Œä¸ç¦è¦é¢å¤–æ„Ÿæ…¨ä¸€ä¸‹ï¼Œè¯ç”Ÿäº†å¦‚æ­¤å¤šRubyå†™å°±çš„å“è¶Šä½œå“ï¼Œåˆ°åº•æ˜¯å› ä¸ºRubyè¦æ¯”å…¶ä»–è¯­è¨€è¶…å‡ºä¸€ç­¹ï¼Œè¿˜æ˜¯å› ä¸ºå…¨ä¸–ç•Œé‚£äº›æ›´æœ‰åˆ›é€ åŠ›çš„äººæ‰éƒ½è·‘åˆ°Rubyåœˆå­é‡Œå»äº†ï¼Ÿæ›´ä¹Ÿè®¸æ˜¯å› ä¸ºRubyå¦‚æ­¤ä¼˜ç§€ï¼Œä»¥è‡³äºå¸å¼•äº†é‚£ä¹ˆå¤šæœ‰åˆ›é€ åŠ›çš„äººæ‰ï¼Ÿ Chefç®€ä»‹: è¦ç†è§£Vagrantï¼‹Chefå¿«é€Ÿéƒ¨ç½²çš„å®ç°ï¼Œé¦–å…ˆéœ€è¦ç®€å•äº†è§£ä¸€ä¸‹Chefã€‚ Chefå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªä¸“ä¸šçš„éƒ¨ç½²å·¥å…·ã€‚å¯¹äºæ¯ä¸ªè½¯ä»¶åŒ…çš„å®‰è£…è¿‡ç¨‹ï¼ŒChefå®šä¹‰äº†ä¸€æ•´å¥—çš„è§„èŒƒï¼ŒæŒ‰ç…§è¿™ä¸ªè§„èŒƒçš„å¤šä¸ªæ–‡ä»¶ï¼Œå„å¸å…¶èŒï¼Œæœ€åå®ç°å®Œæ•´å®‰è£…å¥½æ•´ä¸ªè½¯ä»¶åŒ…ã€‚å…·ä½“ç»†èŠ‚è¿™é‡Œæˆ‘ä»¬ä¸ç”¨å…³å¿ƒï¼Œåªéœ€è¦çŸ¥é“è¿™äº›æ–‡ä»¶æœ€åéƒ½æ”¾åœ¨ä¸€ä¸ªç›®å½•å†…ï¼Œè¿™ä¸ªç›®å½•å°±å«åšä¸€ä¸ªâ€œcookbookâ€ã€‚æ¯ä¸ªcookbooké‡Œéƒ½å¯ä»¥åŒ…å«å¤šä¸ªâ€œrecipeâ€ã€‚ ä»¥Gitä¸ºä¾‹ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä¸€ä¸ªcookbookçš„ç›®å½•ç»“æ„ï¼š . â”œâ”€â”€ Berksfileâ”œâ”€â”€ CHANGELOG. mdâ”œâ”€â”€ CONTRIBUTINGâ”œâ”€â”€ Gemfileâ”œâ”€â”€ LICENSEâ”œâ”€â”€ README. mdâ”œâ”€â”€ TESTING. mdâ”œâ”€â”€ attributesâ”‚Â Â  â””â”€â”€ default. rbâ”œâ”€â”€ metadata. rbâ”œâ”€â”€ recipesâ”‚Â Â  â”œâ”€â”€ default. rbâ”‚Â Â  â”œâ”€â”€ server. rbâ”‚Â Â  â”œâ”€â”€ source. rbâ”‚Â Â  â””â”€â”€ windows. rbâ””â”€â”€ templates  â””â”€â”€ default    â”œâ”€â”€ git-xinetd. d. erb    â”œâ”€â”€ sv-git-daemon-log-run. erb    â””â”€â”€ sv-git-daemon-run. erbæœ€é‡è¦çš„æ˜¯é‚£ä¸‰ä¸ªå­ç›®å½•ï¼šattributesã€recipesã€templatesã€‚    attributesï¼šé¡¾åæ€ä¹‰ï¼Œç›®å½•é‡Œæ”¾ç½®çš„æ˜¯å®‰è£…è¿‡ç¨‹ä¸€äº›éœ€è¦ç”¨åˆ°çš„å‚æ•°è®¾å®šã€‚ä½ å¯ä»¥åœ¨åé¢ç”¨è‡ªå·±çš„è®¾å®šè¦†ç›–å®ƒï¼›     recipesï¼šrecipeæ„æ€æ˜¯â€œèœè°±â€ï¼Œå¾ˆå½¢è±¡çš„å–åã€‚ä¸åŒçš„recipeå®ç°ä¸åŒçš„å®‰è£…æ–¹å¼ã€‚ä¾‹å¦‚default. rbä¼šç›´æ¥å®‰è£…ç³»ç»Ÿç¼–è¯‘å¥½çš„åŒ…ï¼ˆä»¥CentOSè€Œè¨€ï¼Œå°±ç­‰äºyum install gitï¼‰ï¼Œè€Œsource. rbå°±ä¼šé‡‡ç”¨æºä»£ç ç¼–è¯‘çš„æ–¹å¼æ¥å®‰è£…ã€‚å…¶ä»–ç±»æ¨ã€‚     templatesï¼šæ¯ä¸ªè½¯ä»¶åŒ…å®‰è£…å¥½åï¼Œéƒ½å¯èƒ½æœ‰è‡ªå·±çš„confæˆ–å…¶ä»–ç±»ä¼¼ä¸œè¥¿ï¼Œä¾‹å¦‚Apacheåœ¨/etc/httpdä¸‹çš„ä¸€ç³»åˆ—confã€‚è¿™äº›confå¤§éƒ¨åˆ†éƒ½éœ€è¦åšä¸€äº›è°ƒæ•´æ‰èƒ½ç”¨åœ¨å®é™…ç¯å¢ƒä¸­ã€‚ä½ å°±å¯ä»¥æŠŠè¿™äº›confæ–‡ä»¶é¢„å…ˆæ”¹å¥½ï¼Œæ”¾åˆ°templatesä¸‹ï¼Œåˆ°æ—¶Chefä¼šè‡ªåŠ¨æŠŠå®ƒä»¬æ”¾åˆ°å¯¹åº”çš„ä½ç½®ä¸Šã€‚å½“ç„¶äº†ï¼Œä½ ä¸èƒ½ç›´æ¥copyï¼Œçœ‹åˆ°åç¼€åerbæ²¡æœ‰ï¼Ÿè¿™æ˜¯rubyç‰¹æœ‰çš„æ¨¡ç‰ˆæ–‡ä»¶ç±»å‹ï¼Œä½ è¦æŒ‰ç…§æ­£ç¡®è¯­æ³•æ¥å†™æ‰è¡Œã€‚  é‚£ä¹ˆæ¯ä¸€ä¸ªcookbookéƒ½éœ€è¦è‡ªå·±ä»å¤´æ¥å†™ä¹ˆï¼Ÿåªè¦ä½ æ„¿æ„å½“ç„¶æ²¡é—®é¢˜ï¼Œä½†æ˜¯å®Œå…¨ä¸ç”¨å»é‡å¤é€ è½®å­ã€‚OPSCODEç¤¾åŒºå·²ç»æ±‡é›†äº†å¾ˆå¤šåšå¥½çš„cookbookï¼Œç›¸ä¿¡è¦æ¯”ä½ è‡ªå·±å†™çš„å®Œå–„å¾—å¤šã€‚åœ°å€åœ¨è¿™é‡Œï¼š OPSCODE Cookbooksï¼šhttps://github. com/opscode-cookbooks å¯ä»¥çœ‹åˆ°è¿™é‡Œå‡ ä¹å›Šæ‹¬äº†æ‰€æœ‰å¸¸è§å’Œä¸å¸¸è§çš„è½¯ä»¶åŒ…ï¼Œä»€ä¹ˆApacheã€Nginxã€MySQLã€Gitã€PHPç­‰ç­‰ï¼Œåº”æœ‰å°½æœ‰ã€‚åªç®¡æ‹¿æ¥ç”¨å§ã€‚ å¦ä¸€ä¸ªæ¦‚å¿µæ˜¯â€œroleâ€ã€‚æ‰€è°“roleï¼Œå°±æ˜¯ä¸€ç³»åˆ—cookbookçš„ç»„åˆï¼Œä¾‹å¦‚Apacheï¼‹MySQLï¼‹PHPï¼‹Memcached è¿™æ ·ã€‚å®é™…ä¸Šå¯ä»¥çœ‹å‡ºï¼Œroleæ‰æ˜¯æˆ‘ä»¬æœ€åçœŸæ­£éœ€è¦çš„ä¸œè¥¿ã€‚ æœ‰äº†å¯¹Chefäº†è§£çš„åŸºç¡€ï¼Œç°åœ¨å¯ä»¥æ­¥å…¥æ­£é¢˜äº†ã€‚ Vagrantï¼‹Chefå®ç°å¿«é€Ÿéƒ¨ç½²: Vagrantfileçš„cheféƒ¨åˆ†: Vagrantå¯¹Chefçš„ä½¿ç”¨æ–¹å¼å…¨åœ¨æ¯ä¸ªè™šæ‹Ÿæœºçš„Vagrantfileè®¾å®šæ–‡ä»¶å†…ï¼Œé»˜è®¤æ˜¯æ³¨é‡Šæ‰çš„ï¼Œå»æ‰æ³¨é‡Šåä¼šæ˜¯è¿™æ ·ï¼š config. vm. provision :chef_solo do |chef| chef. cookbooks_path =  . . /my-recipes/cookbooks  chef. roles_path =  . . /my-recipes/roles  chef. data_bags_path =  . . /my-recipes/data_bags  chef. add_recipe  mysql  chef. add_role  web  # You may also specify custom JSON attributes: chef. json = { :mysql_password =&gt;  foo  }endå¯ä»¥çœ‹åˆ°ä¸Šè¿°æåˆ°çš„å„ä¸ªChefæœ¯è¯­ï¼Œç°åœ¨ä¸ç”¨æ‹…å¿ƒçœ‹ä¸æ˜ç™½äº†ã€‚ å‰ä¸‰è¡Œæ˜¯å¯¹cookbooksã€rolesã€data_bagsä¸‰ä¸ªç›®å½•åœ°å€çš„è®¾å®šã€‚ç‰¹åˆ«è¦å¼ºè°ƒçš„æ˜¯ï¼Œåœ°å€éƒ½æ˜¯ä»¥Vagrantfileæ‰€åœ¨ç›®å½•ä¸ºåŸºå‡†çš„ã€‚ æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨Vagrantfileæ·»åŠ recipeï¼Œå¦‚åŒä¸Šé¢çš„add_recipe  mysql è¿™æ ·ï¼›ä¹Ÿå¯ä»¥é€šè¿‡chef. json = { :mysql_password =&gt;  foo  }æ¥è®¾å®šattributeã€‚ ä½†æ˜¯ä¸å»ºè®®è¿™ä¹ˆåšï¼Œå› ä¸ºæˆ‘ä»¬å¾€å¾€éœ€è¦å®‰è£…å¾ˆå¤šè½¯ä»¶åŒ…ï¼Œå¦‚æœä¸€ä¸€æ”¾åˆ°è¿™é‡Œå°±å¤ªè‡ƒè‚¿äº†ï¼Œè€Œä¸”ä¹Ÿä¸ä¾¿äºå…¶ä»–è™šæ‹Ÿæœºå¤ç”¨ã€‚ æˆ‘ä»¬é‡‡ç”¨roleæ–¹å¼: å‡è®¾Vagrantfileæ‰€åœ¨ç›®å½•å«vmï¼Œæˆ‘ä»¬åœ¨vmçš„åŒçº§æ–°å»ºç›®å½•chefï¼Œchefä¸‹æ–°å»ºç›®å½•cookbooksã€rolesã€data_bagsã€‚ ä»ä¸Šé¢æåˆ°çš„opscode cookbooks githubä½¿ç”¨git cloneæ–¹å¼ä¸‹è½½ä½ éœ€è¦çš„å„ä¸ªcookbookï¼Œæ”¾åˆ°cookbooksç›®å½•ä¸‹ï¼Œä¾‹å¦‚æˆ‘ç”¨åˆ°çš„cookbookæœ‰è¿™ä¹ˆäº›ï¼š https://github. com/opscode-cookbooks/apache2. githttps://github. com/opscode-cookbooks/mysql. githttps://github. com/opscode-cookbooks/php. githttps://github. com/opscode-cookbooks/yum. githttps://github. com/opscode-cookbooks/openssl. githttps://github. com/opscode-cookbooks/build-essential. githttps://github. com/opscode-cookbooks/xml. githttps://github. com/yevgenko/cookbook-php-fpm. githttps://github. com/opscode-cookbooks/nginx. githttps://github. com/opscode-cookbooks/ohai. githttps://github. com/opscode-cookbooks/runit. githttps://github. com/opscode-cookbooks/vim. githttps://github. com/opscode-cookbooks/git. githttps://github. com/opscode-cookbooks/tmux. githttps://github. com/opscode-cookbooks/memcached. githttps://github. com/opscode-cookbooks/logrotate. githttps://github. com/opscode-cookbooks/man. githttps://github. com/fnichol/chef-ruby_build. githttps://github. com/opscode-cookbooks/postgresql. githttps://github. com/opscode-cookbooks/passenger_apache2. githttps://github. com/fnichol/chef-rbenv. gitæ¥ä¸‹æ¥å°±æ˜¯åˆ›å»ºæ‰€éœ€è¦çš„roleæ–‡ä»¶äº†ã€‚æ‰€æœ‰roleæ–‡ä»¶éƒ½æ”¾åœ¨rolesç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªroleï¼šweb-server. rbï¼š name  web-server override_attributes(  nginx =&gt; {   version  =&gt;  1. 4. 2 ,   source =&gt; {    modules =&gt; [     http_stub_status_module ,     http_ssl_module ,     http_gzip_static_module    ]  } },  mysql  =&gt; {   server_root_password  =&gt;  1234 ,   server_repl_password  =&gt;  1234 ,   server_debian_password  =&gt;  1234  })run_list(  recipe[yum::yum] ,  recipe[yum::epel] ,  recipe[yum::remi] ,  recipe[yum::repoforge] ,  recipe[build-essential] ,  recipe[openssl] ,  recipe[man] ,  recipe[vim] ,  recipe[git] ,  recipe[tmux] ,  recipe[logrotate::global] ,  recipe[xml] ,  recipe[ohai] ,  recipe[runit] ,  recipe[memcached] ,  recipe[mysql::server] ,  recipe[nginx::source] ,  recipe[php-fpm] ,  recipe[php] ,  recipe[php::module_curl] ,  recipe[php::module_gd] ,  recipe[php::module_mcrypt] ,  recipe[php::module_memcache] ,  recipe[php::module_memcached] ,  recipe[php::module_mysql] ,  recipe[php::module_sqlite3] )name  web-server è¡¨ç¤ºè¿™ä¸ªroleçš„åå­—ã€‚ override_attributes æ­£å¦‚ä¹‹å‰æ‰€è¯´ï¼Œå¯ä»¥è¦†ç›–cookbooké»˜è®¤çš„attributeï¼Œè®¾å®šæˆæˆ‘ä»¬è‡ªå·±éœ€è¦çš„ã€‚ run_list è¡¨ç¤ºäº†æ•´ä¸ªå®‰è£…ç”¨åˆ°çš„å…¨éƒ¨cookbookåˆ—è¡¨ã€‚ç¨å¾®è¦æ³¨æ„ä¸‹çš„æ˜¯åŒå†’å·çš„é‚£äº›è¡Œï¼Œå¦‚recipe[mysql::server]ã€‚è¿™è¡¨ç¤ºmysql cookbookä¸‹æœ‰å¤šä¸ªrecipeï¼Œè€Œæˆ‘ä»¬åªä½¿ç”¨serveré‚£ä¸ªï¼Œå…¶ä»–çš„ä¸éœ€è¦ã€‚ æœ€åä¸€æ­¥: ç°åœ¨ç¦»å¤§åŠŸå‘Šæˆåªå·®æœ€åä¸€æ­¥äº†ï¼æˆ‘ä»¬è¦è®©VagrantçŸ¥é“æ€æ ·å¼•ç”¨æ‰€åˆ›å»ºçš„roleï¼Œä¿®æ”¹Vagrantfile cheféƒ¨åˆ†å¦‚ä¸‹ï¼š config. vm. provision :chef_solo do |chef| chef. cookbooks_path =  . . /chef/cookbooks  chef. roles_path =  . . /chef/roles  chef. data_bags_path =  . . /chef/data_bags  # chef. add_recipe  mysql  chef. add_role  web-server  # You may also specify custom JSON attributes: # chef. json = { :mysql_password =&gt;  foo  }endè§è¯å¥‡è¿¹çš„æ—¶åˆ»: å¥½äº†ï¼Œè®©æˆ‘ä»¬ç¡®ä¿ç½‘ç»œç•…é€šï¼Œåœ¨å‘½ä»¤è¡Œè¾“å…¥vagrant upï¼Œå›è½¦ï¼ å½“å½“å½“å½“â€”â€”å¼€å§‹è§è¯Vagrantï¼‹Chefçš„å¥‡è¿¹æ—¶åˆ»å§ï¼ æ³¡ä¸€æ¯å’–å•¡ï¼Œååœ¨å±å¹•å‰ï¼Œæ…¢æ…¢åœ°æ¬£èµä¸Šé¢ç€‘å¸ƒèˆ¬ä¸åœæ»šåŠ¨æµå‡ºçš„ä¿¡æ¯æ–‡å­—ï¼š [2013-08-13T15:07:02+00:00] INFO: *** Chef 11. 4. 4 ***[2013-08-13T15:07:03+00:00] INFO: Setting the run_list to [ role[web-server] ] from JSON[2013-08-13T15:07:03+00:00] INFO: Run List is [role[web-server]]â€¦â€¦[2013-08-13T15:20:30+00:00] INFO: package[php-mysql] installing php-mysql-5. 4. 17-2. el6. remi from remi repository[2013-08-13T15:20:51+00:00] INFO: template[nginx. conf] sending reload action to service[nginx] (delayed)[2013-08-13T15:20:51+00:00] INFO: bash[compile_nginx_source] sending restart action to service[nginx] (delayed)[2013-08-13T15:20:51+00:00] INFO: service[nginx] restarted[2013-08-13T15:20:51+00:00] INFO: Chef Run complete in 827. 681006003 seconds[2013-08-13T15:20:51+00:00] INFO: Running report handlers[2013-08-13T15:20:51+00:00] INFO: Report handlers completeå…±ç”¨æ—¶827ç§’ï¼Œä¸€å°å‡çº§åˆ°CentOSæœ€æ–°ç³»ç»Ÿç‰ˆæœ¬ï¼Œå¹¶ä¸”å®‰è£…å¥½Nginxï¼‹MySQLï¼‹PHPï¼‹Memcachedï¼‹Gitï¼‹Tmuxï¼‹Vimçš„Web Serverçƒ­è…¾è…¾å‡ºç‚‰äº†ï¼ ä¸€æ°”å‘µæˆå•Šï¼å¥—å¥å¹¿å‘Šè¯ï¼Œâ€œä¸€é¡ºåˆ°åº•æ‰å«çˆ½â€ï¼Vagrantï¼‹Chefå°±æ˜¯æœ‰è¿™ä¹ˆé…·ã€‚ å…³äºrole: æ”¶æ‹¾ä¸‹æ¿€åŠ¨çš„å¿ƒæƒ…ï¼ˆç›¸ä¿¡æˆ‘ï¼Œæˆ‘å½“æ—¶ç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™ä¸ªç»“æœæ—¶ä¹ŸçœŸçš„è¢«éœ‡æ’¼äº†ï¼ï¼‰ï¼Œå†è¯´ä¸¤å¥roleã€‚å¦‚åŒä¸Šé¢çš„web-server. rbé‚£æ ·ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥é’ˆå¯¹ä¸åŒçš„æœåŠ¡å™¨ç¯å¢ƒåšå¥½ä¸åŒçš„roleï¼Œä¾‹å¦‚DB Serveræ¥ä¸ªdb-server. rbï¼ŒRails Serveræ¥ä¸ªrails-server. rbâ€¦â€¦ä»¥æ­¤ç±»æ¨ã€‚åˆ°æ—¶å€™ï¼Œæƒ³è¦ä»€ä¹ˆæ ·çš„æœåŠ¡å™¨ï¼Œä¸€è½¬çœ¼å°±ç«¯ç›˜ä¸Šèœäº†ã€‚ ç„¶åï¼Œå°±æ²¡æœ‰ç„¶åäº†ã€‚ä¸€åŠ³æ°¸é€¸è¯´çš„å°±æ˜¯è¿™ä¸ªã€‚ç¹é‡çš„å·¥ä½œä»æ­¤è¿œå»ï¼Œè¿‡ç¨‹åè€Œæˆä¸ºä¹è¶£ã€‚ æœ€å: Vagrantï¼‹Chefï¼Œå¯ä»¥ç”¨äºå¿«é€Ÿéƒ¨ç½²æˆ‘ä»¬çš„å¼€å‘æœåŠ¡å™¨ç¯å¢ƒï¼Œæˆ–è€…æ˜¯å¯¹äºçº¿ä¸Šç”Ÿäº§æœåŠ¡å™¨ç¯å¢ƒçš„æ¨¡æ‹Ÿã€‚ä½†æ€»è€Œè¨€ä¹‹ï¼Œå½’æ ¹ç»“åº•éƒ½æ˜¯è™šæ‹Ÿæœºç¯å¢ƒï¼Œè¿™æ˜¯ç”±Vagrantæœ¬èº«æ‰€å†³å®šçš„ã€‚ æœ‰è¯»è€…å¾ˆå¯èƒ½ä¼šé—®ï¼Œé‚£ä¹ˆå¯¹äºçœŸå®çš„æœåŠ¡å™¨ç¯å¢ƒæ€ä¹ˆåŠå‘¢ï¼Ÿä¹Ÿèƒ½åšåˆ°è¿™æ ·ä¸€æ°”å‘µæˆçš„éƒ¨ç½²å—ï¼Ÿ å½“ç„¶æ˜¯å¯ä»¥çš„ã€‚ä½†è¿™ä¸ªå°±å’ŒVagrantæ²¡æœ‰å…³ç³»äº†ï¼Œè¿™æ—¶è¦ç”¨åˆ°çš„æ˜¯Chefã€‚å…³äºChefçš„è¯¦ç»†è®²è¿°å°†åˆæ˜¯å¦ä¸€ç¯‡å¥½å¤§æ–‡ç« äº†ã€‚ "
    }, {
    "id": 63,
    "url": "/2013/08/vagrant-is-a-powerfull-tool-for-developer/",
    "title": "A powerful tool for developer, Vagrant",
    "body": "2013/08/14 - ç¨‹åºå‘˜çš„ç¥å…µåˆ©å™¨ï¼Vagrant2013å¹´8æœˆ14æ—¥ä¸Šåˆ10:50 å‚è€ƒç½‘å€ï¼š: Vagrantå®˜ç½‘ Railscasts: Virtual Machines with Vagrant ç¼˜èµ·: æœ€è¿‘å‘ç°äº†ä¸€ä¸ªè¶…é…·çš„ä¸œè¥¿â€”â€”Vagrantï¼Œä¸€è§ä¹‹ä¸‹æƒŠä¸ºå¤©äººã€‚çœŸæ˜¯åˆé«˜å…´åˆä¼¤å¿ƒï¼Œé«˜å…´çš„æ˜¯è¿™ä¸œè¥¿ç®€ç›´å¤ªæ£’äº†ï¼Œä»æ­¤è‡ªå·±çš„â€œå…µå™¨è°±â€é‡Œåˆå¢åŠ ä¸€ä»¶åˆ©å™¨ï¼›ä¼¤å¿ƒçš„æ˜¯æ€ä¹ˆç°åœ¨æ‰çœ‹åˆ°ï¼Œå®åœ¨æ˜¯ç›¸è§æ¨æ™šå•Šã€‚ ä»€ä¹ˆæ˜¯Vagrant: ç®€å•æ¥è¯´ï¼ŒVagrant å°±æ˜¯ä¸€ä¸ªè™šæ‹Ÿæœºçš„é›†æˆç®¡ç†å™¨ã€‚ æˆ‘ä»¬ç”¨å®ƒå¯ä»¥å¿«é€Ÿåˆ›å»ºè™šæ‹Ÿæœºï¼Œå¯ä»¥å¿«é€Ÿéƒ¨ç½²å¥½æ‰€éœ€çš„å„ç§ç¯å¢ƒï¼Œæ— è®ºä½ æƒ³è¦å¼€å‘ç¯å¢ƒæˆ–æ˜¯ä¸Šçº¿ç¯å¢ƒéƒ½èƒ½ä¸€é”®æå®šã€‚ç”šè‡³ä½ å¯ä»¥éƒ¨ç½²å¤šå°éƒ½æ²¡é—®é¢˜ã€‚ æƒ³æƒ³çœ‹ï¼Œå‡è®¾ä¸€å°Application Serverï¼Œå†åŠ ä¸€å°Master Database + ä¸€å°Slave Databaseï¼Œä¹Ÿè®¸å¯ä»¥å†æ¥ä¸€å°Monitor Serverç­‰ç­‰ï¼Œå…¨éƒ¨éƒ½å¯ä»¥ç”¨ä½ é‚£å°å¼€å‘å·¥ä½œçš„ç”µè„‘æ¥å®ç°ï¼Œåªè¦æœ‰è¶³å¤Ÿå†…å­˜ã€‚æ˜¯ä¸æ˜¯å¾ˆç‰›çš„æ ·å­ï¼Ÿæ‰€ä»¥è¯´ï¼Œè¦è®©æˆ‘ä»¬ä¸ç”¨Vagrantï¼Œç»™ä¸ªç†ç”±å…ˆï¼Ÿ å®‰è£…: æˆ‘ä»¬æ‰€éœ€è¦çš„å®é™…æ˜¯ Vagrantï¼‹Virtualbox è¿™ä¸¤æ ·ä¸œè¥¿ã€‚ Vagrantå¯ä»¥åœ¨ä¸Šé¢åˆ—å‡ºçš„å®˜ç½‘å»ä¸‹è½½è½¯ä»¶åŒ…ï¼Œç›®å‰æœ€æ–°ç‰ˆæœ¬æ˜¯1. 2. 7ã€‚ Vagrantæ”¯æŒçš„æ˜¯Virtualboxè¿™ä¸ªè™šæ‹Ÿæœºè½¯ä»¶ã€‚Virtualboxæ˜¯å¼€æºçš„ï¼Œå®ƒä»¥å‰æ˜¯ç‹¬ç«‹å‘å¸ƒï¼Œç°åœ¨å·²ç»è¢«Oracleæ”¶è´­äº†ï¼Œç›´æ¥å»å®˜ç½‘ä¸‹è½½å®‰è£…å³å¯ã€‚å¦å¤–ï¼ŒVagrantè¿˜æ”¯æŒVMvareè™šæ‹Ÿæœºï¼Œä¸è¿‡è¿™ä¸ªåŠŸèƒ½æ˜¯æ”¶è´¹çš„ï¼Œä¸€èˆ¬å°±ä¸ç”¨è€ƒè™‘äº†ã€‚ åŸºæœ¬ä½¿ç”¨: æ·»åŠ Boxæº: æˆ‘ä»¬è¦å…ˆç¡®å®šä½¿ç”¨ä»€ä¹ˆç³»ç»Ÿï¼Œæ˜¯å‡†å¤‡ç”¨Ubuntuï¼Œè¿˜æ˜¯ä¸ŠCentosï¼Œæˆ–è€…BSDç³»åˆ—ã€‚ç¡®å®šå¥½åï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ°vagrantbox. esè¿™ä¸ªåœ°æ–¹æŸ¥æ‰¾ã€‚VagrantæŠŠæ¯ä¸ªæ‰“åŒ…å¥½çš„è™šæ‹Ÿæœºç³»ç»Ÿå«åšboxã€‚è¿™é‡Œéƒ½æ˜¯ç½‘ç»œä¸Šçš„çƒ­å¿ƒäººå·²ç»æ‰“åŒ…å¥½çš„boxï¼Œå„ç§ç³»ç»Ÿéƒ½æœ‰ï¼Œå¿…æœ‰ä¸€æ¬¾èƒ½æ»¡è¶³ä½ çš„éœ€è¦ã€‚ ä¾‹å¦‚æˆ‘ä¹ æƒ¯ä½¿ç”¨CentOSï¼Œå°±å¯ä»¥è¿™æ ·æ¥æ·»åŠ ä¸€ä¸ªboxåˆ°Vagranté‡Œï¼š vagrant box add CentOS-64 http://developer. nrel. gov/downloads/vagrant-boxes/CentOS-6. 4-x86_64-v20130427. boxè¿™æ ·Vagrantå°±ä¼šä¸‹è½½è¿™ä¸ªboxï¼Œä¸‹è½½å®Œæˆåæ·»åŠ åˆ°è‡ªå·±çš„boxåˆ—è¡¨é‡Œã€‚å¯ä»¥ç”¨ï¼š vagrant box listæ¥æŸ¥çœ‹ã€‚å¦‚æœç½‘é€Ÿä¸å¤Ÿå¿«ï¼Œä¸€ä¸ªæŠ€å·§å°±æ˜¯å¯ä»¥å…ˆæŠŠè¿™ä¸ªboxä¸‹è½½åˆ°æœ¬åœ°ï¼Œç„¶ååœ¨ä¸Šé¢å‘½ä»¤ä¸­ä½¿ç”¨æœ¬åœ°æ–‡ä»¶åœ°å€å°±å¥½äº†ã€‚ æ¯ä¸ªboxéƒ½ç›¸å½“ä¸€ä¸ªç³»ç»Ÿçš„å®‰è£…æºï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦ç”¨åˆ°äº†ã€‚ å¼€å§‹ç¬¬ä¸€ä¸ªè™šæ‹Ÿæœº: æˆ‘ä»¬æ–°å»ºä¸€ä¸ªå·¥ä½œç›®å½•vmï¼Œç„¶ååœ¨vmé‡Œä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼š vagrant init CentOS-64ç„¶åæˆ‘ä»¬ä¼šçœ‹åˆ°å¦‚ä¸‹æç¤ºä¿¡æ¯ï¼š A `Vagrantfile` has been placed in this directory. You are nowready to `vagrant up` your first virtual environment! Please readthe comments in the Vagrantfile as well as documentation on`vagrantup. com` for more information on using Vagrant. Vagrantåœ¨vmç›®å½•ç”Ÿæˆäº†ä¸€ä¸ªâ€œVagrantfileâ€çš„è®¾å®šæ–‡ä»¶ã€‚å…¨éƒ¨çš„è®¾å®šéƒ½åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œï¼Œæˆ‘ä»¬å…ˆä¸ç®¡ï¼Œä»¥åå†ç ”ç©¶ã€‚ç°åœ¨å…ˆè®©è™šæ‹Ÿæœºè·‘èµ·æ¥ï¼ è¾“å…¥å‘½ä»¤ï¼š vagrant upç¨å¾®ç­‰å¾…ä¸€æ®µæ—¶é—´åï¼Œæˆ‘ä»¬å°±ä¼šçœ‹åˆ°Vagrantä¼šè¾“å‡ºå¾ˆå¤šè¡Œä¿¡æ¯ï¼š Bringing machine 'default' up with 'virtualbox' provider. . . [default] Setting the name of the VM. . . [default] Clearing any previously set forwarded ports. . . [default] Creating shared folders metadata. . . [default] Clearing any previously set network interfaces. . . [default] Preparing network interfaces based on configuration. . . [default] Forwarding ports. . . [default] -- 22 =&gt; 2222 (adapter 1)[default] Booting VM. . . [default] Waiting for VM to boot. This can take a few minutes. [default] VM booted and ready for use![default] Configuring and enabling network interfaces. . . [default] Mounting shared folders. . . [default] -- /vagrantYesï¼è™šæ‹Ÿæœºå·²ç»æ­£å¼åœ¨è¿è¡Œäº†ã€‚ é‚£ä¹ˆæ€ä¹ˆè¿ä¸Šå»å‘¢ï¼Ÿç…§å¸¸è§„é‚£æ ·å¼€ä¸€ä¸ªftpè½¯ä»¶ï¼Œè¾“å…¥ipã€å¸å·ã€å¯†ç å»è¿æ¥å—ï¼ŸNoï¼ vagrant sshè¿™ä¸ªå‘½ä»¤ç›´æ¥å°±æŠŠä½ é€è¿›è™šæ‹Ÿæœºå»äº†ã€‚é»˜è®¤å¸æˆ·æ˜¯vagrantï¼Œå¯†ç ä¸€æ ·ã€‚ç°åœ¨å¼€å§‹æŠ˜è…¾è¿™å°æœºå™¨å§â€¦â€¦ å¦å¤–ï¼Œè™šæ‹Ÿæœºå·²ç»æœ‰ä¸€ä¸ª/vagrantç›®å½•ï¼Œå’Œæˆ‘æ‰€åœ¨çš„vmç›®å½•æ˜¯ç›´æ¥æ˜ å°„çš„ã€‚vmé‡Œçš„ä»»ä½•æ–‡ä»¶éƒ½èƒ½åœ¨/vagrantç›®å½•é‡Œçœ‹åˆ°å’Œä½¿ç”¨ã€‚é…·å§ï¼Ÿ æ‰“åŒ…è‡ªå·±çš„Box: å½“ä½ æŠŠè‡ªå·±çš„è™šæ‹Ÿæœºåšå¥½æ‰€éœ€çš„ç¯å¢ƒï¼Œä¾‹å¦‚æˆ‘çš„CentOS-64ä¼šå‡çº§å¥½yumè½¯ä»¶åŒ…ï¼Œå®‰è£…å¥½MySQLã€PHPç­‰ç¯å¢ƒåï¼Œä¸æƒ³ä»¥åæ¯æ¬¡éƒ½æŠŠè¿™ä¸ªè¿‡ç¨‹é‡æ¥ä¸€æ¬¡ï¼Œæˆ–è€…å‡å¦‚åœ¨å›¢é˜Ÿé‡Œä¸æƒ³æ¯ä¸ªæˆå‘˜çš„å¼€å‘ç¯å¢ƒå„è‡ªäº”èŠ±å…«é—¨ä¹±ä¸ƒå…«ç³Ÿï¼Œæˆ‘å°±å¯ä»¥æŠŠè¿™ä¸ªåšå¥½çš„CentOS-64æ‰“åŒ…å‡ºæ¥ï¼Œåˆ†äº«ç»™å›¢é˜Ÿæˆå‘˜ã€‚ vagrant packageç¨ç­‰ä¸€ç‚¹æ—¶é—´åï¼ŒVagrantä¼šåœ¨vmç›®å½•ä¸‹è¾“å‡ºä¸€ä¸ªpackage. boxçš„æ–‡ä»¶ã€‚æ²¡é”™ï¼Œè¿™å®Œå…¨è·Ÿæˆ‘ä»¬åœ¨ä¸Šé¢vagrantbox. esä¸‹è½½çš„boxæ–‡ä»¶ä¸€æ ·çš„ï¼Œå®é™…ä¸Šé‚£é‡Œçƒ­å¿ƒäººåˆ†äº«çš„boxæ–‡ä»¶éƒ½æ˜¯è¿™ä¹ˆæ¥çš„ã€‚æ‰€ä»¥å¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•æ·»åŠ åˆ°boxåˆ—è¡¨é‡Œå»ï¼Œä¾‹å¦‚ï¼š vagrant box add CentOS-64S package. boxè¿™æ ·ä»¥åæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªæ–°boxæ¥ç”Ÿæˆè™šæ‹Ÿæœºï¼š vagrant init CentOS-64Sæ–°è™šæ‹Ÿæœºç›´æ¥å°±æ˜¯ä¸€ä¸ªåšå¥½çš„PHP Serverã€‚ åŸæ¥çš„CentOS-64è¿™ä¸ªboxå®Œå…¨å¯ä»¥åˆ æ‰äº†ï¼Œè¿˜å¯ä»¥èŠ‚çœä¸€ç‚¹ç©ºé—´ï¼š vagrant box remove CentOS-64è™šæ‹Ÿæœºçš„è®¾å®š: ä¸Šé¢è¯´åˆ°Vagrantä¼šä¸ºæ¯ä¸ªè™šæ‹Ÿæœºéƒ½ç”Ÿæˆä¸€ä¸ªVagrantfileè®¾å®šæ–‡ä»¶ã€‚ ç”¨ä»»æ„æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€å®ƒï¼Œå¦‚æœä½ å¯¹Rubyè¯­è¨€æœ‰ä¸€ç‚¹äº†è§£çš„è¯ï¼Œå°±ä¼šæ˜ç™½å®é™…æ•´ä¸ªå†…å®¹éƒ½æ˜¯Ruby Codeã€‚è€Œä¸”Vagrantå¾ˆè´´å¿ƒçš„å‡†å¤‡äº†è¯¦å°½åˆ°æœ‰äº›å•°å—¦çš„æ³¨é‡Šç»™ä½ ï¼Œè¿™é‡Œå¼ºçƒˆå»ºè®®ä½ ä»”ç»†çœ‹çœ‹ã€‚å®é™…å¯¹äºæ¯ä¸ªé€‰é¡¹è®¾å®šéƒ½è¯´çš„éå¸¸æ¸…æ¥šäº†ã€‚ ä¸»è¦çš„è®¾å®šå¤§æ¦‚æœ‰è¿™ä¹ˆäº›ï¼š æ³¨ï¼šä¸‹é¢æåˆ°çš„è®¾å®šæœ‰äº›æ˜¯é»˜è®¤æ³¨é‡Šæ‰çš„ï¼Œæ²¡æœ‰å¼€å¯ï¼ŒåŠ¡å¿…è¦å–æ¶ˆæ³¨é‡Šæ‰ä¼šç”Ÿæ•ˆã€‚ config. vm. box =  CentOS-64 è¿™æŒ‡å®šäº†è™šæ‹Ÿæœºä½¿ç”¨å“ªä¸ªBoxæºã€‚ config. vm. network :forwarded_port, guest: 80, host: 8080è¿™ä¸ªè®¾å®šéå¸¸ç‰›ï¼Œå®ƒä¼šæŠŠHostæœºå™¨ï¼ˆå°±æ˜¯å®‰è£…Vagrantçš„æœºå™¨ï¼‰çš„8080ç«¯å£è½¬å‘ï¼ˆforwoardï¼‰åˆ°è™šæ‹Ÿæœºçš„80ç«¯å£ã€‚ä¾‹å¦‚ä½ éƒ¨ç½²åˆ°è™šæ‹Ÿæœºçš„ç½‘ç«™è¿è¡Œåï¼Œå½“ä½ åœ¨Hostæœºå™¨ä¸Šæµè§ˆå™¨æ‰“å¼€http://localhost:8080åï¼Œå°±ä¼šè‡ªåŠ¨è½¬åˆ°è™šæ‹Ÿæœºæ­£åœ¨è¿è¡Œçš„Apacheæˆ–Nginx 80ç«¯å£æœåŠ¡ï¼Œä¹Ÿå°±æ˜¯è®¿é—®éƒ¨ç½²çš„ç½‘ç«™ã€‚å®é™…ä¸Šï¼Œè¿™ä¸ªåŠŸèƒ½æ˜¯æ¶èµ·äº†Hostæœºå™¨å’Œè™šæ‹Ÿæœºä¹‹é—´æ²Ÿé€šçš„æ¡¥æ¢ã€‚ ä»¥æ­¤ç±»æ¨ï¼Œæˆ‘ä»¬å¯ä»¥å¢åŠ æ›´å¤šçš„ç«¯å£è½¬å‘ï¼Œå¦‚å¸¸ç”¨çš„MySQL 3306ç«¯å£ï¼ŒRails çš„3000ç«¯å£ç­‰ã€‚ config. vm. network :private_network, ip:  192. 168. 33. 10 config. vm. network :public_networkè¿™ä¸¤ä¸ªæ˜¯è®¾å®šç½‘ç»œè¿æ¥æ–¹å¼ã€‚å‰è€…æŠŠè™šæ‹Ÿæœºç½‘ç»œè®¾å®šä¸ºç§æœ‰æ¨¡å¼ï¼Œå’Œä½ Hostæœºå™¨åŒä¸€ç½‘ç»œçš„å…¶ä»–ç”µè„‘æ˜¯çœ‹ä¸åˆ°å®ƒçš„ã€‚åè€…ç›¸åï¼Œè®¾ä¸ºå…¬å¼€æ¨¡å¼ï¼Œå’Œä½ Hostæœºå™¨æœ‰ç±»ä¼¼çš„IPï¼ŒåŒä¸€ç½‘ç»œçš„å…¶ä»–ç”µè„‘éƒ½èƒ½çœ‹åˆ°å®ƒã€‚ä¸€èˆ¬éƒ½é‡‡ç”¨å‰è€…ï¼Œè€Œä¸”IPä¹Ÿå»ºè®®ä¸ä»¥â€œ192. 168â€å¼€å¤´ï¼Œä»¥å…å†²çªï¼Œä¾‹å¦‚å¯ä»¥è®¾ä¸ºâ€œ66. 66. 66. 10â€è¿™æ ·â€¦â€¦ vb. customize [ modifyvm , :id,  --memory ,  1024 ]è¿™ä¸ªå¯ä»¥æ‰‹å·¥è®¾å®šè™šæ‹Ÿæœºä½¿ç”¨å¤šå°‘å†…å­˜ï¼Œæ ¹æ®ä½ è‡ªå·±æƒ…å†µæ¥å®šå°±å¥½ã€‚ç±»ä¼¼Linuxè¿™æ ·çš„Serverï¼Œä¸€èˆ¬512å°±å¤Ÿäº†ã€‚ å…¶ä»–çš„è®¾å®šè¿˜æœ‰äº›ï¼Œä¸æ˜¯ç‰¹åˆ«é‡è¦ï¼Œè¯»è€…å¯ä»¥è‡ªè¡Œå»äº†è§£çœ‹çœ‹äº†ã€‚ å¤šå°è™šæ‹Ÿæœºç»„åˆ: æˆ‘ä»¬çš„äº§å“æ­£å¼éƒ¨ç½²ä¸Šçº¿çš„æ—¶ä¾¯ï¼Œç»å¸¸éƒ½å¯èƒ½ä¸æ˜¯ä¸€å°è€Œé‡‡ç”¨å¤šå°æœåŠ¡å™¨çš„æƒ…å†µã€‚ä¾‹å¦‚ Database è¦å’Œ Application åˆ†å¼€ï¼ŒDatabase æœ‰æ—¶è¿˜æœ‰ Masterã€Slave ä¹‹åˆ†ï¼Œæœ‰æ—¶è¿˜éœ€è¦ Balance Server ç­‰ç­‰ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œè¿™ä¹ˆå¤šå°æœºå™¨ä¹‹é—´éƒ½æ˜¯éœ€è¦ç›¸äº’æ²Ÿé€šçš„ã€‚é‚£ä¹ˆåœ¨æ­£å¼éƒ¨ç½²å‰è¿›è¡Œå®å†µæ¨¡æ‹Ÿå°±æ˜¯å¾ˆæœ‰å¿…è¦çš„äº†ã€‚ è¿™æ—¶å°±æ­£æ˜¯Vagrantçš„è‹±é›„ç”¨æ­¦ä¹‹åœ°ï¼Œè¿™å¯æ˜¯Vagrantçš„â€œæ€æ‰‹çº§åŠŸèƒ½â€ã€‚é‡å¤´æˆç™»åœºï¼ æˆ‘ä»¬æ¥æ¶è®¾ä¸€å°Web Serverï¼Œä¸€å°Master Database ï¼‹ ä¸€å°Slave Database çš„ç»„åˆã€‚ åœ¨Vagrantfileè®¾å®šæ–‡ä»¶é‡Œæ”¹æˆè¿™æ ·ï¼š Vagrant. configure( 2 ) do |config| config. vm. define :web do |web|  web. vm. box =  CentOS-64   web. vm. network :private_network, ip:  66. 66. 66. 10  end config. vm. define :db0 do |db|  db. vm. box =  CentOS-64   db. vm. network :private_network, ip:  66. 66. 66. 20  end config. vm. define :db1 do |db|  db. vm. box =  CentOS-64   db. vm. network :private_network, ip:  66. 66. 66. 21  endendå„é¡¹è®¾å®šå¦‚åŒä¸Šè¿°ï¼Œåªæ˜¯åç§°åˆ†åˆ«ä½¿ç”¨äº†â€œwebâ€ã€â€œdb0â€ã€â€œdb1â€ï¼Œå¹¶ä¸”è®¾å®šäº†ä¸åŒçš„IPã€‚ ç„¶åæˆ‘ä»¬ä½¿ç”¨vagrant upå¯åŠ¨ï¼Œå¯ä»¥çœ‹åˆ°è·‘å‡ºæ¥å¾ˆå¤šè¡Œä¿¡æ¯ï¼Œæ³¨æ„åˆ°æ¯è¡Œå‰é¢éƒ½æœ‰ç±»ä¼¼â€œ[web]â€ã€â€œ[db0]â€è¿™æ ·çš„å¼€å¤´ï¼Œè¡¨ç¤ºå„è‡ªæ˜¯å“ªä¸€å°æœºå™¨ã€‚ä¿¡æ¯æµåœæ­¢åï¼Œè¡¨ç¤ºæˆ‘ä»¬çš„è™šæ‹Ÿæœºç»„åˆè·‘èµ·æ¥äº†ï¼ SSHå¯ä»¥æŒ‡å®šè¿åˆ°å“ªä¸€å°å»ï¼š vagrant ssh webvagrant ssh db0é…·å¾—ä¸€å¡Œç³Šæ¶‚å•Šï¼ï¼ å†æ¥çœ‹çœ‹å„å°è™šæ‹Ÿæœºä¹‹é—´çš„è¿é€šã€‚ å…ˆè¿›å»åˆ°Web Serverï¼š vagrant ssh webåœ¨webæœºå™¨é‡Œè¿æ¥db0: ssh 66. 66. 66. 20è½»è€Œæ˜“ä¸¾å¤§åŠŸå‘Šæˆï¼ è¿˜æœ‰æ›´ç‰›çš„ä¸œè¥¿åœ¨åå¤´å‘¢ã€‚Vagrantå…è®¸ä½ å•ç‹¬å¯åŠ¨ç»„åˆé‡ŒæŸä¸€å°è™šæ‹Ÿæœºï¼Œä¾‹å¦‚ï¼š vagrant up webåªå¯åŠ¨äº†Web Serverï¼ŒDatabase æœºå™¨å¹¶æ²¡æœ‰å¯åŠ¨ã€‚ Vagrantç”šè‡³å…è®¸ä½ åœ¨å¯åŠ¨æ—¶ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼š vagrant up /db[0-9]/ç°åœ¨ä½ å¯åŠ¨å…¨éƒ¨Database Serveräº†ï¼Œå³ä½¿ä½ æœ‰db0,db1,db2â€¦db9 è¿™ä¹ˆå¤šå°ä¹Ÿæ²¡é—®é¢˜ã€‚ ç°åœ¨å¯¹Vagrantæœ‰ä¸€ä¸ªå¤§æ¦‚çš„äº†è§£äº†å§ï¼Œå°±èµ¶ç´§å»è¯•ä¸€è¯•å§ï¼Œç›¸ä¿¡ä½ ä¼šåƒæˆ‘ä¸€æ ·å–œæ¬¢ä¸Šå®ƒã€‚ "
    }];

var idx = lunr(function () {
    this.ref('id')
    this.field('title')
    this.field('body')

    documents.forEach(function (doc) {
        this.add(doc)
    }, this)
});
function lunr_search(term) {
    document.getElementById('lunrsearchresults').innerHTML = '<ul></ul>';
    if(term) {
        document.getElementById('lunrsearchresults').innerHTML = "<p>Search results for '" + term + "'</p>" + document.getElementById('lunrsearchresults').innerHTML;
        //put results on the screen.
        var results = idx.search(term);
        if(results.length>0){
            //console.log(idx.search(term));
            //if results
            for (var i = 0; i < results.length; i++) {
                // more statements
                var ref = results[i]['ref'];
                var url = documents[ref]['url'];
                var title = documents[ref]['title'];
                var body = documents[ref]['body'].substring(0,160)+'...';
                document.querySelectorAll('#lunrsearchresults ul')[0].innerHTML = document.querySelectorAll('#lunrsearchresults ul')[0].innerHTML + "<li class='lunrsearchresult'><a href='" + url + "'><span class='title'>" + title + "</span><span class='body'>"+ body +"</span><span class='url'>"+ url +"</span></a></li>";
            }
        } else {
            document.querySelectorAll('#lunrsearchresults ul')[0].innerHTML = "<li class='lunrsearchresult'>No results found...</li>";
        }
    }
    return false;
}

function lunr_search(term) {
    $('#lunrsearchresults').show( 400 );
    $( "body" ).addClass( "modal-open" );
    
    document.getElementById('lunrsearchresults').innerHTML = '<div id="resultsmodal" class="modal fade show d-block"  tabindex="-1" role="dialog" aria-labelledby="resultsmodal"> <div class="modal-dialog shadow" role="document"> <div class="modal-content"> <div class="modal-header" id="modtit"> <button type="button" class="close" id="btnx" data-dismiss="modal" aria-label="Close"> &times; </button> </div> <div class="modal-body"> <ul class="mb-0"> </ul>    </div> <div class="modal-footer"><button id="btnx" type="button" class="btn btn-primary btn-sm" data-dismiss="modal">Close</button></div></div> </div></div>';
    if(term) {
        document.getElementById('modtit').innerHTML = "<h5 class='modal-title'>Search results for '" + term + "'</h5>" + document.getElementById('modtit').innerHTML;
        //put results on the screen.
        var results = idx.search(term);
        if(results.length>0){
            //console.log(idx.search(term));
            //if results
            for (var i = 0; i < results.length; i++) {
                // more statements
                var ref = results[i]['ref'];
                var url = documents[ref]['url'];
                var title = documents[ref]['title'];
                var body = documents[ref]['body'].substring(0,160)+'...';
                document.querySelectorAll('#lunrsearchresults ul')[0].innerHTML = document.querySelectorAll('#lunrsearchresults ul')[0].innerHTML + "<li class='lunrsearchresult'><a href='" + url + "'><span class='title'>" + title + "</span><small><span class='body'>"+ body +"</span><span class='url'>"+ url +"</span></small></a></li>";
            }
        } else {
            document.querySelectorAll('#lunrsearchresults ul')[0].innerHTML = "<li class='lunrsearchresult'>Sorry, no results found. Close & try a different search!</li>";
        }
    }
    return false;
}
    
$(function() {
    $("#lunrsearchresults").on('click', '#btnx', function () {
        $('#lunrsearchresults').hide( 5 );
        $( "body" ).removeClass( "modal-open" );
    });
});