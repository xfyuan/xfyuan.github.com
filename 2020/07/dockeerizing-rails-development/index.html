<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="icon" href="/assets/images/logo.png">

<title>éª‘é²¸ä¹‹è·¯â€”â€”Dockeræ¨¡å¼ä¸‹çš„Railså¼€å‘ç¯å¢ƒæ„ç­‘ï¼ˆç¿»è¯‘ï¼‰ | The Tragedy of XY</title>

<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>éª‘é²¸ä¹‹è·¯â€”â€”Dockeræ¨¡å¼ä¸‹çš„Railså¼€å‘ç¯å¢ƒæ„ç­‘ï¼ˆç¿»è¯‘ï¼‰ | The Tragedy of XY</title>
<meta name="generator" content="Jekyll v4.1.0" />
<meta property="og:title" content="éª‘é²¸ä¹‹è·¯â€”â€”Dockeræ¨¡å¼ä¸‹çš„Railså¼€å‘ç¯å¢ƒæ„ç­‘ï¼ˆç¿»è¯‘ï¼‰" />
<meta name="author" content="Mr.Z" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="æœ¬æ–‡å·²è·å¾—åŸä½œè€…ï¼ˆVladimir Dementyevï¼‰å’Œ Evil Martians æˆæƒè®¸å¯è¿›è¡Œç¿»è¯‘ã€‚åŸæ–‡ä»‹ç»äº†ä¸€å¥—æˆç†Ÿçš„ Rails é¡¹ç›®çš„ Docker åŒ–å¼€å‘ç¯å¢ƒå¦‚ä½•æ­å»ºï¼Œæ€æ ·é€šè¿‡ä¸€äº›é…ç½®æŠ€å·§è®©å…¶é«˜æ•ˆè¿è¡Œã€‚ä¹Ÿè°ˆåˆ°äº†è¿™ç§æ¨¡å¼ä¸‹çš„å¼€å‘æµç¨‹å’Œè¯€çªç­‰é—®é¢˜ã€‚å…³äº Docker ä½œä¸ºå¼€å‘ç¯å¢ƒçš„åšæ³•æ—©å·²ä¸æ˜¯æ–°é²œäº‹ï¼Œç›¸å…³æ–‡ç« æ›´æ˜¯æœ‰éå¸¸å¤šäº†ã€‚ä½†æœ¬æ–‡æ˜¯ä¸€åå“è¶Šçš„ Ruby å¼€å‘è€…åœ¨ä¸¤å¹´å¼€å‘å®è·µä¸­æç‚¼å‡ºçš„çœŸæ­£ç»éªŒä¹‹è°ˆï¼Œè§£ç­”äº†ä¹‹å‰è‡ªå·±å¯¹ Docker å¼€å‘ç¯å¢ƒæ¨¡å¼çš„ç§ç§ç–‘æƒ‘ï¼Œå› æ­¤è§‰å¾—å¾ˆæœ‰ä»·å€¼ï¼Œé‚æˆæ­¤æ–‡ã€‚" />
<meta property="og:description" content="æœ¬æ–‡å·²è·å¾—åŸä½œè€…ï¼ˆVladimir Dementyevï¼‰å’Œ Evil Martians æˆæƒè®¸å¯è¿›è¡Œç¿»è¯‘ã€‚åŸæ–‡ä»‹ç»äº†ä¸€å¥—æˆç†Ÿçš„ Rails é¡¹ç›®çš„ Docker åŒ–å¼€å‘ç¯å¢ƒå¦‚ä½•æ­å»ºï¼Œæ€æ ·é€šè¿‡ä¸€äº›é…ç½®æŠ€å·§è®©å…¶é«˜æ•ˆè¿è¡Œã€‚ä¹Ÿè°ˆåˆ°äº†è¿™ç§æ¨¡å¼ä¸‹çš„å¼€å‘æµç¨‹å’Œè¯€çªç­‰é—®é¢˜ã€‚å…³äº Docker ä½œä¸ºå¼€å‘ç¯å¢ƒçš„åšæ³•æ—©å·²ä¸æ˜¯æ–°é²œäº‹ï¼Œç›¸å…³æ–‡ç« æ›´æ˜¯æœ‰éå¸¸å¤šäº†ã€‚ä½†æœ¬æ–‡æ˜¯ä¸€åå“è¶Šçš„ Ruby å¼€å‘è€…åœ¨ä¸¤å¹´å¼€å‘å®è·µä¸­æç‚¼å‡ºçš„çœŸæ­£ç»éªŒä¹‹è°ˆï¼Œè§£ç­”äº†ä¹‹å‰è‡ªå·±å¯¹ Docker å¼€å‘ç¯å¢ƒæ¨¡å¼çš„ç§ç§ç–‘æƒ‘ï¼Œå› æ­¤è§‰å¾—å¾ˆæœ‰ä»·å€¼ï¼Œé‚æˆæ­¤æ–‡ã€‚" />
<meta property="og:site_name" content="The Tragedy of XY" />
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/xfyuan/ossimgs@master/20200710UngNYW.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-07-10T00:00:00+00:00" />
<script type="application/ld+json">
{"dateModified":"2020-07-10T00:00:00+00:00","datePublished":"2020-07-10T00:00:00+00:00","description":"æœ¬æ–‡å·²è·å¾—åŸä½œè€…ï¼ˆVladimir Dementyevï¼‰å’Œ Evil Martians æˆæƒè®¸å¯è¿›è¡Œç¿»è¯‘ã€‚åŸæ–‡ä»‹ç»äº†ä¸€å¥—æˆç†Ÿçš„ Rails é¡¹ç›®çš„ Docker åŒ–å¼€å‘ç¯å¢ƒå¦‚ä½•æ­å»ºï¼Œæ€æ ·é€šè¿‡ä¸€äº›é…ç½®æŠ€å·§è®©å…¶é«˜æ•ˆè¿è¡Œã€‚ä¹Ÿè°ˆåˆ°äº†è¿™ç§æ¨¡å¼ä¸‹çš„å¼€å‘æµç¨‹å’Œè¯€çªç­‰é—®é¢˜ã€‚å…³äº Docker ä½œä¸ºå¼€å‘ç¯å¢ƒçš„åšæ³•æ—©å·²ä¸æ˜¯æ–°é²œäº‹ï¼Œç›¸å…³æ–‡ç« æ›´æ˜¯æœ‰éå¸¸å¤šäº†ã€‚ä½†æœ¬æ–‡æ˜¯ä¸€åå“è¶Šçš„ Ruby å¼€å‘è€…åœ¨ä¸¤å¹´å¼€å‘å®è·µä¸­æç‚¼å‡ºçš„çœŸæ­£ç»éªŒä¹‹è°ˆï¼Œè§£ç­”äº†ä¹‹å‰è‡ªå·±å¯¹ Docker å¼€å‘ç¯å¢ƒæ¨¡å¼çš„ç§ç§ç–‘æƒ‘ï¼Œå› æ­¤è§‰å¾—å¾ˆæœ‰ä»·å€¼ï¼Œé‚æˆæ­¤æ–‡ã€‚","url":"/2020/07/dockeerizing-rails-development/","@type":"BlogPosting","image":"https://cdn.jsdelivr.net/gh/xfyuan/ossimgs@master/20200710UngNYW.jpg","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/assets/images/logo.png"},"name":"Mr.Z"},"mainEntityOfPage":{"@type":"WebPage","@id":"/2020/07/dockeerizing-rails-development/"},"author":{"@type":"Person","name":"Mr.Z"},"headline":"éª‘é²¸ä¹‹è·¯â€”â€”Dockeræ¨¡å¼ä¸‹çš„Railså¼€å‘ç¯å¢ƒæ„ç­‘ï¼ˆç¿»è¯‘ï¼‰","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


<link href="/assets/css/prism.css" rel="stylesheet">

<link href="/assets/css/theme.css" rel="stylesheet">

<script src="/assets/js/jquery.min.js"></script>

</head>




<body>
	<!-- defer loading of font and font awesome -->
	<noscript id="deferred-styles">
		<link href="https://fonts.googleapis.com/css?family=Sen:400,700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
	</noscript>

<!-- Begin Sidebar Navigation
================================================== -->

<div class="sidebar">
</div>
<div class="nav-icon">
    <div class="hamburger-bar"></div>
</div>
<div id="blackover-nav" class="blackover"></div>
<nav id="menu">
    <ul>
        <h3>Navigation</h3>
        <li><a href="/">Home</a></li>
        <li><a href="/categories">Categories</a></li>
        <li><a href="/about">About</a></li>
    </ul>
</nav>

<script src="/assets/js/lunr.js"></script>

<style>
    
</style>

<div class="wrap-search">
    <div class="d-flex align-items-center ml-auto">
        <i class="fas fa-search show-search"></i>
        <form class="bd-search ml-3" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
            <input type="text" class="form-control bigradius text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
        </form>
    </div>
</div>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>


<!-- End Sidebar Navigation
================================================== -->

<div class="site-content ">

<div class="container">

    <!-- Site Logo/Name
    ================================================== -->

    <a class="navbar-brand" href="/">
        <img src="/assets/images/logo.png" alt="The Tragedy of XY">
    </a>


    <!-- Site Tag
    ================================================== -->
    

    <!-- Content
    ================================================== -->
    <div class="main-content">
        <div class="entry-header">
    <!-- Post Title -->
    <h1 class="posttitle">éª‘é²¸ä¹‹è·¯â€”â€”Dockeræ¨¡å¼ä¸‹çš„Railså¼€å‘ç¯å¢ƒæ„ç­‘ï¼ˆç¿»è¯‘ï¼‰</h1>
    <!-- Author & Date  Box -->
    
    
    <div class="d-flex align-items-center mt-4">
        <div>
            
            <img class="author-thumb" src="/assets/images/avatar.png" alt="Mr.Z">
            
        </div>            
        <div>
        Written by <a target="_blank" class="text-dark" href="https://xfyuan.github.io">Mr.Z</a> on 
        <span class="post-date"><time class="post-date" datetime="2020-07-10">10 Jul 2020</time></span>           
        
        </div>            
    </div>
    
</div>

<!-- Adsense under title if enabled from _config.yml (change your pub id and slot) -->


<!-- Featured Image -->

<div class="entry-featured-image">
    
    <img class="featured-image lazyimg " src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAACCAQAAAA3fa6RAAAADklEQVR42mNkAANGCAUAACMAA2w/AMgAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/xfyuan/ossimgs@master/20200710UngNYW.jpg" alt="éª‘é²¸ä¹‹è·¯â€”â€”Dockeræ¨¡å¼ä¸‹çš„Railså¼€å‘ç¯å¢ƒæ„ç­‘ï¼ˆç¿»è¯‘ï¼‰">
    
</div>


<!-- Content -->
<!-- Post, Page Content
================================================== -->
<div class="article-post">
    <!-- Toc if any -->
    
    <!-- End Toc -->
    <p><em>æœ¬æ–‡å·²è·å¾—åŸä½œè€…ï¼ˆVladimir Dementyevï¼‰å’Œ Evil Martians æˆæƒè®¸å¯è¿›è¡Œç¿»è¯‘ã€‚åŸæ–‡ä»‹ç»äº†ä¸€å¥—æˆç†Ÿçš„ Rails é¡¹ç›®çš„ Docker åŒ–å¼€å‘ç¯å¢ƒå¦‚ä½•æ­å»ºï¼Œæ€æ ·é€šè¿‡ä¸€äº›é…ç½®æŠ€å·§è®©å…¶é«˜æ•ˆè¿è¡Œã€‚ä¹Ÿè°ˆåˆ°äº†è¿™ç§æ¨¡å¼ä¸‹çš„å¼€å‘æµç¨‹å’Œè¯€çªç­‰é—®é¢˜ã€‚å…³äº Docker ä½œä¸ºå¼€å‘ç¯å¢ƒçš„åšæ³•æ—©å·²ä¸æ˜¯æ–°é²œäº‹ï¼Œç›¸å…³æ–‡ç« æ›´æ˜¯æœ‰éå¸¸å¤šäº†ã€‚ä½†æœ¬æ–‡æ˜¯ä¸€åå“è¶Šçš„ Ruby å¼€å‘è€…åœ¨ä¸¤å¹´å¼€å‘å®è·µä¸­æç‚¼å‡ºçš„çœŸæ­£ç»éªŒä¹‹è°ˆï¼Œè§£ç­”äº†ä¹‹å‰è‡ªå·±å¯¹ Docker å¼€å‘ç¯å¢ƒæ¨¡å¼çš„ç§ç§ç–‘æƒ‘ï¼Œå› æ­¤è§‰å¾—å¾ˆæœ‰ä»·å€¼ï¼Œé‚æˆæ­¤æ–‡ã€‚</em></p>

<ul>
  <li>åŸæ–‡é“¾æ¥ï¼š<a href="https://evilmartians.com/chronicles/ruby-on-whales-docker-for-ruby-rails-development">Ruby on Whales: Dockerizing Ruby and Rails development â€” Martian Chronicles, Evil Martiansâ€™ team blog</a></li>
  <li>ä½œè€…ï¼š<a href="https://twitter.com/palkan_tula">Vladimir Dementyev</a></li>
  <li>ç«™ç‚¹ï¼šEvil Martians â€”â€”ä½äºçº½çº¦å’Œä¿„ç½—æ–¯çš„ Ruby on Rails å¼€å‘äººå‘˜åšå®¢ã€‚ å®ƒå‘å¸ƒäº†è®¸å¤šä¼˜ç§€çš„æ–‡ç« ï¼Œå¹¶ä¸”æ˜¯ä¸å°‘ gem çš„èµåŠ©å•†ã€‚</li>
</ul>

<p><em>ã€ä¸‹é¢æ˜¯æ­£æ–‡ã€‘</em></p>

<p><img src="https://cdn.jsdelivr.net/gh/xfyuan/ossimgs@master/20200710WutVn8.png" alt="20200710WutVn8" /></p>

<p><strong>è¿™ç¯‡æ–‡ç« æ˜¯å¯¹æˆ‘åœ¨ RailsConf 2019 ä¸Šæ¼”è®²<a href="https://speakerdeck.com/palkan/railsconf-2019-terraforming-legacy-rails-applications">â€œTerraforming legacy Rails applicationsâ€</a>çš„æ•´ç†ã€‚ä»Šå¤©æˆ‘ä¸æ˜¯è¦è¯´æœä½ æŠŠåº”ç”¨ç¨‹åºå¼€å‘åˆ‡æ¢åˆ° Dockerï¼ˆä¸è¿‡ä½ å¯ä»¥å»çœ‹ä¸€ä¸‹<a href="https://www.youtube.com/watch?v=-NKpMn6XSjU">å½“æ—¶ RailsConf çš„è§†é¢‘</a>äº†è§£æ›´å¤šï¼‰ã€‚æˆ‘çš„ç›®çš„æ˜¯åˆ†äº«ç›®å‰è‡ªå·±åœ¨ Rails é¡¹ç›®ä¸Šä½¿ç”¨çš„é…ç½®ï¼Œå…¶è¯ç”Ÿäº Evil Martians çš„å¼€å‘å·¥ä½œä¸­ã€‚å°½æƒ…äº«ç”¨å®ƒå§ï¼</strong></p>

<p><strong>å£°æ˜ï¼š</strong>æœ¬æ–‡ä¼šæ ¹æ®æœ€ä½³å®è·µè¿›è¡Œå®šæœŸæ›´æ–°ï¼Œå‚çœ‹æœ€åçš„ <em>Changelog éƒ¨åˆ†</em>ã€‚</p>

<p>æˆ‘ä»ä¸‰å¹´å‰å°±å¼€å§‹åœ¨è‡ªå·±çš„å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨ Docker äº†ï¼ˆä»£æ›¿äº† Vagrantï¼Œåè€…å¯¹äºæˆ‘çš„ 4GB å†…å­˜ç¬”è®°æœ¬æ¥è¯´å®åœ¨å¤ªé‡äº†ï¼‰ã€‚ä¸€å¼€å§‹ï¼Œè¿™å½“ç„¶å¹¶éé‚£ä¹ˆä»¤äººæ„‰æ‚¦â€”â€”æˆ‘èŠ±äº†ä¸¤å¹´æ—¶é—´æ¥å°è¯•ä¸ºè‡ªå·±æ›´ä¸ºå›¢é˜Ÿæ‰¾åˆ°ä¸€ä¸ªè¶³å¤Ÿå¥½çš„é…ç½®ã€‚</p>

<p>è®©æˆ‘åœ¨è¿™é‡Œæ¥ä¸ºä½ å±•ç¤ºè¿™ä¸ªé…ç½®ï¼Œå¹¶è§£é‡Šå…¶ï¼ˆå‡ ä¹ï¼‰æ¯ä¸€è¡Œå§ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»çœ‹åˆ°å¤ªå¤šé‚£äº›å…³äº Docker çš„æ™¦æ¶©éš¾æ‡‚çš„æ•™ç¨‹äº†ã€‚</p>

<p><strong>ç›¸å…³æºä»£ç å¯ä»¥åœ¨ GitHub çš„ <a href="https://github.com/evilmartians/terraforming-rails/blob/master/examples/dockerdev">evilmartians/terraforming-rails</a> ä¸Šæ‰¾åˆ°ã€‚</strong></p>

<p>æˆ‘ä»¬åœ¨ä¸‹é¢èŒƒä¾‹ä¸­ä½¿ç”¨äº†è¿™äº›æŠ€æœ¯æ ˆï¼š</p>

<ul>
  <li>Ruby 2.6.3</li>
  <li>PostgreSQL 11</li>
  <li>NodeJS 11 &amp; Yarn (for Webpacker-backed assets compilation)</li>
</ul>

<h2 id="dockerfile"><a href="https://github.com/evilmartians/terraforming-rails/blob/master/examples/dockerdev/.dockerdev/Dockerfile">Dockerfile</a></h2>

<p>Dockerfile å®šä¹‰äº†æˆ‘ä»¬ Ruby åº”ç”¨çš„ç¯å¢ƒï¼šè¿™æ˜¯æˆ‘ä»¬ä½œä¸ºå¼€å‘è€…è¿è¡Œ serversã€consoleï¼ˆ<code>rails c</code>ï¼‰ã€testsã€Rake tasks ä»¥åŠä¸ä»£ç è¿›è¡Œäº¤äº’çš„åœ°æ–¹ã€‚</p>

<pre><code class="language-bash">ARG RUBY_VERSION
# See explanation below
FROM ruby:$RUBY_VERSION-slim-buster

ARG PG_MAJOR
ARG NODE_MAJOR
ARG BUNDLER_VERSION
ARG YARN_VERSION

# Common dependencies
RUN apt-get update -qq \
  &amp;&amp; DEBIAN_FRONTEND=noninteractive apt-get install -yq --no-install-recommends \
    build-essential \
    gnupg2 \
    curl \
    less \
    git \
  &amp;&amp; apt-get clean \
  &amp;&amp; rm -rf /var/cache/apt/archives/* \
  &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* \
  &amp;&amp; truncate -s 0 /var/log/*log

# Add PostgreSQL to sources list
RUN curl -sSL https://www.postgresql.org/media/keys/ACCC4CF8.asc | apt-key add - \
  &amp;&amp; echo 'deb http://apt.postgresql.org/pub/repos/apt/ buster-pgdg main' $PG_MAJOR &gt; /etc/apt/sources.list.d/pgdg.list

# Add NodeJS to sources list
RUN curl -sL https://deb.nodesource.com/setup_$NODE_MAJOR.x | bash -

# Add Yarn to the sources list
RUN curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - \
  &amp;&amp; echo 'deb http://dl.yarnpkg.com/debian/ stable main' &gt; /etc/apt/sources.list.d/yarn.list

# Application dependencies
# We use an external Aptfile for that, stay tuned
COPY .dockerdev/Aptfile /tmp/Aptfile
RUN apt-get update -qq &amp;&amp; DEBIAN_FRONTEND=noninteractive apt-get -yq dist-upgrade &amp;&amp; \
  DEBIAN_FRONTEND=noninteractive apt-get install -yq --no-install-recommends \
    libpq-dev \
    postgresql-client-$PG_MAJOR \
    nodejs \
    yarn=$YARN_VERSION-1 \
    $(cat /tmp/Aptfile | xargs) &amp;&amp; \
    apt-get clean &amp;&amp; \
    rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* &amp;&amp; \
    truncate -s 0 /var/log/*log

# Configure bundler
ENV LANG=C.UTF-8 \
  BUNDLE_JOBS=4 \
  BUNDLE_RETRY=3

# Uncomment this line if you store Bundler settings in the project's root
# ENV BUNDLE_APP_CONFIG=.bundle

# Uncomment this line if you want to run binstubs without prefixing with `bin/` or `bundle exec`
# ENV PATH /app/bin:$PATH

# Upgrade RubyGems and install required Bundler version
RUN gem update --system &amp;&amp; \
    gem install bundler:$BUNDLER_VERSION

# Create a directory for the app code
RUN mkdir -p /app

WORKDIR /app
</code></pre>

<p>è¿™ä¸ªé…ç½®ä»…åŒ…å«äº†å¿…ä¸å¯å°‘çš„éƒ¨åˆ†ï¼Œå¯ä»¥è¢«ç”¨ä½œä¸€ä¸ªèµ·ç‚¹ã€‚æˆ‘æ¥è¯´æ˜ä¸‹è¿™é‡Œåšäº†ä»€ä¹ˆã€‚</p>

<p>å¤´ä¸¤è¡Œçœ‹èµ·æ¥æœ‰ç‚¹å¥‡æ€ªï¼š</p>

<pre><code class="language-bash">ARG RUBY_VERSION
FROM ruby:$RUBY_VERSION-slim-buster
</code></pre>

<p>ä¸ºä»€ä¹ˆä¸ä½¿ç”¨<code>FROM ruby:2.6.3</code>æˆ–è€…ä»»ä½• Ruby çš„ç¨³å®šç‰ˆæœ¬å‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬æƒ³ä½¿ç¯å¢ƒæ˜¯å¯ä»å¤–éƒ¨è¿›è¡Œé…ç½®çš„ï¼Œä»¥ä¾¿æŠŠ Dockerfile ä½œä¸ºä¸€ç§æ¨¡æ¿ï¼š</p>

<ul>
  <li>æ˜ç¡®çš„è¿è¡Œæ—¶ç‰ˆæœ¬å€šèµ–ä¼šåœ¨<code>docker-compose.yml</code>ä¸­æŒ‡å®šï¼ˆè§åé¢ï¼‰ï¼›</li>
  <li><code>apt</code>çš„å®‰è£…ä¾èµ–åˆ—è¡¨å­˜æ”¾äºä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶é‡Œï¼ˆè§åé¢ï¼‰</li>
</ul>

<p>æˆ‘ä»¬ä¹Ÿæ˜ç¡®æŒ‡å®šäº† Debian å‘è¡Œç‰ˆï¼ˆbusterï¼‰ä»¥ç¡®ä¿ä¸ºå…¶ä»–ä¾èµ–ï¼ˆæ¯”å¦‚ PostgreSQLï¼‰æ·»åŠ æ­£ç¡®çš„æºã€‚</p>

<p>ä¸‹é¢å››è¡Œå®šä¹‰äº† PostgreSQLã€NodeJSã€Yarn å’Œ Bundler çš„ç‰ˆæœ¬ï¼š</p>

<pre><code class="language-bash">ARG PG_MAJOR
ARG NODE_MAJOR
ARG BUNDLER_VERSION
ARG YARN_VERSION
</code></pre>

<p>å› ä¸ºæˆ‘ä»¬ä¸æœŸæœ›ä»»ä½•äººä¸é€šè¿‡ <a href="https://docs.docker.com/compose/">Docker Compose</a> æ¥ä½¿ç”¨è¯¥ Dockerfileï¼Œæ‰€ä»¥å°±ä¸æä¾›é»˜è®¤å€¼äº†ã€‚</p>

<p>ç„¶åå°±æ˜¯å®é™…çš„é•œåƒ build è¿‡ç¨‹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å®‰è£…ä¸€äº›é€šç”¨çš„ç³»ç»Ÿä¾èµ–åº“ï¼ˆGitï¼ŒcURLç­‰ï¼‰ï¼Œå› ä¸ºä½¿ç”¨äº† <em>slim</em> åŸºç¡€é•œåƒä»¥ç¼©å°ä½“ç§¯ï¼š</p>

<pre><code class="language-bash"># Common dependencies
RUN apt-get update -qq \
  &amp;&amp; DEBIAN_FRONTEND=noninteractive apt-get install -yq --no-install-recommends \
    build-essential \
    gnupg2 \
    curl \
    less \
    git \
  &amp;&amp; apt-get clean \
  &amp;&amp; rm -rf /var/cache/apt/archives/* \
  &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* \
  &amp;&amp; truncate -s 0 /var/log/*log
</code></pre>

<p>æˆ‘ä»¬ä¼šåœ¨ä¸‹é¢è§£é‡Šæ‰€æœ‰è¿™äº›å®‰è£…çš„ç³»ç»Ÿä¾èµ–åº“çš„ç»†èŠ‚ï¼Œå½“è°ˆåˆ°åº”ç”¨ç¨‹åºç‰¹å®šéƒ¨åˆ†çš„æ—¶å€™ã€‚</p>

<p>é€šè¿‡<code>apt</code>å®‰è£… PostgreSQLã€NodeJSã€Yarn éœ€è¦æ·»åŠ å®ƒä»¬ deb åŒ…çš„ repos åˆ°æºçš„åˆ—è¡¨ä¸­ã€‚</p>

<p>å¯¹äº PostgreSQLï¼ˆåŸºäº<a href="https://www.postgresql.org/download/linux/debian/">å®˜æ–¹æ–‡æ¡£</a>ï¼‰ï¼š</p>

<pre><code class="language-bash">RUN curl -sSL https://www.postgresql.org/media/keys/ACCC4CF8.asc | apt-key add - \
  &amp;&amp; echo 'deb http://apt.postgresql.org/pub/repos/apt/ buster-pgdg main' $PG_MAJOR &gt; /etc/apt/sources.list.d/pgdg.list
</code></pre>

<p><strong>æ³¨æ„ï¼š</strong>è¿™å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆä¸º buster çš„åŸå› ã€‚</p>

<p>å¯¹äº NodeJSï¼ˆæ ¹æ® <a href="https://github.com/nodesource/distributions/blob/master/README.md#debinstall">NodeSource repo</a>ï¼‰ï¼š</p>

<pre><code class="language-bash">RUN curl -sL https://deb.nodesource.com/setup_$NODE_MAJOR.x | bash -
</code></pre>

<p>å¯¹äº Yarnï¼ˆæ ¹æ®<a href="https://yarnpkg.com/en/docs/install#debian-stable">å®˜æ–¹ç½‘é¡µ</a>ï¼‰ï¼š</p>

<pre><code class="language-bash">RUN curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add - \
  &amp;&amp; echo 'deb http://dl.yarnpkg.com/debian/ stable main' &gt; /etc/apt/sources.list.d/yarn.list
</code></pre>

<p>ç°åœ¨è¯¥æ¥å®‰è£…é‚£äº›ä¾èµ–åº“äº†ï¼Œä¾‹å¦‚ï¼Œè¿è¡Œ<code>apt-get install</code>ï¼š</p>

<pre><code class="language-bash">COPY .dockerdev/Aptfile /tmp/Aptfile
RUN apt-get update -qq &amp;&amp; DEBIAN_FRONTEND=noninteractive apt-get -yq dist-upgrade &amp;&amp; \
  DEBIAN_FRONTEND=noninteractive apt-get install -yq --no-install-recommends \
    libpq-dev \
    postgresql-client-$PG_MAJOR \
    nodejs \
    yarn \
    $(cat /tmp/Aptfile | xargs) &amp;&amp; \
    apt-get clean &amp;&amp; \
    rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* &amp;&amp; \
    truncate -s 0 /var/log/*log
</code></pre>

<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥è¯´ä¸‹å…³äº Aptfile çš„æŠ€å·§ï¼š</p>

<pre><code class="language-bash">COPY .dockerdev/Aptfile /tmp/Aptfile
RUN apt-get install \
    $(cat /tmp/Aptfile | xargs)
</code></pre>

<p>è¿™æ˜¯æˆ‘ä» <a href="https://github.com/heroku/heroku-buildpack-apt">heroku-buildpack-apt</a> å€Ÿé‰´åˆ°çš„ï¼Œå®ƒå…è®¸åœ¨ Heroku ä¸Šå®‰è£…å…¶ä»–åŒ…ã€‚å¦‚æœä½ ä½¿ç”¨è¿™ä¸ª buildpackï¼Œç”šè‡³èƒ½ä¸ºæœ¬åœ°å’Œçº¿ä¸Šç¯å¢ƒé‡ç”¨ç›¸åŒçš„ Aptfileï¼ˆå°½ç®¡ buildpack æä¾›äº†æ›´å¤šçš„åŠŸèƒ½ï¼‰ã€‚</p>

<p>æˆ‘ä»¬çš„<a href="https://github.com/evilmartians/terraforming-rails/blob/master/examples/dockerdev/.dockerdev/Aptfile">é»˜è®¤ Aptfile</a> ä»…åŒ…å«äº†ä¸€ä¸ªå•ç‹¬çš„åŒ…ï¼ˆå› ä¸ºè¦ä½¿ç”¨ Vim æ¥ç¼–è¾‘ Rails çš„ Credentialsï¼‰ï¼š</p>

<pre><code class="language-bash">vim
</code></pre>

<p>åœ¨æˆ‘å·¥ä½œè¿‡çš„å‰ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ LaTeX å’Œ <a href="https://www.tug.org/texlive/">TexLive</a> æ¥ç”Ÿæˆ PDFã€‚æˆ‘ä»¬çš„ Aptfile çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼ˆé‚£æ—¶æˆ‘è¿˜æ²¡æœ‰è¿ç”¨è¿™ä¸ªæŠ€å·§ï¼‰ï¼š</p>

<pre><code class="language-bash">vim
texlive
texlive-latex-recommended
texlive-fonts-recommended
texlive-lang-cyrillic
</code></pre>

<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬æŠŠæ‰€éœ€è¦çš„ä¾èµ–åº“æ”¾åœ¨ä¸€ä¸ªå•ç‹¬æ–‡ä»¶ä¸­ï¼Œä½¿å¾—è‡ªå·±çš„ Dockerfile æ›´åŠ é€šç”¨ã€‚</p>

<p>å¯¹äº<code>DEBIAN_FRONTEND=noninteractive</code>ï¼Œæˆ‘å»ºè®®å»çœ‹ä¸‹ <a href="https://askubuntu.com/a/972528">answer on Ask Ubuntu</a>ã€‚</p>

<p>è€Œ<code>--no-install-recommends</code>åˆ™é€šè¿‡ä¸å®‰è£…æ¨èçš„åŒ…æ¥å¸®åŠ©æˆ‘ä»¬èŠ‚çœä¸€äº›ç©ºé—´ï¼ˆè®©é•œåƒæ›´åŠ è‹—æ¡ï¼‰ã€‚å¯ä»¥å‚çœ‹<a href="http://xubuntugeek.blogspot.com/2012/06/save-disk-space-with-apt-get-option-no.html">è¿™å„¿</a>ã€‚</p>

<p>æœ€åçš„éƒ¨åˆ†<code>RUN</code> (<code>apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* &amp;&amp; truncate -s 0 /var/log/*log</code>)ä¹Ÿä¸ºäº†åŒæ ·çš„ç›®çš„â€”â€”æ¸…ç†æ‰€æ¥æ”¶åˆ°çš„åŒ…æ–‡ä»¶ï¼ˆå…¨éƒ¨éƒ½å®‰è£…å¥½äº†ï¼Œè¿™äº›ä¸å†éœ€è¦äº†ï¼‰ï¼Œä»¥åŠåœ¨å®‰è£…æœŸé—´æ‰€åˆ›å»ºçš„ä¸´æ—¶æ–‡ä»¶å’Œæ—¥å¿—ã€‚æˆ‘ä»¬éœ€è¦åœ¨åŒä¸€ä¸ª<code>RUN</code>è¯­å¥ä¸­åšè¿™äº›æ¸…ç†ï¼Œä»¥ç¡®ä¿è¿™ä¸ª<a href="https://docs.docker.com/storage/storagedriver/#images-and-layers">Docker layer</a>ä¸åŒ…å«ä»»ä½•åƒåœ¾ã€‚</p>

<p>æœ€åçš„éƒ¨åˆ†å‡ ä¹éƒ½æ˜¯ç”¨äº Bundlerï¼š</p>

<pre><code class="language-bash"># Configure bundler
ENV LANG=C.UTF-8 \
  BUNDLE_JOBS=4 \
  BUNDLE_RETRY=3 \

# Uncomment this line if you store Bundler settings in the project's root
# ENV BUNDLE_APP_CONFIG=.bundle

# Uncomment this line if you want to run binstubs without prefixing with `bin/` or `bundle exec`
# ENV PATH /app/bin:$PATH

# Upgrade RubyGems and install required Bundler version
RUN gem update --system &amp;&amp; \
    gem install bundler:$BUNDLER_VERSION
</code></pre>

<p><code>LANG=C.UTF-8</code>è®¾ç½®é»˜è®¤ä¸º UTF-8ï¼Œå¦åˆ™ Ruby ä¼šå¯¹å­—ç¬¦ä¸²ä½¿ç”¨ US-ASCII ç¼–ç ï¼Œä½ å†ä¹Ÿä¸èƒ½ä½¿ç”¨é‚£äº›å¯çˆ±çš„ emojis ğŸ‘‹</p>

<p>å¦‚æœä½ ä½¿ç”¨<code>&lt;root&gt;/.bundle</code>ç›®å½•æ¥å­˜æ”¾é¡¹ç›®ç‰¹å®šçš„ Bundler è®¾ç½®ï¼ˆä¾‹å¦‚ï¼Œé’ˆå¯¹ç§æœ‰ gems çš„ credentialsï¼‰ï¼Œé‚£ä¹ˆå°±éœ€è¦è®¾ç½®<code>BUNDLE_APP_CONFIG</code>ã€‚Ruby çš„é»˜è®¤é•œåƒå°±<a href="https://github.com/docker-library/ruby/issues/129#issue-229195231">å®šä¹‰äº†è¿™ä¸ªå˜é‡</a>ä»¥ä½¿å¾— Bundler ä¸å›é€€åˆ°æœ¬åœ°é…ç½®ã€‚</p>

<p>ä½ å¯ä»¥é€‰æ‹©æ€§åœ°æŠŠ<code>&lt;root&gt;/bin</code>ç›®å½•æ·»åŠ åˆ°<code>PATH</code>ï¼Œä»¥ä¾¿è¿è¡Œå‘½ä»¤æ—¶æ— éœ€å¸¦ä¸Š<code>bundle exec</code>å‰ç¼€ã€‚æˆ‘ä»¬è¿™é‡Œé»˜è®¤æ²¡æœ‰åŠ ä¸Šï¼Œå› ä¸ºåœ¨å¤šé¡¹ç›®ç¯å¢ƒä¸‹å®ƒå¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œï¼ˆæ¯”å¦‚ï¼Œå½“ä½ åœ¨ Rails åº”ç”¨ä¸­æœ‰æœ¬åœ° gems æˆ– engines çš„æ—¶å€™ï¼‰ã€‚</p>

<h2 id="docker-composeyml"><a href="https://github.com/evilmartians/terraforming-rails/blob/master/examples/dockerdev/docker-compose.yml">docker-compose.yml</a></h2>

<p><a href="https://docs.docker.com/compose/">Docker Compose</a> æ˜¯ä¸€ä¸ªç¼–æ’å®¹å™¨ç¯å¢ƒçš„å·¥å…·ã€‚å®ƒä½¿æˆ‘ä»¬èƒ½å¤Ÿç›¸äº’é“¾æ¥å®¹å™¨ã€å®šä¹‰æŒä¹…åŒ– volumes å’Œ servicesã€‚</p>

<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹ Rails åº”ç”¨ç¨‹åºå¼€å‘ç¯å¢ƒçš„ compose æ–‡ä»¶ï¼Œä½¿ç”¨ PostgreSQL ä½œä¸ºæ•°æ®åº“ï¼ŒSidekiq ä½œä¸ºåå°ä»»åŠ¡å¤„ç†å™¨ï¼š</p>

<pre><code class="language-yaml">version: '2.4'

services:
  app: &amp;app
    build:
      context: .
      dockerfile: ./.dockerdev/Dockerfile
      args:
        RUBY_VERSION: '2.6.3'
        PG_MAJOR: '11'
        NODE_MAJOR: '11'
        YARN_VERSION: '1.13.0'
        BUNDLER_VERSION: '2.0.2'
    image: example-dev:1.0.0
    tmpfs:
      - /tmp

  backend: &amp;backend
    &lt;&lt;: *app
    stdin_open: true
    tty: true
    volumes:
      - .:/app:cached
      - rails_cache:/app/tmp/cache
      - bundle:/usr/local/bundle
      - node_modules:/app/node_modules
      - packs:/app/public/packs
      - .dockerdev/.psqlrc:/root/.psqlrc:ro
    environment:
      - NODE_ENV=development
      - RAILS_ENV=${RAILS_ENV:-development}
      - REDIS_URL=redis://redis:6379/
      - DATABASE_URL=postgres://postgres:postgres@postgres:5432
      - BOOTSNAP_CACHE_DIR=/usr/local/bundle/_bootsnap
      - WEBPACKER_DEV_SERVER_HOST=webpacker
      - WEB_CONCURRENCY=1
      - HISTFILE=/app/log/.bash_history
      - PSQL_HISTFILE=/app/log/.psql_history
      - EDITOR=vi
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy

  runner:
    &lt;&lt;: *backend
    command: /bin/bash
    ports:
      - '3000:3000'
      - '3002:3002'

  rails:
    &lt;&lt;: *backend
    command: bundle exec rails server -b 0.0.0.0
    ports:
      - '3000:3000'

  sidekiq:
    &lt;&lt;: *backend
    command: bundle exec sidekiq -C config/sidekiq.yml

  postgres:
    image: postgres:11.1
    volumes:
      - .psqlrc:/root/.psqlrc:ro
      - postgres:/var/lib/postgresql/data
      - ./log:/root/log:cached
    environment:
      - PSQL_HISTFILE=/root/log/.psql_history
    ports:
      - 5432
    healthcheck:
      test: pg_isready -U postgres -h 127.0.0.1
      interval: 5s

  redis:
    image: redis:3.2-alpine
    volumes:
      - redis:/data
    ports:
      - 6379
    healthcheck:
      test: redis-cli ping
      interval: 1s
      timeout: 3s
      retries: 30

  webpacker:
    &lt;&lt;: *app
    command: ./bin/webpack-dev-server
    ports:
      - '3035:3035'
    volumes:
      - .:/app:cached
      - bundle:/usr/local/bundle
      - node_modules:/app/node_modules
      - packs:/app/public/packs
    environment:
      - NODE_ENV=${NODE_ENV:-development}
      - RAILS_ENV=${RAILS_ENV:-development}
      - WEBPACKER_DEV_SERVER_HOST=0.0.0.0

volumes:
  postgres:
  redis:
  bundle:
  node_modules:
  rails_cache:
  packs:
</code></pre>

<p>æˆ‘ä»¬å®šä¹‰äº†å…«ä¸ª serviceã€‚ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå¤šï¼Ÿå…¶ä¸­ä¸€äº›åªæ˜¯ç”¨æ¥å®šä¹‰å…±äº«é…ç½®ç»™åˆ«çš„ service ç”¨è€Œå·²ï¼ˆæŠ½è±¡ serviceï¼Œä¾‹å¦‚ï¼Œ<code>app</code>å’Œ<code>backend</code>ï¼‰ï¼Œå…¶ä»–åˆ™ç”¨äºä½¿ç”¨åº”ç”¨ç¨‹åºå®¹å™¨ï¼ˆä¾‹å¦‚ï¼Œ<code>runner</code>ï¼‰çš„ç‰¹å®šå‘½ä»¤ã€‚</p>

<p>ä½¿ç”¨è¿™ç§æ–¹æ¡ˆï¼Œæˆ‘ä»¬å°±ä¸å¿…ä½¿ç”¨<code>docker-compose up</code>å‘½ä»¤æ¥è¿è¡Œåº”ç”¨ç¨‹åºäº†ï¼Œè€Œæ˜¯æ€»èƒ½æŒ‡å®šè‡ªå·±æœŸæœ›è¿è¡Œçš„ç¡®å®š service æ¥è¿è¡Œï¼ˆæ¯”å¦‚ï¼Œ<code>docker-compose up rails</code>ï¼‰ã€‚è¿™åœ¨å¼€å‘æ—¶å¾ˆæœ‰ç”¨ï¼Œä½ å¾ˆå°‘éœ€è¦æ‰€æœ‰ service åŒæ—¶å¯åŠ¨å’Œè¿è¡Œï¼ˆWebpackerã€Sidekiq ç­‰ç­‰ï¼‰ã€‚</p>

<p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ¯ä¸ª serviceã€‚</p>

<h3 id="app">app</h3>

<p>è¯¥ service çš„ä¸»è¦ç›®çš„æ˜¯æä¾›æ‰€æœ‰éœ€è¦çš„ä¿¡æ¯ä»¥æ„å»ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå®¹å™¨ï¼ˆå®šä¹‰åœ¨ Dockerfile ä¸Šæ–¹çš„éƒ¨åˆ†ï¼‰ï¼š</p>

<pre><code class="language-yaml">build:
  context: .
  dockerfile: ./.dockerdev/Dockerfile
  args:
    RUBY_VERSION: '2.6.3'
    PG_MAJOR: '11'
    NODE_MAJOR: '11'
    YARN_VERSION: '1.13.0'
    BUNDLER_VERSION: '2.0.2'
</code></pre>

<p><code>context</code>ä¸º Docker å®šä¹‰äº† <a href="https://docs.docker.com/compose/compose-file/#context">build context</a>ï¼šç±»ä¼¼äº build è¿›ç¨‹çš„å·¥ä½œç›®å½•ï¼Œä¾‹å¦‚ï¼Œå®ƒä¼šè¢«<code>COPY</code>å‘½ä»¤ç”¨åˆ°ã€‚</p>

<p>æˆ‘ä»¬æ˜ç¡®æŒ‡å®šäº† Dockerfile çš„è·¯å¾„ï¼Œå› ä¸ºå¹¶æ²¡æœ‰æŠŠå®ƒæ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œè€Œæ˜¯æŠŠæ‰€æœ‰ Docker æœ‰å…³çš„æ–‡ä»¶ä¸€èµ·æ”¾åœ¨ä¸€ä¸ªéšè—ç›®å½•<code>.dockerdev</code>å†…ã€‚</p>

<p>å¹¶ä¸”ï¼Œå¦‚å‰æ‰€è¿°ï¼Œæˆ‘ä»¬æŒ‡å®šäº†é‚£äº›ä¾èµ–åº“çš„ç¡®åˆ‡ç‰ˆæœ¬ï¼Œå®ƒä»¬åœ¨ Dockerfile ä¸­ç”¨<code>args</code>æ‰€å£°æ˜çš„ã€‚</p>

<p>ä¸€ä¸ªæˆ‘ä»¬åº”è¯¥æ³¨æ„çš„åœ°æ–¹æ˜¯æˆ‘ä»¬å¯¹é•œåƒæ‰“ä¸Š tag çš„æ–¹å¼ï¼š</p>

<pre><code class="language-bash">image: example-dev:1.0.0
</code></pre>

<p>åœ¨å¼€å‘ä¸­ä½¿ç”¨ Docker çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯åœ¨å›¢é˜Ÿé‡Œè‡ªåŠ¨åŒæ­¥è¿™äº›é…ç½®çš„å˜åŠ¨çš„èƒ½åŠ›ã€‚ä½ åªéœ€è¦æ¯æ¬¡å¯¹æœ¬åœ°é•œåƒè¿›è¡Œæ”¹åŠ¨æ—¶å‡çº§å…¶ç‰ˆæœ¬ï¼ˆæˆ–è€…åœ¨ arguments æˆ–è€…åœ¨æ‰€ä¾èµ–çš„æ–‡ä»¶ï¼‰å³å¯ã€‚æœ€ç³Ÿç³•çš„åˆ™æ˜¯ä½¿ç”¨<code>example-dev:latest</code>ä½œä¸ºä½ çš„ tagã€‚</p>

<p>ä¿ç•™é•œåƒç‰ˆæœ¬è¿˜æœ‰åŠ©äºåœ¨ä¸¤ç§ä¸åŒçš„ç¯å¢ƒä¸‹å·¥ä½œï¼Œè€Œä¸ä¼šå¸¦æ¥ä»»ä½•å…¶ä»–éº»çƒ¦ã€‚æ¯”å¦‚ï¼Œå½“ä½ åœ¨ä¸€ä¸ªé•¿æœŸçš„â€œchore/upgrade-to-ruby-3â€åˆ†æ”¯ä¸Šå·¥ä½œæ—¶ï¼Œèƒ½å¤Ÿå¾ˆå®¹æ˜“å°±åˆ‡æ¢åˆ°<code>master</code>åˆ†æ”¯å¹¶ä½¿ç”¨å¸¦æ—§ Ruby ç‰ˆæœ¬çš„æ—§é•œåƒï¼Œè€Œæ— éœ€é‡æ–°æ„å»ºä»»ä½•ä¸œè¥¿ã€‚</p>

<p><strong>æœ€ç³Ÿç³•çš„å°±æ˜¯åœ¨ä½ çš„<code>docker-compose.yml</code>ä¸­å¯¹é•œåƒä½¿ç”¨<code>latest</code>çš„ tagã€‚</strong></p>

<p>æˆ‘ä»¬ä¹Ÿå‘ŠçŸ¥ Docker åœ¨ä¸€ä¸ªå®¹å™¨å†…ä¸º<code>/tmp</code>ç›®å½•<a href="https://docs.docker.com/v17.09/engine/admin/volumes/tmpfs/#choosing-the-tmpfs-or-mount-flag">ä½¿ç”¨ tmpfs</a> ä»¥åŠ å¿«é€Ÿåº¦ï¼š</p>

<pre><code class="language-yaml">tmpfs:
  - /tmp
</code></pre>

<h3 id="backend">backend</h3>

<p>æˆ‘ä»¬æ¥åˆ°äº†è¿™ç¯‡åšå®¢ä¸­æœ€æœ‰è¶£çš„éƒ¨åˆ†ã€‚</p>

<p>è¯¥ service å®šä¹‰äº†å…³äºæ‰€æœ‰ Ruby service çš„å…±äº«è¡Œä¸ºã€‚</p>

<p>æˆ‘ä»¬æ¥å…ˆçœ‹ä¸‹ volumesï¼š</p>

<pre><code class="language-yaml">volumes:
  - .:/app:cached
  - bundle:/usr/local/bundle
  - rails_cache:/app/tmp/cache
  - node_modules:/app/node_modules
  - packs:/app/public/packs
  - .dockerdev/.psqlrc:/root/.psqlrc:ro
</code></pre>

<p>è¯¥ volumes åˆ—è¡¨çš„ç¬¬ä¸€æ¡æ˜¯æŒ‚è½½å½“å‰å·¥ä½œç›®å½•ï¼ˆé¡¹ç›®æ ¹ç›®å½•ï¼‰åˆ°å®¹å™¨å†…çš„<code>/app</code>ç›®å½•ï¼Œå¹¶ä½¿ç”¨äº†<code>cached</code>ç­–ç•¥ã€‚è¯¥<code>/cached</code>ä¿®é¥°å™¨æ˜¯åœ¨ macOS ä¸Šæé«˜ Docker å¼€å‘æ•ˆç‡çš„å…³é”®ã€‚æœ¬æ–‡ä¸­æˆ‘ä»¬ä¸æ·±å…¥è®¨è®ºè¿™ä¸ªï¼ˆæˆ‘ä»¬æ­£åœ¨å°±æ­¤ä¸»é¢˜å†™å¦ä¸€ç¯‡æ–‡ç« ğŸ˜‰ï¼‰ï¼Œä½†ä½ å¯ä»¥çœ‹çœ‹è¿™ä¸ª<a href="https://docs.docker.com/docker-for-mac/osxfs-caching/">æ–‡æ¡£</a>ã€‚</p>

<p>ä¸‹ä¸€è¡Œå‘Šè¯‰å®¹å™¨ä½¿ç”¨ä¸€ä¸ªåä¸º<code>bundle</code>çš„ volume æ¥å­˜å‚¨<code>/usr/local/bundle</code>çš„å†…å®¹ï¼ˆè¿™æ˜¯<a href="https://github.com/infosiftr/ruby/blob/9b1f77c11d663930f4175c683b1c5f268d4d8191/Dockerfile.template#L47">é»˜è®¤</a>å­˜æ”¾ gems çš„åœ°æ–¹ï¼‰ã€‚é€šè¿‡è¿™ç§æ–¹å¼æˆ‘ä»¬æŠŠ gems æ•°æ®åœ¨è¿è¡ŒæœŸé—´è¿›è¡ŒæŒä¹…åŒ–ï¼šæ‰€æœ‰å®šä¹‰åœ¨<code>docker-compose.yml</code>ä¸­çš„ volumes å°†ä¿æŒ put çŠ¶æ€ï¼Œç›´åˆ°æˆ‘ä»¬è¿è¡Œ<code>docker-compose down --volumes</code>ä¸ºæ­¢ã€‚</p>

<p>ä¸‹é¢ä¸‰è¡Œä¹Ÿæ˜¯ä¸ºäº†æ‘†è„±â€œDocker åœ¨ Mac ä¸Šæ…¢â€çš„è¯…å’’ã€‚æˆ‘ä»¬æŠŠæ‰€æœ‰ç”Ÿæˆçš„æ–‡ä»¶æ”¾ç½®åˆ° Docker çš„ volumes ä¸­ä»¥é¿å…åœ¨ host æœºå™¨ä¸€æ–¹çš„ç¹é‡ç£ç›˜æ“ä½œï¼š</p>

<pre><code class="language-yaml">- rails_cache:/app/tmp/cache
- node_modules:/app/node_modules
- packs:/app/public/packs
</code></pre>

<p><strong>è¦è®© Docker åœ¨ macOS ä¸Šè¶³å¤Ÿå¿«ï¼Œéµå¾ªä¸‹é¢ä¸¤æ¡è§„åˆ™ï¼šä½¿ç”¨<code>:cached</code>æ¥æŒ‚è½½æºæ–‡ä»¶å’Œé’ˆå¯¹ç”Ÿæˆçš„å†…å®¹ï¼ˆassetsã€bundle ç­‰ç­‰ï¼‰ä½¿ç”¨ volumesã€‚</strong></p>

<p>æœ€åä¸€è¡Œæ·»åŠ äº†ä¸€ä¸ªç‰¹å®šçš„<code>psql</code>é…ç½®åˆ°å®¹å™¨ã€‚æˆ‘ä»¬ç»å¸¸éœ€è¦ä¿å­˜å…¶å†å²å‘½ä»¤ï¼Œè¿™é‡Œå­˜å‚¨åˆ°äº† app çš„<code>log/.psql_history</code>æ–‡ä»¶ã€‚ä¸ºä»€ä¹ˆè¦åœ¨ Ruby å®¹å™¨å†…æ‰§è¡Œ<code>psql</code>ï¼Ÿå½“ä½ è¿è¡Œ<code>rails dbconsole</code>æ—¶åœ¨å†…éƒ¨å°±ä¼šç”¨åˆ°ã€‚</p>

<p>æˆ‘ä»¬çš„<code>.psqlrc</code>æ–‡ä»¶åŒ…å«ä¸‹é¢çš„æŠ€å·§æ¥ä½¿å…¶é€šè¿‡ç¯å¢ƒå˜é‡æŒ‡å®šå†å²æ–‡ä»¶è·¯å¾„æˆä¸ºå¯èƒ½ï¼ˆå…è®¸é€šè¿‡<code>PSQL_HISTFILE</code>ç¯å¢ƒå˜é‡æŒ‡å®šå†å²æ–‡ä»¶è·¯å¾„ï¼Œå¦åˆ™å°±ä¸ºé»˜è®¤çš„<code>$HOME/.psql_history</code>ï¼‰ï¼š</p>

<pre><code class="language-bash">\set HISTFILE `[[ -z $PSQL_HISTFILE ]] &amp;&amp; echo $HOME/.psql_history || echo $PSQL_HISTFILE`
</code></pre>

<p>è®©æˆ‘ä»¬æ¥è°ˆä¸‹ç¯å¢ƒå˜é‡ï¼š</p>

<pre><code class="language-yaml">environment:
  - NODE_ENV=${NODE_ENV:-development}
  - RAILS_ENV=${RAILS_ENV:-development}
  - REDIS_URL=redis://redis:6379/
  - DATABASE_URL=postgres://postgres:postgres@postgres:5432
  - WEBPACKER_DEV_SERVER_HOST=webpacker
  - BOOTSNAP_CACHE_DIR=/usr/local/bundle/_bootsnap
  - HISTFILE=/app/log/.bash_history
  - PSQL_HISTFILE=/app/log/.psql_history
  - EDITOR=vi
  - MALLOC_ARENA_MAX=2
  - WEB_CONCURRENCY=${WEB_CONCURRENCY:-1}
</code></pre>

<p>è¿™é‡Œæœ‰å¥½äº›ä¸œè¥¿ï¼Œæˆ‘é‡ç‚¹è°ˆä¸€ä¸ªã€‚</p>

<p>é¦–å…ˆæ˜¯<code>X=${X:-smth}</code>çš„è¯­æ³•ã€‚å…¶å¯ä»¥è¢«ç¿»è¯‘ä¸ºâ€œå¯¹äºå®¹å™¨å†…çš„ X å˜é‡ï¼Œä½¿ç”¨ host æœºå™¨çš„ X ç¯å¢ƒå˜é‡å€¼å¦‚æœå…¶å­˜åœ¨çš„è¯ï¼Œå¦åˆ™å°±ç”¨å¦ä¸€ä¸ªå€¼â€ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬è®© service è¿è¡Œåœ¨é€šè¿‡å‘½ä»¤æ‰€æä¾›çš„ä¸åŒç¯å¢ƒä¸­å°±æˆä¸ºå¯èƒ½ï¼Œä¾‹å¦‚ï¼Œ<code>RAILS_ENV=test docker-compose up rails</code>ã€‚</p>

<p>å˜é‡<code>DATABASE_URL</code>ã€<code>REDIS_URL</code>å’Œ<code>WEBPACKER_DEV_SERVER_HOST</code>æŠŠæˆ‘ä»¬çš„ Ruby åº”ç”¨è¿æ¥åˆ°äº†å…¶ä»– serviceã€‚<code>DATABASE_URL</code>å’Œ<code>WEBPACKER_DEV_SERVER_HOST</code>å˜é‡æ˜¯ Rails åŸç”Ÿæ‰€æ”¯æŒçš„ï¼ˆåˆ†åˆ«æ˜¯ ActiveRecord å’Œ Webpackerï¼‰ã€‚æŸäº›åº“ä¹Ÿæ”¯æŒ<code>REDIS_URL</code>ï¼ˆSidekiqï¼‰ï¼Œä½†å¹¶éæ‰€æœ‰ï¼ˆæ¯”å¦‚ï¼ŒAction Cable å¿…é¡»æ˜ç¡®é…ç½®æ‰è¡Œï¼‰ã€‚</p>

<p>æˆ‘ä»¬ä½¿ç”¨äº†<a href="https://www.github.com/Shopify/bootsnap">bootsnap</a>æ¥æå‡åº”ç”¨ç¨‹åºçš„åŠ è½½æ—¶é—´ï¼ŒæŠŠå…¶ç¼“å­˜å­˜å‚¨äºè·Ÿ Bundler æ•°æ®ç›¸åŒçš„ volume ä¸­ï¼Œå› ä¸ºè¿™ä¸ªç¼“å­˜ä¸»è¦æ˜¯åŒ…å« gems æ•°æ®ï¼›å› æ­¤ï¼Œæˆ‘ä»¬åœ¨åšå¦ä¸€æ¬¡ Ruby ç‰ˆæœ¬å‡çº§æ—¶ï¼Œå°±åº”è¯¥ä¸€èµ·åˆ é™¤æ‰€æœ‰å†…å®¹ã€‚</p>

<p><code>HISTFILE=/app/log/.bash_history</code>ä»å¼€å‘è€…çš„ UX è§’åº¦çœ‹æ˜¯å¾ˆé‡è¦çš„è®¾ç½®ï¼šå‘Šè¯‰ Bash åœ¨æŒ‡å®šä½ç½®å­˜å‚¨å…¶å†å²å‘½ä»¤ä»¥ä½¿å…¶æŒä¹…åŒ–ã€‚</p>

<p><code>EDITOR=vi</code>è¢«ç”¨åœ¨ï¼Œä¾‹å¦‚ï¼Œ<code>rails credentials:edit</code>å‘½ä»¤ç®¡ç† credentials æ–‡ä»¶æ—¶ã€‚</p>

<p>æœ€åï¼Œæœ«å°¾ä¸¤ä¸ªè®¾ç½®ï¼Œ<code>MALLOC_ARENA_MAX</code>å’Œ<code>WEB_CONCURRENCY</code>ï¼Œå¸®åŠ©ä½ æ£€æŸ¥ Rails å†…å­˜çš„å¤„ç†æƒ…å†µã€‚</p>

<p>è¯¥ service ä¸­å°šæœªæ¶µç›–çš„æ˜¯ï¼š</p>

<pre><code class="language-yaml">stdin_open: true
tty: true
</code></pre>

<p>å®ƒä»¬ä½¿å¾—è¯¥ service æ˜¯å¯äº¤äº’çš„ï¼Œä¾‹å¦‚ï¼Œæä¾› TTYã€‚æˆ‘ä»¬éœ€è¦è¿™ä¸ªï¼Œæ¯”å¦‚ï¼Œæ¥è¿è¡Œ Rails console æˆ–è€…åœ¨å®¹å™¨å†…çš„ Bashã€‚</p>

<p>è¿™è·Ÿä½¿ç”¨<code>-it</code>é€‰é¡¹æ¥è¿è¡Œ Docker å®¹å™¨æ˜¯ç›¸åŒçš„ã€‚</p>

<h3 id="webpacker">webpacker</h3>

<p>è¿™é‡Œæˆ‘åªæƒ³å¼ºè°ƒä¸€ç‚¹å°±æ˜¯<code>WEBPACKER_DEV_SERVER_HOST=0.0.0.0</code>çš„é…ç½®ï¼šå®ƒè®© Webpack dev server ä»å¤–éƒ¨æ˜¯å¯è®¿é—®çš„ï¼ˆé»˜è®¤è¿è¡Œåœ¨<code>localhost</code>ä¸Šï¼‰.</p>

<h3 id="runner">runner</h3>

<p>è¦è§£é‡Šè¯¥ service çš„ç›®çš„ï¼Œè®©æˆ‘æ¥åˆ†äº«ä¸€ä¸‹è‡ªå·±åœ¨å¼€å‘æ—¶ä½¿ç”¨ Docker çš„æ–¹å¼ï¼š</p>

<ul>
  <li>å¯åŠ¨ä¸€ä¸ª Docker daemonï¼Œè¿è¡Œä¸€ä¸ªè‡ªå®šä¹‰çš„<code>docker-start</code>è„šæœ¬ï¼š</li>
</ul>

<pre><code class="language-bash">#!/bin/sh

if ! $(docker info &gt; /dev/null 2&gt;&amp;1); then
  echo "Opening Docker for Mac..."
  open -a /Applications/Docker.app
  while ! docker system info &gt; /dev/null 2&gt;&amp;1; do sleep 1; done
  echo "Docker is ready to rock!"
else
  echo "Docker is up and running."
fi
</code></pre>

<ul>
  <li>ç„¶åæˆ‘åœ¨é¡¹ç›®ç›®å½•ä¸‹è¿è¡Œ<code>dcr runner</code>ï¼ˆ<code>dcr</code>æ˜¯<code>docker-compose run</code>çš„ aliasï¼‰ä»¥è¿›å…¥å®¹å™¨çš„ shell ä¸­ï¼›è¿™æ˜¯ä¸‹é¢å‘½ä»¤çš„ aliasï¼š</li>
</ul>

<pre><code class="language-bash">$ docker-compose run --rm runner
</code></pre>

<ul>
  <li>æˆ‘åœ¨è¿™ä¸ªå®¹å™¨å†…è¿è¡Œï¼ˆå‡ ä¹ï¼‰ä¸€åˆ‡ï¼štestsã€migrationsã€Rake tasksï¼Œç­‰ç­‰ã€‚</li>
</ul>

<p>å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä¸æ˜¯åœ¨éœ€è¦è¿è¡Œä¸€ä¸ªä»»åŠ¡æ—¶å»å¼€æ–°å®¹å™¨ï¼Œè€Œæ˜¯æ€»ä½¿ç”¨åŒä¸€ä¸ªã€‚</p>

<p>è¿™æ ·ï¼Œæˆ‘å°±å¦‚åŒå¤šå¹´å‰ä½¿ç”¨<code>vagrant ssh</code>é‚£æ ·æ¥ä½¿ç”¨<code>dcr runner</code>äº†ã€‚</p>

<p>æˆ‘ä¹‹æ‰€ä»¥æŠŠå®ƒç§°ä¸º<code>runner</code>è€Œä¸æ˜¯<code>shell</code>ï¼Œæ˜¯å› ä¸ºå®ƒè¿˜å¯åœ¨å®¹å™¨å†…ç”¨æ¥è¿è¡Œä»»æ„å‘½ä»¤ã€‚</p>

<p><strong>æ³¨æ„ï¼š</strong><code>runner</code>è¿™ä¸ª service æ˜¯ä¸€ä¸ªå“å‘³é—®é¢˜ï¼Œè·Ÿ<code>web</code> service ç›¸æ¯”ï¼Œé™¤äº†é»˜è®¤ <code>command</code>ï¼ˆ<code>/bin/bash</code>ï¼‰å¤–ï¼Œå®ƒå¹¶æ²¡æœ‰å¸¦æ¥ä»»ä½•æ–°ä¸œè¥¿ï¼›å› æ­¤ï¼Œ<code>docker-compose run runner</code>è·Ÿ<code>docker-compose run web /bin/bash</code>æ˜¯ä¸€æ ·çš„ï¼ˆé™¤äº†çŸ­ä¸€äº›ğŸ˜‰ï¼‰ã€‚</p>

<h2 id="health-checks">Health checks</h2>

<p>å½“è¿è¡Œè¯¸å¦‚<code>db:migrate</code>çš„å¸¸è§„ Rails å‘½ä»¤æ—¶ï¼Œæˆ‘ä»¬æœŸæœ›ç¡®è®¤æ•°æ®åº“å·²ç»å¯åŠ¨å¹¶å‡†å¤‡å¥½è¿æ¥äº†ã€‚å¦‚ä½•å‘ŠçŸ¥ Docker Compose ç­‰å¾…æ‰€ä¾èµ–çš„ service ç›´è‡³å°±ç»ªï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<a href="https://docs.docker.com/compose/compose-file/compose-file-v2/#healthcheck">å¥åº·æ£€æŸ¥</a>ï¼</p>

<p>ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°æˆ‘ä»¬çš„<code>depends_on</code>å®šä¹‰å¹¶é services åˆ—è¡¨ï¼š</p>

<pre><code class="language-yaml">backend:
  # ...
  depends_on:
    postgres:
      condition: service_healthy
    redis:
      condition: service_healthy

postgres:
  # ...
  healthcheck:
    test: pg_isready -U postgres -h 127.0.0.1
    interval: 5s

redis:
  # ...
  healthcheck:
    test: redis-cli ping
    interval: 1s
    timeout: 3s
    retries: 30
</code></pre>

<p>æ³¨æ„ï¼šå¥åº·æ£€æŸ¥ä»…è¢« Docker Compose æ–‡ä»¶æ ¼å¼åœ¨ v2.1 åŠæ›´é«˜ç‰ˆæœ¬ä»¥ä¸Šæ”¯æŒï¼›è¿™å°±æ˜¯æˆ‘ä»¬ç”¨åœ¨å¼€å‘ä¸­çš„åŸå› äº†ã€‚</p>

<h2 id="é¢˜å¤–è¯dipyml">é¢˜å¤–è¯ï¼š<a href="https://github.com/evilmartians/terraforming-rails/blob/master/examples/dockerdev/dip.yml">dip.yml</a></h2>

<p>å¦‚æœä½ ä»ç„¶è§‰å¾— <em>Docker Compose</em> çš„æ–¹å¼è¿‡äºå¤æ‚ï¼Œæœ‰ä¸€ä¸ªå«åš <a href="https://github.com/bibendi/dip">Dip</a> çš„å·¥å…·ï¼Œæ˜¯æˆ‘åœ¨ Evil Martians çš„åŒäº‹å¼€å‘çš„ï¼Œç›®çš„æ˜¯è®©å¼€å‘ä½“éªŒæ›´åŠ é¡ºæ»‘ã€‚</p>

<p>å¦‚æœä½ æœ‰å¤šä¸ª compose æ–‡ä»¶æˆ–å¹³å°é…ç½®ï¼Œé‚£ä¹ˆå®ƒå°¤å…¶æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥æŠŠè¿™äº›é…ç½®ç²˜åˆåˆ°ä¸€èµ·ï¼Œå¹¶æä¾›ä¸€ä¸ªé€šç”¨ç•Œé¢æ¥ç®¡ç† Docker å¼€å‘ç¯å¢ƒã€‚</p>

<p>æˆ‘ä»¬å°†åœ¨æœªæ¥ä¸ºä½ ä»‹ç»æœ‰å…³å®ƒçš„æ›´å¤šå†…å®¹ï¼Œæ•¬è¯·å…³æ³¨ï¼</p>

<p>æ³¨ï¼šç‰¹åˆ«æ„Ÿè°¢ <a href="https://github.com/sponomarev">Sergey Ponomarev</a> å’Œ <a href="https://github.com/bibendi">Mikhail Merkushin</a> åˆ†äº«äº†æœ‰å…³è¯¥ä¸»é¢˜çš„æŠ€å·§ğŸ¤˜</p>

<p>å°é¢<a href="https://mars.nasa.gov/resources/1246/odyssey-views-a-surface-changed-by-floods/">å›¾ç‰‡</a>ï¼š<em>Â© NASA/JPL-Caltech, 2009</em></p>

<h2 id="changelog">Changelog</h2>

<h3 id="110-2019-12-10">1.1.0 (2019-12-10)</h3>

<ul>
  <li>Change base Ruby image to <code>slim</code>.</li>
  <li>Specify Debian release for Ruby version explicitly and upgrade to <code>buster</code>.</li>
  <li>Use standard Bundler path (<code>/usr/local/bundle</code>) instead of <code>/bundle</code>.</li>
  <li>Use Docker Compose file format v2.4.</li>
  <li>Add health checking to <code>postgres</code> and <code>redis</code> services.</li>
</ul>


</div>

<!-- Rating -->


<!-- Author Box if enabled from _config.yml -->
<!-- Author Box -->


<div class="d-flex authorbox align-items-center">
    <div class="col-md-2 mr-4 text-center">
        
        <img class="author-thumb" src="/assets/images/avatar.png" alt="Mr.Z">
        
    </div>
    <div class="col-md-10"> 
        <a target="_blank" class="text-dark h4" href="https://xfyuan.github.io">About Mr.Z</a>   <a target="_blank" href="https://twitter.com/apexy" class="btn-sm"><i class="fab fa-twitter"></i></a>        
        <span class="author-description d-block mt-2">A Chinese software engineer living and working in Chengdu. I love Creating the future in digital worlds, big and small.</span>            
    </div>
</div>



<!-- Comments if not disabled with comments: false -->
<!-- Comments
================================================== -->
 
<div class="comments">
    <button class="btn btn-dark show-comments">Load Comments</button>         
    <div id="comments">  
        <h4 class="mb-4">Comments</h4>                 
            <section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'xfyuan'; 
        var disqus_developer = 0;
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = window.location.protocol + '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>
     
    <div class="clearfix"></div>              
    </div>    
</div>       


<!-- Share -->
<div class="share">
    <p>
        Share
    </p>
    <ul>
        <li class="ml-1 mr-1">
            <a target="_blank" href="https://twitter.com/intent/tweet?text=éª‘é²¸ä¹‹è·¯â€”â€”Dockeræ¨¡å¼ä¸‹çš„Railså¼€å‘ç¯å¢ƒæ„ç­‘ï¼ˆç¿»è¯‘ï¼‰&url=/2020/07/dockeerizing-rails-development/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fab fa-twitter"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://facebook.com/sharer.php?u=/2020/07/dockeerizing-rails-development/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
                <i class="fab fa-facebook-f"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=/2020/07/dockeerizing-rails-development/" onclick="window.open(this.href, 'width=550,height=435');return false;">
                <i class="fab fa-linkedin-in"></i>
            </a>
        </li>

    </ul>
</div>


<!-- Related Post -->
<!-- Related Posts
================================================== -->
<div class=" related-posts ">  

    
    <h2 class="text-center mb-4">Explore more like this</h2>
    
    
    <div class="d-flex justify-content-center align-items-center">
    
    <!-- Categories -->
    
    
    <a class="smoothscroll badge badge-primary text-capitalize" href="/categories#Programming">Programming</a>                
    
    <a class="smoothscroll badge badge-primary text-capitalize" href="/categories#Translation">Translation</a>                
    

    <!-- Tags -->  
    
                    
    <a class="smoothscroll badge badge-primary text-capitalize" href="/tags#docker">docker</a>               
                    
    <a class="smoothscroll badge badge-primary text-capitalize" href="/tags#rails">rails</a>               
                    
    <a class="smoothscroll badge badge-primary text-capitalize" href="/tags#ruby">ruby</a>               
    

    </div>

    
    
    
    <div class="blog-grid-container">
        
        
            
            
        
            
        
            
            <!-- begin post -->


<div class="blog-grid-item">
    <div class="card h-100">
        <div class="maxthumb">
            <a href="/2021/04/hotwire-reactive-rails-with-no-javascript/">
                

                    
                        <img class="img-thumb lazyimg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAACCAQAAAA3fa6RAAAADklEQVR42mNkAANGCAUAACMAA2w/AMgAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/xfyuan/ossimgs@master/uPic/IMG_20210220_121324.jpg" alt="Hotwire: æ²¡æœ‰JavaScriptçš„Reactive Rails">
                    

                
            </a>
        </div>
        <div class="card-body">
            <h2 class="card-title">
                <a class="text-dark" href="/2021/04/hotwire-reactive-rails-with-no-javascript/">Hotwire: æ²¡æœ‰JavaScriptçš„Reactive Rails</a>
                
                <div class="mb-2 mt-2 font-weight-normal">
                <div class="rating-holder">
<div class="c-rating c-rating--regular" data-rating-value="5">
  <button>1</button>
  <button>2</button>
  <button>3</button>
  <button>4</button>
  <button>5</button>
</div>
</div>
                </div>
                
            </h2>
            <h4 class="card-text">æœ¬æ–‡å·²è·å¾—åŸä½œè€…ï¼ˆVladimir Dementyevï¼‰å’Œ Evil Martians æˆæƒè®¸å¯è¿›è¡Œç¿»è¯‘ã€‚åŸæ–‡ä»‹ç»äº† Rails çš„æœ€æ–°â€œé­”æ³•â€ï¼šHotwireã€‚è¿™ä¹Ÿæ˜¯ Vladimir Dementyev åœ¨ RailsConf 2021 ä¸Šçš„æ¼”è®²å†…å®¹ã€‚
</h4>
        </div>
        <div class="card-footer bg-white">
            <div class="wrapfooter">
                
                <span class="meta-footer-thumb">
                
                <img class="author-thumb" src="/assets/images/avatar.png" alt="Mr.Z">
                
                </span>
                <span class="author-meta">
                <span class="post-name"><a target="_blank" href="https://xfyuan.github.io">Mr.Z</a></span> 
                
                <span class="post-date">24 Apr 2021</span>
                </span>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>
</div>
<!-- end post -->
            
            
            
        
        
        
            
            
        
            
        
            
            <!-- begin post -->


<div class="blog-grid-item">
    <div class="card h-100">
        <div class="maxthumb">
            <a href="/2021/04/the-foundation-of-how-tailwindcss-works/">
                

                    
                        <img class="img-thumb lazyimg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAACCAQAAAA3fa6RAAAADklEQVR42mNkAANGCAUAACMAA2w/AMgAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/xfyuan/ossimgs@master/uPic/IMG_20210220_115551.jpg" alt="Tailwindcssåº•å±‚åŸºçŸ³çš„ç†å¿µ">
                    

                
            </a>
        </div>
        <div class="card-body">
            <h2 class="card-title">
                <a class="text-dark" href="/2021/04/the-foundation-of-how-tailwindcss-works/">Tailwindcssåº•å±‚åŸºçŸ³çš„ç†å¿µ</a>
                
            </h2>
            <h4 class="card-text">Tailwindcss ä» 2019 å¹´å¼€å§‹é€æ¸åœ¨å›½å¤–çš„ Web å¼€å‘åœˆå­å†…ç››è¡Œèµ·æ¥ã€‚å›½å†…å€’æ˜¯è‡³ä»Šä»ç„¶ä¸æ¸©ä¸ç«ã€‚2020 å¹´çš„ Ruby China ä¸Šè¿‡çº¯ä¸­åšè¿‡ä¸€æ¬¡åœ¨é¡¹ç›®ä¸Šä½¿ç”¨ tailwindcss ä½“éªŒçš„æœ‰å…³æ¼”è®²ã€‚æˆ‘åœ¨ 2020 å¹´ä¹Ÿå†™è¿‡ä¸€ç¯‡æœ‰å…³çš„åšå®¢â€œåœ¨ Rails 6 ä¸­æ•´åˆ Stimulus å’Œ Tailwind CSSâ€ï¼ˆè¢«å‰è€…åœ¨æ¼”è®²ä¸­æ‰€å¼•ç”¨^_^ï¼‰ã€‚
</h4>
        </div>
        <div class="card-footer bg-white">
            <div class="wrapfooter">
                
                <span class="meta-footer-thumb">
                
                <img class="author-thumb" src="/assets/images/avatar.png" alt="Mr.Z">
                
                </span>
                <span class="author-meta">
                <span class="post-name"><a target="_blank" href="https://xfyuan.github.io">Mr.Z</a></span> 
                
                <span class="post-date">10 Apr 2021</span>
                </span>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>
</div>
<!-- end post -->
            
            
            
        
        
        
            
            
        
            
        
            
            <!-- begin post -->


<div class="blog-grid-item">
    <div class="card h-100">
        <div class="maxthumb">
            <a href="/2021/03/hotwire-build-turbo-application/">
                

                    
                        <img class="img-thumb lazyimg" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAACCAQAAAA3fa6RAAAADklEQVR42mNkAANGCAUAACMAA2w/AMgAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/xfyuan/ossimgs@master/uPic/IMG_20210220_133340.jpg" alt="Hotwireä¹‹æ„å»ºTurboåº”ç”¨">
                    

                
            </a>
        </div>
        <div class="card-body">
            <h2 class="card-title">
                <a class="text-dark" href="/2021/03/hotwire-build-turbo-application/">Hotwireä¹‹æ„å»ºTurboåº”ç”¨</a>
                
            </h2>
            <h4 class="card-text">æœ¬æ–‡æ˜¯å¯¹æ„å»º Turbo åº”ç”¨çš„å…·ä½“æè¿°ï¼ŒåŸæ–‡å‡ºè‡ªï¼šhttps://turbo.hotwire.dev/handbook/buildingã€‚
</h4>
        </div>
        <div class="card-footer bg-white">
            <div class="wrapfooter">
                
                <span class="meta-footer-thumb">
                
                <img class="author-thumb" src="/assets/images/avatar.png" alt="Mr.Z">
                
                </span>
                <span class="author-meta">
                <span class="post-name"><a target="_blank" href="https://xfyuan.github.io">Mr.Z</a></span> 
                
                <span class="post-date">26 Mar 2021</span>
                </span>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>
</div>
<!-- end post -->
            
            
                
        </div>        
</div>

<!-- Review with LD-JSON, adapt it for your needs if you like, but make sure you test the generated HTML source code first: 
https://search.google.com/structured-data/testing-tool/u/0/
================================================== -->

    </div>

    

</div>

<!-- Begin Footer
================================================== -->
<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-12 text-center text-lg-left">
                Copyright Â© 2021 The Tragedy of XY
            </div>
            <div class="col-md-6 col-sm-12 text-center text-lg-right">
                <a target="_blank" href="https://www.wowthemes.net/memoirs-free-jekyll-theme/">Memoirs Jekyll Theme</a>
            </div>
        </div>
    </div>
</footer>
<!-- End Footer
================================================== -->

</div> <!-- /.site-content -->

<!-- Scripts (if you need bootstrap.js, please add it yourself. I didn't use it for performance reasons, it was not needed in this theme)
================================================== -->

<script src="/assets/js/prism.js"></script>

<script src="/assets/js/theme.js"></script>


<script src="/assets/js/lazyload.js"></script>



<script id="dsq-count-scr" src="//xfyuan.disqus.com/count.js"></script>


</body>
</html>
